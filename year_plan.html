<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <script src="config.js"></script>
    
    <!-- Firebase配置 -->
    <script src="firebase-config.js"></script>
    
    <!-- 同步修复工具 -->
    <script src="sync-fix.js"></script>
    
    <!-- Firebase数据库同步 -->
    <script src="firebase-database-sync.js"></script>
    <script src="gemini-ai-assistant.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>年计划 - 智能计划管理系统</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="ai-assistant-styles.css">
</head>

<body>
    <div class="container">
        <!-- 页面头部 -->
        <div class="page-header">
            <a href="index.html" class="back-to-home">← 返回主页</a>
            <h1 class="page-title">🚀 年计划管理</h1>
            <div style="display: flex; gap: 8px;">
                <a href="quarter_plan.html" class="btn-main" style="font-size: 0.9em;">季度计划</a>
                <a href="halfyear_plan.html" class="btn-main" style="font-size: 0.9em;">半年计划</a>
            </div>
        </div>

        <!-- 智能控制栏 -->
        <div class="plan-smartbar">
            <button type="button" class="ai-assistant-btn">🤖 AI助手</button>
            
            <div class="progress-bar" style="flex: 1;">
                <div style="background:#eee;border-radius:8px;height:18px;overflow:hidden;">
                    <div id="year-progress-inner" class="progress-inner" style="width: 0%;"></div>
                </div>
                <div style="font-size:0.9em;color:#666;margin-top:3px;">
                    <span id="year-progress-text">本年进度 0%</span>
                </div>
            </div>
            
            <button type="button" id="year-prev">←</button>
            <input type="number" id="year_input" min="2020" max="2050" style="width:80px;padding:4px;text-align:center;">
            <span id="year_display" style="font-weight: 600; color: var(--theme-color); padding: 4px 8px;"></span>
            <button type="button" id="year-next">→</button>
        </div>

        <!-- 操作栏 -->
        <div class="save-bar">
            <button type="button" id="template-btn" class="btn-main" style="background: #ff9800 !important; color: white !important; font-weight: bold !important; border: 2px solid #f57c00 !important;">📋 使用模板</button>
            <button type="button" class="save-btn" data-type="year">💾 保存计划</button>
            <button type="button" class="save-view-btn" data-type="year">📚 历史记录</button>
            <button type="button" id="year-summary-btn">📊 年度总结</button>
        </div>

        <!-- 年度愿景 -->
        <div class="plan-item-header">
            <label>🌟 年度愿景与使命</label>
        </div>
        <textarea id="year_vision" placeholder="描述您的年度愿景和使命...

例如：
• 在专业领域取得重大突破
• 建立更健康的生活方式
• 深化重要的人际关系
• 探索新的兴趣和可能性
• 为社会创造有意义的价值" style="min-height: 120px;"></textarea>

        <!-- 核心价值观 -->
        <div class="plan-item-header">
            <label>💎 核心价值观</label>
        </div>
        <textarea id="year_values" placeholder="明确您的核心价值观...

例如：
• 诚信正直，言行一致
• 持续学习，追求卓越
• 平衡发展，身心健康
• 关爱他人，回馈社会
• 创新思维，勇于突破" style="min-height: 100px;"></textarea>

        <!-- 年度目标 -->
        <div class="plan-item-header">
            <label>🎯 年度核心目标</label>
        </div>
        <div id="year_goals" class="todo-list-container" data-placeholder="[ ] 设定本年度的核心目标..."></div>

        <!-- 人生领域规划 -->
        <div class="plan-item-header">
            <label>📋 人生领域规划</label>
        </div>
        
        <!-- 领域网格 -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
            <!-- 事业发展 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #2196f3;">
                <h4 style="margin: 0 0 12px 0; color: #2196f3; display: flex; align-items: center; gap: 8px;">
                    💼 事业发展
                </h4>
                <div id="career_goals" class="todo-list-container" data-placeholder="[ ] 事业发展目标..." style="min-height: 100px;"></div>
            </div>

            <!-- 健康生活 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #4caf50;">
                <h4 style="margin: 0 0 12px 0; color: #4caf50; display: flex; align-items: center; gap: 8px;">
                    🏃 健康生活
                </h4>
                <div id="health_goals" class="todo-list-container" data-placeholder="[ ] 健康生活目标..." style="min-height: 100px;"></div>
            </div>

            <!-- 学习成长 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #ff9800;">
                <h4 style="margin: 0 0 12px 0; color: #ff9800; display: flex; align-items: center; gap: 8px;">
                    📚 学习成长
                </h4>
                <div id="learning_goals" class="todo-list-container" data-placeholder="[ ] 学习成长目标..." style="min-height: 100px;"></div>
            </div>

            <!-- 人际关系 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #e91e63;">
                <h4 style="margin: 0 0 12px 0; color: #e91e63; display: flex; align-items: center; gap: 8px;">
                    👥 人际关系
                </h4>
                <div id="relationship_goals" class="todo-list-container" data-placeholder="[ ] 人际关系目标..." style="min-height: 100px;"></div>
            </div>

            <!-- 财务管理 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #9c27b0;">
                <h4 style="margin: 0 0 12px 0; color: #9c27b0; display: flex; align-items: center; gap: 8px;">
                    💰 财务管理
                </h4>
                <div id="finance_goals" class="todo-list-container" data-placeholder="[ ] 财务管理目标..." style="min-height: 100px;"></div>
            </div>

            <!-- 兴趣爱好 -->
            <div style="background: rgba(255,255,255,0.9); border-radius: 12px; padding: 16px; border-left: 4px solid #00bcd4;">
                <h4 style="margin: 0 0 12px 0; color: #00bcd4; display: flex; align-items: center; gap: 8px;">
                    🎨 兴趣爱好
                </h4>
                <div id="hobby_goals" class="todo-list-container" data-placeholder="[ ] 兴趣爱好目标..." style="min-height: 100px;"></div>
            </div>
        </div>

        <!-- 年度回顾 -->
        <div class="plan-item-header">
            <label>📝 年度回顾与反思</label>
            <button type="button" id="review-template-btn" class="btn-main" style="background: #9c27b0 !important; color: white !important; font-size: 0.85em; padding: 4px 8px;">📋 回顾模板</button>
        </div>
        <textarea id="year_review" placeholder="年度回顾与反思...

回顾内容：
• 本年度最重要的成就和突破
• 遇到的挑战和克服的困难
• 个人成长和能力提升
• 重要的学习和体验
• 对未来的展望和规划" style="min-height: 150px;"></textarea>
    </div>

    <script src="common.js"></script>
    <script>
        // 年计划简化实现
        let currentYear = new Date().getFullYear();

        document.addEventListener('DOMContentLoaded', function() {
            initYearPlan();
        });

        function initYearPlan() {
            document.getElementById('year_input').value = currentYear;
            document.getElementById('year_display').textContent = `${currentYear}年`;
            
            // 启用待办事项功能
            const containers = document.querySelectorAll('.todo-list-container');
            containers.forEach(container => {
                TodoUtils.enableTodoFunctionality(container);
            });
            
            // 设置事件监听器
            document.getElementById('year-prev').addEventListener('click', () => navigateYear(-1));
            document.getElementById('year-next').addEventListener('click', () => navigateYear(1));
            document.getElementById('year_input').addEventListener('change', handleYearChange);
            document.querySelector('.save-btn').addEventListener('click', saveYearPlan);
            document.querySelector('.save-view-btn').addEventListener('click', showYearHistory);
            document.getElementById('year-summary-btn').addEventListener('click', generateYearSummary);
            const templateBtn = document.getElementById('template-btn');
            if (templateBtn) {
                console.log('年计划模板按钮找到，绑定事件监听器');
                templateBtn.addEventListener('click', showYearTemplateSelector);
                // 让按钮更明显
                templateBtn.style.cssText += 'display: inline-block !important; visibility: visible !important;';
            } else {
                console.error('年计划模板按钮未找到！');
                // 如果按钮不存在，创建一个
                const saveBar = document.querySelector('.save-bar');
                if (saveBar) {
                    const newBtn = document.createElement('button');
                    newBtn.type = 'button';
                    newBtn.id = 'template-btn';
                    newBtn.className = 'btn-main';
                    newBtn.style.cssText = 'background: #ff9800 !important; color: white !important; font-weight: bold !important; border: 2px solid #f57c00 !important;';
                    newBtn.innerHTML = '📋 使用模板';
                    newBtn.addEventListener('click', showYearTemplateSelector);
                    saveBar.insertBefore(newBtn, saveBar.firstChild);
                    console.log('动态创建了模板按钮');
                }
            }
            
            // 绑定回顾模板按钮
            const reviewTemplateBtn = document.getElementById('review-template-btn');
            if (reviewTemplateBtn) {
                reviewTemplateBtn.addEventListener('click', showYearReviewTemplateSelector);
                console.log('年度回顾模板按钮已绑定');
            }
            
            loadYearPlan();
            updateProgress();
        }

        function navigateYear(years) {
            currentYear += years;
            document.getElementById('year_input').value = currentYear;
            document.getElementById('year_display').textContent = `${currentYear}年`;
            loadYearPlan();
            updateProgress();
        }

        function handleYearChange() {
            currentYear = parseInt(document.getElementById('year_input').value);
            document.getElementById('year_display').textContent = `${currentYear}年`;
            loadYearPlan();
            updateProgress();
        }

        function saveYearPlan() {
            const data = {
                vision: document.getElementById('year_vision').value,
                values: document.getElementById('year_values').value,
                goals: getTodoContent('year_goals'),
                careerGoals: getTodoContent('career_goals'),
                healthGoals: getTodoContent('health_goals'),
                learningGoals: getTodoContent('learning_goals'),
                relationshipGoals: getTodoContent('relationship_goals'),
                financeGoals: getTodoContent('finance_goals'),
                hobbyGoals: getTodoContent('hobby_goals'),
                review: document.getElementById('year_review').value
            };

            const success = StorageUtils.savePlan('year', currentYear.toString(), data);
            if (success) {
                MessageUtils.success('年计划保存成功！');
            }
        }

        function loadYearPlan() {
            const data = StorageUtils.loadPlan('year', currentYear.toString());
            if (data) {
                document.getElementById('year_vision').value = data.vision || '';
                document.getElementById('year_values').value = data.values || '';
                document.getElementById('year_review').value = data.review || '';
                
                // 加载各领域目标
                loadTodoContent('year_goals', data.goals);
                loadTodoContent('career_goals', data.careerGoals);
                loadTodoContent('health_goals', data.healthGoals);
                loadTodoContent('learning_goals', data.learningGoals);
                loadTodoContent('relationship_goals', data.relationshipGoals);
                loadTodoContent('finance_goals', data.financeGoals);
                loadTodoContent('hobby_goals', data.hobbyGoals);
            } else {
                clearFields();
            }
        }

        function clearFields() {
            document.getElementById('year_vision').value = '';
            document.getElementById('year_values').value = '';
            document.getElementById('year_review').value = '';
            
            const containers = ['year_goals', 'career_goals', 'health_goals', 'learning_goals', 'relationship_goals', 'finance_goals', 'hobby_goals'];
            containers.forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
        }

        function loadTodoContent(containerId, content) {
            const container = document.getElementById(containerId);
            if (container && content) {
                container.textContent = content;
                TodoUtils.renderTodos(container);
            }
        }

        function getTodoContent(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return '';
            
            const tasks = container.querySelectorAll('.task-item');
            const lines = [];
            
            tasks.forEach(task => {
                const checkbox = task.querySelector('.custom-checkbox');
                const text = task.querySelector('.task-text').textContent;
                const isChecked = checkbox.classList.contains('checked');
                lines.push(`[${isChecked ? 'x' : ' '}] ${text}`);
            });
            
            return lines.join('\n');
        }

        function updateProgress() {
            const progress = ProgressUtils.calculateYearProgress();
            document.getElementById('year-progress-inner').style.width = `${progress}%`;
            document.getElementById('year-progress-text').textContent = `本年进度 ${progress}%`;
        }

        function showYearHistory() {
            MessageUtils.info('年计划历史记录功能正在开发中...');
        }

        function generateYearSummary() {
            const vision = document.getElementById('year_vision').value;
            const values = document.getElementById('year_values').value;
            const review = document.getElementById('year_review').value;
            
            const content = `
                <h3 style="color: var(--theme-color); margin-bottom: 16px;">📊 ${currentYear}年度总结</h3>
                
                ${vision ? `
                <div style="background: rgba(25,118,210,0.05); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: var(--theme-color);">🌟 年度愿景</h4>
                    <p style="white-space: pre-line; margin: 0;">${vision}</p>
                </div>
                ` : ''}
                
                ${values ? `
                <div style="background: rgba(76,175,80,0.05); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #4caf50;">💎 核心价值观</h4>
                    <p style="white-space: pre-line; margin: 0;">${values}</p>
                </div>
                ` : ''}
                
                ${review ? `
                <div style="background: rgba(156,39,176,0.05); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #9c27b0;">📝 年度回顾</h4>
                    <p style="white-space: pre-line; margin: 0;">${review}</p>
                </div>
                ` : ''}
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn-main" onclick="exportYearSummary()">导出年度总结</button>
                </div>
            `;
            
            ModalUtils.show('年度总结', content);
        }

        function exportYearSummary() {
            MessageUtils.info('年度总结导出功能正在开发中...');
        }

        // 年计划模板数据
        const yearTemplates = {
            student: {
                name: "🎓 学生成长模板",
                description: "适合学生群体的全面发展规划",
                vision: "成为一名全面发展、具备核心竞争力的优秀学生\n\n• 在学术上取得优异成绩，掌握扎实的专业知识\n• 培养批判性思维和创新能力\n• 建立良好的人际关系网络\n• 发展个人兴趣爱好，保持身心健康\n• 为未来职业发展打下坚实基础",
                values: "• 勤奋刻苦，追求学术卓越\n• 诚实守信，品格端正\n• 开放包容，善于合作\n• 积极进取，勇于创新\n• 感恩回馈，服务社会",
                goals: "[ ] 本年度GPA达到3.8以上\n[ ] 完成一个重要的研究项目或实习\n[ ] 考取相关专业证书或资格认证\n[ ] 参与至少一个学生组织或社团活动",
                careerGoals: "[ ] 明确职业发展方向和目标\n[ ] 完成至少2次实习或实践项目\n[ ] 建立专业导师关系\n[ ] 参加职业规划讲座和招聘会",
                healthGoals: "[ ] 保持规律的作息时间\n[ ] 每周运动3-4次，每次30分钟以上\n[ ] 学习压力管理和情绪调节技巧\n[ ] 定期体检，关注身体健康",
                learningGoals: "[ ] 完成专业核心课程学习\n[ ] 学习一门新的技能或语言\n[ ] 阅读至少12本专业或通识书籍\n[ ] 参加学术会议或专业培训",
                relationshipGoals: "[ ] 维护与家人的良好关系\n[ ] 建立3-5个深度友谊\n[ ] 积极参与团队协作项目\n[ ] 扩展专业人脉网络",
                financeGoals: "[ ] 学习基本的理财知识\n[ ] 制定并执行节约计划\n[ ] 寻找兼职或奖学金机会\n[ ] 为未来深造或就业储备资金",
                hobbyGoals: "[ ] 坚持一项体育运动\n[ ] 培养一个艺术类兴趣爱好\n[ ] 参加志愿服务活动\n[ ] 记录成长经历和感悟",
                review: ""
            },
            professional: {
                name: "💼 职场精英模板",
                description: "适合职场人士的事业发展规划",
                vision: "成为行业内具有影响力的专业人士\n\n• 在专业领域达到专家级水平\n• 承担更大的责任和挑战性项目\n• 建立强大的行业人脉网络\n• 实现工作与生活的平衡\n• 为团队和组织创造显著价值",
                values: "• 专业精进，追求卓越\n• 诚信负责，值得信赖\n• 创新思维，拥抱变化\n• 团队合作，共创价值\n• 持续学习，终身成长",
                goals: "[ ] 完成年度业绩目标，获得优秀评价\n[ ] 获得职位晋升或薪资提升\n[ ] 领导一个重要项目并取得成功\n[ ] 在行业内建立个人品牌影响力",
                careerGoals: "[ ] 制定3-5年职业发展规划\n[ ] 获得行业相关认证或资格\n[ ] 参与高层次的行业交流活动\n[ ] 建立个人专业品牌",
                healthGoals: "[ ] 保持工作与生活的平衡\n[ ] 每周坚持运动3次以上\n[ ] 学习压力管理技巧\n[ ] 定期健康检查",
                learningGoals: "[ ] 完成专业技能提升培训\n[ ] 学习新兴技术或管理方法\n[ ] 阅读行业前沿书籍和报告\n[ ] 参加高质量的专业会议",
                relationshipGoals: "[ ] 扩展行业人脉网络\n[ ] 建立导师和被导师关系\n[ ] 加强团队协作能力\n[ ] 平衡家庭和工作关系",
                financeGoals: "[ ] 制定投资理财计划\n[ ] 建立应急资金储备\n[ ] 规划退休和保险计划\n[ ] 增加被动收入来源",
                hobbyGoals: "[ ] 培养一个放松身心的爱好\n[ ] 参与社会公益活动\n[ ] 学习一门新技能\n[ ] 安排家庭旅行和聚会",
                review: ""
            },
            entrepreneur: {
                name: "🚀 创业者模板",
                description: "适合创业者和自由职业者的发展规划",
                vision: "打造成功的事业，实现财务自由和人生价值\n\n• 建立可持续发展的商业模式\n• 在目标市场中占据重要地位\n• 建立高效的团队和合作伙伴关系\n• 实现个人财富和社会价值的双重增长\n• 成为行业内的创新引领者",
                values: "• 创新进取，敢于冒险\n• 客户至上，价值导向\n• 团队协作，共同成长\n• 诚信经营，社会责任\n• 持续改进，追求卓越",
                goals: "[ ] 实现年度营收目标\n[ ] 扩大市场份额和客户基础\n[ ] 完成产品或服务的重大升级\n[ ] 建立稳定的盈利模式",
                careerGoals: "[ ] 制定清晰的商业发展战略\n[ ] 建立核心竞争优势\n[ ] 扩展业务范围或市场\n[ ] 建立行业合作伙伴关系",
                healthGoals: "[ ] 管理创业压力和焦虑\n[ ] 保持规律的作息和运动\n[ ] 学习时间管理技巧\n[ ] 建立支持系统和社交网络",
                learningGoals: "[ ] 学习商业管理和领导力\n[ ] 了解行业趋势和新技术\n[ ] 提升财务管理能力\n[ ] 学习营销和品牌建设",
                relationshipGoals: "[ ] 建立投资人和顾问关系\n[ ] 扩展商业人脉网络\n[ ] 培养核心团队成员\n[ ] 维护重要客户关系",
                financeGoals: "[ ] 制定详细的财务规划\n[ ] 寻找投资和融资机会\n[ ] 建立多元化收入流\n[ ] 规划税务优化策略",
                hobbyGoals: "[ ] 保持创新思维的兴趣爱好\n[ ] 参与创业社区活动\n[ ] 学习新的技能或知识\n[ ] 安排放松和充电时间",
                review: ""
            },
            family: {
                name: "👨‍👩‍👧‍👦 家庭幸福模板",
                description: "注重家庭和生活平衡的全面规划",
                vision: "创造温馨和谐的家庭生活，实现个人与家庭的共同成长\n\n• 建立稳固的家庭关系和价值观\n• 为家庭成员提供良好的生活条件\n• 培养孩子的全面发展和品格\n• 保持夫妻关系的和谐与成长\n• 实现工作与家庭生活的平衡",
                values: "• 家庭第一，关爱至上\n• 相互尊重，包容理解\n• 责任担当，共同成长\n• 诚实守信，以身作则\n• 感恩知足，传递爱心",
                goals: "[ ] 改善家庭生活质量和条件\n[ ] 加强家庭成员之间的沟通\n[ ] 为孩子教育做好规划和准备\n[ ] 实现工作与家庭的平衡",
                careerGoals: "[ ] 在稳定收入的基础上寻求发展\n[ ] 提升工作效率，减少加班\n[ ] 寻找更好的工作机会\n[ ] 发展副业或被动收入",
                healthGoals: "[ ] 全家人保持健康的生活方式\n[ ] 定期家庭体检和健康管理\n[ ] 培养家庭运动习惯\n[ ] 学习急救和健康知识",
                learningGoals: "[ ] 学习育儿和家庭教育知识\n[ ] 提升职业技能和竞争力\n[ ] 学习理财和投资知识\n[ ] 培养新的兴趣爱好",
                relationshipGoals: "[ ] 加强夫妻关系和沟通\n[ ] 与孩子建立良好的亲子关系\n[ ] 维护与双方父母的关系\n[ ] 扩展家庭社交圈",
                financeGoals: "[ ] 制定家庭理财计划\n[ ] 建立教育基金和应急基金\n[ ] 规划房产和保险计划\n[ ] 优化家庭开支结构",
                hobbyGoals: "[ ] 培养家庭共同兴趣爱好\n[ ] 安排定期的家庭旅行\n[ ] 参与社区和学校活动\n[ ] 记录家庭成长历程",
                review: ""
            },
            health: {
                name: "🏃‍♂️ 健康生活模板",
                description: "专注于身心健康的全面生活规划",
                vision: "拥有健康的身体和积极的心态，享受高质量的生活\n\n• 建立科学的健康生活方式\n• 保持理想的身体状态和体能\n• 培养积极乐观的心理素质\n• 预防疾病，延长健康寿命\n• 成为身边人健康生活的榜样",
                values: "• 健康第一，预防为主\n• 科学理性，循序渐进\n• 持之以恒，自律自强\n• 身心并重，全面发展\n• 分享传播，帮助他人",
                goals: "[ ] 达到理想的身体状态和体重\n[ ] 建立稳定的运动习惯\n[ ] 改善睡眠质量和作息规律\n[ ] 学习健康知识和技能",
                careerGoals: "[ ] 选择有利于健康的工作环境\n[ ] 在工作中保持良好的身心状态\n[ ] 学习健康相关的专业知识\n[ ] 平衡工作压力和健康需求",
                healthGoals: "[ ] 制定个性化的运动计划\n[ ] 建立科学的饮食习惯\n[ ] 定期体检和健康监测\n[ ] 学习压力管理和放松技巧",
                learningGoals: "[ ] 学习营养学和运动科学\n[ ] 了解疾病预防知识\n[ ] 学习心理健康维护方法\n[ ] 掌握急救和自我保健技能",
                relationshipGoals: "[ ] 影响家人朋友关注健康\n[ ] 加入健康生活社群\n[ ] 寻找运动伙伴和健康导师\n[ ] 参与健康公益活动",
                financeGoals: "[ ] 合理规划健康投资预算\n[ ] 购买合适的健康保险\n[ ] 投资健康设备和服务\n[ ] 建立健康应急基金",
                hobbyGoals: "[ ] 选择有益健康的兴趣爱好\n[ ] 学习烹饪健康美食\n[ ] 培养户外运动兴趣\n[ ] 练习冥想或瑜伽",
                review: ""
            },
            creative: {
                name: "🎨 创意生活模板",
                description: "追求创意和艺术的个性化生活规划",
                vision: "用创意点亮生活，通过艺术表达实现自我价值\n\n• 在创意领域建立个人特色和风格\n• 通过创作获得精神满足和经济收益\n• 建立创意社区和合作网络\n• 保持对美和创新的敏感度\n• 用创意作品影响和启发他人",
                values: "• 创新思维，独特表达\n• 美学追求，品质生活\n• 开放包容，多元文化\n• 持续探索，勇于实验\n• 分享创造，启发他人",
                goals: "[ ] 完成一个重要的创意作品或项目\n[ ] 建立个人创意品牌和作品集\n[ ] 参与创意比赛或展览活动\n[ ] 通过创意获得收入或认可",
                careerGoals: "[ ] 在创意行业建立职业地位\n[ ] 发展多元化的创意技能\n[ ] 建立创意合作伙伴关系\n[ ] 探索创意变现的途径",
                healthGoals: "[ ] 保护创作相关的身体健康\n[ ] 管理创作压力和情绪波动\n[ ] 培养放松和充电的习惯\n[ ] 保持创作灵感和动力",
                learningGoals: "[ ] 学习新的创作技法和工具\n[ ] 了解创意行业趋势和机会\n[ ] 提升审美能力和文化素养\n[ ] 学习创意项目管理",
                relationshipGoals: "[ ] 建立创意社群和艺术圈人脉\n[ ] 寻找创作导师和合作伙伴\n[ ] 参与创意交流和分享活动\n[ ] 影响身边人关注美和创意",
                financeGoals: "[ ] 规划创意项目的资金需求\n[ ] 探索创意作品的商业价值\n[ ] 建立多元化收入来源\n[ ] 投资创作设备和学习资源",
                hobbyGoals: "[ ] 探索不同的艺术形式\n[ ] 收集和欣赏优秀作品\n[ ] 参加创意工作坊和活动\n[ ] 记录创作过程和心得",
                review: ""
            }
        };

        // 显示年计划模板选择器
        function showYearTemplateSelector() {
            console.log('年计划模板选择器被调用');
            console.log('可用模板:', Object.keys(yearTemplates));
            const templateList = Object.keys(yearTemplates).map(key => {
                const template = yearTemplates[key];
                return `
                    <div class="template-card" onclick="selectYearTemplate('${key}')" style="
                        border: 2px solid #e0e0e0;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        background: white;
                    " onmouseover="this.style.borderColor='var(--theme-color)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.borderColor='#e0e0e0'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <h4 style="margin: 0 0 8px 0; color: var(--theme-color); font-size: 1.1em;">${template.name}</h4>
                        <p style="margin: 0; color: #666; font-size: 0.9em; line-height: 1.4;">${template.description}</p>
                    </div>
                `;
            }).join('');

            const content = `
                <div style="max-height: 500px; overflow-y: auto;">
                    <p style="margin-bottom: 20px; color: #666; text-align: center;">选择一个适合您的年计划模板，快速开始制定计划</p>
                    ${templateList}
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <button class="btn-main" onclick="ModalUtils.hide(document.querySelector('.modal-mask'))" style="background: #666;">取消</button>
                    </div>
                </div>
            `;

            ModalUtils.show('选择年计划模板', content, 'large');
        }

        // 选择并应用年计划模板
        function selectYearTemplate(templateKey) {
            const template = yearTemplates[templateKey];
            if (!template) {
                MessageUtils.error('模板不存在！');
                return;
            }

            // 确认对话框
            const confirmContent = `
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 3em; margin-bottom: 16px;">⚠️</div>
                    <h3 style="margin: 0 0 16px 0; color: #f44336;">确认应用模板</h3>
                    <p style="margin-bottom: 20px; color: #666; line-height: 1.6;">
                        应用模板 <strong style="color: var(--theme-color);">${template.name}</strong> 将会覆盖当前页面的所有内容。
                        <br>请确保您已经保存了重要的内容。
                    </p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn-main" onclick="applyYearTemplate('${templateKey}')" style="background: #f44336;">确认应用</button>
                        <button class="btn-main" onclick="ModalUtils.hide(document.querySelector('.modal-mask'))" style="background: #666;">取消</button>
                    </div>
                </div>
            `;

            ModalUtils.show('确认应用模板', confirmContent, 'medium');
        }

        // 应用年计划模板到页面
        function applyYearTemplate(templateKey) {
            const template = yearTemplates[templateKey];
            if (!template) return;

            // 关闭模态框
            const modal = document.querySelector('.modal-mask');
            if (modal) ModalUtils.hide(modal);

            // 应用模板内容
            document.getElementById('year_vision').value = template.vision;
            document.getElementById('year_values').value = template.values;
            document.getElementById('year_review').value = template.review;

            // 应用各领域目标
            applyYearTemplateToTodoContainer('year_goals', template.goals);
            applyYearTemplateToTodoContainer('career_goals', template.careerGoals);
            applyYearTemplateToTodoContainer('health_goals', template.healthGoals);
            applyYearTemplateToTodoContainer('learning_goals', template.learningGoals);
            applyYearTemplateToTodoContainer('relationship_goals', template.relationshipGoals);
            applyYearTemplateToTodoContainer('finance_goals', template.financeGoals);
            applyYearTemplateToTodoContainer('hobby_goals', template.hobbyGoals);

            // 显示成功消息
            MessageUtils.success(`已成功应用模板：${template.name}`);

            // 自动保存
            setTimeout(() => {
                saveYearPlan();
            }, 500);
        }

        // 将年计划模板内容应用到待办事项容器
        function applyYearTemplateToTodoContainer(containerId, content) {
            const container = document.getElementById(containerId);
            if (container && content) {
                container.textContent = content;
                TodoUtils.renderTodos(container);
            }
        }

        // 年度回顾模板数据
        const yearReviewTemplates = {
            comprehensive: {
                name: "📊 全面回顾模板",
                description: "涵盖成就、挑战、成长、学习的完整年度回顾",
                content: `🎯 **年度目标达成情况**

目标完成度评估：
• 目标1: [完成度%] - [具体描述完成情况和成果]
• 目标2: [完成度%] - [具体描述完成情况和成果]
• 目标3: [完成度%] - [具体描述完成情况和成果]

🏆 **本年度最重要的成就和突破**

职业/学业成就：
• [列出在工作或学习中取得的重要成就]
• [描述获得的认可、奖项或晋升]
• [记录完成的重要项目或里程碑]

个人发展突破：
• [记录技能提升和能力发展]
• [描述克服的个人局限或恐惧]
• [列出建立的新习惯或改变的行为]

🤔 **遇到的挑战和克服的困难**

主要挑战：
• [描述本年度遇到的最大挑战]
• [分析挑战产生的原因和背景]

解决方案和应对策略：
• [记录采用的解决方法和策略]
• [总结从挑战中学到的经验教训]
• [评估解决效果和改进空间]

📈 **个人成长和能力提升**

技能发展：
• [列出掌握的新技能或知识]
• [描述专业能力的提升情况]
• [记录获得的认证或资格]

思维和认知成长：
• [反思思维方式的转变]
• [记录价值观或人生观的演进]
• [总结对自己更深入的认识]

🌟 **重要的学习和体验**

有意义的经历：
• [记录本年度最有意义的经历]
• [描述印象深刻的旅行、活动或事件]
• [总结参与的重要项目或合作]

学习收获：
• [列出阅读的重要书籍和收获]
• [记录参加的课程、培训或会议]
• [总结从他人身上学到的东西]

🔮 **对未来的展望和规划**

下一年度重点方向：
• [明确下一年的主要目标和方向]
• [规划需要重点发展的领域]
• [设定具体的成长计划]

长远愿景：
• [描述3-5年的长远目标]
• [明确人生重要里程碑的规划]
• [表达对未来生活的期待和愿景]`
            },
            simple: {
                name: "✨ 简洁回顾模板",
                description: "简洁明了的年度回顾，适合快速总结",
                content: `📅 ${new Date().getFullYear()}年度回顾

🏆 **主要成就**
• [最重要的3-5个成就]

💪 **克服的挑战**
• [面对并解决的主要困难]

📚 **重要学习**
• [获得的新知识或技能]

🌱 **个人成长**
• [性格、思维或能力的提升]

🎯 **下年计划**
• [明年的重点目标和方向]`
            },
            gratitude: {
                name: "🙏 感恩回顾模板",
                description: "以感恩的心态回顾年度收获和成长",
                content: `🙏 ${new Date().getFullYear()}年度感恩回顾

💝 **感恩的人**
• 家人朋友: [感谢家人朋友的支持和陪伴]
• 导师同事: [感谢工作学习中给予帮助的人]
• 意外遇见: [感谢今年遇到的重要的人]

🎁 **感恩的事**
• 重要机会: [感谢获得的机会和平台]
• 美好经历: [感谢难忘的经历和体验]
• 意外收获: [感谢意想不到的收获和惊喜]

🌟 **感恩的成长**
• 能力提升: [感谢自己的努力和进步]
• 心智成熟: [感谢经历带来的智慧]
• 品格塑造: [感谢困难磨练出的品质]

🌈 **感恩的感悟**
• 人生感悟: [今年最深刻的人生体会]
• 价值认知: [对重要价值的新认识]
• 生活态度: [对生活态度的积极转变]

🔮 **带着感恩前行**
• [用感恩的心态规划未来]
• [继续珍惜和感恩的决心]`
            },
            professional: {
                name: "💼 职业发展回顾",
                description: "专注于职业成长和工作成就的回顾",
                content: `💼 ${new Date().getFullYear()}年度职业发展回顾

🎯 **工作目标达成**
• 年度KPI完成情况: [具体数据和完成度]
• 重要项目成果: [主导或参与的重要项目]
• 业绩表现评估: [工作表现和上级评价]

🚀 **职业成就突破**
• 职位晋升或角色变化: [职业发展的重要节点]
• 专业技能提升: [掌握的新技能或工具]
• 行业认知深化: [对行业的理解和洞察]

🤝 **团队协作与领导力**
• 团队合作表现: [在团队中的贡献和作用]
• 领导力发展: [管理和领导能力的提升]
• 人际网络建设: [建立的重要职业关系]

📈 **学习成长记录**
• 专业培训参与: [参加的培训、会议、课程]
• 知识技能更新: [学习的新知识和技能]
• 行业趋势把握: [对行业发展的理解]

💡 **工作挑战与解决**
• 遇到的主要挑战: [工作中的困难和问题]
• 解决方案和策略: [采用的方法和策略]
• 经验教训总结: [从挑战中获得的成长]

🔮 **职业发展规划**
• 短期目标(1年): [明年的职业发展目标]
• 中期规划(3-5年): [职业发展的中期规划]
• 能力提升计划: [需要重点发展的能力]`
            },
            personal: {
                name: "🌱 个人成长回顾",
                description: "专注于个人发展和生活品质的回顾",
                content: `🌱 ${new Date().getFullYear()}年度个人成长回顾

🎯 **生活目标实现**
• 健康目标: [运动、饮食、作息的改善情况]
• 学习目标: [个人兴趣学习和技能发展]
• 关系目标: [家庭、友谊关系的维护和发展]

💪 **个人习惯建立**
• 建立的好习惯: [今年养成的积极习惯]
• 改变的坏习惯: [成功改掉的不良习惯]
• 习惯坚持情况: [习惯养成的效果评估]

🧠 **思维认知升级**
• 思维模式转变: [思考方式的积极改变]
• 价值观澄清: [对重要价值的认识深化]
• 自我认知提升: [对自己更准确的认识]

❤️ **情感关系发展**
• 家庭关系: [与家人关系的变化和改善]
• 友谊维护: [朋友关系的深化和拓展]
• 社交能力: [社交技能和人际交往的提升]

🎨 **兴趣爱好发展**
• 培养的新兴趣: [今年开始的新爱好]
• 深化的技能: [在兴趣领域的进步]
• 创意表达: [创造性活动的参与和成果]

🌈 **生活品质提升**
• 生活环境改善: [居住环境的优化]
• 生活方式升级: [生活质量的提升]
• 幸福感变化: [整体生活满意度的改善]

🔮 **未来成长方向**
• 重点发展领域: [明年个人成长的重点]
• 生活目标规划: [生活质量改善的计划]
• 自我实现路径: [个人价值实现的规划]`
            }
        };

        // 显示年度回顾模板选择器
        function showYearReviewTemplateSelector() {
            console.log('年度回顾模板选择器被调用');
            const templateList = Object.keys(yearReviewTemplates).map(key => {
                const template = yearReviewTemplates[key];
                return `
                    <div class="template-card" onclick="selectYearReviewTemplate('${key}')" style="
                        border: 2px solid #e0e0e0;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        background: white;
                    " onmouseover="this.style.borderColor='#9c27b0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.borderColor='#e0e0e0'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                        <h4 style="margin: 0 0 8px 0; color: #9c27b0; font-size: 1.1em;">${template.name}</h4>
                        <p style="margin: 0; color: #666; font-size: 0.9em; line-height: 1.4;">${template.description}</p>
                    </div>
                `;
            }).join('');

            const content = `
                <div style="max-height: 500px; overflow-y: auto;">
                    <p style="margin-bottom: 20px; color: #666; text-align: center;">选择一个年度回顾模板，帮助您系统地总结这一年的收获和成长</p>
                    ${templateList}
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <button class="btn-main" onclick="ModalUtils.hide(document.querySelector('.modal-mask'))" style="background: #666;">取消</button>
                    </div>
                </div>
            `;

            ModalUtils.show('选择年度回顾模板', content, 'large');
        }

        // 选择并应用年度回顾模板
        function selectYearReviewTemplate(templateKey) {
            const template = yearReviewTemplates[templateKey];
            if (!template) {
                MessageUtils.error('模板不存在！');
                return;
            }

            // 确认对话框
            const confirmContent = `
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 3em; margin-bottom: 16px;">📝</div>
                    <h3 style="margin: 0 0 16px 0; color: #9c27b0;">应用回顾模板</h3>
                    <p style="margin-bottom: 20px; color: #666; line-height: 1.6;">
                        应用模板 <strong style="color: #9c27b0;">${template.name}</strong> 将会替换当前的回顾内容。
                        <br>请确保您已经保存了重要的内容。
                    </p>
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button class="btn-main" onclick="applyYearReviewTemplate('${templateKey}')" style="background: #9c27b0;">确认应用</button>
                        <button class="btn-main" onclick="ModalUtils.hide(document.querySelector('.modal-mask'))" style="background: #666;">取消</button>
                    </div>
                </div>
            `;

            ModalUtils.show('确认应用回顾模板', confirmContent, 'medium');
        }

        // 应用年度回顾模板
        function applyYearReviewTemplate(templateKey) {
            const template = yearReviewTemplates[templateKey];
            if (!template) return;

            // 关闭模态框
            const modal = document.querySelector('.modal-mask');
            if (modal) ModalUtils.hide(modal);

            // 应用模板内容到年度回顾文本框
            const reviewTextarea = document.getElementById('year_review');
            if (reviewTextarea) {
                reviewTextarea.value = template.content;
                reviewTextarea.focus();
                // 滚动到回顾部分
                reviewTextarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // 显示成功消息
            MessageUtils.success(`已成功应用回顾模板：${template.name}`);

            // 自动保存
            setTimeout(() => {
                const saveBtn = document.querySelector('.save-btn[data-type="year"]');
                if (saveBtn) saveBtn.click();
            }, 500);
        }
    </script>
    
    <!-- 同步服务 -->
    <script src="sync-service.js"></script>
    <script src="sync-providers.js"></script>
    <!-- 通用自动同步功能 -->
    <script src="universal-auto-sync.js"></script>
    <script src="add-ai-to-all-pages.js"></script>
</body>

</html>

