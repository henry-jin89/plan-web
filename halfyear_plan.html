<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <script src="config.js"></script>
    
    <!-- Firebaseé…ç½® -->
    <script src="firebase-config.js"></script>
    
    <!-- åŒæ­¥ä¿®å¤å·¥å…· -->
    <script src="sync-fix.js"></script>
    
    <!-- Firebaseæ•°æ®åº“åŒæ­¥ -->
    <script src="firebase-database-sync.js"></script>
    <script src="gemini-ai-assistant.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŠå¹´è®¡åˆ’ - æ™ºèƒ½è®¡åˆ’ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="ai-assistant-styles.css">
    <style>
        /* å¢å¼ºè¾“å…¥ç•Œé¢æ ·å¼ */
        .quarter-card {
            transition: all 0.3s ease;
        }
        
        .quarter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12) !important;
        }
        
        .mode-btn {
            transition: all 0.2s ease;
            font-weight: 500;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mode-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .mode-btn.active {
            font-weight: 600;
        }
        
        .quick-add-btn {
            font-weight: 500;
            min-height: 32px;
            border: none !important;
        }
        
        .quick-add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
        }
        
        .template-btn {
            transition: all 0.2s ease;
            font-weight: 500;
            min-height: 32px;
        }
        
        .template-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .template-menu {
            animation: slideDown 0.2s ease;
            border: 1px solid #e0e0e0 !important;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .template-item {
            transition: all 0.15s ease;
        }
        
        .template-item:hover {
            background: #f8f9fa !important;
            color: #333 !important;
        }
        
        .enhanced-input-area {
            transition: all 0.3s ease;
            position: relative;
        }
        
        .enhanced-input-area:hover {
            border-color: #ccc !important;
        }
        
        .enhanced-input-area:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .enhanced-input-area[data-input-mode="outline"] {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        
        .input-hint {
            transition: opacity 0.3s ease;
        }
        
        .input-container:hover .input-hint {
            opacity: 0.5;
        }
        
        /* è¾“å…¥å·¥å…·æ æ ·å¼ */
        .input-toolbar {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #f0f0f0;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .quarter-card {
                padding: 16px !important;
            }
            
            .input-toolbar {
                flex-direction: column;
                gap: 8px !important;
                align-items: stretch !important;
            }
            
            .input-mode-selector {
                justify-content: center;
            }
            
            .template-dropdown {
                width: 100%;
            }
            
            .template-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* å¾…åŠäº‹é¡¹å¢å¼ºæ ·å¼ */
        .task-item {
            transition: all 0.2s ease;
            margin: 4px 0;
            padding: 8px;
            border-radius: 6px;
        }
        
        .task-item:hover {
            background: rgba(0, 0, 0, 0.02);
        }
        
        .custom-checkbox {
            transition: all 0.2s ease;
        }
        
        .custom-checkbox:hover {
            transform: scale(1.1);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-animation {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top: 2px solid #2196f3;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æˆåŠŸåé¦ˆåŠ¨ç”» */
        .success-feedback {
            animation: successPulse 0.6s ease;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* å­£åº¦å¡ç‰‡ç‰¹å®šæ ·å¼ */
        .quarter-card[data-quarter="1"] .enhanced-input-area:focus {
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .quarter-card[data-quarter="2"] .enhanced-input-area:focus {
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }
        
        /* æ™ºèƒ½åˆ†ææŒ‰é’®æ ·å¼ */
        .smart-btn {
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .smart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .smart-btn:active {
            transform: translateY(0);
        }
        
        .growth-btn:hover {
            background: #00695c !important;
        }
        
        .skill-btn:hover {
            background: #1565c0 !important;
        }
        
        .learning-btn:hover {
            background: #2e7d32 !important;
        }
        
        /* æ™ºèƒ½åˆ†æç»„å“åº”å¼ */
        @media (max-width: 768px) {
            .smart-analysis-group {
                margin-left: 0 !important;
                margin-top: 8px;
                flex-wrap: wrap;
            }
            
            .smart-btn {
                font-size: 0.8em !important;
                padding: 4px 12px !important;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <a href="index.html" class="back-to-home">â† è¿”å›ä¸»é¡µ</a>
            <h1 class="page-title">ğŸ“Š åŠå¹´è®¡åˆ’ç®¡ç†</h1>
            <div style="display: flex; gap: 8px;">
                <a href="quarter_plan.html" class="btn-main" style="font-size: 0.9em;">å­£åº¦è®¡åˆ’</a>
                <a href="year_plan.html" class="btn-main" style="font-size: 0.9em;">å¹´è®¡åˆ’</a>
            </div>
        </div>

        <!-- AIæ™ºèƒ½åˆ†æåŒºåŸŸ - æ”¾åœ¨æœ€é¡¶éƒ¨ -->
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px;">
                <div style="flex: 1;">
                    <h3 style="color: white; margin: 0 0 8px 0; font-size: 1.4em; display: flex; align-items: center; gap: 10px;">
                        ğŸ¤– AI æ™ºèƒ½åˆ†æ
                        <span style="font-size: 0.5em; background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px;">Gemini 2.5 Pro</span>
                    </h3>
                    <p style="color: rgba(255,255,255,0.95); margin: 0; font-size: 1em; line-height: 1.6;">
                        è®© AI åˆ†ææ‚¨çš„åŠå¹´è®¡åˆ’ï¼Œæä¾›ä¸“ä¸šå»ºè®®å’Œä¼˜åŒ–æ–¹æ¡ˆ
                    </p>
                </div>
                <button type="button" onclick="startAIAnalysis()" style="background: white; color: #667eea; border: none; padding: 16px 40px; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s ease; white-space: nowrap;">
                    ğŸš€ å¼€å§‹åˆ†æ
                </button>
            </div>
        </div>

        <!-- æ™ºèƒ½æ§åˆ¶æ  -->
        <div class="plan-smartbar">
            <!-- æ™ºèƒ½åˆ†æåŠŸèƒ½ -->
            <div class="smart-analysis-group" style="display: flex; gap: 8px; margin-left: 16px;">
                <button type="button" id="growth-analysis-btn" class="smart-btn growth-btn" style="background: #00897b; color: white; border: none; border-radius: 20px; padding: 6px 16px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">ğŸ“ˆ</span>
                    Growth
                </button>
                
                <button type="button" id="skill-assessment-btn" class="smart-btn skill-btn" style="background: #1976d2; color: white; border: none; border-radius: 20px; padding: 6px 16px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">ğŸ“Š</span>
                    æŠ€èƒ½è¯„ä¼°
                </button>
                
                <button type="button" id="learning-path-btn" class="smart-btn learning-btn" style="background: #388e3c; color: white; border: none; border-radius: 20px; padding: 6px 16px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">ğŸŒ²</span>
                    å­¦ä¹ è·¯å¾„
                </button>
                
                <button type="button" id="balance-analysis-btn" class="smart-btn balance-btn" style="background: #795548; color: white; border: none; border-radius: 20px; padding: 6px 16px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="background: rgba(255,255,255,0.2); border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px;">âš–ï¸</span>
                    å¹³è¡¡åˆ†æ
                </button>
            </div>
            
            <div class="progress-bar" style="flex: 1;">
                <div style="background:#eee;border-radius:8px;height:18px;overflow:hidden;">
                    <div id="halfyear-progress-inner" class="progress-inner" style="width: 0%;"></div>
                </div>
                <div style="font-size:0.9em;color:#666;margin-top:3px;">
                    <span id="halfyear-progress-text">åŠå¹´è¿›åº¦ 0%</span>
                </div>
            </div>
            
            <button type="button" id="halfyear-prev">â†</button>
            <select id="halfyear_select" style="width:100px;padding:4px;">
                <option value="1">ä¸ŠåŠå¹´</option>
                <option value="2">ä¸‹åŠå¹´</option>
            </select>
            <input type="number" id="halfyear_year" min="2020" max="2050" style="width:80px;padding:4px;text-align:center;">
            <button type="button" id="halfyear-next">â†’</button>
        </div>

        <!-- æ“ä½œæ  -->
        <div class="save-bar">
            <button type="button" class="save-btn" data-type="halfyear">ğŸ’¾ ä¿å­˜è®¡åˆ’</button>
            <button type="button" class="save-view-btn" data-type="halfyear">ğŸ“š å†å²è®°å½•</button>
            <button type="button" id="halfyear-analytics-btn">ğŸ“Š åŠå¹´åˆ†æ</button>
            <button type="button" id="strategic-review-btn">ğŸ¯ æˆ˜ç•¥å›é¡¾</button>
        </div>

        <!-- åŠå¹´æ„¿æ™¯ -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                ğŸŒŸ åŠå¹´æ„¿æ™¯ä¸ä¸»é¢˜
                <span style="background: #e3f2fd; color: #1976d2; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Vision</span>
            </label>
        </div>
        <textarea id="halfyear_vision" placeholder="è®¾å®šè¿™åŠå¹´çš„æ„¿æ™¯å’Œä¸»é¢˜...

ä¾‹å¦‚ï¼š
â€¢ èŒä¸šå‘å±•çš„é‡å¤§çªç ´æœŸ
â€¢ æŠ€èƒ½æå‡å’Œèƒ½åŠ›å»ºè®¾æœŸ
â€¢ å¥åº·ç”Ÿæ´»æ–¹å¼å»ºç«‹æœŸ
â€¢ äººé™…å…³ç³»æ·±åŒ–æœŸ
â€¢ åˆ›æ–°æ¢ç´¢å’Œå°è¯•æœŸ" style="min-height: 120px;"></textarea>

        <!-- æˆ˜ç•¥ç›®æ ‡ -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                ğŸ¯ æˆ˜ç•¥ç›®æ ‡
                <span style="background: #4caf50; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Strategic</span>
            </label>
            <div style="display: flex; gap: 6px;">
                <button type="button" id="strategic-planning-btn" style="background: #e3f2fd; color: #1976d2; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ§  æˆ˜ç•¥è§„åˆ’
                </button>
                <button type="button" id="goal-alignment-btn" style="background: #e8f5e9; color: #2e7d32; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ¯ ç›®æ ‡å¯¹é½
                </button>
            </div>
        </div>
        <div id="halfyear_strategic_goals" class="todo-list-container" 
             data-placeholder="[ ] åŠå¹´çš„æˆ˜ç•¥æ€§ç›®æ ‡..."
             style="border: 2px solid #4caf50; background: linear-gradient(135deg, rgba(76,175,80,0.05), rgba(76,175,80,0.02));">
        </div>

        <!-- å­£åº¦åˆ†è§£ -->
        <div class="plan-item-header">
            <label>ğŸ“… å­£åº¦é‡Œç¨‹ç¢‘åˆ†è§£</label>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px; margin-bottom: 24px;">
            <!-- ç¬¬ä¸€å­£åº¦ -->
            <div class="quarter-card" style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 24px; border-left: 4px solid #2196f3; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);">
                <div class="quarter-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h4 style="margin: 0; color: #2196f3; display: flex; align-items: center; gap: 8px;" id="quarter1-title">
                    ğŸŒ± ç¬¬ä¸€å­£åº¦
                    <span style="background: rgba(33,150,243,0.1); color: #2196f3; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">å¯åŠ¨æœŸ</span>
                </h4>
                    <div class="input-mode-selector" style="display: flex; gap: 4px;">
                        <button type="button" class="mode-btn active" data-mode="todo" data-quarter="1" title="å¾…åŠæ¸…å•æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #2196f3; color: white; font-size: 12px; cursor: pointer;">ğŸ“</button>
                        <button type="button" class="mode-btn" data-mode="text" data-quarter="1" title="è‡ªç”±æ–‡æœ¬æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #e3f2fd; color: #2196f3; font-size: 12px; cursor: pointer;">ğŸ’­</button>
                        <button type="button" class="mode-btn" data-mode="outline" data-quarter="1" title="å¤§çº²æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #e3f2fd; color: #2196f3; font-size: 12px; cursor: pointer;">ğŸ“‹</button>
                    </div>
                </div>
                
                <!-- è¾“å…¥å·¥å…·æ  -->
                <div class="input-toolbar" id="quarter1-toolbar" style="display: flex; gap: 8px; margin-bottom: 12px; align-items: center; flex-wrap: wrap;">
                    <button type="button" class="quick-add-btn" data-quarter="1" style="padding: 6px 12px; border: none; border-radius: 8px; background: linear-gradient(135deg, #2196f3, #1976d2); color: white; font-size: 12px; cursor: pointer; transition: all 0.2s;">
                        â• å¿«é€Ÿæ·»åŠ 
                    </button>
                    <div class="template-dropdown" style="position: relative;">
                        <button type="button" class="template-btn" data-quarter="1" style="padding: 6px 12px; border: none; border-radius: 8px; background: #e3f2fd; color: #2196f3; font-size: 12px; cursor: pointer;">
                            ğŸ“„ æ¨¡æ¿
                        </button>
                        <div class="template-menu" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 10; min-width: 200px;">
                            <div class="template-item" data-template="work" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ’¼ å·¥ä½œç›®æ ‡</div>
                            <div class="template-item" data-template="learning" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ“š å­¦ä¹ è®¡åˆ’</div>
                            <div class="template-item" data-template="health" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ’ª å¥åº·ç›®æ ‡</div>
                            <div class="template-item" data-template="project" style="padding: 8px 12px; cursor: pointer; font-size: 12px;">ğŸš€ é¡¹ç›®é‡Œç¨‹ç¢‘</div>
                        </div>
                    </div>
                    <button type="button" class="help-btn" data-quarter="1" title="ä½¿ç”¨å¸®åŠ©" style="padding: 6px 8px; border: none; border-radius: 6px; background: transparent; color: #999; font-size: 12px; cursor: pointer;">â“</button>
                    <span style="font-size: 11px; color: #666; margin-left: auto;">Ctrl+Enter å¿«é€Ÿæ·»åŠ </span>
                </div>

                <!-- è¾“å…¥å®¹å™¨ -->
                <div class="input-container" style="position: relative;">
                    <div id="quarter1_milestones" class="enhanced-input-area todo-list-container" data-placeholder="ç‚¹å‡»å¼€å§‹æ·»åŠ ç¬¬ä¸€å­£åº¦çš„å…³é”®é‡Œç¨‹ç¢‘..." style="min-height: 140px; border: 2px dashed #e3f2fd; border-radius: 12px; padding: 16px; background: #fafafe; transition: all 0.3s; position: relative;">
                        <div class="input-hint" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #999; font-size: 14px; pointer-events: none; opacity: 0.7;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; margin-bottom: 8px;">ğŸ¯</div>
                                <div>ç‚¹å‡»å¼€å§‹è§„åˆ’ç¬¬ä¸€å­£åº¦é‡Œç¨‹ç¢‘</div>
                                <div style="font-size: 12px; margin-top: 4px;">æ”¯æŒå¾…åŠæ¸…å•ã€è‡ªç”±æ–‡æœ¬å’Œå¤§çº²ä¸‰ç§æ¨¡å¼</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç¬¬äºŒå­£åº¦ -->
            <div class="quarter-card" style="background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 24px; border-left: 4px solid #ff9800; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);">
                <div class="quarter-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h4 style="margin: 0; color: #ff9800; display: flex; align-items: center; gap: 8px;" id="quarter2-title">
                    ğŸš€ ç¬¬äºŒå­£åº¦
                    <span style="background: rgba(255,152,0,0.1); color: #ff9800; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">å†²åˆºæœŸ</span>
                </h4>
                    <div class="input-mode-selector" style="display: flex; gap: 4px;">
                        <button type="button" class="mode-btn active" data-mode="todo" data-quarter="2" title="å¾…åŠæ¸…å•æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #ff9800; color: white; font-size: 12px; cursor: pointer;">ğŸ“</button>
                        <button type="button" class="mode-btn" data-mode="text" data-quarter="2" title="è‡ªç”±æ–‡æœ¬æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #fff3e0; color: #ff9800; font-size: 12px; cursor: pointer;">ğŸ’­</button>
                        <button type="button" class="mode-btn" data-mode="outline" data-quarter="2" title="å¤§çº²æ¨¡å¼" style="padding: 4px 8px; border: none; border-radius: 6px; background: #fff3e0; color: #ff9800; font-size: 12px; cursor: pointer;">ğŸ“‹</button>
                    </div>
                </div>
                
                <!-- è¾“å…¥å·¥å…·æ  -->
                <div class="input-toolbar" id="quarter2-toolbar" style="display: flex; gap: 8px; margin-bottom: 12px; align-items: center; flex-wrap: wrap;">
                    <button type="button" class="quick-add-btn" data-quarter="2" style="padding: 6px 12px; border: none; border-radius: 8px; background: linear-gradient(135deg, #ff9800, #f57c00); color: white; font-size: 12px; cursor: pointer; transition: all 0.2s;">
                        â• å¿«é€Ÿæ·»åŠ 
                    </button>
                    <div class="template-dropdown" style="position: relative;">
                        <button type="button" class="template-btn" data-quarter="2" style="padding: 6px 12px; border: none; border-radius: 8px; background: #fff3e0; color: #ff9800; font-size: 12px; cursor: pointer;">
                            ğŸ“„ æ¨¡æ¿
                        </button>
                        <div class="template-menu" style="display: none; position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 10; min-width: 200px;">
                            <div class="template-item" data-template="work" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ’¼ å·¥ä½œç›®æ ‡</div>
                            <div class="template-item" data-template="learning" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ“š å­¦ä¹ è®¡åˆ’</div>
                            <div class="template-item" data-template="health" style="padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #f0f0f0;">ğŸ’ª å¥åº·ç›®æ ‡</div>
                            <div class="template-item" data-template="project" style="padding: 8px 12px; cursor: pointer; font-size: 12px;">ğŸš€ é¡¹ç›®é‡Œç¨‹ç¢‘</div>
                        </div>
                    </div>
                    <button type="button" class="help-btn" data-quarter="2" title="ä½¿ç”¨å¸®åŠ©" style="padding: 6px 8px; border: none; border-radius: 6px; background: transparent; color: #999; font-size: 12px; cursor: pointer;">â“</button>
                    <span style="font-size: 11px; color: #666; margin-left: auto;">Ctrl+Enter å¿«é€Ÿæ·»åŠ </span>
                </div>

                <!-- è¾“å…¥å®¹å™¨ -->
                <div class="input-container" style="position: relative;">
                    <div id="quarter2_milestones" class="enhanced-input-area todo-list-container" data-placeholder="ç‚¹å‡»å¼€å§‹æ·»åŠ ç¬¬äºŒå­£åº¦çš„å…³é”®é‡Œç¨‹ç¢‘..." style="min-height: 140px; border: 2px dashed #fff3e0; border-radius: 12px; padding: 16px; background: #fffaf5; transition: all 0.3s; position: relative;">
                        <div class="input-hint" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #999; font-size: 14px; pointer-events: none; opacity: 0.7;">
                            <div style="text-align: center;">
                                <div style="font-size: 24px; margin-bottom: 8px;">ğŸš€</div>
                                <div>ç‚¹å‡»å¼€å§‹è§„åˆ’ç¬¬äºŒå­£åº¦é‡Œç¨‹ç¢‘</div>
                                <div style="font-size: 12px; margin-top: 4px;">æ”¯æŒå¾…åŠæ¸…å•ã€è‡ªç”±æ–‡æœ¬å’Œå¤§çº²ä¸‰ç§æ¨¡å¼</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é‡ç‚¹é¡¹ç›® -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                ğŸ—ï¸ é‡ç‚¹é¡¹ç›®è§„åˆ’
                <span style="background: #9c27b0; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Projects</span>
            </label>
            <div style="display: flex; gap: 6px;">
                <button type="button" id="project-planning-btn" style="background: #f3e5f5; color: #7b1fa2; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ“‹ é¡¹ç›®è§„åˆ’
                </button>
                <button type="button" id="resource-allocation-btn" style="background: #fff3e0; color: #ef6c00; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ¯ èµ„æºåˆ†é…
                </button>
            </div>
        </div>
        <div id="halfyear_projects" class="todo-list-container" 
             data-placeholder="[ ] åŠå¹´å†…è¦æ¨è¿›çš„é‡ç‚¹é¡¹ç›®..."
             style="border: 2px solid #9c27b0; background: linear-gradient(135deg, rgba(156,39,176,0.05), rgba(156,39,176,0.02));">
        </div>

        <!-- èƒ½åŠ›å‘å±• -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                ğŸ“ˆ èƒ½åŠ›å‘å±•è§„åˆ’
                <span style="background: #00796b; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Growth</span>
            </label>
            <div style="display: flex; gap: 6px;">
                <button type="button" id="skills-assessment-btn" style="background: #e0f2f1; color: #00796b; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ“Š æŠ€èƒ½è¯„ä¼°
                </button>
                <button type="button" id="skills-learning-path-btn" style="background: #e3f2fd; color: #1976d2; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ›¤ï¸ å­¦ä¹ è·¯å¾„
                </button>
            </div>
        </div>
        <textarea id="halfyear_skills" placeholder="èƒ½åŠ›å‘å±•å’Œå­¦ä¹ è§„åˆ’...

åŒ…æ‹¬ï¼š
â€¢ ä¸“ä¸šæŠ€èƒ½æå‡è®¡åˆ’
â€¢ æ–°é¢†åŸŸæ¢ç´¢å­¦ä¹ 
â€¢ è½¯æŠ€èƒ½å‘å±•é‡ç‚¹
â€¢ çŸ¥è¯†ä½“ç³»æ„å»º
â€¢ å®è·µé¡¹ç›®è§„åˆ’" style="min-height: 120px;"></textarea>

        <!-- ç”Ÿæ´»å¹³è¡¡ -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡
                <span style="background: #795548; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Balance</span>
            </label>
            <div style="display: flex; gap: 6px;">
                <button type="button" id="balance-assessment-btn" style="background: #efebe9; color: #795548; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    âš–ï¸ å¹³è¡¡åˆ†æ
                </button>
                <button type="button" id="balance-suggestions-btn" style="background: #f3e5f5; color: #7b1fa2; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ’¡ æ”¹å–„å»ºè®®
                </button>
            </div>
        </div>
        <div id="halfyear_balance" class="todo-list-container" 
             data-placeholder="[ ] å·¥ä½œç”Ÿæ´»å¹³è¡¡çš„å…·ä½“æªæ–½..."
             style="border: 2px solid #795548; background: linear-gradient(135deg, rgba(121,85,72,0.05), rgba(121,85,72,0.02));">
        </div>

        <!-- é‡Œç¨‹ç¢‘æ—¶é—´çº¿ -->
        <div class="plan-item-header">
            <label>ğŸ—“ï¸ å…³é”®é‡Œç¨‹ç¢‘æ—¶é—´çº¿</label>
        </div>
        <div style="background: rgba(255,255,255,0.9); border-radius: 16px; padding: 20px; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;">
                <div style="text-align: center; padding: 12px; background: rgba(33,150,243,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #2196f3;" id="month1-label">1æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">å¯åŠ¨æœˆ</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(76,175,80,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #4caf50;" id="month2-label">2æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">æ¨è¿›æœˆ</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(255,152,0,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #ff9800;" id="month3-label">3æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">è¯„ä¼°æœˆ</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(156,39,176,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #9c27b0;" id="month4-label">4æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">è°ƒæ•´æœˆ</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(244,67,54,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #f44336;" id="month5-label">5æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">å†²åˆºæœˆ</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(0,121,107,0.1); border-radius: 8px;">
                    <div style="font-weight: 600; color: #00796b;" id="month6-label">6æœˆ</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 4px;">æ”¶è·æœˆ</div>
                </div>
            </div>
        </div>

        <!-- åŠå¹´å›é¡¾ -->
        <div class="plan-item-header">
            <label style="display: flex; align-items: center; gap: 8px;">
                ğŸ“ åŠå¹´å›é¡¾ä¸æ€»ç»“
                <span style="background: #607d8b; color: white; font-size: 0.8em; padding: 2px 6px; border-radius: 10px; font-weight: normal;">Review</span>
            </label>
            <div style="display: flex; gap: 6px;">
                <button type="button" id="comprehensive-review-btn" style="background: #eceff1; color: #607d8b; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ“Š å…¨é¢å›é¡¾
                </button>
                <button type="button" id="lessons-learned-btn" style="background: #fff3e0; color: #ef6c00; border: none; border-radius: 6px; padding: 4px 8px; cursor: pointer; font-size: 0.85em;">
                    ğŸ’¡ ç»éªŒæ€»ç»“
                </button>
            </div>
        </div>
        <textarea id="halfyear_review" placeholder="åŠå¹´å›é¡¾ä¸æ€»ç»“...

å›é¡¾ç»´åº¦ï¼š
â€¢ æˆ˜ç•¥ç›®æ ‡è¾¾æˆæƒ…å†µåˆ†æ
â€¢ é‡ç‚¹é¡¹ç›®æ¨è¿›æˆæœè¯„ä¼°
â€¢ èƒ½åŠ›å‘å±•å’Œæˆé•¿æ”¶è·
â€¢ å·¥ä½œç”Ÿæ´»å¹³è¡¡çŠ¶å†µ
â€¢ é‡è¦ç»éªŒæ•™è®­æ€»ç»“
â€¢ ä¸‹åŠå¹´æ”¹è¿›ä¼˜åŒ–æ–¹å‘" style="min-height: 150px;"></textarea>
    </div>

    <script src="common.js"></script>
    <script>
        // åŠå¹´è®¡åˆ’å®ç°
        let currentHalf = getCurrentHalf();
        let currentYear = new Date().getFullYear();

        function getCurrentHalf() {
            return new Date().getMonth() < 6 ? 1 : 2;
        }

        // å¢å¼ºè¾“å…¥åŠŸèƒ½
        function initializeEnhancedInput() {
            // åˆå§‹åŒ–è¾“å…¥æ¨¡å¼åˆ‡æ¢
            initInputModeButtons();
            
            // åˆå§‹åŒ–å¿«é€Ÿæ·»åŠ æŒ‰é’®
            initQuickAddButtons();
            
            // åˆå§‹åŒ–æ¨¡æ¿åŠŸèƒ½
            initTemplateDropdowns();
            
            // åˆå§‹åŒ–è¾“å…¥åŒºåŸŸäº¤äº’
            initInputAreaInteractions();
            
            // åˆå§‹åŒ–å¿«æ·é”®
            initKeyboardShortcuts();
            
            // åˆå§‹åŒ–å¸®åŠ©åŠŸèƒ½
            initHelpButtons();
        }

        // è¾“å…¥æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
        function initInputModeButtons() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const quarter = this.dataset.quarter;
                    const mode = this.dataset.mode;
                    switchInputMode(quarter, mode, this);
                });
            });
        }

        function switchInputMode(quarter, mode, activeBtn) {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const modeSelector = activeBtn.parentElement;
            modeSelector.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
                if (quarter === '1') {
                    btn.style.background = '#e3f2fd';
                    btn.style.color = '#2196f3';
                } else {
                    btn.style.background = '#fff3e0';
                    btn.style.color = '#ff9800';
                }
            });
            
            activeBtn.classList.add('active');
            if (quarter === '1') {
                activeBtn.style.background = '#2196f3';
                activeBtn.style.color = 'white';
            } else {
                activeBtn.style.background = '#ff9800';
                activeBtn.style.color = 'white';
            }

            // æ›´æ–°è¾“å…¥åŒºåŸŸ
            const inputArea = document.getElementById(`quarter${quarter}_milestones`);
            updateInputAreaForMode(inputArea, mode);
        }

        function updateInputAreaForMode(inputArea, mode) {
            const currentContent = inputArea.textContent || '';
            
            switch(mode) {
                case 'todo':
                    inputArea.dataset.inputMode = 'todo';
                    inputArea.style.fontFamily = 'inherit';
                    break;
                case 'text':
                    inputArea.dataset.inputMode = 'text';
                    inputArea.style.fontFamily = 'inherit';
                    break;
                case 'outline':
                    inputArea.dataset.inputMode = 'outline';
                    inputArea.style.fontFamily = 'monospace';
                    break;
            }
            
            // é‡æ–°æ¸²æŸ“å†…å®¹
            if (currentContent) {
                formatContentForMode(inputArea, currentContent, mode);
            }
        }

        function formatContentForMode(inputArea, content, mode) {
            switch(mode) {
                case 'todo':
                    // ç¡®ä¿æ‰€æœ‰è¡Œéƒ½æ˜¯å¾…åŠäº‹é¡¹æ ¼å¼
                    const lines = content.split('\n').filter(line => line.trim());
                    const todoLines = lines.map(line => {
                        const trimmed = line.trim();
                        if (!trimmed.match(/^\[.\]/)) {
                            return `[ ] ${trimmed}`;
                        }
                        return line;
                    });
                    inputArea.textContent = todoLines.join('\n');
                    TodoUtils.renderTodos(inputArea);
                    break;
                case 'text':
                    // ç§»é™¤å¾…åŠäº‹é¡¹æ ¼å¼ï¼Œä¿ç•™çº¯æ–‡æœ¬
                    const textLines = content.split('\n').map(line => {
                        return line.replace(/^\[.\]\s*/, '').trim();
                    }).filter(line => line);
                    inputArea.textContent = textLines.join('\n');
                    break;
                case 'outline':
                    // è½¬æ¢ä¸ºå¤§çº²æ ¼å¼
                    const outlineLines = content.split('\n').map((line, index) => {
                        const clean = line.replace(/^\[.\]\s*/, '').trim();
                        if (clean) {
                            return `${index + 1}. ${clean}`;
                        }
                        return '';
                    }).filter(line => line);
                    inputArea.textContent = outlineLines.join('\n');
                    break;
            }
        }

        // å¿«é€Ÿæ·»åŠ åŠŸèƒ½
        function initQuickAddButtons() {
            document.querySelectorAll('.quick-add-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const quarter = this.dataset.quarter;
                    quickAddItem(quarter);
                });
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                btn.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                });
                
                btn.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
        }

        function quickAddItem(quarter) {
            const inputArea = document.getElementById(`quarter${quarter}_milestones`);
            const mode = inputArea.dataset.inputMode || 'todo';
            
            const currentContent = inputArea.textContent || '';
            let newContent = '';
            
            switch(mode) {
                case 'todo':
                    newContent = currentContent + (currentContent ? '\n' : '') + '[ ] ';
                    break;
                case 'text':
                    newContent = currentContent + (currentContent ? '\n' : '') + '';
                    break;
                case 'outline':
                    const lines = currentContent.split('\n').filter(line => line.trim());
                    const nextNumber = lines.length + 1;
                    newContent = currentContent + (currentContent ? '\n' : '') + `${nextNumber}. `;
                    break;
            }
            
            inputArea.textContent = newContent;
            
            // æ ¹æ®æ¨¡å¼è¿›è¡Œæ¸²æŸ“
            if (mode === 'todo') {
                TodoUtils.renderTodos(inputArea);
            }
            
            // èšç„¦åˆ°æœ«å°¾
            inputArea.focus();
            const range = document.createRange();
            const selection = window.getSelection();
            range.selectNodeContents(inputArea);
            range.collapse(false);
            selection.removeAllRanges();
            selection.addRange(range);
        }

        // æ¨¡æ¿åŠŸèƒ½
        function initTemplateDropdowns() {
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const dropdown = this.nextElementSibling;
                    const isVisible = dropdown.style.display === 'block';
                    
                    // å…³é—­æ‰€æœ‰å…¶ä»–ä¸‹æ‹‰èœå•
                    document.querySelectorAll('.template-menu').forEach(menu => {
                        menu.style.display = 'none';
                    });
                    
                    dropdown.style.display = isVisible ? 'none' : 'block';
                });
            });

            document.querySelectorAll('.template-item').forEach(item => {
                item.addEventListener('click', function() {
                    const template = this.dataset.template;
                    const quarter = this.closest('.quarter-card').querySelector('.template-btn').dataset.quarter;
                    applyTemplate(quarter, template);
                    
                    // å…³é—­ä¸‹æ‹‰èœå•
                    this.closest('.template-menu').style.display = 'none';
                });
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                item.addEventListener('mouseenter', function() {
                    this.style.background = '#f5f5f5';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.background = 'white';
                });
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', function() {
                document.querySelectorAll('.template-menu').forEach(menu => {
                    menu.style.display = 'none';
                });
            });
        }

        function applyTemplate(quarter, template) {
            const inputArea = document.getElementById(`quarter${quarter}_milestones`);
            const mode = inputArea.dataset.inputMode || 'todo';
            let templateContent = '';

            const templates = {
                work: [
                    'å®Œæˆå…³é”®é¡¹ç›®é‡Œç¨‹ç¢‘',
                    'æå‡å›¢é˜Ÿåä½œæ•ˆç‡',
                    'ä¼˜åŒ–å·¥ä½œæµç¨‹',
                    'è¾¾æˆä¸šç»©ç›®æ ‡'
                ],
                learning: [
                    'æŒæ¡æ–°æŠ€èƒ½æˆ–çŸ¥è¯†é¢†åŸŸ',
                    'å®Œæˆåœ¨çº¿è¯¾ç¨‹å­¦ä¹ ',
                    'å‚åŠ ä¸“ä¸šåŸ¹è®­',
                    'é˜…è¯»ä¸“ä¸šä¹¦ç±'
                ],
                health: [
                    'å»ºç«‹è§„å¾‹è¿åŠ¨ä¹ æƒ¯',
                    'æ”¹å–„é¥®é£Ÿç»“æ„',
                    'ä¿æŒè‰¯å¥½ä½œæ¯',
                    'å®šæœŸå¥åº·æ£€æŸ¥'
                ],
                project: [
                    'é¡¹ç›®å¯åŠ¨å’Œè§„åˆ’',
                    'æ ¸å¿ƒåŠŸèƒ½å¼€å‘',
                    'æµ‹è¯•å’Œä¼˜åŒ–',
                    'é¡¹ç›®äº¤ä»˜ä¸Šçº¿'
                ]
            };

            const items = templates[template] || [];
            
            switch(mode) {
                case 'todo':
                    templateContent = items.map(item => `[ ] ${item}`).join('\n');
                    break;
                case 'text':
                    templateContent = items.join('\n');
                    break;
                case 'outline':
                    templateContent = items.map((item, index) => `${index + 1}. ${item}`).join('\n');
                    break;
            }

            const currentContent = inputArea.textContent || '';
            const newContent = currentContent + (currentContent ? '\n' : '') + templateContent;
            
            inputArea.textContent = newContent;
            
            if (mode === 'todo') {
                TodoUtils.renderTodos(inputArea);
            }
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            MessageUtils.success(`å·²åº”ç”¨${getTemplateName(template)}æ¨¡æ¿`);
        }

        function getTemplateName(template) {
            const names = {
                work: 'å·¥ä½œç›®æ ‡',
                learning: 'å­¦ä¹ è®¡åˆ’',
                health: 'å¥åº·ç›®æ ‡',
                project: 'é¡¹ç›®é‡Œç¨‹ç¢‘'
            };
            return names[template] || template;
        }

        // è¾“å…¥åŒºåŸŸäº¤äº’
        function initInputAreaInteractions() {
            document.querySelectorAll('.enhanced-input-area').forEach(area => {
                const hint = area.querySelector('.input-hint');
                
                area.addEventListener('focus', function() {
                    hint.style.display = 'none';
                    this.style.borderColor = this.id.includes('quarter1') ? '#2196f3' : '#ff9800';
                    this.style.borderStyle = 'solid';
                    this.style.background = 'white';
                });
                
                area.addEventListener('blur', function() {
                    if (!this.textContent.trim()) {
                        hint.style.display = 'block';
                        this.style.borderStyle = 'dashed';
                        this.style.borderColor = this.id.includes('quarter1') ? '#e3f2fd' : '#fff3e0';
                        this.style.background = this.id.includes('quarter1') ? '#fafafe' : '#fffaf5';
                    }
                });
                
                area.addEventListener('input', function() {
                    if (this.textContent.trim()) {
                        hint.style.display = 'none';
                    }
                });
            });
        }

        // å¿«æ·é”®åŠŸèƒ½
        function initKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Ctrl+Enter: å¿«é€Ÿæ·»åŠ 
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    const focusedElement = document.activeElement;
                    if (focusedElement && focusedElement.classList.contains('enhanced-input-area')) {
                        const quarter = focusedElement.id.includes('quarter1') ? '1' : '2';
                        quickAddItem(quarter);
                    }
                }
                
                // Ctrl+T: åˆ‡æ¢åˆ°å¾…åŠæ¨¡å¼
                if (e.ctrlKey && e.key === 't') {
                    e.preventDefault();
                    const focusedElement = document.activeElement;
                    if (focusedElement && focusedElement.classList.contains('enhanced-input-area')) {
                        const quarter = focusedElement.id.includes('quarter1') ? '1' : '2';
                        const modeBtn = document.querySelector(`[data-mode="todo"][data-quarter="${quarter}"]`);
                        if (modeBtn) modeBtn.click();
                    }
                }
            });
        }

        // å¸®åŠ©åŠŸèƒ½
        function initHelpButtons() {
            document.querySelectorAll('.help-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const quarter = this.dataset.quarter;
                    showInputHelp(quarter);
                });
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                btn.addEventListener('mouseenter', function() {
                    this.style.background = '#f0f0f0';
                    this.style.color = '#666';
                });
                
                btn.addEventListener('mouseleave', function() {
                    this.style.background = 'transparent';
                    this.style.color = '#999';
                });
            });
        }

        function showInputHelp(quarter) {
            const quarterName = quarter === '1' ? 'ç¬¬ä¸€å­£åº¦' : 'ç¬¬äºŒå­£åº¦';
            const helpContent = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: ${quarter === '1' ? '#2196f3' : '#ff9800'}; margin-bottom: 16px;">
                        â“ ${quarterName}è¾“å…¥æ–¹å¼æŒ‡å—
                    </h4>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
                        æ–°çš„è¾“å…¥ç•Œé¢æ”¯æŒå¤šç§è¾“å…¥æ¨¡å¼ï¼Œè®©æ‚¨æ›´çµæ´»åœ°ç®¡ç†å­£åº¦é‡Œç¨‹ç¢‘
                    </p>
                </div>
                
                <!-- è¾“å…¥æ¨¡å¼è¯´æ˜ -->
                <div style="margin-bottom: 20px;">
                    <h5 style="color: #333; margin-bottom: 12px;">ğŸ“ ä¸‰ç§è¾“å…¥æ¨¡å¼</h5>
                    <div style="display: grid; gap: 12px;">
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #2196f3;">
                            <strong>ğŸ“ å¾…åŠæ¸…å•æ¨¡å¼</strong>
                            <div style="font-size: 0.9em; color: #666; margin-top: 4px;">
                                â€¢ é€‚åˆç®¡ç†å…·ä½“çš„ä»»åŠ¡å’Œç›®æ ‡<br>
                                â€¢ æ”¯æŒå¤é€‰æ¡†å‹¾é€‰å®ŒæˆçŠ¶æ€<br>
                                â€¢ æ ¼å¼ï¼š[ ] ä»»åŠ¡æè¿°
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #ff9800;">
                            <strong>ğŸ’­ è‡ªç”±æ–‡æœ¬æ¨¡å¼</strong>
                            <div style="font-size: 0.9em; color: #666; margin-top: 4px;">
                                â€¢ é€‚åˆè®°å½•æƒ³æ³•ã€è®¡åˆ’å’Œæè¿°<br>
                                â€¢ æ— æ ¼å¼é™åˆ¶ï¼Œçµæ´»ç¼–è¾‘<br>
                                â€¢ æ”¯æŒå¤šè¡Œæ–‡æœ¬è¾“å…¥
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; border-left: 4px solid #9c27b0;">
                            <strong>ğŸ“‹ å¤§çº²æ¨¡å¼</strong>
                            <div style="font-size: 0.9em; color: #666; margin-top: 4px;">
                                â€¢ é€‚åˆç»“æ„åŒ–çš„è®¡åˆ’åˆ—è¡¨<br>
                                â€¢ è‡ªåŠ¨ç¼–å·ï¼Œå±‚æ¬¡æ¸…æ™°<br>
                                â€¢ ä½¿ç”¨ç­‰å®½å­—ä½“æ˜¾ç¤º
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½ä»‹ç» -->
                <div style="margin-bottom: 20px;">
                    <h5 style="color: #333; margin-bottom: 12px;">âš¡ å¿«æ·åŠŸèƒ½</h5>
                    <div style="background: #e8f5e9; padding: 16px; border-radius: 8px;">
                        <div style="display: grid; gap: 8px; font-size: 0.9em;">
                            <div><strong>â• å¿«é€Ÿæ·»åŠ ï¼š</strong> ç‚¹å‡»æŒ‰é’®æˆ–æŒ‰ Ctrl+Enter å¿«é€Ÿæ·»åŠ æ–°é¡¹ç›®</div>
                            <div><strong>ğŸ“„ æ¨¡æ¿åŠŸèƒ½ï¼š</strong> é€‰æ‹©é¢„è®¾æ¨¡æ¿å¿«é€Ÿå¡«å……å¸¸ç”¨å†…å®¹</div>
                            <div><strong>ğŸ”„ æ¨¡å¼åˆ‡æ¢ï¼š</strong> éšæ—¶åˆ‡æ¢è¾“å…¥æ¨¡å¼ï¼Œå†…å®¹è‡ªåŠ¨è½¬æ¢æ ¼å¼</div>
                            <div><strong>âŒ¨ï¸ é”®ç›˜å¿«æ·é”®ï¼š</strong> Ctrl+T åˆ‡æ¢åˆ°å¾…åŠæ¨¡å¼</div>
                        </div>
                    </div>
                </div>
                
                <!-- æ¨¡æ¿è¯´æ˜ -->
                <div style="margin-bottom: 20px;">
                    <h5 style="color: #333; margin-bottom: 12px;">ğŸ“„ å†…ç½®æ¨¡æ¿</h5>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.9em;">
                        <div style="background: white; padding: 8px; border-radius: 6px; border: 1px solid #e0e0e0;">
                            <strong>ğŸ’¼ å·¥ä½œç›®æ ‡</strong><br>
                            <span style="color: #666;">èŒåœºå‘å±•ç›¸å…³</span>
                        </div>
                        <div style="background: white; padding: 8px; border-radius: 6px; border: 1px solid #e0e0e0;">
                            <strong>ğŸ“š å­¦ä¹ è®¡åˆ’</strong><br>
                            <span style="color: #666;">æŠ€èƒ½æå‡ç›¸å…³</span>
                        </div>
                        <div style="background: white; padding: 8px; border-radius: 6px; border: 1px solid #e0e0e0;">
                            <strong>ğŸ’ª å¥åº·ç›®æ ‡</strong><br>
                            <span style="color: #666;">èº«å¿ƒå¥åº·ç›¸å…³</span>
                        </div>
                        <div style="background: white; padding: 8px; border-radius: 6px; border: 1px solid #e0e0e0;">
                            <strong>ğŸš€ é¡¹ç›®é‡Œç¨‹ç¢‘</strong><br>
                            <span style="color: #666;">é¡¹ç›®ç®¡ç†ç›¸å…³</span>
                        </div>
                    </div>
                </div>
                
                <!-- ä½¿ç”¨æŠ€å·§ -->
                <div style="margin-bottom: 20px;">
                    <h5 style="color: #333; margin-bottom: 12px;">ğŸ’¡ ä½¿ç”¨æŠ€å·§</h5>
                    <div style="background: #fff3e0; padding: 16px; border-radius: 8px; font-size: 0.9em; color: #ef6c00;">
                        <div style="margin-bottom: 8px;">â€¢ å…ˆé€‰æ‹©åˆé€‚çš„è¾“å…¥æ¨¡å¼ï¼Œå†å¼€å§‹è¾“å…¥å†…å®¹</div>
                        <div style="margin-bottom: 8px;">â€¢ ä½¿ç”¨æ¨¡æ¿å¯ä»¥å¿«é€Ÿç”Ÿæˆå¸¸ç”¨çš„é‡Œç¨‹ç¢‘ç»“æ„</div>
                        <div style="margin-bottom: 8px;">â€¢ åœ¨å¾…åŠæ¨¡å¼ä¸‹å¯ä»¥é€šè¿‡ç‚¹å‡»å¤é€‰æ¡†æ ‡è®°å®ŒæˆçŠ¶æ€</div>
                        <div>â€¢ å†…å®¹ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜</div>
                    </div>
                </div>
            `;
            
            ModalUtils.show(`ğŸ¯ ${quarterName}è¾“å…¥æŒ‡å—`, helpContent, 'large');
        }

        // æ™ºèƒ½åˆ†æåŠŸèƒ½
        function initSmartAnalysisButtons() {
            console.log('ğŸš€ åˆå§‹åŒ–æ™ºèƒ½åˆ†ææŒ‰é’®...');
            
            // Growth åˆ†ææŒ‰é’®
            const growthBtn = document.getElementById('growth-analysis-btn');
            if (growthBtn) {
                growthBtn.addEventListener('click', function() {
                    console.log('ğŸ“ˆ GrowthæŒ‰é’®è¢«ç‚¹å‡»');
                    generateGrowthAnalysis();
                });
                console.log('âœ… GrowthæŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°GrowthæŒ‰é’®');
            }
            
            // æŠ€èƒ½è¯„ä¼°æŒ‰é’® - ä¸»æ§åˆ¶æ 
            const skillBtn = document.getElementById('skill-assessment-btn');
            if (skillBtn) {
                skillBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ğŸ“Š ä¸»æ§åˆ¶æ -æŠ€èƒ½è¯„ä¼°æŒ‰é’®è¢«ç‚¹å‡»');
                    generateSkillAssessment();
                });
                console.log('âœ… æŠ€èƒ½è¯„ä¼°æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°æŠ€èƒ½è¯„ä¼°æŒ‰é’®');
            }
            
            // å­¦ä¹ è·¯å¾„æŒ‰é’® - ä¸»æ§åˆ¶æ 
            const learningBtn = document.getElementById('learning-path-btn');
            if (learningBtn) {
                learningBtn.addEventListener('click', function() {
                    console.log('ğŸŒ² å­¦ä¹ è·¯å¾„æŒ‰é’®è¢«ç‚¹å‡»');
                    generateLearningPath();
                });
                console.log('âœ… å­¦ä¹ è·¯å¾„æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å­¦ä¹ è·¯å¾„æŒ‰é’®');
            }
            
            // å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææŒ‰é’® - ä¸»æ§åˆ¶æ 
            const balanceBtn = document.getElementById('balance-analysis-btn');
            if (balanceBtn) {
                balanceBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææŒ‰é’®è¢«ç‚¹å‡»');
                    generateBalanceAnalysis();
                });
                console.log('âœ… å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææŒ‰é’®');
            }
            
            // æŠ€èƒ½è¯„ä¼°æŒ‰é’® - æŠ€èƒ½å‘å±•åŒºåŸŸ
            const skillsBtn = document.getElementById('skills-assessment-btn');
            if (skillsBtn) {
                skillsBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ğŸ“Š æŠ€èƒ½å‘å±•åŒºåŸŸ-æŠ€èƒ½è¯„ä¼°æŒ‰é’®è¢«ç‚¹å‡»');
                    generateSkillAssessment();
                });
                console.log('âœ… æŠ€èƒ½å‘å±•åŒºåŸŸ-æŠ€èƒ½è¯„ä¼°æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°æŠ€èƒ½å‘å±•åŒºåŸŸ-æŠ€èƒ½è¯„ä¼°æŒ‰é’®');
            }
            
            // å­¦ä¹ è·¯å¾„æŒ‰é’® - æŠ€èƒ½å‘å±•åŒºåŸŸ
            const skillsLearningBtn = document.getElementById('skills-learning-path-btn');
            if (skillsLearningBtn) {
                skillsLearningBtn.addEventListener('click', function() {
                    console.log('ğŸŒ² æŠ€èƒ½å‘å±•åŒºåŸŸ-å­¦ä¹ è·¯å¾„æŒ‰é’®è¢«ç‚¹å‡»');
                    generateLearningPath();
                });
                console.log('âœ… æŠ€èƒ½å‘å±•åŒºåŸŸ-å­¦ä¹ è·¯å¾„æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            }
            
            // å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææŒ‰é’® - å¹³è¡¡åŒºåŸŸ
            const balanceAssessmentBtn = document.getElementById('balance-assessment-btn');
            if (balanceAssessmentBtn) {
                balanceAssessmentBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('âš–ï¸ å¹³è¡¡åŒºåŸŸ-å¹³è¡¡åˆ†ææŒ‰é’®è¢«ç‚¹å‡»');
                    generateBalanceAnalysis();
                });
                console.log('âœ… å¹³è¡¡åŒºåŸŸ-å¹³è¡¡åˆ†ææŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å¹³è¡¡åŒºåŸŸ-å¹³è¡¡åˆ†ææŒ‰é’®');
            }
            
            // å¹³è¡¡æ”¹å–„å»ºè®®æŒ‰é’® - å¹³è¡¡åŒºåŸŸ
            const balanceSuggestionsBtn = document.getElementById('balance-suggestions-btn');
            if (balanceSuggestionsBtn) {
                balanceSuggestionsBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('ğŸ’¡ å¹³è¡¡æ”¹å–„å»ºè®®æŒ‰é’®è¢«ç‚¹å‡»');
                    generateBalanceSuggestions();
                });
                console.log('âœ… å¹³è¡¡æ”¹å–„å»ºè®®æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°å¹³è¡¡æ”¹å–„å»ºè®®æŒ‰é’®');
            }
            
            console.log('ğŸ‰ æ™ºèƒ½åˆ†ææŒ‰é’®åˆå§‹åŒ–å®Œæˆ');
        }

        // Growth æˆé•¿åˆ†æåŠŸèƒ½
        function generateGrowthAnalysis() {
            console.log('ğŸ”¥ å¼€å§‹ç”ŸæˆGrowthæˆé•¿åˆ†æ...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('ğŸ“Š åŠ è½½çš„æ•°æ®:', currentData);
                
                const growthAnalysis = analyzeGrowthMetrics(currentData);
                console.log('ğŸ“ˆ åˆ†æç»“æœ:', growthAnalysis);
                
                const growthContent = generateGrowthAnalysisHTML(growthAnalysis);
                console.log('ğŸ¨ ç”Ÿæˆçš„HTMLé•¿åº¦:', growthContent.length);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('ğŸ“ˆ Growth æˆé•¿åˆ†æ', growthContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºGrowthåˆ†ææ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰');
                    alert('Growthæˆé•¿åˆ†æåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
                }
            } catch (error) {
                console.error('âŒ Growthåˆ†æç”Ÿæˆå¤±è´¥:', error);
                alert('Growthåˆ†æå‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeGrowthMetrics(data) {
            console.log('ğŸ“Š å¼€å§‹åˆ†ææˆé•¿æŒ‡æ ‡ï¼Œæ•°æ®:', data);
            
            // ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
            const safeData = data || {};
            
            // åˆ†æå„ä¸ªç»´åº¦çš„æˆé•¿æŒ‡æ ‡
            const metrics = {
                strategic: analyzeGrowthDimension(safeData.strategicGoals || '', 'æˆ˜ç•¥ç›®æ ‡'),
                quarters: {
                    q1: analyzeGrowthDimension(safeData.quarter1Milestones || '', 'ç¬¬ä¸€å­£åº¦'),
                    q2: analyzeGrowthDimension(safeData.quarter2Milestones || '', 'ç¬¬äºŒå­£åº¦')
                },
                projects: analyzeGrowthDimension(safeData.projects || '', 'é‡ç‚¹é¡¹ç›®'),
                skills: analyzeSkillGrowth(safeData.skills || ''),
                balance: analyzeBalanceGrowth(safeData.balance || ''),
                overall: calculateOverallGrowthScore(safeData)
            };
            
            console.log('ğŸ“ˆ æˆé•¿æŒ‡æ ‡åˆ†æç»“æœ:', metrics);
            return metrics;
        }

        function analyzeGrowthDimension(content, dimension) {
            const lines = content.split('\n').filter(line => line.trim());
            const completed = lines.filter(line => line.includes('[x]') || line.includes('[X]')).length;
            const total = lines.filter(line => line.match(/^\[.\]/)).length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            // æˆé•¿æ½œåŠ›è¯„ä¼°
            const growthKeywords = [
                'å­¦ä¹ ', 'æå‡', 'å‘å±•', 'çªç ´', 'åˆ›æ–°', 'ä¼˜åŒ–', 'æ”¹è¿›', 'å¢é•¿', 
                'æ‰©å±•', 'æ·±åŒ–', 'å»ºç«‹', 'åŸ¹å…»', 'æŒæ¡', 'ç²¾é€š', 'æ¢ç´¢'
            ];
            
            const growthIndicators = lines.filter(line => 
                growthKeywords.some(keyword => line.includes(keyword))
            ).length;
            
            const growthPotential = Math.min(100, (growthIndicators / Math.max(1, lines.length)) * 100 + 
                                           (progress * 0.3));
            
            return {
                dimension,
                progress,
                total,
                completed,
                growthIndicators,
                growthPotential: Math.round(growthPotential),
                suggestions: generateGrowthSuggestions(content, progress)
            };
        }

        function analyzeSkillGrowth(skillsContent) {
            const skillCategories = {
                technical: ['æŠ€æœ¯', 'ç¼–ç¨‹', 'å¼€å‘', 'è®¾è®¡', 'å·¥å…·', 'è½¯ä»¶', 'ç³»ç»Ÿ'],
                soft: ['æ²Ÿé€š', 'é¢†å¯¼', 'å›¢é˜Ÿ', 'ç®¡ç†', 'åä½œ', 'æ¼”è®²', 'å†™ä½œ'],
                business: ['å•†ä¸š', 'å¸‚åœº', 'è¿è¥', 'åˆ†æ', 'ç­–ç•¥', 'è´¢åŠ¡', 'é¡¹ç›®'],
                personal: ['æ—¶é—´', 'æ•ˆç‡', 'æ€ç»´', 'åˆ›æ–°', 'å­¦ä¹ ', 'é˜…è¯»', 'å¥åº·']
            };
            
            const skillAnalysis = {};
            Object.keys(skillCategories).forEach(category => {
                const keywords = skillCategories[category];
                const mentions = keywords.filter(keyword => 
                    skillsContent.toLowerCase().includes(keyword)
                ).length;
                
                skillAnalysis[category] = {
                    name: getCategoryName(category),
                    score: Math.min(100, mentions * 20),
                    keywords: keywords.filter(keyword => 
                        skillsContent.toLowerCase().includes(keyword)
                    )
                };
            });
            
            return skillAnalysis;
        }

        function getCategoryName(category) {
            const names = {
                technical: 'æŠ€æœ¯æŠ€èƒ½',
                soft: 'è½¯æŠ€èƒ½',
                business: 'å•†ä¸šæŠ€èƒ½',
                personal: 'ä¸ªäººå‘å±•'
            };
            return names[category] || category;
        }

        function analyzeBalanceGrowth(balanceContent) {
            const balanceAreas = {
                work: ['å·¥ä½œ', 'èŒä¸š', 'é¡¹ç›®', 'ä»»åŠ¡', 'æ•ˆç‡'],
                health: ['å¥åº·', 'è¿åŠ¨', 'é”»ç‚¼', 'é¥®é£Ÿ', 'ç¡çœ '],
                relationship: ['äººé™…', 'ç¤¾äº¤', 'å®¶åº­', 'æœ‹å‹', 'å…³ç³»'],
                personal: ['å…´è¶£', 'çˆ±å¥½', 'å­¦ä¹ ', 'æˆé•¿', 'ä¼‘é—²']
            };
            
            const balanceAnalysis = {};
            Object.keys(balanceAreas).forEach(area => {
                const keywords = balanceAreas[area];
                const mentions = keywords.filter(keyword => 
                    balanceContent.toLowerCase().includes(keyword)
                ).length;
                
                balanceAnalysis[area] = {
                    name: getBalanceAreaName(area),
                    attention: Math.min(100, mentions * 25),
                    keywords: keywords.filter(keyword => 
                        balanceContent.toLowerCase().includes(keyword)
                    )
                };
            });
            
            return balanceAnalysis;
        }

        function getBalanceAreaName(area) {
            const names = {
                work: 'å·¥ä½œå‘å±•',
                health: 'å¥åº·ç®¡ç†', 
                relationship: 'äººé™…å…³ç³»',
                personal: 'ä¸ªäººå…´è¶£'
            };
            return names[area] || area;
        }

        function calculateOverallGrowthScore(data) {
            const weights = {
                strategic: 0.25,
                quarters: 0.3,
                projects: 0.2,
                skills: 0.15,
                balance: 0.1
            };
            
            let totalScore = 0;
            let totalWeight = 0;
            
            // è®¡ç®—å„ç»´åº¦å¾—åˆ†
            if (data.strategicGoals) {
                const strategic = analyzeGrowthDimension(data.strategicGoals, 'æˆ˜ç•¥');
                totalScore += strategic.growthPotential * weights.strategic;
                totalWeight += weights.strategic;
            }
            
            if (data.quarter1Milestones || data.quarter2Milestones) {
                const q1 = analyzeGrowthDimension(data.quarter1Milestones || '', 'Q1');
                const q2 = analyzeGrowthDimension(data.quarter2Milestones || '', 'Q2');
                const avgQuarter = (q1.growthPotential + q2.growthPotential) / 2;
                totalScore += avgQuarter * weights.quarters;
                totalWeight += weights.quarters;
            }
            
            if (totalWeight > 0) {
                return Math.round(totalScore / totalWeight);
            }
            
            return 0;
        }

        function generateGrowthSuggestions(content, progress) {
            const suggestions = [];
            
            if (progress < 30) {
                suggestions.push('å»ºè®®åˆ†è§£å¤§ç›®æ ‡ä¸ºæ›´å°çš„å¯æ‰§è¡Œæ­¥éª¤');
                suggestions.push('è®¾å®šæ¯å‘¨æ£€æŸ¥ç‚¹ï¼Œç¡®ä¿æŒç»­æ¨è¿›');
            } else if (progress < 70) {
                suggestions.push('è¿›å±•è‰¯å¥½ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ æŒ‘æˆ˜æ€§ç›®æ ‡');
                suggestions.push('å»ºç«‹åé¦ˆæœºåˆ¶ï¼ŒæŒç»­ä¼˜åŒ–æ‰§è¡Œæ–¹å¼');
            } else {
                suggestions.push('æ‰§è¡Œæ•ˆæœä¼˜ç§€ï¼Œå¯ä»¥åˆ†äº«ç»éªŒç»™å›¢é˜Ÿ');
                suggestions.push('è€ƒè™‘è®¾ç«‹æ›´é«˜å±‚æ¬¡çš„å‘å±•ç›®æ ‡');
            }
            
            return suggestions;
        }

        function generateGrowthAnalysisHTML(analysis) {
            return `
                <div style="margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“ˆ</div>
                        <h3 style="color: #00897b; margin: 0;">Growth æˆé•¿åˆ†ææŠ¥å‘Š</h3>
                        <p style="color: #666; margin: 8px 0 0 0;">åŸºäºæ‚¨çš„åŠå¹´è®¡åˆ’æ•°æ®ç”Ÿæˆçš„ä¸ªäººæˆé•¿æ´å¯Ÿ</p>
                    </div>
                </div>

                <!-- æ•´ä½“æˆé•¿æŒ‡æ•° -->
                <div style="background: linear-gradient(135deg, #00897b, #4db6ac); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white; text-align: center;">
                    <h4 style="margin: 0 0 12px 0; font-size: 1.2em;">ğŸ† æ•´ä½“æˆé•¿æŒ‡æ•°</h4>
                    <div style="font-size: 3em; font-weight: bold; margin: 12px 0;">${analysis.overall}</div>
                    <div style="font-size: 1em; opacity: 0.9;">
                        ${analysis.overall >= 80 ? 'ğŸŒŸ å“è¶Šæˆé•¿' : 
                          analysis.overall >= 60 ? 'ğŸš€ å¿«é€Ÿæˆé•¿' : 
                          analysis.overall >= 40 ? 'ğŸ“ˆ ç¨³æ­¥æˆé•¿' : 'ğŸŒ± èµ·æ­¥é˜¶æ®µ'}
                    </div>
                </div>

                <!-- å„ç»´åº¦æˆé•¿åˆ†æ -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #00897b; margin-bottom: 16px;">ğŸ“Š å¤šç»´åº¦æˆé•¿åˆ†æ</h4>
                    <div style="display: grid; gap: 16px;">
                        
                        <!-- æˆ˜ç•¥ç›®æ ‡ç»´åº¦ -->
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 16px; border-left: 4px solid #00897b;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong>ğŸ¯ ${analysis.strategic.dimension}</strong>
                                <span style="background: #00897b; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                    ${analysis.strategic.growthPotential}%
                                </span>
                            </div>
                            <div style="font-size: 0.9em; color: #666;">
                                è¿›åº¦: ${analysis.strategic.completed}/${analysis.strategic.total} 
                                (${analysis.strategic.progress}%)
                            </div>
                            <div style="background: #e0e0e0; height: 6px; border-radius: 3px; margin: 8px 0;">
                                <div style="background: #00897b; height: 100%; width: ${analysis.strategic.growthPotential}%; border-radius: 3px; transition: width 0.3s;"></div>
                            </div>
                        </div>

                        <!-- å­£åº¦é‡Œç¨‹ç¢‘ç»´åº¦ -->
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 16px; border-left: 4px solid #1976d2;">
                            <strong>ğŸ“… å­£åº¦é‡Œç¨‹ç¢‘</strong>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px;">
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">ç¬¬ä¸€å­£åº¦</div>
                                    <div style="background: #e3f2fd; height: 6px; border-radius: 3px; margin: 4px 0;">
                                        <div style="background: #1976d2; height: 100%; width: ${analysis.quarters.q1.growthPotential}%; border-radius: 3px;"></div>
                                    </div>
                                    <div style="font-size: 0.8em; color: #1976d2;">${analysis.quarters.q1.growthPotential}%</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.9em; color: #666;">ç¬¬äºŒå­£åº¦</div>
                                    <div style="background: #e3f2fd; height: 6px; border-radius: 3px; margin: 4px 0;">
                                        <div style="background: #1976d2; height: 100%; width: ${analysis.quarters.q2.growthPotential}%; border-radius: 3px;"></div>
                                    </div>
                                    <div style="font-size: 0.8em; color: #1976d2;">${analysis.quarters.q2.growthPotential}%</div>
                                </div>
                            </div>
                        </div>

                        <!-- æŠ€èƒ½å‘å±•ç»´åº¦ -->
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 16px; border-left: 4px solid #ff9800;">
                            <strong>ğŸ§  æŠ€èƒ½å‘å±•é›·è¾¾</strong>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 12px;">
                                ${Object.values(analysis.skills || {}).map(skill => `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0;">
                                        <span style="font-size: 0.9em;">${skill.name}</span>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <div style="background: #ffcc80; height: 4px; width: 40px; border-radius: 2px;">
                                                <div style="background: #ff9800; height: 100%; width: ${skill.score}%; border-radius: 2px;"></div>
                                            </div>
                                            <span style="font-size: 0.8em; color: #ff9800; min-width: 30px;">${skill.score}%</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æˆé•¿å»ºè®® -->
                <div style="background: #e8f5e9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #2e7d32; margin: 0 0 16px 0;">ğŸ’¡ ä¸ªæ€§åŒ–æˆé•¿å»ºè®®</h4>
                    <div style="display: grid; gap: 12px;">
                        ${(analysis.strategic?.suggestions || []).map(suggestion => `
                            <div style="display: flex; align-items: flex-start; gap: 8px;">
                                <span style="color: #4caf50; font-size: 1.2em;">â€¢</span>
                                <span style="color: #2e7d32; font-size: 0.9em;">${suggestion}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- æˆé•¿è¶‹åŠ¿é¢„æµ‹ -->
                <div style="background: linear-gradient(135deg, #f3e5f5, #e1bee7); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #7b1fa2; margin: 0 0 12px 0;">ğŸ”® æˆé•¿è¶‹åŠ¿é¢„æµ‹</h4>
                    <div style="font-size: 0.9em; color: #4a148c; line-height: 1.6;">
                        åŸºäºå½“å‰çš„æˆé•¿è½¨è¿¹ï¼Œé¢„è®¡åœ¨æ¥ä¸‹æ¥çš„å­£åº¦ä¸­ï¼š<br>
                        â€¢ æ‚¨åœ¨æˆ˜ç•¥ç›®æ ‡æ‰§è¡Œæ–¹é¢å°†æœ‰ <strong>${Math.min(100, analysis.strategic.growthPotential + 15)}%</strong> çš„æå‡ç©ºé—´<br>
                        â€¢ æŠ€èƒ½å‘å±•å°†å‘ˆç° <strong>${analysis.overall >= 70 ? 'åŠ é€Ÿ' : 'ç¨³æ­¥'}</strong> ä¸Šå‡è¶‹åŠ¿<br>
                        â€¢ å»ºè®®é‡ç‚¹å…³æ³¨ <strong>${Object.values(analysis.skills).sort((a,b) => a.score - b.score)[0]?.name || 'ä¸ªäººå‘å±•'}</strong> é¢†åŸŸçš„æå‡
                    </div>
                </div>
            `;
        }

        // æŠ€èƒ½è¯„ä¼°åŠŸèƒ½
        function generateSkillAssessment() {
            console.log('ğŸ”¥ å¼€å§‹ç”ŸæˆæŠ€èƒ½è¯„ä¼°...');
            
            // ç«‹å³æ˜¾ç¤ºä¸€ä¸ªæµ‹è¯•æç¤ºï¼Œç¡®è®¤å‡½æ•°è¢«è°ƒç”¨
            if (typeof MessageUtils !== 'undefined' && MessageUtils.info) {
                MessageUtils.info('æ­£åœ¨ç”ŸæˆæŠ€èƒ½è¯„ä¼°æŠ¥å‘Š...');
            }
            
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('ğŸ“Š æŠ€èƒ½è¯„ä¼°-åŠ è½½çš„æ•°æ®:', currentData);
                
                // æ£€æŸ¥ModalUtilsæ˜¯å¦å¯ç”¨
                console.log('ğŸ” æ£€æŸ¥ModalUtilsçŠ¶æ€:', {
                    typeof_ModalUtils: typeof ModalUtils,
                    has_show: ModalUtils && typeof ModalUtils.show === 'function',
                    common_js_loaded: typeof StorageUtils !== 'undefined'
                });
                
                const skillAssessment = analyzeSkillsComprehensive(currentData);
                console.log('ğŸ“Š æŠ€èƒ½åˆ†æç»“æœ:', skillAssessment);
                
                const assessmentContent = generateSkillAssessmentHTML(skillAssessment);
                console.log('ğŸ¨ HTMLå†…å®¹é•¿åº¦:', assessmentContent.length);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    console.log('âœ… å‡†å¤‡æ˜¾ç¤ºæ¨¡æ€æ¡†...');
                    ModalUtils.show('ğŸ“Š æŠ€èƒ½è¯„ä¼°æŠ¥å‘Š', assessmentContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºæŠ€èƒ½è¯„ä¼°æ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰æˆ–ç¼ºå°‘showæ–¹æ³•');
                    // åˆ›å»ºç®€å•çš„æç¤ºæ¡†ä½œä¸ºfallback
                    const fallbackModal = document.createElement('div');
                    fallbackModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.5); z-index: 9999; display: flex;
                        align-items: center; justify-content: center;
                    `;
                    fallbackModal.innerHTML = `
                        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 80vw; max-height: 80vh; overflow: auto;">
                            <button onclick="this.closest('div').parentNode.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
                            <div>${assessmentContent}</div>
                        </div>
                    `;
                    document.body.appendChild(fallbackModal);
                }
            } catch (error) {
                console.error('âŒ æŠ€èƒ½è¯„ä¼°ç”Ÿæˆå¤±è´¥:', error);
                console.error('âŒ é”™è¯¯å †æ ˆ:', error.stack);
                alert('æŠ€èƒ½è¯„ä¼°å‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeSkillsComprehensive(data) {
            const skillFramework = {
                technical: {
                    name: 'æŠ€æœ¯æŠ€èƒ½',
                    icon: 'ğŸ’»',
                    color: '#1976d2',
                    categories: {
                        programming: { name: 'ç¼–ç¨‹å¼€å‘', keywords: ['ç¼–ç¨‹', 'å¼€å‘', 'ä»£ç ', 'è½¯ä»¶', 'Python', 'Java', 'JavaScript', 'å‰ç«¯', 'åç«¯'] },
                        tools: { name: 'å·¥å…·ä½¿ç”¨', keywords: ['å·¥å…·', 'è½¯ä»¶', 'ç³»ç»Ÿ', 'å¹³å°', 'Office', 'Photoshop', 'Excel'] },
                        technical_writing: { name: 'æŠ€æœ¯æ–‡æ¡£', keywords: ['æ–‡æ¡£', 'æŠ€æœ¯å†™ä½œ', 'è§„èŒƒ', 'æ ‡å‡†', 'æµç¨‹'] }
                    }
                },
                soft: {
                    name: 'è½¯æŠ€èƒ½',
                    icon: 'ğŸ¤',
                    color: '#ff9800',
                    categories: {
                        communication: { name: 'æ²Ÿé€šè¡¨è¾¾', keywords: ['æ²Ÿé€š', 'è¡¨è¾¾', 'æ¼”è®²', 'æ±‡æŠ¥', 'äº¤æµ', 'å†™ä½œ'] },
                        leadership: { name: 'é¢†å¯¼ç®¡ç†', keywords: ['é¢†å¯¼', 'ç®¡ç†', 'å›¢é˜Ÿ', 'åè°ƒ', 'ç»„ç»‡', 'å†³ç­–'] },
                        collaboration: { name: 'åä½œèƒ½åŠ›', keywords: ['åä½œ', 'åˆä½œ', 'é…åˆ', 'å›¢é˜Ÿ', 'é›†ä½“'] }
                    }
                },
                business: {
                    name: 'å•†ä¸šæŠ€èƒ½',
                    icon: 'ğŸ“ˆ',
                    color: '#4caf50',
                    categories: {
                        analysis: { name: 'åˆ†ææ€ç»´', keywords: ['åˆ†æ', 'æ•°æ®', 'é€»è¾‘', 'æ€ç»´', 'è§£å†³é—®é¢˜', 'å†³ç­–'] },
                        market: { name: 'å¸‚åœºæ´å¯Ÿ', keywords: ['å¸‚åœº', 'å•†ä¸š', 'å®¢æˆ·', 'ç”¨æˆ·', 'éœ€æ±‚', 'ç«äº‰'] },
                        project: { name: 'é¡¹ç›®ç®¡ç†', keywords: ['é¡¹ç›®', 'ç®¡ç†', 'è®¡åˆ’', 'æ‰§è¡Œ', 'ç›‘æ§', 'é£é™©'] }
                    }
                },
                personal: {
                    name: 'ä¸ªäººå‘å±•',
                    icon: 'ğŸŒ±',
                    color: '#9c27b0',
                    categories: {
                        learning: { name: 'å­¦ä¹ èƒ½åŠ›', keywords: ['å­¦ä¹ ', 'æˆé•¿', 'å‘å±•', 'æå‡', 'è¿›æ­¥', 'æŒæ¡'] },
                        efficiency: { name: 'æ•ˆç‡ç®¡ç†', keywords: ['æ•ˆç‡', 'æ—¶é—´', 'ç®¡ç†', 'ä¼˜åŒ–', 'æµç¨‹', 'æ–¹æ³•'] },
                        innovation: { name: 'åˆ›æ–°æ€ç»´', keywords: ['åˆ›æ–°', 'åˆ›æ„', 'çªç ´', 'æ”¹è¿›', 'ä¼˜åŒ–', 'æ¢ç´¢'] }
                    }
                }
            };

            const assessment = {};
            const allContent = `
                ${data.strategicGoals || ''} 
                ${data.quarter1Milestones || ''} 
                ${data.quarter2Milestones || ''} 
                ${data.projects || ''} 
                ${data.skills || ''}
            `.toLowerCase();

            Object.keys(skillFramework).forEach(domain => {
                const domainInfo = skillFramework[domain];
                assessment[domain] = {
                    ...domainInfo,
                    categories: {},
                    overallScore: 0
                };

                let domainTotal = 0;
                let categoryCount = 0;

                Object.keys(domainInfo.categories).forEach(category => {
                    const categoryInfo = domainInfo.categories[category];
                    const matches = categoryInfo.keywords.filter(keyword => 
                        allContent.includes(keyword)
                    ).length;
                    
                    const score = Math.min(100, matches * 15 + Math.random() * 10);
                    const level = getSkillLevel(score);
                    
                    assessment[domain].categories[category] = {
                        ...categoryInfo,
                        score: Math.round(score),
                        level: level,
                        matchedKeywords: categoryInfo.keywords.filter(keyword => 
                            allContent.includes(keyword)
                        ),
                        recommendations: generateSkillRecommendations(category, score)
                    };

                    domainTotal += score;
                    categoryCount++;
                });

                assessment[domain].overallScore = Math.round(domainTotal / categoryCount);
            });

            // è®¡ç®—æŠ€èƒ½é›·è¾¾å›¾æ•°æ®
            const radarData = generateSkillRadarData(assessment);
            
            // ç”Ÿæˆå‘å±•å»ºè®®
            const developmentPlan = generateSkillDevelopmentPlan(assessment);

            return {
                domains: assessment,
                radar: radarData,
                development: developmentPlan,
                summary: generateSkillSummary(assessment)
            };
        }

        function getSkillLevel(score) {
            if (score >= 80) return { name: 'ä¸“å®¶', icon: 'ğŸ†', color: '#4caf50' };
            if (score >= 60) return { name: 'ç†Ÿç»ƒ', icon: 'â­', color: '#ff9800' };
            if (score >= 40) return { name: 'è¿›é˜¶', icon: 'ğŸ“ˆ', color: '#2196f3' };
            if (score >= 20) return { name: 'å…¥é—¨', icon: 'ğŸŒ±', color: '#9c27b0' };
            return { name: 'å¾…å‘å±•', icon: 'ğŸ’¡', color: '#f44336' };
        }

        function generateSkillRecommendations(category, score) {
            const recommendations = {
                programming: [
                    'å‚åŠ ç¼–ç¨‹è®­ç»ƒè¥æˆ–åœ¨çº¿è¯¾ç¨‹',
                    'å®Œæˆå®é™…é¡¹ç›®ç»ƒä¹ ',
                    'é˜…è¯»ä¼˜ç§€ä»£ç å’ŒæŠ€æœ¯æ–‡æ¡£',
                    'å‚ä¸å¼€æºé¡¹ç›®è´¡çŒ®'
                ],
                communication: [
                    'å‚åŠ æ¼”è®²ä¿±ä¹éƒ¨å¦‚Toastmasters',
                    'å¤šå†™æŠ€æœ¯åšå®¢å’Œæ–‡æ¡£',
                    'ä¸»åŠ¨åœ¨ä¼šè®®ä¸­å‘è¨€',
                    'ç»ƒä¹ ä¸€å¯¹ä¸€æ²Ÿé€šæŠ€å·§'
                ],
                analysis: [
                    'å­¦ä¹ æ•°æ®åˆ†æå·¥å…·',
                    'åŸ¹å…»é€»è¾‘æ€ç»´èƒ½åŠ›',
                    'ç»ƒä¹ æ¡ˆä¾‹åˆ†ææ–¹æ³•',
                    'å­¦ä¹ å•†ä¸šåˆ†ææ¡†æ¶'
                ],
                learning: [
                    'åˆ¶å®šç³»ç»Ÿçš„å­¦ä¹ è®¡åˆ’',
                    'å»ºç«‹çŸ¥è¯†ç®¡ç†ä½“ç³»',
                    'åŸ¹å…»åæ€æ€»ç»“ä¹ æƒ¯',
                    'å¯»æ‰¾å­¦ä¹ ä¼™ä¼´å’Œå¯¼å¸ˆ'
                ]
            };

            const defaultRecs = [
                'è®¾å®šæ˜ç¡®çš„æŠ€èƒ½å‘å±•ç›®æ ‡',
                'å¯»æ‰¾å®è·µåº”ç”¨çš„æœºä¼š',
                'å‘ç›¸å…³é¢†åŸŸä¸“å®¶å­¦ä¹ ',
                'å®šæœŸå›é¡¾å’Œè°ƒæ•´å­¦ä¹ æ–¹æ³•'
            ];

            return recommendations[category] || defaultRecs;
        }

        function generateSkillRadarData(assessment) {
            return Object.keys(assessment).map(domain => ({
                domain: assessment[domain].name,
                score: assessment[domain].overallScore,
                color: assessment[domain].color
            }));
        }

        function generateSkillDevelopmentPlan(assessment) {
            const weakestDomains = Object.keys(assessment)
                .map(domain => ({
                    domain,
                    score: assessment[domain].overallScore,
                    name: assessment[domain].name
                }))
                .sort((a, b) => a.score - b.score)
                .slice(0, 2);

            const strongestDomains = Object.keys(assessment)
                .map(domain => ({
                    domain,
                    score: assessment[domain].overallScore,
                    name: assessment[domain].name
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 2);

            return {
                priorityAreas: weakestDomains,
                strengthAreas: strongestDomains,
                actionPlan: generateSkillActionPlan(weakestDomains, assessment)
            };
        }

        function generateSkillActionPlan(weakAreas, assessment) {
            return weakAreas.map(area => {
                const domain = assessment[area.domain];
                const weakestCategory = Object.keys(domain.categories)
                    .map(cat => ({
                        category: cat,
                        ...domain.categories[cat]
                    }))
                    .sort((a, b) => a.score - b.score)[0];

                return {
                    area: area.name,
                    focus: weakestCategory.name,
                    score: weakestCategory.score,
                    actions: weakestCategory.recommendations.slice(0, 2)
                };
            });
        }

        function generateSkillSummary(assessment) {
            const overallScore = Object.values(assessment)
                .reduce((sum, domain) => sum + domain.overallScore, 0) / Object.keys(assessment).length;

            const strengths = [];
            const improvements = [];

            Object.keys(assessment).forEach(domain => {
                const domainData = assessment[domain];
                if (domainData.overallScore >= 60) {
                    strengths.push(domainData.name);
                } else {
                    improvements.push(domainData.name);
                }
            });

            return {
                overallScore: Math.round(overallScore),
                level: getSkillLevel(overallScore),
                strengths,
                improvements
            };
        }

        function generateSkillAssessmentHTML(assessment) {
            // ç¡®ä¿assessmentå¯¹è±¡çš„åŸºæœ¬ç»“æ„
            if (!assessment || !assessment.summary) {
                console.error('âŒ æŠ€èƒ½è¯„ä¼°æ•°æ®ç»“æ„ä¸å®Œæ•´:', assessment);
                return `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3em; margin-bottom: 16px;">âš ï¸</div>
                        <h3 style="color: #f44336;">æ•°æ®åŠ è½½å¤±è´¥</h3>
                        <p style="color: #666;">è¯·ç¡®ä¿æ‚¨çš„åŠå¹´è®¡åˆ’åŒ…å«è¶³å¤Ÿçš„å†…å®¹è¿›è¡Œåˆ†æ</p>
                    </div>
                `;
            }

            console.log('ğŸ¨ å¼€å§‹ç”ŸæˆæŠ€èƒ½è¯„ä¼°HTMLï¼Œæ•°æ®ç»“æ„:', assessment);

            const summary = assessment.summary || {};
            const domains = assessment.domains || {};
            const radar = assessment.radar || [];
            const development = assessment.development || {};

            return `
                <div style="margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ“Š</div>
                        <h3 style="color: #1976d2; margin: 0;">æŠ€èƒ½è¯„ä¼°æŠ¥å‘Š</h3>
                        <p style="color: #666; margin: 8px 0 0 0;">åŸºäºæ‚¨çš„è®¡åˆ’å†…å®¹è¿›è¡Œçš„å…¨æ–¹ä½æŠ€èƒ½åˆ†æ</p>
                    </div>
                </div>

                <!-- ç»¼åˆæŠ€èƒ½æ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, #1976d2, #42a5f5); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white; text-align: center;">
                    <h4 style="margin: 0 0 12px 0; font-size: 1.2em;">ğŸ¯ ç»¼åˆæŠ€èƒ½æ°´å¹³</h4>
                    <div style="font-size: 3em; font-weight: bold; margin: 12px 0;">${summary.overallScore || 0}</div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 1.1em;">
                        <span>${(summary.level && summary.level.icon) || 'ğŸ’¡'}</span>
                        <span>${(summary.level && summary.level.name) || 'å¾…è¯„ä¼°'}</span>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.9; margin-top: 8px;">
                        ä¼˜åŠ¿é¢†åŸŸ: ${(summary.strengths || []).join('ã€') || 'å¾…æŒ–æ˜'}
                    </div>
                </div>

                <!-- å››å¤§æŠ€èƒ½åŸŸè¯¦ç»†åˆ†æ -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #1976d2; margin-bottom: 16px;">ğŸ§  æŠ€èƒ½åŸŸæ·±åº¦åˆ†æ</h4>
                    <div style="display: grid; gap: 16px;">
                        ${Object.keys(domains).map(domain => {
                            const domainData = domains[domain];
                            if (!domainData) return '';
                            
                            return `
                                <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 4px solid ${domainData.color || '#ccc'};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 1.2em;">${domainData.icon || 'ğŸ“Š'}</span>
                                            <strong style="font-size: 1.1em;">${domainData.name || domain}</strong>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="background: ${domainData.color || '#ccc'}; color: white; padding: 4px 12px; border-radius: 16px; font-size: 0.9em; font-weight: bold;">
                                                ${domainData.overallScore || 0}åˆ†
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <!-- å­æŠ€èƒ½åˆ†æ -->
                                    <div style="display: grid; gap: 12px;">
                                        ${Object.keys(domainData.categories || {}).map(category => {
                                            const catData = domainData.categories[category];
                                            if (!catData) return '';
                                            
                                            return `
                                                <div style="background: white; border-radius: 8px; padding: 12px;">
                                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                                        <span style="font-weight: 500;">${catData.name || category}</span>
                                                        <div style="display: flex; align-items: center; gap: 6px;">
                                                            <span style="font-size: 0.9em;">${(catData.level && catData.level.icon) || 'ğŸ’¡'}</span>
                                                            <span style="color: ${(catData.level && catData.level.color) || '#666'}; font-size: 0.8em; font-weight: 500;">${(catData.level && catData.level.name) || 'å¾…è¯„ä¼°'}</span>
                                                            <span style="font-size: 0.9em; font-weight: bold;">${catData.score || 0}%</span>
                                                        </div>
                                                    </div>
                                                    <div style="background: #e0e0e0; height: 6px; border-radius: 3px; overflow: hidden;">
                                                        <div style="background: ${domainData.color || '#ccc'}; height: 100%; width: ${catData.score || 0}%; border-radius: 3px; transition: width 0.5s ease;"></div>
                                                    </div>
                                                    ${(catData.matchedKeywords && catData.matchedKeywords.length > 0) ? `
                                                        <div style="margin-top: 8px; font-size: 0.8em; color: #666;">
                                                            ç›¸å…³æŠ€èƒ½: ${catData.matchedKeywords.slice(0, 3).join('ã€')}
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- æŠ€èƒ½é›·è¾¾å›¾ -->
                <div style="background: #f3e5f5; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <h4 style="color: #7b1fa2; margin: 0 0 16px 0; text-align: center;">ğŸ“¡ æŠ€èƒ½é›·è¾¾å›¾</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; text-align: center;">
                        ${radar.map(item => `
                            <div style="background: white; border-radius: 8px; padding: 16px;">
                                <div style="font-size: 0.9em; font-weight: 500; margin-bottom: 8px;">${item.domain || 'æœªçŸ¥'}</div>
                                <div style="position: relative; width: 80px; height: 80px; margin: 0 auto; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <div style="position: absolute; width: ${Math.min(80, (item.score || 0) * 0.8)}px; height: ${Math.min(80, (item.score || 0) * 0.8)}px; background: ${item.color || '#ccc'}; border-radius: 50%; opacity: 0.7;"></div>
                                    <span style="position: relative; z-index: 1; font-weight: bold; color: #333;">${item.score || 0}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- å‘å±•è¡ŒåŠ¨è®¡åˆ’ -->
                <div style="background: #e8f5e9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #2e7d32; margin: 0 0 16px 0;">ğŸ¯ ä¸ªæ€§åŒ–å‘å±•è®¡åˆ’</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #4caf50; margin: 0 0 12px 0;">ğŸš€ ä¼˜å…ˆå‘å±•é¢†åŸŸ</h5>
                        ${(development.actionPlan || []).map(plan => `
                            <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid #ff9800;">
                                <div style="font-weight: 500; margin-bottom: 8px;">
                                    ${plan.area || 'æœªçŸ¥é¢†åŸŸ'} - ${plan.focus || 'å¾…å®š'} 
                                    <span style="color: #ff9800; font-size: 0.8em;">(å½“å‰: ${plan.score || 0}åˆ†)</span>
                                </div>
                                <div style="font-size: 0.9em; color: #666;">
                                    æ¨èè¡ŒåŠ¨:
                                    <ul style="margin: 4px 0 0 16px; padding: 0;">
                                        ${(plan.actions || []).map(action => `<li>${action}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div>
                        <h5 style="color: #4caf50; margin: 0 0 12px 0;">ğŸ’ª å‘æŒ¥ä¼˜åŠ¿é¢†åŸŸ</h5>
                        ${(development.strengthAreas || []).map(strength => `
                            <div style="background: white; border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 4px solid #4caf50;">
                                <div style="font-weight: 500; color: #2e7d32;">
                                    ${strength.name || 'æœªçŸ¥'} 
                                    <span style="font-size: 0.8em;">(${strength.score || 0}åˆ†)</span>
                                </div>
                                <div style="font-size: 0.8em; color: #666;">ç»§ç»­ä¿æŒå¹¶è€ƒè™‘åˆ†äº«ç»éªŒï¼Œæˆä¸ºè¯¥é¢†åŸŸçš„ä¸“å®¶</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- æŠ€èƒ½å‘å±•æ—¶é—´çº¿ -->
                <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #1565c0; margin: 0 0 16px 0;">â° 6ä¸ªæœˆæŠ€èƒ½å‘å±•è·¯çº¿å›¾</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px;">å‰2ä¸ªæœˆ</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ è¯„ä¼°ç°çŠ¶<br>
                                â€¢ åˆ¶å®šè®¡åˆ’<br>
                                â€¢ å¼€å§‹å­¦ä¹ 
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px;">ä¸­2ä¸ªæœˆ</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ æ·±å…¥å®è·µ<br>
                                â€¢ é¡¹ç›®åº”ç”¨<br>
                                â€¢ åé¦ˆè°ƒæ•´
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #1976d2; margin-bottom: 8px;">å2ä¸ªæœˆ</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ å·©å›ºæå‡<br>
                                â€¢ ç»éªŒæ€»ç»“<br>
                                â€¢ è§„åˆ’è¿›é˜¶
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æåŠŸèƒ½
        function generateBalanceAnalysis() {
            console.log('ğŸ”¥ å¼€å§‹ç”Ÿæˆå·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æ...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('âš–ï¸ å¹³è¡¡åˆ†æ-åŠ è½½çš„æ•°æ®:', currentData);
                
                const balanceAnalysis = analyzeWorkLifeBalance(currentData);
                console.log('âš–ï¸ å¹³è¡¡åˆ†æç»“æœ:', balanceAnalysis);
                
                // éªŒè¯æ•°æ®ç»“æ„
                if (!balanceAnalysis || !balanceAnalysis.dimensions) {
                    throw new Error('å¹³è¡¡åˆ†ææ•°æ®ç»“æ„å¼‚å¸¸');
                }
                
                const balanceContent = generateBalanceAnalysisHTML(balanceAnalysis);
                console.log('ğŸ¨ ç”Ÿæˆçš„å¹³è¡¡åˆ†æHTMLé•¿åº¦:', balanceContent.length);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æ', balanceContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºå·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†ææ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰');
                    // åˆ›å»ºç®€å•çš„æç¤ºæ¡†ä½œä¸ºfallback
                    const fallbackModal = document.createElement('div');
                    fallbackModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.5); z-index: 9999; display: flex;
                        align-items: center; justify-content: center;
                    `;
                    fallbackModal.innerHTML = `
                        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 80vw; max-height: 80vh; overflow: auto;">
                            <button onclick="this.closest('div').parentNode.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
                            <div>${balanceContent}</div>
                        </div>
                    `;
                    document.body.appendChild(fallbackModal);
                }
            } catch (error) {
                console.error('âŒ å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æç”Ÿæˆå¤±è´¥:', error);
                console.error('âŒ é”™è¯¯å †æ ˆ:', error.stack);
                alert('å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æå‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeWorkLifeBalance(data) {
            console.log('ğŸ” å¼€å§‹åˆ†æå·¥ä½œç”Ÿæ´»å¹³è¡¡æ•°æ®...');
            
            // åŸºç¡€æ•°æ®
            const balanceContent = data.balance || '';
            const allContent = `
                ${data.strategicGoals || ''} 
                ${data.quarter1Milestones || ''} 
                ${data.quarter2Milestones || ''} 
                ${data.projects || ''} 
                ${data.skills || ''}
                ${balanceContent}
            `.toLowerCase();

            // å¹³è¡¡ç»´åº¦æ¡†æ¶
            const balanceDimensions = {
                work: {
                    name: 'å·¥ä½œå‘å±•',
                    icon: 'ğŸ’¼',
                    color: '#1976d2',
                    keywords: ['å·¥ä½œ', 'èŒä¸š', 'é¡¹ç›®', 'ä»»åŠ¡', 'æ•ˆç‡', 'æˆå°±', 'ç›®æ ‡', 'ä¸šåŠ¡', 'èŒè´£', 'ä¼šè®®', 'åŠ ç­', 'æˆªæ­¢æ—¥æœŸ'],
                    weight: 0.3
                },
                health: {
                    name: 'å¥åº·ç®¡ç†',
                    icon: 'ğŸƒâ€â™‚ï¸',
                    color: '#4caf50',
                    keywords: ['å¥åº·', 'è¿åŠ¨', 'é”»ç‚¼', 'é¥®é£Ÿ', 'ç¡çœ ', 'ä½“æ£€', 'æ”¾æ¾', 'ä¼‘æ¯', 'èº«ä½“', 'ç²¾ç¥', 'å‹åŠ›', 'å†¥æƒ³'],
                    weight: 0.25
                },
                relationship: {
                    name: 'äººé™…å…³ç³»',
                    icon: 'ğŸ‘¥',
                    color: '#ff9800',
                    keywords: ['å®¶åº­', 'æœ‹å‹', 'ç¤¾äº¤', 'äººé™…', 'å…³ç³»', 'æ²Ÿé€š', 'é™ªä¼´', 'èšä¼š', 'äº¤æµ', 'ä¼´ä¾£', 'çˆ¶æ¯', 'å­©å­'],
                    weight: 0.25
                },
                personal: {
                    name: 'ä¸ªäººæˆé•¿',
                    icon: 'ğŸŒ±',
                    color: '#9c27b0',
                    keywords: ['å…´è¶£', 'çˆ±å¥½', 'å­¦ä¹ ', 'é˜…è¯»', 'æ—…è¡Œ', 'æ–‡åŒ–', 'è‰ºæœ¯', 'éŸ³ä¹', 'ç”µå½±', 'æ¸¸æˆ', 'åˆ›ä½œ', 'æ€è€ƒ'],
                    weight: 0.2
                }
            };

            // åˆ†æå„ç»´åº¦
            const dimensionAnalysis = {};
            let totalScore = 0;
            
            Object.keys(balanceDimensions).forEach(dimension => {
                const dimInfo = balanceDimensions[dimension];
                const mentions = dimInfo.keywords.filter(keyword => 
                    allContent.includes(keyword)
                ).length;
                
                const balanceMentions = dimInfo.keywords.filter(keyword => 
                    balanceContent.toLowerCase().includes(keyword)
                ).length;
                
                const attentionScore = Math.min(100, mentions * 8 + balanceMentions * 15);
                const level = getBalanceLevel(attentionScore);
                
                dimensionAnalysis[dimension] = {
                    ...dimInfo,
                    attentionScore: Math.round(attentionScore),
                    level: level,
                    matchedKeywords: dimInfo.keywords.filter(keyword => 
                        allContent.includes(keyword)
                    ),
                    balanceActions: extractBalanceActions(balanceContent, dimInfo.keywords),
                    suggestions: generateBalanceRecommendations(dimension, attentionScore)
                };
                
                totalScore += attentionScore * dimInfo.weight;
            });

            // è®¡ç®—å¹³è¡¡æŒ‡æ•°
            const balanceIndex = Math.round(totalScore);
            const balanceLevel = getBalanceLevel(balanceIndex);
            
            // åˆ†æå¹³è¡¡çŠ¶æ€
            const balanceStatus = analyzeBalanceStatus(dimensionAnalysis);
            
            // ç”Ÿæˆæ”¹å–„è®¡åˆ’
            const improvementPlan = generateBalanceImprovementPlan(dimensionAnalysis);

            return {
                dimensions: dimensionAnalysis,
                overall: {
                    balanceIndex: balanceIndex,
                    level: balanceLevel,
                    status: balanceStatus
                },
                improvements: improvementPlan,
                insights: generateBalanceInsights(dimensionAnalysis, balanceIndex)
            };
        }

        function getBalanceLevel(score) {
            if (score >= 80) return { name: 'ä¼˜ç§€å¹³è¡¡', icon: 'ğŸŒŸ', color: '#4caf50', description: 'å„æ–¹é¢å‘å±•å‡è¡¡ï¼ŒçŠ¶æ€è‰¯å¥½' };
            if (score >= 60) return { name: 'è‰¯å¥½å¹³è¡¡', icon: 'ğŸ‘', color: '#8bc34a', description: 'æ•´ä½“å¹³è¡¡è¾ƒå¥½ï¼Œæœ‰æå‡ç©ºé—´' };
            if (score >= 40) return { name: 'éœ€è¦è°ƒæ•´', icon: 'âš ï¸', color: '#ff9800', description: 'å­˜åœ¨å¤±è¡¡é£é™©ï¼Œéœ€è¦å…³æ³¨' };
            if (score >= 20) return { name: 'æ˜æ˜¾å¤±è¡¡', icon: 'ğŸš¨', color: '#f44336', description: 'å¹³è¡¡çŠ¶å†µè¾ƒå·®ï¼Œéœ€è¦æ”¹å–„' };
            return { name: 'ä¸¥é‡å¤±è¡¡', icon: 'ğŸ’”', color: '#d32f2f', description: 'æ€¥éœ€è°ƒæ•´ç”Ÿæ´»æ–¹å¼' };
        }

        function extractBalanceActions(balanceContent, keywords) {
            const lines = balanceContent.split('\n');
            return lines.filter(line => {
                const lineLower = line.toLowerCase();
                return keywords.some(keyword => lineLower.includes(keyword)) && 
                       (line.includes('[ ]') || line.includes('[x]') || line.includes('[X]'));
            }).slice(0, 3); // æœ€å¤š3ä¸ªç›¸å…³è¡ŒåŠ¨
        }

        function generateBalanceRecommendations(dimension, score) {
            const recommendations = {
                work: {
                    high: ['ä¿æŒå·¥ä½œçƒ­æƒ…ï¼Œå¯»æ±‚æ–°çš„æŒ‘æˆ˜', 'åˆ†äº«ç»éªŒï¼ŒæŒ‡å¯¼ä»–äºº', 'è€ƒè™‘èŒä¸šå‘å±•è§„åˆ’'],
                    medium: ['è®¾å®šæ¸…æ™°çš„å·¥ä½œç›®æ ‡', 'æé«˜å·¥ä½œæ•ˆç‡å’ŒæŠ€èƒ½', 'å»ºç«‹è‰¯å¥½çš„å·¥ä½œä¹ æƒ¯'],
                    low: ['é‡æ–°å®¡è§†å·¥ä½œä¼˜å…ˆçº§', 'å¯»æ±‚å·¥ä½œä¸­çš„æˆå°±æ„Ÿ', 'è€ƒè™‘èŒä¸šè½¬æ¢æˆ–è°ƒæ•´']
                },
                health: {
                    high: ['ä¿æŒè‰¯å¥½çš„å¥åº·ä¹ æƒ¯', 'å°è¯•æ–°çš„è¿åŠ¨é¡¹ç›®', 'å…³æ³¨å¿ƒç†å¥åº·'],
                    medium: ['å»ºç«‹è§„å¾‹çš„è¿åŠ¨è®¡åˆ’', 'æ”¹å–„é¥®é£Ÿå’Œç¡çœ ä¹ æƒ¯', 'å®šæœŸä½“æ£€'],
                    low: ['ç«‹å³å¼€å§‹è¿åŠ¨è®¡åˆ’', 'è°ƒæ•´ä½œæ¯æ—¶é—´', 'å¯»æ±‚ä¸“ä¸šå¥åº·æŒ‡å¯¼']
                },
                relationship: {
                    high: ['ç»´æŠ¤ç°æœ‰è‰¯å¥½å…³ç³»', 'æ‰©å±•ç¤¾äº¤åœˆå­', 'å¸®åŠ©ä»–äººå»ºç«‹å…³ç³»'],
                    medium: ['ä¸»åŠ¨è”ç³»æœ‹å‹å®¶äºº', 'å‚åŠ ç¤¾äº¤æ´»åŠ¨', 'æé«˜æ²Ÿé€šæŠ€å·§'],
                    low: ['é‡å»ºé‡è¦å…³ç³»', 'å­¦ä¹ ç¤¾äº¤æŠ€èƒ½', 'å¯»æ±‚å…³ç³»å’¨è¯¢']
                },
                personal: {
                    high: ['æ¢ç´¢æ–°çš„å…´è¶£é¢†åŸŸ', 'æ·±åŒ–ç°æœ‰çˆ±å¥½', 'åˆ†äº«ä¸ªäººæˆé•¿ç»éªŒ'],
                    medium: ['åŸ¹å…»æ–°çš„å…´è¶£çˆ±å¥½', 'å®‰æ’ä¸ªäººæ—¶é—´', 'è¿½æ±‚ä¸ªäººç›®æ ‡'],
                    low: ['æ‰¾å›ä¸ªäººå…´è¶£', 'ä¸ºè‡ªå·±å®‰æ’æ—¶é—´', 'é‡æ–°å‘ç°è‡ªæˆ‘ä»·å€¼']
                }
            };

            const category = score >= 60 ? 'high' : score >= 30 ? 'medium' : 'low';
            return recommendations[dimension]?.[category] || ['éœ€è¦æ›´å¤šå…³æ³¨è¿™ä¸ªé¢†åŸŸ'];
        }

        function analyzeBalanceStatus(dimensionAnalysis) {
            const scores = Object.values(dimensionAnalysis).map(d => d.attentionScore);
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);
            const variance = maxScore - minScore;
            
            if (variance <= 20) {
                return { type: 'balanced', message: 'å„ç»´åº¦å‘å±•ç›¸å¯¹å‡è¡¡' };
            } else if (variance <= 40) {
                return { type: 'moderate_imbalance', message: 'å­˜åœ¨è½»åº¦å¤±è¡¡ï¼Œéœ€è¦é€‚å½“è°ƒæ•´' };
            } else {
                return { type: 'significant_imbalance', message: 'å­˜åœ¨æ˜æ˜¾å¤±è¡¡ï¼Œå»ºè®®é‡ç‚¹å…³æ³¨è–„å¼±ç¯èŠ‚' };
            }
        }

        function generateBalanceImprovementPlan(dimensionAnalysis) {
            const sortedDimensions = Object.entries(dimensionAnalysis)
                .map(([key, data]) => ({ key, ...data }))
                .sort((a, b) => a.attentionScore - b.attentionScore);

            const weakestDimensions = sortedDimensions.slice(0, 2);
            const strongestDimensions = sortedDimensions.slice(-2);

            return {
                focus_areas: weakestDimensions.map(dim => ({
                    dimension: dim.name,
                    icon: dim.icon,
                    score: dim.attentionScore,
                    actions: dim.suggestions.slice(0, 2)
                })),
                maintain_areas: strongestDimensions.map(dim => ({
                    dimension: dim.name,
                    icon: dim.icon,
                    score: dim.attentionScore,
                    advice: 'ç»§ç»­ä¿æŒï¼Œå¹¶å¯ä»¥è€ƒè™‘å¸®åŠ©ä»–äººæˆ–æ·±å…¥å‘å±•'
                }))
            };
        }

        function generateBalanceInsights(dimensionAnalysis, balanceIndex) {
            const insights = [];
            
            // æ•´ä½“æ´å¯Ÿ
            if (balanceIndex >= 70) {
                insights.push('ğŸ‰ æ‚¨çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡çŠ¶å†µæ•´ä½“è‰¯å¥½ï¼Œç»§ç»­ä¿æŒè¿™ç§çŠ¶æ€ï¼');
            } else if (balanceIndex >= 50) {
                insights.push('ğŸ‘ æ‚¨çš„å¹³è¡¡çŠ¶å†µå¤„äºä¸­ç­‰æ°´å¹³ï¼Œæœ‰è¿›ä¸€æ­¥ä¼˜åŒ–çš„ç©ºé—´ã€‚');
            } else {
                insights.push('âš ï¸ æ‚¨çš„å·¥ä½œç”Ÿæ´»å¹³è¡¡éœ€è¦é‡ç‚¹å…³æ³¨å’Œæ”¹å–„ã€‚');
            }
            
            // ç»´åº¦ç‰¹å®šæ´å¯Ÿ
            const workScore = dimensionAnalysis.work?.attentionScore || 0;
            const healthScore = dimensionAnalysis.health?.attentionScore || 0;
            
            if (workScore > healthScore + 30) {
                insights.push('ğŸ’¼ æ‚¨å¯èƒ½è¿‡åº¦ä¸“æ³¨äºå·¥ä½œï¼Œå»ºè®®å¢åŠ å¥åº·ç®¡ç†çš„æŠ•å…¥ã€‚');
            }
            
            if (healthScore < 30) {
                insights.push('ğŸƒâ€â™‚ï¸ å¥åº·æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼Œå»ºè®®ä¼˜å…ˆæ”¹å–„å¥åº·ç›¸å…³ä¹ æƒ¯ã€‚');
            }
            
            const personalScore = dimensionAnalysis.personal?.attentionScore || 0;
            if (personalScore < 25) {
                insights.push('ğŸŒ± ä¸è¦å¿˜è®°ä¸ºè‡ªå·±çš„å…´è¶£å’Œæˆé•¿ç•™å‡ºæ—¶é—´ã€‚');
            }
            
            return insights;
        }

        function generateBalanceAnalysisHTML(analysis) {
            // å®‰å…¨æ€§æ£€æŸ¥
            if (!analysis || typeof analysis !== 'object') {
                console.error('âŒ åˆ†ææ•°æ®æ— æ•ˆ:', analysis);
                return '<div style="text-align: center; padding: 40px;"><h3 style="color: #f44336;">æ•°æ®åˆ†æå¼‚å¸¸</h3><p>è¯·é‡æ–°å°è¯•åˆ†æ</p></div>';
            }

            const { dimensions, overall, improvements, insights } = analysis;
            
            // ç¡®ä¿å¿…è¦çš„æ•°æ®å­˜åœ¨
            if (!dimensions || typeof dimensions !== 'object') {
                console.error('âŒ ç»´åº¦æ•°æ®æ— æ•ˆ:', dimensions);
                return '<div style="text-align: center; padding: 40px;"><h3 style="color: #f44336;">ç»´åº¦æ•°æ®å¼‚å¸¸</h3><p>è¯·ç¡®ä¿æ‚¨çš„è®¡åˆ’åŒ…å«è¶³å¤Ÿçš„å†…å®¹</p></div>';
            }

            return `
                <div style="margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">âš–ï¸</div>
                        <h3 style="color: #795548; margin: 0;">å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æ</h3>
                        <p style="color: #666; margin: 8px 0 0 0;">åŸºäºæ‚¨çš„è®¡åˆ’å†…å®¹è¿›è¡Œçš„å…¨æ–¹ä½å¹³è¡¡åˆ†æ</p>
                    </div>
                </div>

                <!-- æ•´ä½“å¹³è¡¡æŒ‡æ•° -->
                <div style="background: linear-gradient(135deg, #795548, #8d6e63); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white; text-align: center;">
                    <h4 style="margin: 0 0 12px 0; font-size: 1.2em;">âš–ï¸ å¹³è¡¡æŒ‡æ•°</h4>
                    <div style="font-size: 3em; font-weight: bold; margin: 12px 0;">${overall.balanceIndex}</div>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 1.1em;">
                        <span>${overall.level.icon}</span>
                        <span>${overall.level.name}</span>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.9; margin-top: 8px;">
                        ${overall.level.description}
                    </div>
                    <div style="font-size: 0.8em; opacity: 0.8; margin-top: 8px;">
                        ${overall.status.message}
                    </div>
                </div>

                <!-- å››ç»´åº¦è¯¦ç»†åˆ†æ -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #795548; margin-bottom: 16px;">ğŸ“Š å››ç»´åº¦æ·±åº¦åˆ†æ</h4>
                    <div style="display: grid; gap: 16px;">
                        ${Object.keys(dimensions).map(key => {
                            const dimension = dimensions[key];
                            return `
                                <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 4px solid ${dimension.color};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="font-size: 1.2em;">${dimension.icon}</span>
                                            <strong style="font-size: 1.1em;">${dimension.name}</strong>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span style="background: ${dimension.color}; color: white; padding: 4px 12px; border-radius: 16px; font-size: 0.9em; font-weight: bold;">
                                                ${dimension.attentionScore}åˆ†
                                            </span>
                                            <span style="font-size: 0.9em;">${dimension.level.icon}</span>
                                        </div>
                                    </div>
                                    
                                    <!-- è¿›åº¦æ¡ -->
                                    <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                                        <div style="background: ${dimension.color}; height: 100%; width: ${dimension.attentionScore}%; border-radius: 4px; transition: width 0.5s ease;"></div>
                                    </div>
                                    
                                    <!-- å…³é”®è¯åŒ¹é… -->
                                    ${dimension.matchedKeywords.length > 0 ? `
                                        <div style="margin-bottom: 12px;">
                                            <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">å‘ç°çš„å…³é”®æ´»åŠ¨:</div>
                                            <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                                                ${dimension.matchedKeywords.slice(0, 6).map(keyword => `
                                                    <span style="background: ${dimension.color}20; color: ${dimension.color}; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">${keyword}</span>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    <!-- ç›¸å…³è¡ŒåŠ¨ -->
                                    ${dimension.balanceActions.length > 0 ? `
                                        <div style="margin-bottom: 12px;">
                                            <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">ç›¸å…³è®¡åˆ’è¡ŒåŠ¨:</div>
                                            ${dimension.balanceActions.map(action => `
                                                <div style="font-size: 0.8em; padding: 4px 8px; background: white; border-radius: 4px; margin-bottom: 2px;">
                                                    ${action}
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    
                                    <!-- æ”¹å–„å»ºè®® -->
                                    <div>
                                        <div style="font-size: 0.9em; color: #666; margin-bottom: 6px;">æ”¹å–„å»ºè®®:</div>
                                        <ul style="margin: 0; padding-left: 16px; font-size: 0.9em;">
                                            ${dimension.suggestions.map(suggestion => `<li style="margin-bottom: 4px;">${suggestion}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- å¹³è¡¡é›·è¾¾å›¾ -->
                <div style="background: #f3e5f5; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <h4 style="color: #7b1fa2; margin: 0 0 16px 0; text-align: center;">ğŸ“¡ å¹³è¡¡é›·è¾¾å›¾</h4>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; text-align: center;">
                        ${Object.values(dimensions).map(dimension => `
                            <div style="background: white; border-radius: 8px; padding: 16px;">
                                <div style="font-size: 0.9em; font-weight: 500; margin-bottom: 8px;">${dimension.icon} ${dimension.name}</div>
                                <div style="position: relative; width: 80px; height: 80px; margin: 0 auto; background: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <div style="position: absolute; width: ${Math.min(80, dimension.attentionScore * 0.8)}px; height: ${Math.min(80, dimension.attentionScore * 0.8)}px; background: ${dimension.color}; border-radius: 50%; opacity: 0.7;"></div>
                                    <span style="position: relative; z-index: 1; font-weight: bold; color: #333;">${dimension.attentionScore}</span>
                                </div>
                                <div style="font-size: 0.8em; color: ${dimension.level.color}; margin-top: 8px;">${dimension.level.name}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- æ ¸å¿ƒæ´å¯Ÿ -->
                <div style="background: #e3f2fd; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <h4 style="color: #1565c0; margin: 0 0 16px 0;">ğŸ’¡ æ ¸å¿ƒæ´å¯Ÿ</h4>
                    ${insights.map(insight => `
                        <div style="background: white; border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 4px solid #2196f3;">
                            <div style="font-size: 0.9em;">${insight}</div>
                        </div>
                    `).join('')}
                </div>

                <!-- æ”¹å–„è¡ŒåŠ¨è®¡åˆ’ -->
                <div style="background: #e8f5e9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #2e7d32; margin: 0 0 16px 0;">ğŸ¯ æ”¹å–„è¡ŒåŠ¨è®¡åˆ’</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <h5 style="color: #4caf50; margin: 0 0 12px 0;">ğŸš€ é‡ç‚¹å…³æ³¨é¢†åŸŸ</h5>
                        ${improvements.focus_areas.map(area => `
                            <div style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid #ff9800;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <span>${area.icon}</span>
                                    <strong>${area.dimension}</strong>
                                    <span style="color: #ff9800; font-size: 0.8em;">(å½“å‰: ${area.score}åˆ†)</span>
                                </div>
                                <div style="font-size: 0.9em; color: #666;">
                                    æ¨èè¡ŒåŠ¨:
                                    <ul style="margin: 4px 0 0 16px; padding: 0;">
                                        ${area.actions.map(action => `<li>${action}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div>
                        <h5 style="color: #4caf50; margin: 0 0 12px 0;">ğŸ’ª ä¿æŒä¼˜åŠ¿é¢†åŸŸ</h5>
                        ${improvements.maintain_areas.map(area => `
                            <div style="background: white; border-radius: 8px; padding: 12px; margin-bottom: 8px; border-left: 4px solid #4caf50;">
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                    <span>${area.icon}</span>
                                    <strong style="color: #2e7d32;">${area.dimension}</strong>
                                    <span style="font-size: 0.8em;">(${area.score}åˆ†)</span>
                                </div>
                                <div style="font-size: 0.8em; color: #666;">${area.advice}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- å¹³è¡¡æ”¹å–„æ—¶é—´çº¿ -->
                <div style="background: linear-gradient(135deg, #fce4ec, #f8bbd9); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #c2185b; margin: 0 0 16px 0;">â° å¹³è¡¡æ”¹å–„æ—¶é—´çº¿</h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #e91e63; margin-bottom: 8px;">ç¬¬1-2å‘¨</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ è¯†åˆ«å…³é”®é—®é¢˜<br>
                                â€¢ è®¾å®šæ”¹å–„ç›®æ ‡<br>
                                â€¢ å»ºç«‹æ–°ä¹ æƒ¯
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #e91e63; margin-bottom: 8px;">ç¬¬3-6å‘¨</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ åšæŒæ–°ä¹ æƒ¯<br>
                                â€¢ è°ƒæ•´å’Œä¼˜åŒ–<br>
                                â€¢ ç›‘æ§è¿›å±•
                            </div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-weight: bold; color: #e91e63; margin-bottom: 8px;">ç¬¬7å‘¨ä»¥å</div>
                            <div style="font-size: 0.9em; color: #666;">
                                â€¢ å·©å›ºæˆæœ<br>
                                â€¢ æŒç»­æ”¹å–„<br>
                                â€¢ åˆ†äº«ç»éªŒ
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // å¹³è¡¡æ”¹å–„å»ºè®®åŠŸèƒ½
        function generateBalanceSuggestions() {
            console.log('ğŸ’¡ å¼€å§‹ç”Ÿæˆå¹³è¡¡æ”¹å–„å»ºè®®...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                
                const balanceAnalysis = analyzeWorkLifeBalance(currentData);
                const suggestions = generateDetailedBalanceSuggestions(balanceAnalysis);
                
                const suggestionsContent = generateBalanceSuggestionsHTML(suggestions);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('ğŸ’¡ å·¥ä½œç”Ÿæ´»å¹³è¡¡æ”¹å–„å»ºè®®', suggestionsContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºå¹³è¡¡æ”¹å–„å»ºè®®æ¨¡æ€æ¡†');
                } else {
                    // åˆ›å»ºç®€å•çš„æç¤ºæ¡†ä½œä¸ºfallback
                    const fallbackModal = document.createElement('div');
                    fallbackModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.5); z-index: 9999; display: flex;
                        align-items: center; justify-content: center;
                    `;
                    fallbackModal.innerHTML = `
                        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 80vw; max-height: 80vh; overflow: auto;">
                            <button onclick="this.closest('div').parentNode.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
                            <div>${suggestionsContent}</div>
                        </div>
                    `;
                    document.body.appendChild(fallbackModal);
                }
            } catch (error) {
                console.error('âŒ å¹³è¡¡æ”¹å–„å»ºè®®ç”Ÿæˆå¤±è´¥:', error);
                alert('å¹³è¡¡æ”¹å–„å»ºè®®ç”Ÿæˆå‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function generateDetailedBalanceSuggestions(analysis) {
            const { dimensions, overall } = analysis;
            
            // åŸºäºæ•´ä½“å¹³è¡¡æŒ‡æ•°ç”Ÿæˆå»ºè®®
            const generalSuggestions = [];
            if (overall.balanceIndex < 40) {
                generalSuggestions.push({
                    priority: 'high',
                    title: 'ç«‹å³è¡ŒåŠ¨ï¼šé‡æ–°è§„åˆ’ç”Ÿæ´»èŠ‚å¥',
                    description: 'æ‚¨çš„å¹³è¡¡çŠ¶å†µéœ€è¦é‡ç‚¹å…³æ³¨ï¼Œå»ºè®®ç«‹å³å¼€å§‹è°ƒæ•´',
                    actions: [
                        'æš‚åœä¸€äº›éå¿…è¦çš„æ´»åŠ¨ï¼Œä¸ºé‡è¦ç»´åº¦è…¾å‡ºæ—¶é—´',
                        'åˆ¶å®šæ˜ç¡®çš„æ—¶é—´åˆ†é…è®¡åˆ’ï¼Œç¡®ä¿å„ç»´åº¦éƒ½æœ‰æŠ•å…¥',
                        'å¯»æ±‚æ”¯æŒç³»ç»Ÿï¼ŒåŒ…æ‹¬å®¶äººæœ‹å‹æˆ–ä¸“ä¸šæŒ‡å¯¼'
                    ]
                });
            } else if (overall.balanceIndex < 70) {
                generalSuggestions.push({
                    priority: 'medium',
                    title: 'ä¼˜åŒ–è°ƒæ•´ï¼šæå‡å¹³è¡¡è´¨é‡',
                    description: 'æ‚¨çš„åŸºç¡€è¿˜ä¸é”™ï¼Œé€šè¿‡ä¼˜åŒ–å¯ä»¥è¾¾åˆ°æ›´å¥½çš„å¹³è¡¡',
                    actions: [
                        'è¯†åˆ«å¹¶å¼ºåŒ–è–„å¼±ç¯èŠ‚',
                        'å»ºç«‹æ›´å¥½çš„æ—¶é—´ç®¡ç†ä¹ æƒ¯',
                        'å®šæœŸè¯„ä¼°å’Œè°ƒæ•´å„ç»´åº¦çš„æŠ•å…¥'
                    ]
                });
            }

            // åŸºäºå„ç»´åº¦ç”Ÿæˆå…·ä½“å»ºè®®
            const dimensionSuggestions = Object.entries(dimensions).map(([key, dimension]) => {
                let category, urgency;
                if (dimension.attentionScore < 30) {
                    category = 'urgent';
                    urgency = 'ç´§æ€¥';
                } else if (dimension.attentionScore < 60) {
                    category = 'improve';
                    urgency = 'æ”¹å–„';
                } else {
                    category = 'maintain';
                    urgency = 'ä¿æŒ';
                }

                return {
                    dimension: dimension.name,
                    icon: dimension.icon,
                    color: dimension.color,
                    score: dimension.attentionScore,
                    category: category,
                    urgency: urgency,
                    suggestions: dimension.suggestions,
                    quickActions: generateQuickActions(key, dimension.attentionScore)
                };
            });

            return {
                general: generalSuggestions,
                dimensions: dimensionSuggestions,
                weeklyPlan: generateWeeklyBalancePlan(dimensionSuggestions),
                habits: generateBalanceHabits(dimensionSuggestions)
            };
        }

        function generateQuickActions(dimension, score) {
            const quickActions = {
                work: score < 40 ? [
                    'æ¯å¤©è®¾å®š3ä¸ªæœ€é‡è¦çš„å·¥ä½œç›®æ ‡',
                    'ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•æé«˜ä¸“æ³¨åº¦',
                    'æ¯å‘¨å®‰æ’1æ¬¡æŠ€èƒ½å­¦ä¹ æ—¶é—´'
                ] : [
                    'å¯»æ‰¾å·¥ä½œä¸­çš„æ–°æŒ‘æˆ˜',
                    'ä¸åŒäº‹åˆ†äº«ç»éªŒå’ŒçŸ¥è¯†',
                    'è€ƒè™‘æ‰¿æ‹…æ›´å¤šè´£ä»»'
                ],
                health: score < 40 ? [
                    'æ¯å¤©æ­¥è¡Œè‡³å°‘30åˆ†é’Ÿ',
                    'è®¾å®šå›ºå®šçš„ç¡çœ æ—¶é—´',
                    'å‡†å¤‡å¥åº·çš„é›¶é£Ÿå’Œé¥®å“'
                ] : [
                    'å°è¯•æ–°çš„è¿åŠ¨é¡¹ç›®',
                    'å®šæœŸè¿›è¡Œèº«ä½“æ£€æŸ¥',
                    'å…³æ³¨å¿ƒç†å¥åº·å’Œå‹åŠ›ç®¡ç†'
                ],
                relationship: score < 40 ? [
                    'æ¯å‘¨ä¸»åŠ¨è”ç³»1-2ä½æœ‹å‹æˆ–å®¶äºº',
                    'å®‰æ’å›ºå®šçš„å®¶åº­æ—¶é—´',
                    'å­¦ä¹ ç§¯æå€¾å¬æŠ€å·§'
                ] : [
                    'ç»„ç»‡æœ‹å‹èšä¼šæˆ–æ´»åŠ¨',
                    'å¸®åŠ©ä»–äººå»ºç«‹ç¤¾äº¤å…³ç³»',
                    'åœ¨å…³ç³»ä¸­æ‰¿æ‹…æ›´å¤šè´£ä»»'
                ],
                personal: score < 40 ? [
                    'æ¯å¤©å®‰æ’30åˆ†é’Ÿçš„ä¸ªäººæ—¶é—´',
                    'é‡æ–°å‘ç°ä¸€ä¸ªæ›¾ç»çš„å…´è¶£',
                    'å¼€å§‹å†™æ—¥è®°æˆ–åæ€'
                ] : [
                    'æŒ‘æˆ˜è‡ªå·±å­¦ä¹ æ–°æŠ€èƒ½',
                    'å‚ä¸åˆ›ä½œæˆ–è‰ºæœ¯æ´»åŠ¨',
                    'åˆ†äº«ä¸ªäººæˆé•¿ç»éªŒ'
                ]
            };

            return quickActions[dimension] || ['å…³æ³¨è¿™ä¸ªé¢†åŸŸçš„å‘å±•'];
        }

        function generateWeeklyBalancePlan(dimensionSuggestions) {
            const urgentDimensions = dimensionSuggestions.filter(d => d.category === 'urgent');
            const improveDimensions = dimensionSuggestions.filter(d => d.category === 'improve');
            
            return {
                monday: urgentDimensions.length > 0 ? `å…³æ³¨${urgentDimensions[0].dimension}` : 'æ•´ä½“è§„åˆ’',
                tuesday: 'å·¥ä½œæ•ˆç‡æå‡',
                wednesday: 'å¥åº·ç®¡ç†æ£€æŸ¥',
                thursday: 'äººé™…å…³ç³»ç»´æŠ¤',
                friday: 'å·¥ä½œæ€»ç»“ä¸è®¡åˆ’',
                weekend: 'ä¸ªäººæ—¶é—´ä¸æ”¾æ¾'
            };
        }

        function generateBalanceHabits(dimensionSuggestions) {
            return [
                { habit: 'æ™¨é—´è§„åˆ’', description: 'æ¯å¤©æ—©ä¸ŠèŠ±5åˆ†é’Ÿè§„åˆ’å½“å¤©å„ç»´åº¦çš„æ´»åŠ¨', frequency: 'æ¯æ—¥' },
                { habit: 'å¹³è¡¡æ£€æŸ¥', description: 'æ¯å‘¨å›é¡¾å„ç»´åº¦çš„æŠ•å…¥æƒ…å†µ', frequency: 'æ¯å‘¨' },
                { habit: 'è¾¹ç•Œè®¾å®š', description: 'ä¸ºå·¥ä½œå’Œç”Ÿæ´»è®¾å®šæ˜ç¡®çš„æ—¶é—´è¾¹ç•Œ', frequency: 'æŒç»­' },
                { habit: 'æ„Ÿæ©è®°å½•', description: 'è®°å½•å„ç»´åº¦ä¸­å€¼å¾—æ„Ÿæ©çš„äº‹æƒ…', frequency: 'æ¯æ—¥' }
            ];
        }

        function generateBalanceSuggestionsHTML(suggestions) {
            return `
                <div style="margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸ’¡</div>
                        <h3 style="color: #7b1fa2; margin: 0;">å·¥ä½œç”Ÿæ´»å¹³è¡¡æ”¹å–„å»ºè®®</h3>
                        <p style="color: #666; margin: 8px 0 0 0;">ä¸ªæ€§åŒ–çš„å¹³è¡¡æ”¹å–„æ–¹æ¡ˆå’Œè¡ŒåŠ¨æŒ‡å—</p>
                    </div>
                </div>

                <!-- æ•´ä½“å»ºè®® -->
                ${suggestions.general.map(suggestion => `
                    <div style="background: ${suggestion.priority === 'high' ? '#ffebee' : '#f3e5f5'}; border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid ${suggestion.priority === 'high' ? '#f44336' : '#9c27b0'};">
                        <h4 style="color: ${suggestion.priority === 'high' ? '#d32f2f' : '#7b1fa2'}; margin: 0 0 12px 0;">${suggestion.title}</h4>
                        <p style="color: #666; margin-bottom: 12px;">${suggestion.description}</p>
                        <ul style="margin: 0; padding-left: 20px;">
                            ${suggestion.actions.map(action => `<li style="margin-bottom: 6px;">${action}</li>`).join('')}
                        </ul>
                    </div>
                `).join('')}

                <!-- ç»´åº¦å»ºè®® -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #7b1fa2; margin-bottom: 16px;">ğŸ¯ åˆ†ç»´åº¦æ”¹å–„å»ºè®®</h4>
                    <div style="display: grid; gap: 16px;">
                        ${suggestions.dimensions.map(dimension => `
                            <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 4px solid ${dimension.color};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 1.2em;">${dimension.icon}</span>
                                        <strong style="font-size: 1.1em;">${dimension.dimension}</strong>
                                        <span style="background: ${dimension.color}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">${dimension.urgency}</span>
                                    </div>
                                    <span style="font-size: 0.9em; color: #666;">${dimension.score}åˆ†</span>
                                </div>
                                
                                <div style="margin-bottom: 16px;">
                                    <h5 style="color: ${dimension.color}; margin: 0 0 8px 0;">ğŸ’« å¿«é€Ÿè¡ŒåŠ¨</h5>
                                    <ul style="margin: 0; padding-left: 16px; font-size: 0.9em;">
                                        ${dimension.quickActions.map(action => `<li style="margin-bottom: 4px;">${action}</li>`).join('')}
                                    </ul>
                                </div>
                                
                                <div>
                                    <h5 style="color: ${dimension.color}; margin: 0 0 8px 0;">ğŸ¯ é•¿æœŸå»ºè®®</h5>
                                    <ul style="margin: 0; padding-left: 16px; font-size: 0.9em;">
                                        ${dimension.suggestions.slice(0, 2).map(suggestion => `<li style="margin-bottom: 4px;">${suggestion}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- æ¯å‘¨å¹³è¡¡è®¡åˆ’ -->
                <div style="background: #e8f5e9; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <h4 style="color: #2e7d32; margin: 0 0 16px 0;">ğŸ“… æ¯å‘¨å¹³è¡¡è®¡åˆ’</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                        ${Object.entries(suggestions.weeklyPlan).map(([day, focus]) => {
                            const dayNames = {
                                monday: 'å‘¨ä¸€',
                                tuesday: 'å‘¨äºŒ', 
                                wednesday: 'å‘¨ä¸‰',
                                thursday: 'å‘¨å››',
                                friday: 'å‘¨äº”',
                                weekend: 'å‘¨æœ«'
                            };
                            return `
                                <div style="background: white; border-radius: 8px; padding: 12px; text-align: center;">
                                    <div style="font-weight: bold; color: #4caf50; margin-bottom: 6px;">${dayNames[day]}</div>
                                    <div style="font-size: 0.8em; color: #666;">${focus}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- å¹³è¡¡ä¹ æƒ¯å…»æˆ -->
                <div style="background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #ef6c00; margin: 0 0 16px 0;">ğŸ”„ å¹³è¡¡ä¹ æƒ¯å…»æˆ</h4>
                    <div style="display: grid; gap: 12px;">
                        ${suggestions.habits.map(habit => `
                            <div style="background: white; border-radius: 8px; padding: 16px; border-left: 4px solid #ff9800;">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                                    <strong style="color: #f57c00;">${habit.habit}</strong>
                                    <span style="background: #ff9800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-left: auto;">${habit.frequency}</span>
                                </div>
                                <div style="font-size: 0.9em; color: #666;">${habit.description}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // å­¦ä¹ è·¯å¾„åŠŸèƒ½
        function generateLearningPath() {
            console.log('ğŸ”¥ å¼€å§‹ç”Ÿæˆå­¦ä¹ è·¯å¾„...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('ğŸ“Š å­¦ä¹ è·¯å¾„-åŠ è½½çš„æ•°æ®:', currentData);
                
                const learningAnalysis = analyzeLearningNeeds(currentData);
                const pathContent = generateLearningPathHTML(learningAnalysis);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('ğŸŒ² ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„', pathContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºå­¦ä¹ è·¯å¾„æ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰');
                    alert('å­¦ä¹ è·¯å¾„åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
                }
            } catch (error) {
                console.error('âŒ å­¦ä¹ è·¯å¾„ç”Ÿæˆå¤±è´¥:', error);
                alert('å­¦ä¹ è·¯å¾„å‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeLearningNeeds(data) {
            // åˆ†æå­¦ä¹ éœ€æ±‚å’Œç›®æ ‡
            const allContent = `
                ${data.strategicGoals || ''} 
                ${data.quarter1Milestones || ''} 
                ${data.quarter2Milestones || ''} 
                ${data.projects || ''} 
                ${data.skills || ''}
            `;

            // å­¦ä¹ è·¯å¾„æ¡†æ¶
            const learningFramework = {
                technical_skills: {
                    name: 'æŠ€æœ¯æŠ€èƒ½è·¯å¾„',
                    icon: 'ğŸ’»',
                    color: '#1976d2',
                    priority: calculateLearningPriority(allContent, ['æŠ€æœ¯', 'ç¼–ç¨‹', 'å¼€å‘', 'å·¥å…·', 'è½¯ä»¶']),
                    tracks: {
                        programming: {
                            name: 'ç¼–ç¨‹å¼€å‘',
                            description: 'æŒæ¡ç¼–ç¨‹è¯­è¨€å’Œå¼€å‘æŠ€èƒ½',
                            levels: [
                                { name: 'åŸºç¡€å…¥é—¨', duration: '2-4å‘¨', skills: ['ç¼–ç¨‹åŸºç¡€', 'è¯­æ³•ç†è§£', 'åŸºæœ¬è°ƒè¯•'] },
                                { name: 'å®è·µåº”ç”¨', duration: '4-6å‘¨', skills: ['é¡¹ç›®å¼€å‘', 'ä»£ç ä¼˜åŒ–', 'å›¢é˜Ÿåä½œ'] },
                                { name: 'é«˜çº§ç²¾é€š', duration: '8-12å‘¨', skills: ['æ¶æ„è®¾è®¡', 'æ€§èƒ½ä¼˜åŒ–', 'æŠ€æœ¯é€‰å‹'] }
                            ]
                        },
                        tools: {
                            name: 'å·¥å…·ä½¿ç”¨',
                            description: 'æŒæ¡å¼€å‘å’ŒåŠå…¬å·¥å…·',
                            levels: [
                                { name: 'åŸºç¡€å·¥å…·', duration: '1-2å‘¨', skills: ['åŸºæœ¬æ“ä½œ', 'å¸¸ç”¨åŠŸèƒ½', 'å¿«æ·é”®'] },
                                { name: 'è¿›é˜¶åŠŸèƒ½', duration: '2-3å‘¨', skills: ['é«˜çº§åŠŸèƒ½', 'è‡ªå®šä¹‰é…ç½®', 'æ’ä»¶ä½¿ç”¨'] },
                                { name: 'ä¸“å®¶çº§', duration: '4-6å‘¨', skills: ['è‡ªåŠ¨åŒ–', 'è„šæœ¬ç¼–å†™', 'å·¥ä½œæµä¼˜åŒ–'] }
                            ]
                        }
                    }
                },
                soft_skills: {
                    name: 'è½¯æŠ€èƒ½è·¯å¾„',
                    icon: 'ğŸ¤',
                    color: '#ff9800',
                    priority: calculateLearningPriority(allContent, ['æ²Ÿé€š', 'é¢†å¯¼', 'ç®¡ç†', 'å›¢é˜Ÿ', 'åä½œ']),
                    tracks: {
                        communication: {
                            name: 'æ²Ÿé€šè¡¨è¾¾',
                            description: 'æå‡æ²Ÿé€šå’Œè¡¨è¾¾èƒ½åŠ›',
                            levels: [
                                { name: 'åŸºç¡€æ²Ÿé€š', duration: '2-3å‘¨', skills: ['å€¾å¬æŠ€å·§', 'æ¸…æ™°è¡¨è¾¾', 'éè¯­è¨€æ²Ÿé€š'] },
                                { name: 'è¿›é˜¶è¡¨è¾¾', duration: '3-4å‘¨', skills: ['æ¼”è®²æŠ€å·§', 'ä¼šè®®ä¸»æŒ', 'æ±‡æŠ¥æŠ€èƒ½'] },
                                { name: 'å½±å“åŠ›æ²Ÿé€š', duration: '6-8å‘¨', skills: ['è¯´æœæŠ€å·§', 'å†²çªè§£å†³', 'è·¨æ–‡åŒ–æ²Ÿé€š'] }
                            ]
                        },
                        leadership: {
                            name: 'é¢†å¯¼ç®¡ç†',
                            description: 'åŸ¹å…»é¢†å¯¼åŠ›å’Œç®¡ç†èƒ½åŠ›',
                            levels: [
                                { name: 'è‡ªæˆ‘ç®¡ç†', duration: '3-4å‘¨', skills: ['æ—¶é—´ç®¡ç†', 'ç›®æ ‡è®¾å®š', 'è‡ªæˆ‘æ¿€åŠ±'] },
                                { name: 'å›¢é˜Ÿé¢†å¯¼', duration: '4-6å‘¨', skills: ['å›¢é˜Ÿå»ºè®¾', 'ä»»åŠ¡åˆ†é…', 'æ¿€åŠ±å›¢é˜Ÿ'] },
                                { name: 'æˆ˜ç•¥é¢†å¯¼', duration: '8-10å‘¨', skills: ['æˆ˜ç•¥æ€ç»´', 'å˜é©ç®¡ç†', 'ç»„ç»‡å‘å±•'] }
                            ]
                        }
                    }
                },
                business_skills: {
                    name: 'å•†ä¸šæŠ€èƒ½è·¯å¾„',
                    icon: 'ğŸ“ˆ',
                    color: '#4caf50',
                    priority: calculateLearningPriority(allContent, ['å•†ä¸š', 'å¸‚åœº', 'åˆ†æ', 'é¡¹ç›®', 'ç­–ç•¥']),
                    tracks: {
                        analysis: {
                            name: 'å•†ä¸šåˆ†æ',
                            description: 'åŸ¹å…»å•†ä¸šåˆ†æå’Œå†³ç­–èƒ½åŠ›',
                            levels: [
                                { name: 'æ•°æ®åŸºç¡€', duration: '2-3å‘¨', skills: ['æ•°æ®æ”¶é›†', 'åŸºç¡€åˆ†æ', 'å›¾è¡¨åˆ¶ä½œ'] },
                                { name: 'æ·±åº¦åˆ†æ', duration: '4-5å‘¨', skills: ['è¶‹åŠ¿åˆ†æ', 'å¯¹æ¯”åˆ†æ', 'é¢„æµ‹æ¨¡å‹'] },
                                { name: 'æˆ˜ç•¥åˆ†æ', duration: '6-8å‘¨', skills: ['å¸‚åœºåˆ†æ', 'ç«äº‰åˆ†æ', 'å•†ä¸šæ¨¡å¼'] }
                            ]
                        },
                        project_management: {
                            name: 'é¡¹ç›®ç®¡ç†',
                            description: 'æŒæ¡é¡¹ç›®ç®¡ç†æ–¹æ³•å’Œå·¥å…·',
                            levels: [
                                { name: 'åŸºç¡€ç®¡ç†', duration: '2-3å‘¨', skills: ['é¡¹ç›®è§„åˆ’', 'ä»»åŠ¡åˆ†è§£', 'è¿›åº¦è·Ÿè¸ª'] },
                                { name: 'è¿›é˜¶ç®¡ç†', duration: '3-5å‘¨', skills: ['é£é™©ç®¡ç†', 'èµ„æºä¼˜åŒ–', 'è´¨é‡æ§åˆ¶'] },
                                { name: 'é«˜çº§ç®¡ç†', duration: '6-8å‘¨', skills: ['æ•æ·ç®¡ç†', 'å›¢é˜Ÿåè°ƒ', 'å¹²ç³»äººç®¡ç†'] }
                            ]
                        }
                    }
                },
                personal_development: {
                    name: 'ä¸ªäººå‘å±•è·¯å¾„',
                    icon: 'ğŸŒ±',
                    color: '#9c27b0',
                    priority: calculateLearningPriority(allContent, ['å­¦ä¹ ', 'æˆé•¿', 'æ€ç»´', 'åˆ›æ–°', 'æ•ˆç‡']),
                    tracks: {
                        learning_ability: {
                            name: 'å­¦ä¹ èƒ½åŠ›',
                            description: 'æå‡å­¦ä¹ æ•ˆç‡å’Œæ–¹æ³•',
                            levels: [
                                { name: 'å­¦ä¹ æ–¹æ³•', duration: '1-2å‘¨', skills: ['å­¦ä¹ è®¡åˆ’', 'ç¬”è®°æ–¹æ³•', 'è®°å¿†æŠ€å·§'] },
                                { name: 'æ·±åº¦å­¦ä¹ ', duration: '2-4å‘¨', skills: ['æ‰¹åˆ¤æ€ç»´', 'ç³»ç»Ÿæ€è€ƒ', 'çŸ¥è¯†è¿æ¥'] },
                                { name: 'ç»ˆèº«å­¦ä¹ ', duration: 'æŒç»­', skills: ['å­¦ä¹ ç¤¾åŒº', 'çŸ¥è¯†ç®¡ç†', 'æ•™å­¦ç›¸é•¿'] }
                            ]
                        },
                        innovation: {
                            name: 'åˆ›æ–°æ€ç»´',
                            description: 'åŸ¹å…»åˆ›æ–°å’Œåˆ›æ„èƒ½åŠ›',
                            levels: [
                                { name: 'åˆ›æ„æ€ç»´', duration: '2-3å‘¨', skills: ['å¤´è„‘é£æš´', 'åˆ›æ„æ–¹æ³•', 'é—®é¢˜é‡æ„'] },
                                { name: 'åˆ›æ–°å®è·µ', duration: '4-5å‘¨', skills: ['åŸå‹è®¾è®¡', 'å¿«é€Ÿè¿­ä»£', 'ç”¨æˆ·åé¦ˆ'] },
                                { name: 'åˆ›æ–°ç®¡ç†', duration: '6-8å‘¨', skills: ['åˆ›æ–°æµç¨‹', 'å›¢é˜Ÿåˆ›æ–°', 'åˆ›æ–°æ–‡åŒ–'] }
                            ]
                        }
                    }
                }
            };

            // ç”Ÿæˆä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„
            const personalizedPath = generatePersonalizedPath(learningFramework, allContent);
            
            // åˆ›å»ºå­¦ä¹ æ—¶é—´çº¿
            const timeline = generateLearningTimeline(personalizedPath);
            
            // æ¨èå­¦ä¹ èµ„æº
            const resources = generateLearningResources(personalizedPath);

            return {
                framework: learningFramework,
                personalizedPath,
                timeline,
                resources,
                recommendations: generateLearningRecommendations(allContent)
            };
        }

        function calculateLearningPriority(content, keywords) {
            const matches = keywords.filter(keyword => 
                content.toLowerCase().includes(keyword)
            ).length;
            return Math.min(100, matches * 20 + Math.random() * 10);
        }

        function generatePersonalizedPath(framework, content) {
            // æ ¹æ®å†…å®¹åˆ†æï¼Œä¸ºæ¯ä¸ªé¢†åŸŸåˆ†é…ä¼˜å…ˆçº§
            const prioritizedDomains = Object.keys(framework)
                .map(domain => ({
                    domain,
                    ...framework[domain],
                    priority: Math.round(framework[domain].priority)
                }))
                .sort((a, b) => b.priority - a.priority);

            // é€‰æ‹©å‰3ä¸ªä¼˜å…ˆé¢†åŸŸ
            const selectedDomains = prioritizedDomains.slice(0, 3);
            
            // ä¸ºæ¯ä¸ªé€‰ä¸­çš„é¢†åŸŸç”Ÿæˆè¯¦ç»†è·¯å¾„
            return selectedDomains.map(domain => {
                const tracks = Object.keys(domain.tracks).map(trackKey => ({
                    key: trackKey,
                    ...domain.tracks[trackKey],
                    estimatedTime: domain.tracks[trackKey].levels.reduce((total, level) => {
                        const weeks = parseInt(level.duration.split('-')[1] || level.duration.split('-')[0]);
                        return total + weeks;
                    }, 0)
                }));

                return {
                    domain: domain.domain,
                    name: domain.name,
                    icon: domain.icon,
                    color: domain.color,
                    priority: domain.priority,
                    tracks,
                    recommendedTrack: tracks[0] // æ¨èç¬¬ä¸€ä¸ªè½¨é“
                };
            });
        }

        function generateLearningTimeline(personalizedPath) {
            const timeline = [];
            let currentWeek = 1;

            personalizedPath.forEach(domain => {
                domain.tracks.forEach(track => {
                    track.levels.forEach((level, index) => {
                        const duration = parseInt(level.duration.split('-')[1] || level.duration.split('-')[0]);
                        timeline.push({
                            week: currentWeek,
                            duration,
                            domain: domain.name,
                            track: track.name,
                            level: level.name,
                            skills: level.skills,
                            color: domain.color,
                            phase: index === 0 ? 'å…¥é—¨' : index === 1 ? 'è¿›é˜¶' : 'ç²¾é€š'
                        });
                        currentWeek += duration;
                    });
                });
            });

            return timeline.slice(0, 24); // é™åˆ¶åœ¨24å‘¨å†…
        }

        function generateLearningResources(personalizedPath) {
            const resourceTypes = {
                books: 'ğŸ“š æ¨èä¹¦ç±',
                courses: 'ğŸ“ åœ¨çº¿è¯¾ç¨‹',
                practice: 'ğŸ’» å®è·µé¡¹ç›®',
                community: 'ğŸ‘¥ å­¦ä¹ ç¤¾åŒº'
            };

            const resources = {};

            personalizedPath.forEach(domain => {
                resources[domain.domain] = {
                    name: domain.name,
                    color: domain.color,
                    items: {
                        books: generateResourceList('books', domain.domain),
                        courses: generateResourceList('courses', domain.domain),
                        practice: generateResourceList('practice', domain.domain),
                        community: generateResourceList('community', domain.domain)
                    }
                };
            });

            return resources;
        }

        function generateResourceList(type, domain) {
            const resourceDatabase = {
                books: {
                    technical_skills: ['ã€Šä»£ç å¤§å…¨ã€‹', 'ã€Šè®¾è®¡æ¨¡å¼ã€‹', 'ã€Šé‡æ„ã€‹'],
                    soft_skills: ['ã€Šå…³é”®å¯¹è¯ã€‹', 'ã€Šå½±å“åŠ›ã€‹', 'ã€Šé«˜æ•ˆèƒ½äººå£«çš„ä¸ƒä¸ªä¹ æƒ¯ã€‹'],
                    business_skills: ['ã€Šä»0åˆ°1ã€‹', 'ã€Šç²¾ç›Šåˆ›ä¸šã€‹', 'ã€Šå•†ä¸šæ¨¡å¼æ–°ç”Ÿä»£ã€‹'],
                    personal_development: ['ã€Šåˆ»æ„ç»ƒä¹ ã€‹', 'ã€Šæ€è€ƒï¼Œå¿«ä¸æ…¢ã€‹', 'ã€ŠåŸåˆ™ã€‹']
                },
                courses: {
                    technical_skills: ['Courseraç¼–ç¨‹è¯¾ç¨‹', 'Udemyå¼€å‘å®æˆ˜', 'edXè®¡ç®—æœºç§‘å­¦'],
                    soft_skills: ['é¢†å¯¼åŠ›è®­ç»ƒè¥', 'Toastmastersæ¼”è®²', 'MindToolsç®¡ç†è¯¾ç¨‹'],
                    business_skills: ['å•†ä¸šåˆ†æè®¤è¯', 'PMPé¡¹ç›®ç®¡ç†', 'MBAæ ¸å¿ƒè¯¾ç¨‹'],
                    personal_development: ['å­¦ä¹ å¦‚ä½•å­¦ä¹ ', 'æ‰¹åˆ¤æ€§æ€ç»´', 'åˆ›æ–°æ–¹æ³•è®º']
                },
                practice: {
                    technical_skills: ['GitHubå¼€æºé¡¹ç›®', 'ä¸ªäººé¡¹ç›®ä½œå“é›†', 'æŠ€æœ¯åšå®¢å†™ä½œ'],
                    soft_skills: ['å›¢é˜Ÿåä½œé¡¹ç›®', 'æ¼”è®²æ¯”èµ›å‚ä¸', 'å¯¼å¸ˆæŒ‡å¯¼å®è·µ'],
                    business_skills: ['å•†ä¸šæ¡ˆä¾‹åˆ†æ', 'åˆ›ä¸šé¡¹ç›®ä½“éªŒ', 'æ•°æ®åˆ†æå®æˆ˜'],
                    personal_development: ['ä¸ªäººå“ç‰Œå»ºè®¾', 'çŸ¥è¯†åˆ†äº«', 'è·¨ç•Œå­¦ä¹ æŒ‘æˆ˜']
                },
                community: {
                    technical_skills: ['Stack Overflow', 'æŠ€æœ¯è®ºå›', 'å¼€å‘è€…ç¤¾ç¾¤'],
                    soft_skills: ['ä¸“ä¸šåä¼š', 'è¯»ä¹¦ä¼š', 'èŒåœºå¯¼å¸ˆç½‘ç»œ'],
                    business_skills: ['å•†ä¸šä¿±ä¹éƒ¨', 'åˆ›ä¸šç¤¾åŒº', 'è¡Œä¸šåä¼š'],
                    personal_development: ['å­¦ä¹ å°ç»„', 'æˆé•¿ç¤¾åŒº', 'çŸ¥è¯†åˆ†äº«å¹³å°']
                }
            };

            return resourceDatabase[type][domain] || ['å¾…è¡¥å……èµ„æº'];
        }

        function generateLearningRecommendations(content) {
            const recommendations = [
                {
                    title: 'åˆ¶å®šæ˜ç¡®çš„å­¦ä¹ ç›®æ ‡',
                    description: 'åŸºäºæ‚¨çš„è®¡åˆ’å†…å®¹ï¼Œå»ºè®®è®¾å®šSMARTå­¦ä¹ ç›®æ ‡',
                    priority: 'high',
                    timeframe: 'ç¬¬1å‘¨'
                },
                {
                    title: 'å»ºç«‹å­¦ä¹ èŠ‚å¥',
                    description: 'å»ºè®®æ¯å‘¨å›ºå®š2-3æ¬¡å­¦ä¹ æ—¶é—´ï¼Œæ¯æ¬¡1-2å°æ—¶',
                    priority: 'high',
                    timeframe: 'æŒç»­æ‰§è¡Œ'
                },
                {
                    title: 'å¯»æ‰¾å­¦ä¹ ä¼™ä¼´',
                    description: 'æ‰¾åˆ°å¿—åŒé“åˆçš„å­¦ä¹ ä¼™ä¼´ï¼Œäº’ç›¸ç›‘ç£å’Œäº¤æµ',
                    priority: 'medium',
                    timeframe: 'ç¬¬2-3å‘¨'
                },
                {
                    title: 'å®è·µåº”ç”¨å­¦ä¹ ',
                    description: 'å°†å­¦åˆ°çš„çŸ¥è¯†ç«‹å³åº”ç”¨åˆ°å®é™…å·¥ä½œæˆ–é¡¹ç›®ä¸­',
                    priority: 'high',
                    timeframe: 'å­¦ä¹ è¿‡ç¨‹ä¸­'
                },
                {
                    title: 'å®šæœŸåæ€æ€»ç»“',
                    description: 'æ¯æœˆæ€»ç»“å­¦ä¹ æˆæœï¼Œè°ƒæ•´å­¦ä¹ ç­–ç•¥',
                    priority: 'medium',
                    timeframe: 'æ¯æœˆåº•'
                }
            ];

            return recommendations;
        }

        function generateLearningPathHTML(analysis) {
            return `
                <div style="margin-bottom: 24px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">ğŸŒ²</div>
                        <h3 style="color: #388e3c; margin: 0;">ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„</h3>
                        <p style="color: #666; margin: 8px 0 0 0;">åŸºäºæ‚¨çš„ç›®æ ‡å’Œè®¡åˆ’å®šåˆ¶çš„ä¸“å±å­¦ä¹ è·¯å¾„</p>
                    </div>
                </div>

                <!-- å­¦ä¹ è·¯å¾„æ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, #388e3c, #66bb6a); border-radius: 16px; padding: 24px; margin-bottom: 24px; color: white;">
                    <h4 style="margin: 0 0 16px 0; font-size: 1.2em; text-align: center;">ğŸ¯ æ¨èå­¦ä¹ è·¯å¾„</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        ${(analysis.personalizedPath || []).map((domain, index) => `
                            <div style="background: rgba(255,255,255,0.2); border-radius: 12px; padding: 16px; text-align: center;">
                                <div style="font-size: 2em; margin-bottom: 8px;">${domain.icon}</div>
                                <div style="font-weight: bold; margin-bottom: 4px;">${domain.name}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ä¼˜å…ˆçº§: ${domain.priority}%</div>
                                <div style="background: rgba(255,255,255,0.3); border-radius: 8px; padding: 4px 8px; margin-top: 8px; font-size: 0.8em;">
                                    æ¨è: ${domain.recommendedTrack.name}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- è¯¦ç»†å­¦ä¹ è½¨é“ -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #388e3c; margin-bottom: 16px;">ğŸ“š è¯¦ç»†å­¦ä¹ è½¨é“</h4>
                    ${(analysis.personalizedPath || []).map(domain => `
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid ${domain.color};">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <span style="font-size: 1.5em;">${domain.icon}</span>
                                <div>
                                    <h5 style="margin: 0; color: ${domain.color};">${domain.name}</h5>
                                    <div style="font-size: 0.9em; color: #666;">ä¼˜å…ˆçº§: ${domain.priority}% | é¢„è®¡æ—¶é—´: ${(domain.tracks || []).reduce((total, track) => total + track.estimatedTime, 0)}å‘¨</div>
                                </div>
                            </div>
                            
                            <div style="display: grid; gap: 16px;">
                                ${(domain.tracks || []).map(track => `
                                    <div style="background: white; border-radius: 8px; padding: 16px;">
                                        <h6 style="margin: 0 0 8px 0; color: #333;">${track.name}</h6>
                                        <p style="font-size: 0.9em; color: #666; margin: 0 0 12px 0;">${track.description}</p>
                                        
                                        <div style="display: grid; gap: 8px;">
                                            ${(track.levels || []).map((level, index) => `
                                                <div style="display: flex; align-items: center; gap: 12px; padding: 8px; background: #f8f9fa; border-radius: 6px;">
                                                    <div style="background: ${domain.color}; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; font-weight: bold;">
                                                        ${index + 1}
                                                    </div>
                                                    <div style="flex: 1;">
                                                        <div style="font-weight: 500; font-size: 0.9em;">${level.name}</div>
                                                        <div style="font-size: 0.8em; color: #666;">
                                                            ${level.duration} | ${(level.skills || []).join('ã€')}
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- å­¦ä¹ æ—¶é—´çº¿ -->
                <div style="background: #e3f2fd; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                    <h4 style="color: #1976d2; margin: 0 0 16px 0;">â° 6ä¸ªæœˆå­¦ä¹ æ—¶é—´çº¿</h4>
                    <div style="position: relative;">
                        ${(analysis.timeline || []).slice(0, 12).map((item, index) => `
                            <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 12px; padding: 12px; background: white; border-radius: 8px; border-left: 4px solid ${item.color};">
                                <div style="background: ${item.color}; color: white; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 0.9em; font-weight: bold;">
                                    W${item.week}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; color: #333; margin-bottom: 4px;">
                                        ${item.level} - ${item.track}
                                    </div>
                                    <div style="font-size: 0.8em; color: #666;">
                                        ${(item.skills || []).slice(0, 2).join('ã€')} | ${item.duration}å‘¨
                                    </div>
                                </div>
                                <div style="background: ${item.color}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7em;">
                                    ${item.phase}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- å­¦ä¹ èµ„æºæ¨è -->
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #388e3c; margin-bottom: 16px;">ğŸ“– å­¦ä¹ èµ„æºæ¨è</h4>
                    ${Object.keys(analysis.resources || {}).map(domain => {
                        const resource = analysis.resources[domain];
                        return `
                            <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid ${resource.color};">
                                <h5 style="margin: 0 0 16px 0; color: ${resource.color};">${resource.name}</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                                    ${Object.keys(resource.items).map(type => `
                                        <div style="background: white; border-radius: 8px; padding: 12px;">
                                            <div style="font-weight: 500; margin-bottom: 8px; color: #333;">
                                                ${type === 'books' ? 'ğŸ“š æ¨èä¹¦ç±' : 
                                                  type === 'courses' ? 'ğŸ“ åœ¨çº¿è¯¾ç¨‹' : 
                                                  type === 'practice' ? 'ğŸ’» å®è·µé¡¹ç›®' : 'ğŸ‘¥ å­¦ä¹ ç¤¾åŒº'}
                                            </div>
                                            <ul style="margin: 0; padding-left: 16px; font-size: 0.9em; color: #666;">
                                                ${(resource.items[type] || []).map(item => `<li>${item}</li>`).join('')}
                                            </ul>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <!-- å­¦ä¹ å»ºè®® -->
                <div style="background: #e8f5e9; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #2e7d32; margin: 0 0 16px 0;">ğŸ’¡ å­¦ä¹ æˆåŠŸå»ºè®®</h4>
                    <div style="display: grid; gap: 12px;">
                        ${(analysis.recommendations || []).map(rec => `
                            <div style="background: white; border-radius: 8px; padding: 16px; border-left: 4px solid ${rec.priority === 'high' ? '#f44336' : '#ff9800'};">
                                <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                                    <h6 style="margin: 0; color: #333;">${rec.title}</h6>
                                    <span style="background: ${rec.priority === 'high' ? '#f44336' : '#ff9800'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7em; margin-left: auto;">
                                        ${rec.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : 'ä¸­ä¼˜å…ˆçº§'}
                                    </span>
                                </div>
                                <p style="font-size: 0.9em; color: #666; margin: 0 0 8px 0;">${rec.description}</p>
                                <div style="font-size: 0.8em; color: #999;">å»ºè®®æ—¶é—´: ${rec.timeframe}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- å­¦ä¹ è¿›åº¦è·Ÿè¸ª -->
                <div style="background: linear-gradient(135deg, #fff3e0, #ffcc80); border-radius: 12px; padding: 20px;">
                    <h4 style="color: #ef6c00; margin: 0 0 16px 0;">ğŸ“Š å­¦ä¹ è¿›åº¦è·Ÿè¸ªå»ºè®®</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ“…</div>
                            <div style="font-weight: bold; margin-bottom: 4px;">æ¯å‘¨å›é¡¾</div>
                            <div style="font-size: 0.9em; color: #666;">è®°å½•å­¦ä¹ è¿›åº¦å’Œå¿ƒå¾—</div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ¯</div>
                            <div style="font-weight: bold; margin-bottom: 4px;">é‡Œç¨‹ç¢‘è®¾å®š</div>
                            <div style="font-size: 0.9em; color: #666;">è®¾å®šé˜¶æ®µæ€§æˆæœç›®æ ‡</div>
                        </div>
                        <div style="background: white; border-radius: 8px; padding: 16px; text-align: center;">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ†</div>
                            <div style="font-weight: bold; margin-bottom: 4px;">æˆæœå±•ç¤º</div>
                            <div style="font-size: 0.9em; color: #666;">åˆ†äº«å­¦ä¹ æˆæœå’Œé¡¹ç›®</div>
                        </div>
                    </div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', function() {
            initHalfyearPlan();
            initializeEnhancedInput();
            
            // ç¡®ä¿æ™ºèƒ½åˆ†ææŒ‰é’®æ­£ç¡®åˆå§‹åŒ–
            setTimeout(function() {
                initSmartAnalysisButtons();
            }, 100);
        });

        function initHalfyearPlan() {
            document.getElementById('halfyear_select').value = currentHalf;
            document.getElementById('halfyear_year').value = currentYear;
            updateMonthLabels();
            updateQuarterTitles();
            
            // å¯ç”¨å¾…åŠäº‹é¡¹åŠŸèƒ½
            const containers = document.querySelectorAll('.todo-list-container');
            containers.forEach(container => {
                TodoUtils.enableTodoFunctionality(container);
            });
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('halfyear-prev').addEventListener('click', () => navigateHalfyear(-1));
            document.getElementById('halfyear-next').addEventListener('click', () => navigateHalfyear(1));
            document.getElementById('halfyear_select').addEventListener('change', handleHalfyearChange);
            document.getElementById('halfyear_year').addEventListener('change', handleYearChange);
            document.querySelector('.save-btn').addEventListener('click', saveHalfyearPlan);
            document.querySelector('.save-view-btn').addEventListener('click', showHalfyearHistory);
            
            // åŠŸèƒ½æŒ‰é’®äº‹ä»¶
            document.getElementById('halfyear-analytics-btn')?.addEventListener('click', showHalfyearAnalytics);
            document.getElementById('strategic-review-btn')?.addEventListener('click', showStrategicReview);
            document.getElementById('strategic-planning-btn')?.addEventListener('click', showStrategicPlanning);
            document.getElementById('goal-alignment-btn')?.addEventListener('click', showGoalAlignment);
            document.getElementById('project-planning-btn')?.addEventListener('click', showProjectPlanning);
            document.getElementById('resource-allocation-btn')?.addEventListener('click', showResourceAllocation);
            document.getElementById('skill-assessment-btn')?.addEventListener('click', showSkillAssessment);
            document.getElementById('learning-path-btn')?.addEventListener('click', showLearningPath);
            document.getElementById('comprehensive-review-btn')?.addEventListener('click', showComprehensiveReview);
            document.getElementById('lessons-learned-btn')?.addEventListener('click', showLessonsLearned);
            
            // AIåŠ©æ‰‹æŒ‰é’®äº‹ä»¶
            document.querySelector('.ai-assistant-btn')?.addEventListener('click', showHalfyearAIAssistant);
            
            loadHalfyearPlan();
            updateProgress();
        }

        function navigateHalfyear(halfs) {
            currentHalf += halfs;
            if (currentHalf < 1) {
                currentHalf = 2;
                currentYear--;
            } else if (currentHalf > 2) {
                currentHalf = 1;
                currentYear++;
            }
            
            document.getElementById('halfyear_select').value = currentHalf;
            document.getElementById('halfyear_year').value = currentYear;
            updateMonthLabels();
            updateQuarterTitles();
            loadHalfyearPlan();
            updateProgress();
        }

        function handleHalfyearChange() {
            currentHalf = parseInt(document.getElementById('halfyear_select').value);
            updateMonthLabels();
            updateQuarterTitles();
            loadHalfyearPlan();
            updateProgress();
        }

        function handleYearChange() {
            currentYear = parseInt(document.getElementById('halfyear_year').value);
            loadHalfyearPlan();
            updateProgress();
        }

        function updateMonthLabels() {
            const months = currentHalf === 1 ? 
                ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'] : 
                ['7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
            
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`month${i}-label`).textContent = months[i-1];
            }
        }

        function updateQuarterTitles() {
            if (currentHalf === 1) {
                document.getElementById('quarter1-title').innerHTML = `
                    ğŸŒ± ç¬¬ä¸€å­£åº¦ (Q1)
                    <span style="background: rgba(33,150,243,0.1); color: #2196f3; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">å¯åŠ¨æœŸ</span>
                `;
                document.getElementById('quarter2-title').innerHTML = `
                    ğŸš€ ç¬¬äºŒå­£åº¦ (Q2)
                    <span style="background: rgba(255,152,0,0.1); color: #ff9800; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">å†²åˆºæœŸ</span>
                `;
            } else {
                document.getElementById('quarter1-title').innerHTML = `
                    ğŸŒ± ç¬¬ä¸‰å­£åº¦ (Q3)
                    <span style="background: rgba(33,150,243,0.1); color: #2196f3; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">æ·±è€•æœŸ</span>
                `;
                document.getElementById('quarter2-title').innerHTML = `
                    ğŸš€ ç¬¬å››å­£åº¦ (Q4)
                    <span style="background: rgba(255,152,0,0.1); color: #ff9800; font-size: 0.8em; padding: 2px 6px; border-radius: 8px;">æ”¶è·æœŸ</span>
                `;
            }
        }

        function saveHalfyearPlan() {
            const halfyearKey = `${currentYear}-H${currentHalf}`;
            const data = {
                vision: document.getElementById('halfyear_vision').value,
                strategicGoals: getTodoContent('halfyear_strategic_goals'),
                quarter1Milestones: getTodoContent('quarter1_milestones'),
                quarter2Milestones: getTodoContent('quarter2_milestones'),
                projects: getTodoContent('halfyear_projects'),
                skills: document.getElementById('halfyear_skills').value,
                balance: getTodoContent('halfyear_balance'),
                review: document.getElementById('halfyear_review').value
            };

            const success = StorageUtils.savePlan('halfyear', halfyearKey, data);
            if (success) {
                MessageUtils.success('åŠå¹´è®¡åˆ’ä¿å­˜æˆåŠŸï¼');
                animateSaveSuccess();
            }
        }

        function loadHalfyearPlan() {
            const halfyearKey = `${currentYear}-H${currentHalf}`;
            const data = StorageUtils.loadPlan('halfyear', halfyearKey);
            
            if (data) {
                document.getElementById('halfyear_vision').value = data.vision || '';
                document.getElementById('halfyear_skills').value = data.skills || '';
                document.getElementById('halfyear_review').value = data.review || '';
                
                loadTodoContent('halfyear_strategic_goals', data.strategicGoals);
                loadTodoContent('quarter1_milestones', data.quarter1Milestones);
                loadTodoContent('quarter2_milestones', data.quarter2Milestones);
                loadTodoContent('halfyear_projects', data.projects);
                loadTodoContent('halfyear_balance', data.balance);
            } else {
                clearFields();
            }
        }

        function clearFields() {
            document.getElementById('halfyear_vision').value = '';
            document.getElementById('halfyear_skills').value = '';
            document.getElementById('halfyear_review').value = '';
            
            const containers = ['halfyear_strategic_goals', 'quarter1_milestones', 'quarter2_milestones', 'halfyear_projects', 'halfyear_balance'];
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = '';
                    container.textContent = '';
                }
            });
        }

        function loadTodoContent(containerId, content) {
            const container = document.getElementById(containerId);
            if (container && content) {
                container.textContent = content;
                TodoUtils.renderTodos(container);
            }
        }

        function getTodoContent(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return '';
            
            const tasks = container.querySelectorAll('.task-item');
            const lines = [];
            
            tasks.forEach(task => {
                const checkbox = task.querySelector('.custom-checkbox');
                const text = task.querySelector('.task-text').textContent;
                const isChecked = checkbox.classList.contains('checked');
                lines.push(`[${isChecked ? 'x' : ' '}] ${text}`);
            });
            
            return lines.join('\n');
        }

        function updateProgress() {
            // ç®€åŒ–çš„åŠå¹´è¿›åº¦è®¡ç®—
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            
            let progress = 0;
            if (currentHalf === 1) {
                // ä¸ŠåŠå¹´ (1-6æœˆ)
                if (currentMonth <= 6) {
                    progress = Math.round(((currentMonth - 1) * 30 + now.getDate()) / 181 * 100);
                } else {
                    progress = 100;
                }
            } else {
                // ä¸‹åŠå¹´ (7-12æœˆ)
                if (currentMonth >= 7) {
                    progress = Math.round(((currentMonth - 7) * 30 + now.getDate()) / 184 * 100);
                } else {
                    progress = 0;
                }
            }
            
            progress = Math.min(progress, 100);
            document.getElementById('halfyear-progress-inner').style.width = `${progress}%`;
            document.getElementById('halfyear-progress-text').textContent = `åŠå¹´è¿›åº¦ ${progress}%`;
        }

        function animateSaveSuccess() {
            const saveBtn = document.querySelector('.save-btn');
            const originalText = saveBtn.textContent;
            
            saveBtn.style.background = '#4caf50';
            saveBtn.style.color = 'white';
            saveBtn.textContent = 'âœ… å·²ä¿å­˜';
            
            setTimeout(() => {
                saveBtn.style.background = '';
                saveBtn.style.color = '';
                saveBtn.textContent = originalText;
            }, 2000);
        }

        // åŠŸèƒ½æŒ‰é’®å®ç°
        function showHalfyearHistory() {
            const history = StorageUtils.getHistory('halfyear');
            if (history.length === 0) {
                MessageUtils.info('æš‚æ— åŠå¹´è®¡åˆ’å†å²è®°å½•');
                return;
            }
            
            let historyHtml = '<div style="max-height: 400px; overflow-y: auto;">';
            history.forEach((record, index) => {
                historyHtml += `
                    <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 12px; background: #f9f9f9;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <strong style="color: #1976d2;">${record.date}</strong>
                            <span style="font-size: 0.9em; color: #666;">${new Date(record.timestamp).toLocaleString()}</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">${record.summary}</div>
                    </div>
                `;
            });
            historyHtml += '</div>';
            
            ModalUtils.show('ğŸ“š åŠå¹´è®¡åˆ’å†å²è®°å½•', historyHtml, 'large');
        }

        function showHalfyearAnalytics() {
            generateHalfyearAnalytics();
        }

        function showStrategicReview() {
            generateStrategicReview();
        }

        function showStrategicPlanning() {
            generateStrategicPlanningGuide();
        }

        function showGoalAlignment() {
            generateGoalAlignmentAnalysis();
        }

        function showProjectPlanning() {
            const currentData = getCurrentPlanData();
            const projectPlan = generateProjectPlanningGuide(currentData);
            
            ModalUtils.show('ğŸ“‹ é¡¹ç›®è§„åˆ’åŠ©æ‰‹', projectPlan, {
                size: 'large',
                buttons: [
                    {
                        text: 'ç”Ÿæˆé¡¹ç›®æ¨¡æ¿',
                        class: 'btn-main',
                        handler: () => generateProjectTemplates(),
                        close: false
                    },
                    {
                        text: 'åº”ç”¨é¡¹ç›®å»ºè®®',
                        class: 'btn-secondary',
                        handler: () => applyProjectSuggestions(),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function showResourceAllocation() {
            const currentData = getCurrentPlanData();
            const resourceAnalysis = generateResourceAllocationGuide(currentData);
            
            ModalUtils.show('ğŸ¯ èµ„æºåˆ†é…åŠ©æ‰‹', resourceAnalysis, {
                size: 'large',
                buttons: [
                    {
                        text: 'ä¼˜åŒ–èµ„æºé…ç½®',
                        class: 'btn-main',
                        handler: () => optimizeResourceAllocation(),
                        close: false
                    },
                    {
                        text: 'ç”Ÿæˆèµ„æºè®¡åˆ’',
                        class: 'btn-secondary',
                        handler: () => generateResourcePlan(),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function showSkillAssessment() {
            console.log('ğŸ”„ showSkillAssessmentè¢«è°ƒç”¨ï¼Œè½¬å‘åˆ°generateSkillAssessment');
            generateSkillAssessment();
        }

        function showLearningPath() {
            MessageUtils.info('å­¦ä¹ è·¯å¾„åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
        }

        function showComprehensiveReview() {
            console.log('ğŸ“Š å¼€å§‹ç”Ÿæˆå…¨é¢å›é¡¾...');
            generateComprehensiveReview();
        }

        function showLessonsLearned() {
            console.log('ğŸ’¡ å¼€å§‹ç”Ÿæˆç»éªŒæ€»ç»“...');
            generateLessonsLearned();
        }

        // === åŠå¹´åˆ†æåŠŸèƒ½ ===
        function generateHalfyearAnalytics() {
            const halfyearKey = `${currentYear}-H${currentHalf}`;
            let currentData = StorageUtils.loadPlan('halfyear', halfyearKey);
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®ç»“æ„ç”¨äºåˆ†æ
            if (!currentData) {
                currentData = {
                    vision: '',
                    strategicGoals: '',
                    quarter1Milestones: '',
                    quarter2Milestones: '',
                    projects: '',
                    skills: '',
                    balance: '',
                    review: ''
                };
                MessageUtils.info('å½“å‰ä¸ºç©ºç™½è®¡åˆ’ï¼Œå°†æ˜¾ç¤ºåˆå§‹çŠ¶æ€åˆ†æ');
            }

            // è®¡ç®—å„é¡¹æŒ‡æ ‡
            const analytics = calculateHalfyearMetrics(currentData);
            
            // ç”Ÿæˆåˆ†ææŠ¥å‘ŠHTML
            const analyticsHtml = generateAnalyticsHTML(analytics);
            
            ModalUtils.show('ğŸ“Š åŠå¹´åˆ†ææŠ¥å‘Š', analyticsHtml, {
                size: 'large',
                buttons: [
                    {
                        text: 'å¯¼å‡ºæŠ¥å‘Š',
                        class: 'btn-main',
                        handler: () => exportAnalyticsReport(analytics),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function calculateHalfyearMetrics(data) {
            // æˆ˜ç•¥ç›®æ ‡åˆ†æ
            const strategicGoalsData = analyzeTaskContent(data.strategicGoals || '');
            
            // é¡¹ç›®åˆ†æ
            const projectsData = analyzeTaskContent(data.projects || '');
            
            // å·¥ä½œç”Ÿæ´»å¹³è¡¡åˆ†æ
            const balanceData = analyzeTaskContent(data.balance || '');
            
            // Q1é‡Œç¨‹ç¢‘åˆ†æ
            const q1Data = analyzeTaskContent(data.quarter1Milestones || '');
            
            // Q2é‡Œç¨‹ç¢‘åˆ†æ
            const q2Data = analyzeTaskContent(data.quarter2Milestones || '');
            
            // æ•´ä½“å®Œæˆåº¦
            const totalTasks = strategicGoalsData.total + projectsData.total + balanceData.total + q1Data.total + q2Data.total;
            const completedTasks = strategicGoalsData.completed + projectsData.completed + balanceData.completed + q1Data.completed + q2Data.completed;
            const overallProgress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            // æ—¶é—´è¿›åº¦
            const timeProgress = calculateTimeProgress();
            
            // è¿›åº¦åå·®åˆ†æ
            const progressDeviation = overallProgress - timeProgress;
            
            return {
                strategic: strategicGoalsData,
                projects: projectsData,
                balance: balanceData,
                quarter1: q1Data,
                quarter2: q2Data,
                overall: {
                    totalTasks,
                    completedTasks,
                    progress: overallProgress,
                    timeProgress,
                    deviation: progressDeviation
                },
                insights: generateInsights(strategicGoalsData, projectsData, balanceData, progressDeviation),
                recommendations: generateRecommendations(overallProgress, timeProgress, progressDeviation)
            };
        }

        function analyzeTaskContent(content) {
            if (!content) return { total: 0, completed: 0, pending: 0, rate: 0 };
            
            const tasks = content.split('\n').filter(line => line.trim() && line.includes('['));
            const total = tasks.length;
            const completed = tasks.filter(task => task.includes('[x]') || task.includes('[X]')).length;
            const pending = total - completed;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            return { total, completed, pending, rate };
        }

        function calculateTimeProgress() {
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            
            if (currentHalf === 1) {
                // ä¸ŠåŠå¹´ (1-6æœˆ)
                if (currentMonth <= 6) {
                    return Math.round(((currentMonth - 1) * 30 + now.getDate()) / 181 * 100);
                } else {
                    return 100;
                }
            } else {
                // ä¸‹åŠå¹´ (7-12æœˆ)
                if (currentMonth >= 7) {
                    return Math.round(((currentMonth - 7) * 30 + now.getDate()) / 184 * 100);
                } else {
                    return 0;
                }
            }
        }

        function generateInsights(strategic, projects, balance, deviation) {
            const insights = [];
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç©ºç™½è®¡åˆ’
            const isEmptyPlan = strategic.total === 0 && projects.total === 0 && balance.total === 0;
            
            if (isEmptyPlan) {
                insights.push('ğŸŒ± è¿™æ˜¯ä¸€ä¸ªå´­æ–°çš„å¼€å§‹ï¼ç°åœ¨æ˜¯åˆ¶å®šåŠå¹´è®¡åˆ’çš„æœ€ä½³æ—¶æœº');
                insights.push('ğŸ’¡ å»ºè®®å…ˆè®¾å®š2-3ä¸ªæ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡ï¼Œç„¶åé€æ­¥å®Œå–„');
                insights.push('ğŸ¯ è®°ä½ï¼šæ˜ç¡®çš„ç›®æ ‡æ˜¯æˆåŠŸçš„ç¬¬ä¸€æ­¥');
                insights.push('ğŸ“… å¯ä»¥ä»å½“å‰æœ€é‡è¦çš„äº‹æƒ…å¼€å§‹è§„åˆ’');
                return insights;
            }
            
            // æˆ˜ç•¥ç›®æ ‡æ´å¯Ÿ
            if (strategic.total === 0) {
                insights.push('ğŸ¯ å»ºè®®æ·»åŠ æˆ˜ç•¥ç›®æ ‡ï¼Œä¸ºåŠå¹´è®¾å®šæ˜ç¡®æ–¹å‘');
            } else if (strategic.rate >= 80) {
                insights.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡æ‰§è¡Œä¼˜ç§€ï¼Œä¿æŒå½“å‰èŠ‚å¥');
            } else if (strategic.rate >= 60) {
                insights.push('âš¡ æˆ˜ç•¥ç›®æ ‡è¿›å±•è‰¯å¥½ï¼Œå¯é€‚å½“åŠ é€Ÿ');
            } else {
                insights.push('ğŸš¨ æˆ˜ç•¥ç›®æ ‡æ‰§è¡Œåæ…¢ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨');
            }
            
            // é¡¹ç›®è¿›å±•æ´å¯Ÿ
            if (projects.total === 0) {
                insights.push('ğŸ—ï¸ è€ƒè™‘æ·»åŠ é‡ç‚¹é¡¹ç›®ï¼Œå°†æˆ˜ç•¥ç›®æ ‡è½¬åŒ–ä¸ºå…·ä½“è¡ŒåŠ¨');
            } else if (projects.rate >= 75) {
                insights.push('ğŸš€ é¡¹ç›®æ¨è¿›æ•ˆç‡é«˜ï¼Œå›¢é˜Ÿæ‰§è¡ŒåŠ›å¼º');
            } else if (projects.rate >= 50) {
                insights.push('ğŸ“ˆ é¡¹ç›®è¿›å±•ä¸­ç­‰ï¼Œå¯ä¼˜åŒ–èµ„æºé…ç½®');
            } else {
                insights.push('â° é¡¹ç›®è¿›åº¦æ»åï¼Œéœ€è°ƒæ•´ä¼˜å…ˆçº§');
            }
            
            // å·¥ä½œç”Ÿæ´»å¹³è¡¡æ´å¯Ÿ
            if (balance.total === 0) {
                insights.push('âš–ï¸ å»ºè®®å…³æ³¨å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œåˆ¶å®šç›¸åº”çš„ä¿éšœæªæ–½');
            } else if (balance.rate >= 70) {
                insights.push('âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡è‰¯å¥½ï¼Œèº«å¿ƒçŠ¶æ€ä½³');
            } else {
                insights.push('ğŸ”„ å·¥ä½œç”Ÿæ´»å¹³è¡¡éœ€è¦è°ƒæ•´ï¼Œå…³æ³¨å¥åº·');
            }
            
            // è¿›åº¦åå·®æ´å¯Ÿ
            if (Math.abs(deviation) <= 10) {
                insights.push('ğŸ“Š æ•´ä½“è¿›åº¦ä¸æ—¶é—´è¿›åº¦åŸºæœ¬åŒæ­¥');
            } else if (deviation > 10) {
                insights.push('ğŸƒâ€â™€ï¸ æ‰§è¡Œè¿›åº¦é¢†å…ˆæ—¶é—´ï¼Œå¯èƒ½éœ€è¦å¯æŒç»­æ€§è€ƒè™‘');
            } else {
                insights.push('â³ æ‰§è¡Œè¿›åº¦è½åæ—¶é—´ï¼Œéœ€è¦åŠ é€Ÿæ¨è¿›');
            }
            
            return insights;
        }

        function generateRecommendations(overallProgress, timeProgress, deviation) {
            const recommendations = [];
            
            // å¦‚æœæ˜¯ç©ºç™½è®¡åˆ’ï¼Œæä¾›åˆå§‹å»ºè®®
            if (overallProgress === 0 && timeProgress > 0) {
                recommendations.push('ğŸš€ ç«‹å³å¼€å§‹ï¼šå…ˆå¡«å†™åŠå¹´æ„¿æ™¯ï¼Œè®¾å®šå¤§æ–¹å‘');
                recommendations.push('ğŸ¯ è®¾å®šç›®æ ‡ï¼šåˆ¶å®š2-3ä¸ªæ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡');
                recommendations.push('ğŸ“‹ åˆ†è§£ä»»åŠ¡ï¼šå°†ç›®æ ‡åˆ†è§£ä¸ºå…·ä½“çš„å­£åº¦é‡Œç¨‹ç¢‘');
                recommendations.push('âš–ï¸ å¹³è¡¡è§„åˆ’ï¼šä¸è¦å¿˜è®°å·¥ä½œç”Ÿæ´»å¹³è¡¡çš„å®‰æ’');
                recommendations.push('ğŸ’¡ å°æ­¥å¿«è·‘ï¼šä»æœ€é‡è¦ã€æœ€ç´§æ€¥çš„ç›®æ ‡å¼€å§‹');
                return recommendations;
            }
            
            if (deviation < -20) {
                recommendations.push('ğŸ¯ å»ºè®®é‡æ–°è¯„ä¼°ç›®æ ‡çš„å¯è¡Œæ€§ï¼Œé€‚å½“è°ƒæ•´æœŸæœ›');
                recommendations.push('ğŸ”§ ä¼˜åŒ–å·¥ä½œæ–¹æ³•ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡');
                recommendations.push('ğŸ‘¥ è€ƒè™‘å¯»æ±‚æ›´å¤šèµ„æºæˆ–å›¢é˜Ÿæ”¯æŒ');
            } else if (deviation < -10) {
                recommendations.push('âš¡ åŠ å¿«å…³é”®ä»»åŠ¡çš„æ¨è¿›é€Ÿåº¦');
                recommendations.push('ğŸ“… é‡æ–°è§„åˆ’å‰©ä½™æ—¶é—´çš„ä»»åŠ¡ä¼˜å…ˆçº§');
                recommendations.push('ğŸ¯ èšç„¦æœ€é‡è¦çš„2-3ä¸ªæ ¸å¿ƒç›®æ ‡');
            } else if (deviation > 15) {
                recommendations.push('ğŸ‰ å½“å‰è¿›åº¦å¾ˆå¥½ï¼Œå¯ä»¥è€ƒè™‘æŒ‘æˆ˜æ›´é«˜ç›®æ ‡');
                recommendations.push('ğŸ“š åˆ©ç”¨é¢†å…ˆä¼˜åŠ¿ï¼ŒæŠ•èµ„é•¿æœŸèƒ½åŠ›å»ºè®¾');
                recommendations.push('ğŸ¤ åˆ†äº«æˆåŠŸç»éªŒï¼Œå¸®åŠ©ä»–äººæå‡');
            } else {
                recommendations.push('âœ… ä¿æŒå½“å‰çš„æ‰§è¡ŒèŠ‚å¥');
                recommendations.push('ğŸ” å®šæœŸå›é¡¾å’Œå¾®è°ƒè®¡åˆ’');
                recommendations.push('ğŸ’ª ç»§ç»­ä¿æŒä¸“æ³¨å’Œæ‰§è¡ŒåŠ›');
            }
            
            return recommendations;
        }

        function generateAnalyticsHTML(analytics) {
            const { strategic, projects, balance, quarter1, quarter2, overall, insights, recommendations } = analytics;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç©ºç™½è®¡åˆ’
            const isEmptyPlan = overall.totalTasks === 0;
            
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <!-- æ€»ä½“æ¦‚è§ˆ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                        <h3 style="margin: 0 0 16px 0; font-size: 1.5em;">ğŸ“Š ${currentYear}å¹´${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´åˆ†ææ¦‚è§ˆ</h3>
                        ${isEmptyPlan ? '<p style="margin: 8px 0; opacity: 0.9; font-size: 0.9em;">ğŸŒ± è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¼€å§‹ï¼è®©æˆ‘ä»¬å¼€å§‹è§„åˆ’æ‚¨çš„åŠå¹´ç›®æ ‡å§ã€‚</p>' : ''}
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${overall.progress}%</div>
                                <div style="opacity: 0.9;">æ•´ä½“å®Œæˆåº¦</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${overall.totalTasks}</div>
                                <div style="opacity: 0.9;">æ€»ä»»åŠ¡æ•°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${overall.completedTasks}</div>
                                <div style="opacity: 0.9;">å·²å®Œæˆ</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: ${overall.deviation >= 0 ? '#4caf50' : '#ff5722'}">${overall.deviation > 0 ? '+' : ''}${overall.deviation}%</div>
                                <div style="opacity: 0.9;">è¿›åº¦åå·®</div>
                            </div>
                        </div>
                    </div>

                    <!-- å„ç»´åº¦åˆ†æ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        ${generateDimensionCard('ğŸ¯ æˆ˜ç•¥ç›®æ ‡', strategic, '#2196f3')}
                        ${generateDimensionCard('ğŸ—ï¸ é‡ç‚¹é¡¹ç›®', projects, '#9c27b0')}
                        ${generateDimensionCard('âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡', balance, '#795548')}
                    </div>

                    <!-- å­£åº¦å¯¹æ¯” -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ“… å­£åº¦æ‰§è¡Œå¯¹æ¯”</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            ${generateQuarterCard(currentHalf === 1 ? 'Q1' : 'Q3', quarter1, '#2196f3')}
                            ${generateQuarterCard(currentHalf === 1 ? 'Q2' : 'Q4', quarter2, '#ff9800')}
                        </div>
                    </div>

                    <!-- æ™ºèƒ½æ´å¯Ÿ -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ§  æ™ºèƒ½æ´å¯Ÿ</h4>
                        <div style="display: grid; gap: 8px;">
                            ${insights.map(insight => `<div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">${insight}</div>`).join('')}
                        </div>
                    </div>

                    <!-- æ”¹è¿›å»ºè®® -->
                    <div style="background: #fff3e0; border-radius: 12px; padding: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #ef6c00;">ğŸ’¡ æ”¹è¿›å»ºè®®</h4>
                        <div style="display: grid; gap: 8px;">
                            ${recommendations.map(rec => `<div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #ff9800;">${rec}</div>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDimensionCard(title, data, color) {
            return `
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 16px;">
                    <h5 style="margin: 0 0 12px 0; color: ${color};">${title}</h5>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span>å®Œæˆç‡</span>
                        <span style="font-weight: bold; color: ${color};">${data.rate}%</span>
                    </div>
                    <div style="background: #f0f0f0; border-radius: 8px; height: 8px; overflow: hidden;">
                        <div style="background: ${color}; height: 100%; width: ${data.rate}%; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.9em; color: #666;">
                        <span>å·²å®Œæˆ: ${data.completed}</span>
                        <span>æ€»è®¡: ${data.total}</span>
                    </div>
                </div>
            `;
        }

        function generateQuarterCard(quarter, data, color) {
            return `
                <div style="text-align: center; padding: 16px; background: rgba(${color === '#2196f3' ? '33,150,243' : '255,152,0'}, 0.1); border-radius: 8px;">
                    <h5 style="margin: 0 0 8px 0; color: ${color};">${quarter}</h5>
                    <div style="font-size: 1.5em; font-weight: bold; color: ${color};">${data.rate}%</div>
                    <div style="font-size: 0.9em; color: #666; margin-top: 4px;">${data.completed}/${data.total} é¡¹</div>
                </div>
            `;
        }

        function exportAnalyticsReport(analytics) {
            const reportData = {
                reportDate: new Date().toISOString(),
                period: `${currentYear}å¹´${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´`,
                analytics: analytics
            };
            
            ExportUtils.exportToJSON(reportData, `halfyear_analytics_${currentYear}_H${currentHalf}.json`);
            MessageUtils.success('åˆ†ææŠ¥å‘Šå·²å¯¼å‡º');
        }

        // === æˆ˜ç•¥å›é¡¾åŠŸèƒ½ ===
        function generateStrategicReview() {
            const halfyearKey = `${currentYear}-H${currentHalf}`;
            let currentData = StorageUtils.loadPlan('halfyear', halfyearKey);
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®ç»“æ„ç”¨äºå›é¡¾
            if (!currentData) {
                currentData = {
                    vision: '',
                    strategicGoals: '',
                    quarter1Milestones: '',
                    quarter2Milestones: '',
                    projects: '',
                    skills: '',
                    balance: '',
                    review: ''
                };
                MessageUtils.info('å½“å‰ä¸ºç©ºç™½è®¡åˆ’ï¼Œå°†æ˜¾ç¤ºåˆå§‹çŠ¶æ€å›é¡¾');
            }

            // è·å–å†å²æ•°æ®è¿›è¡Œå¯¹æ¯”
            const historicalData = getHistoricalHalfyearData();
            
            // ç”Ÿæˆæˆ˜ç•¥å›é¡¾å†…å®¹
            const reviewContent = generateStrategicReviewContent(currentData, historicalData);
            
            ModalUtils.show('ğŸ¯ æˆ˜ç•¥å›é¡¾', reviewContent, {
                size: 'large',
                buttons: [
                    {
                        text: 'ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’',
                        class: 'btn-main',
                        handler: () => generateActionPlan(currentData),
                        close: false
                    },
                    {
                        text: 'å¯¼å‡ºå›é¡¾',
                        class: 'btn-secondary',
                        handler: () => exportStrategicReview(currentData, historicalData),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function getHistoricalHalfyearData() {
            const allPlans = StorageUtils.getAllPlans('halfyear');
            const historicalData = [];
            
            // è·å–æœ€è¿‘3ä¸ªåŠå¹´çš„æ•°æ®
            for (let year = currentYear; year >= currentYear - 2; year--) {
                for (let half = 2; half >= 1; half--) {
                    const key = `${year}-H${half}`;
                    if (key !== `${currentYear}-H${currentHalf}` && allPlans[key]) {
                        historicalData.push({
                            key,
                            year,
                            half,
                            data: allPlans[key]
                        });
                        if (historicalData.length >= 3) break;
                    }
                }
                if (historicalData.length >= 3) break;
            }
            
            return historicalData;
        }

        function generateStrategicReviewContent(currentData, historicalData) {
            const currentAnalytics = calculateHalfyearMetrics(currentData);
            const strategicAssessment = assessStrategicExecution(currentData);
            const trends = analyzeHistoricalTrends(historicalData);
            
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <!-- æˆ˜ç•¥æ‰§è¡Œè¯„ä¼° -->
                    <div style="background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                        <h3 style="margin: 0 0 16px 0;">ğŸ¯ ${currentYear}å¹´${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´æˆ˜ç•¥å›é¡¾</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold;">${strategicAssessment.overallScore}</div>
                                <div style="opacity: 0.9;">æˆ˜ç•¥å¾—åˆ†</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold;">${strategicAssessment.executionLevel}</div>
                                <div style="opacity: 0.9;">æ‰§è¡Œç­‰çº§</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold;">${strategicAssessment.focusAreas.length}</div>
                                <div style="opacity: 0.9;">å…³é”®é¢†åŸŸ</div>
                            </div>
                        </div>
                    </div>

                    <!-- æ„¿æ™¯å®ç°åº¦è¯„ä¼° -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸŒŸ æ„¿æ™¯å®ç°åº¦è¯„ä¼°</h4>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                            <strong>åŠå¹´æ„¿æ™¯:</strong><br>
                            <div style="margin-top: 8px; color: #666; font-style: italic;">${currentData.vision || 'æœªè®¾å®šæ„¿æ™¯'}</div>
                        </div>
                        ${generateVisionAssessment(currentData, currentAnalytics)}
                    </div>

                    <!-- æˆ˜ç•¥ç›®æ ‡æ·±åº¦åˆ†æ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ¯ æˆ˜ç•¥ç›®æ ‡æ·±åº¦åˆ†æ</h4>
                        ${generateStrategicGoalsAnalysis(currentData.strategicGoals, currentAnalytics.strategic)}
                    </div>

                    <!-- èƒ½åŠ›å‘å±•è¯„ä¼° -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ“ˆ èƒ½åŠ›å‘å±•è¯„ä¼°</h4>
                        ${generateSkillDevelopmentAssessment(currentData.skills)}
                    </div>

                    <!-- å†å²è¶‹åŠ¿å¯¹æ¯” -->
                    ${historicalData.length > 0 ? `
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ“Š å†å²è¶‹åŠ¿å¯¹æ¯”</h4>
                        ${generateHistoricalComparison(trends)}
                    </div>
                    ` : ''}

                    <!-- æˆ˜ç•¥è°ƒæ•´å»ºè®® -->
                    <div style="background: #e8f5e9; border-radius: 12px; padding: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #2e7d32;">ğŸ”§ æˆ˜ç•¥è°ƒæ•´å»ºè®®</h4>
                        ${generateStrategicAdjustments(strategicAssessment, currentAnalytics)}
                    </div>
                </div>
            `;
        }

        function assessStrategicExecution(data) {
            const strategicData = analyzeTaskContent(data.strategicGoals || '');
            const projectsData = analyzeTaskContent(data.projects || '');
            
            // è®¡ç®—ç»¼åˆå¾—åˆ†
            const visionScore = data.vision && data.vision.trim() ? 20 : 0;
            const strategicScore = strategicData.rate * 0.3;
            const projectScore = projectsData.rate * 0.3;
            const skillsScore = data.skills && data.skills.trim() ? 20 : 0;
            
            const overallScore = Math.round(visionScore + strategicScore + projectScore + skillsScore);
            
            // ç¡®å®šæ‰§è¡Œç­‰çº§
            let executionLevel = 'C';
            if (overallScore >= 90) executionLevel = 'A+';
            else if (overallScore >= 80) executionLevel = 'A';
            else if (overallScore >= 70) executionLevel = 'B+';
            else if (overallScore >= 60) executionLevel = 'B';
            else if (overallScore >= 50) executionLevel = 'C+';
            
            // è¯†åˆ«å…³é”®é¢†åŸŸ
            const focusAreas = [];
            if (strategicData.rate >= 70) focusAreas.push('æˆ˜ç•¥æ‰§è¡Œ');
            if (projectsData.rate >= 70) focusAreas.push('é¡¹ç›®ç®¡ç†');
            if (data.vision && data.vision.trim()) focusAreas.push('æ„¿æ™¯è§„åˆ’');
            if (data.skills && data.skills.trim()) focusAreas.push('èƒ½åŠ›å‘å±•');
            
            return {
                overallScore,
                executionLevel,
                focusAreas,
                strategicScore: strategicData.rate,
                projectScore: projectsData.rate
            };
        }

        function generateVisionAssessment(data, analytics) {
            if (!data.vision || !data.vision.trim()) {
                return '<div style="color: #ff5722; padding: 12px; background: #ffebee; border-radius: 6px;">âš ï¸ æœªè®¾å®šæ˜ç¡®æ„¿æ™¯ï¼Œå»ºè®®è¡¥å……</div>';
            }
            
            const visionKeywords = data.vision.toLowerCase();
            const hasCareerFocus = visionKeywords.includes('èŒä¸š') || visionKeywords.includes('å·¥ä½œ') || visionKeywords.includes('æŠ€èƒ½');
            const hasHealthFocus = visionKeywords.includes('å¥åº·') || visionKeywords.includes('è¿åŠ¨') || visionKeywords.includes('èº«ä½“');
            const hasRelationshipFocus = visionKeywords.includes('å…³ç³»') || visionKeywords.includes('å®¶åº­') || visionKeywords.includes('æœ‹å‹');
            
            const assessmentItems = [
                { label: 'èŒä¸šå‘å±•ç»´åº¦', status: hasCareerFocus, score: hasCareerFocus ? 'âœ…' : 'âš ï¸' },
                { label: 'å¥åº·ç”Ÿæ´»ç»´åº¦', status: hasHealthFocus, score: hasHealthFocus ? 'âœ…' : 'âš ï¸' },
                { label: 'äººé™…å…³ç³»ç»´åº¦', status: hasRelationshipFocus, score: hasRelationshipFocus ? 'âœ…' : 'âš ï¸' },
                { label: 'æ‰§è¡Œè½åœ°æƒ…å†µ', status: analytics.overall.progress > 60, score: analytics.overall.progress > 60 ? 'âœ…' : 'âŒ' }
            ];
            
            return `
                <div style="display: grid; gap: 8px;">
                    ${assessmentItems.map(item => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: ${item.status ? '#e8f5e9' : '#fff3e0'}; border-radius: 6px;">
                            <span>${item.label}</span>
                            <span>${item.score}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateStrategicGoalsAnalysis(goals, analytics) {
            if (!goals || !goals.trim()) {
                return '<div style="color: #ff5722; padding: 12px; background: #ffebee; border-radius: 6px;">æœªè®¾å®šæˆ˜ç•¥ç›®æ ‡</div>';
            }
            
            const goalLines = goals.split('\n').filter(line => line.trim() && line.includes('['));
            const completedGoals = goalLines.filter(line => line.includes('[x]') || line.includes('[X]'));
            const pendingGoals = goalLines.filter(line => line.includes('[ ]'));
            
            return `
                <div style="display: grid; gap: 16px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                        <div style="text-align: center; padding: 12px; background: #e8f5e9; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4caf50;">${completedGoals.length}</div>
                            <div style="font-size: 0.9em; color: #666;">å·²å®Œæˆ</div>
                        </div>
                        <div style="text-align: center; padding: 12px; background: #fff3e0; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #ff9800;">${pendingGoals.length}</div>
                            <div style="font-size: 0.9em; color: #666;">è¿›è¡Œä¸­</div>
                        </div>
                        <div style="text-align: center; padding: 12px; background: #e3f2fd; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #2196f3;">${analytics.rate}%</div>
                            <div style="font-size: 0.9em; color: #666;">å®Œæˆç‡</div>
                        </div>
                    </div>
                    
                    ${completedGoals.length > 0 ? `
                    <div>
                        <h5 style="color: #4caf50; margin: 0 0 8px 0;">âœ… å·²å®Œæˆç›®æ ‡</h5>
                        <div style="background: #e8f5e9; padding: 12px; border-radius: 6px;">
                            ${completedGoals.map(goal => `<div style="margin: 4px 0;">â€¢ ${goal.replace(/^\[x\]\s*/i, '')}</div>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${pendingGoals.length > 0 ? `
                    <div>
                        <h5 style="color: #ff9800; margin: 0 0 8px 0;">â³ å¾…å®Œæˆç›®æ ‡</h5>
                        <div style="background: #fff3e0; padding: 12px; border-radius: 6px;">
                            ${pendingGoals.map(goal => `<div style="margin: 4px 0;">â€¢ ${goal.replace(/^\[\s\]\s*/, '')}</div>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function generateSkillDevelopmentAssessment(skills) {
            if (!skills || !skills.trim()) {
                return '<div style="color: #ff5722; padding: 12px; background: #ffebee; border-radius: 6px;">æœªè®¾å®šèƒ½åŠ›å‘å±•è®¡åˆ’</div>';
            }
            
            const skillContent = skills.toLowerCase();
            const categories = [
                { name: 'ä¸“ä¸šæŠ€èƒ½', keywords: ['æŠ€èƒ½', 'ä¸“ä¸š', 'æŠ€æœ¯', 'å·¥å…·'], found: false },
                { name: 'å­¦ä¹ è®¡åˆ’', keywords: ['å­¦ä¹ ', 'è¯¾ç¨‹', 'åŸ¹è®­', 'é˜…è¯»'], found: false },
                { name: 'å®è·µé¡¹ç›®', keywords: ['é¡¹ç›®', 'å®è·µ', 'ç»ƒä¹ ', 'åº”ç”¨'], found: false },
                { name: 'è½¯æŠ€èƒ½', keywords: ['æ²Ÿé€š', 'é¢†å¯¼', 'ç®¡ç†', 'åä½œ'], found: false }
            ];
            
            categories.forEach(category => {
                category.found = category.keywords.some(keyword => skillContent.includes(keyword));
            });
            
            const completionScore = Math.round((categories.filter(c => c.found).length / categories.length) * 100);
            
            return `
                <div style="display: grid; gap: 16px;">
                    <div style="text-align: center; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                        <div style="font-size: 1.8em; font-weight: bold;">${completionScore}%</div>
                        <div style="opacity: 0.9;">èƒ½åŠ›è§„åˆ’å®Œæ•´åº¦</div>
                    </div>
                    
                    <div style="display: grid; gap: 8px;">
                        ${categories.map(category => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: ${category.found ? '#e8f5e9' : '#f5f5f5'}; border-radius: 6px;">
                                <span>${category.name}</span>
                                <span style="font-size: 1.2em;">${category.found ? 'âœ…' : 'âšª'}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px;">
                        <strong>èƒ½åŠ›å‘å±•å†…å®¹é¢„è§ˆ:</strong><br>
                        <div style="margin-top: 8px; color: #666; max-height: 100px; overflow-y: auto;">${skills.substring(0, 200)}${skills.length > 200 ? '...' : ''}</div>
                    </div>
                </div>
            `;
        }

        function analyzeHistoricalTrends(historicalData) {
            if (historicalData.length === 0) return null;
            
            const trends = historicalData.map(item => {
                const analytics = calculateHalfyearMetrics(item.data);
                return {
                    period: `${item.year}å¹´${item.half === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´`,
                    progress: analytics.overall.progress,
                    strategicRate: analytics.strategic.rate,
                    projectRate: analytics.projects.rate
                };
            });
            
            return trends;
        }

        function generateHistoricalComparison(trends) {
            if (!trends || trends.length === 0) {
                return '<div style="color: #666;">æš‚æ— å†å²æ•°æ®å¯¹æ¯”</div>';
            }
            
            return `
                <div style="display: grid; gap: 16px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        ${trends.map(trend => `
                            <div style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; text-align: center;">
                                <h6 style="margin: 0 0 8px 0; color: #666;">${trend.period}</h6>
                                <div style="font-size: 1.5em; font-weight: bold; color: #2196f3;">${trend.progress}%</div>
                                <div style="font-size: 0.9em; color: #666; margin-top: 4px;">æ•´ä½“è¿›åº¦</div>
                                <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.8em; color: #999;">
                                    <span>æˆ˜ç•¥: ${trend.strategicRate}%</span>
                                    <span>é¡¹ç›®: ${trend.projectRate}%</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px;">
                        <strong>è¶‹åŠ¿åˆ†æ:</strong> ${generateTrendInsight(trends)}
                    </div>
                </div>
            `;
        }

        function generateTrendInsight(trends) {
            if (trends.length < 2) return 'éœ€è¦æ›´å¤šæ•°æ®æ‰èƒ½åˆ†æè¶‹åŠ¿';
            
            const currentProgress = trends[0].progress;
            const previousProgress = trends[1].progress;
            const progressChange = currentProgress - previousProgress;
            
            if (progressChange > 10) {
                return 'ğŸ“ˆ æ‰§è¡Œèƒ½åŠ›æ˜¾è‘—æå‡ï¼Œä¿æŒè‰¯å¥½å‘å±•åŠ¿å¤´';
            } else if (progressChange > 0) {
                return 'ğŸ“Š æ‰§è¡Œèƒ½åŠ›ç¨³æ­¥æå‡ï¼Œç»§ç»­ä¼˜åŒ–æ‰§è¡Œç­–ç•¥';
            } else if (progressChange > -10) {
                return 'ğŸ“Š æ‰§è¡Œèƒ½åŠ›åŸºæœ¬ç¨³å®šï¼Œå¯è€ƒè™‘æŒ‘æˆ˜æ›´é«˜ç›®æ ‡';
            } else {
                return 'ğŸ“‰ æ‰§è¡Œèƒ½åŠ›æœ‰æ‰€ä¸‹é™ï¼Œéœ€è¦é‡æ–°å®¡è§†ç›®æ ‡è®¾å®šå’Œæ‰§è¡Œæ–¹æ³•';
            }
        }

        function generateStrategicAdjustments(assessment, analytics) {
            const adjustments = [];
            
            // åŸºäºæ•´ä½“å¾—åˆ†çš„å»ºè®®
            if (assessment.overallScore >= 80) {
                adjustments.push('ğŸ¯ æˆ˜ç•¥æ‰§è¡Œä¼˜ç§€ï¼Œå¯ä»¥è€ƒè™‘åˆ¶å®šæ›´å…·æŒ‘æˆ˜æ€§çš„ç›®æ ‡');
                adjustments.push('ğŸ“ˆ åˆ©ç”¨å½“å‰ä¼˜åŠ¿ï¼Œæ‰©å±•åˆ°æ–°çš„æˆ˜ç•¥é¢†åŸŸ');
                adjustments.push('ğŸ¤ åˆ†äº«æˆåŠŸç»éªŒï¼Œå»ºç«‹æœ€ä½³å®è·µ');
            } else if (assessment.overallScore >= 60) {
                adjustments.push('âš¡ ç»§ç»­ä¿æŒå½“å‰æˆ˜ç•¥æ–¹å‘ï¼Œé€‚å½“ä¼˜åŒ–æ‰§è¡Œæ–¹æ³•');
                adjustments.push('ğŸ¯ èšç„¦æ ¸å¿ƒç›®æ ‡ï¼Œé¿å…èµ„æºåˆ†æ•£');
                adjustments.push('ğŸ“Š å»ºç«‹æ›´æ¸…æ™°çš„è¿›åº¦è·Ÿè¸ªæœºåˆ¶');
            } else {
                adjustments.push('ğŸ”§ éœ€è¦é‡æ–°è¯„ä¼°æˆ˜ç•¥å¯è¡Œæ€§å’Œèµ„æºé…ç½®');
                adjustments.push('ğŸ“ ç®€åŒ–ç›®æ ‡ï¼Œç¡®ä¿å¯æ‰§è¡Œæ€§');
                adjustments.push('ğŸ’ª åŠ å¼ºæ‰§è¡Œçºªå¾‹ï¼Œå»ºç«‹å®šæœŸå›é¡¾æœºåˆ¶');
            }
            
            // åŸºäºå…·ä½“ç»´åº¦çš„å»ºè®®
            if (analytics.strategic.rate < 50) {
                adjustments.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡æ‰§è¡Œåå¼±ï¼Œå»ºè®®é‡æ–°å®¡è§†ç›®æ ‡è®¾å®šçš„åˆç†æ€§');
            }
            
            if (analytics.projects.rate < 50) {
                adjustments.push('ğŸ—ï¸ é¡¹ç›®æ¨è¿›ç¼“æ…¢ï¼Œè€ƒè™‘ä¼˜åŒ–é¡¹ç›®ç®¡ç†æµç¨‹');
            }
            
            if (analytics.balance.rate < 50) {
                adjustments.push('âš–ï¸ å·¥ä½œç”Ÿæ´»å¹³è¡¡éœ€è¦é‡è§†ï¼Œå…³æ³¨å¯æŒç»­å‘å±•');
            }
            
            return adjustments.map(adj => `<div style="padding: 8px 12px; background: white; border-radius: 6px; margin: 4px 0; border-left: 3px solid #4caf50;">${adj}</div>`).join('');
        }

        function generateActionPlan(currentData) {
            const analytics = calculateHalfyearMetrics(currentData);
            const assessment = assessStrategicExecution(currentData);
            
            const actionPlanHtml = `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 8px 0;">ğŸš€ ä¸‹é˜¶æ®µè¡ŒåŠ¨è®¡åˆ’</h3>
                        <p style="margin: 0; opacity: 0.9;">åŸºäºå½“å‰æ‰§è¡Œæƒ…å†µç”Ÿæˆçš„å…·ä½“è¡ŒåŠ¨å»ºè®®</p>
                    </div>
                    
                    <!-- ç´§æ€¥è¡ŒåŠ¨é¡¹ -->
                    <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: #f44336;">ğŸš¨ ç´§æ€¥è¡ŒåŠ¨é¡¹ (æœªæ¥2å‘¨)</h4>
                        ${generateUrgentActions(analytics)}
                    </div>
                    
                    <!-- çŸ­æœŸè¡ŒåŠ¨é¡¹ -->
                    <div style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: #ff9800;">âš¡ çŸ­æœŸè¡ŒåŠ¨é¡¹ (æœªæ¥1ä¸ªæœˆ)</h4>
                        ${generateShortTermActions(analytics, assessment)}
                    </div>
                    
                    <!-- ä¸­æœŸè¡ŒåŠ¨é¡¹ -->
                    <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 8px; padding: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: #4caf50;">ğŸ“ˆ ä¸­æœŸè¡ŒåŠ¨é¡¹ (æœªæ¥3ä¸ªæœˆ)</h4>
                        ${generateMidTermActions(analytics, assessment)}
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸš€ è¡ŒåŠ¨è®¡åˆ’', actionPlanHtml, 'large');
        }

        function generateUrgentActions(analytics) {
            const actions = [];
            
            if (analytics.overall.progress < 30) {
                actions.push('ç«‹å³å›é¡¾å½“å‰æ‰€æœ‰ç›®æ ‡ï¼Œè¯†åˆ«æœ€æ ¸å¿ƒçš„2-3ä¸ªç›®æ ‡');
                actions.push('æš‚åœä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œé›†ä¸­èµ„æºäºå…³é”®ç›®æ ‡');
            }
            
            if (analytics.strategic.rate < 25) {
                actions.push('ç´§æ€¥è¯„ä¼°æˆ˜ç•¥ç›®æ ‡çš„å¯è¡Œæ€§ï¼Œå¿…è¦æ—¶è¿›è¡Œè°ƒæ•´');
                actions.push('è®¾ç«‹æ¯æ—¥æˆ˜ç•¥ç›®æ ‡æ£€æŸ¥æœºåˆ¶');
            }
            
            if (analytics.projects.rate < 25) {
                actions.push('å¬é›†é¡¹ç›®å›é¡¾ä¼šè®®ï¼Œè¯†åˆ«é˜»å¡ç‚¹');
                actions.push('é‡æ–°åˆ†é…é¡¹ç›®èµ„æºå’Œæ—¶é—´å®‰æ’');
            }
            
            if (actions.length === 0) {
                actions.push('ç»§ç»­ä¿æŒå½“å‰æ‰§è¡ŒèŠ‚å¥');
                actions.push('å®šæœŸç›‘æ§å…³é”®æŒ‡æ ‡å˜åŒ–');
            }
            
            return actions.map(action => `<div style="padding: 8px 0; border-bottom: 1px solid #ffcdd2;">â€¢ ${action}</div>`).join('');
        }

        function generateShortTermActions(analytics, assessment) {
            const actions = [];
            
            if (assessment.overallScore < 70) {
                actions.push('å»ºç«‹æ¯å‘¨ç›®æ ‡å›é¡¾æœºåˆ¶ï¼Œè·Ÿè¸ªæ‰§è¡Œè¿›åº¦');
                actions.push('ä¼˜åŒ–æ—¶é—´ç®¡ç†æ–¹æ³•ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡');
            }
            
            if (analytics.balance.rate < 60) {
                actions.push('åˆ¶å®šå·¥ä½œç”Ÿæ´»å¹³è¡¡æ”¹å–„è®¡åˆ’');
                actions.push('å®‰æ’å®šæœŸçš„ä¼‘æ¯å’Œæ¢å¤æ—¶é—´');
            }
            
            actions.push('å»ºç«‹å…³é”®æŒ‡æ ‡dashboardï¼Œå®æ—¶ç›‘æ§è¿›åº¦');
            actions.push('è®¾ç½®é‡Œç¨‹ç¢‘åº†ç¥æœºåˆ¶ï¼Œä¿æŒæ‰§è¡ŒåŠ¨åŠ›');
            
            return actions.map(action => `<div style="padding: 8px 0; border-bottom: 1px solid #ffe0b2;">â€¢ ${action}</div>`).join('');
        }

        function generateMidTermActions(analytics, assessment) {
            const actions = [];
            
            if (assessment.overallScore >= 80) {
                actions.push('æ¢ç´¢æ–°çš„æŒ‘æˆ˜é¢†åŸŸï¼Œæ‰©å±•æˆ˜ç•¥è¾¹ç•Œ');
                actions.push('å»ºç«‹çŸ¥è¯†åˆ†äº«æœºåˆ¶ï¼Œè¾“å‡ºæœ€ä½³å®è·µ');
            } else {
                actions.push('å»ºç«‹æ›´å®Œå–„çš„ç›®æ ‡è®¾å®šå’Œæ‰§è¡Œä½“ç³»');
                actions.push('æŠ•èµ„äºèƒ½åŠ›å»ºè®¾ï¼Œæå‡æ‰§è¡Œæ°´å¹³');
            }
            
            actions.push('å»ºç«‹é•¿æœŸèƒ½åŠ›å‘å±•è®¡åˆ’');
            actions.push('æ„å»ºæ›´å¼ºçš„æ”¯æŒç½‘ç»œå’Œåé¦ˆæœºåˆ¶');
            actions.push('å‡†å¤‡ä¸‹åŠå¹´/ä¸‹ä¸€é˜¶æ®µçš„æˆ˜ç•¥è§„åˆ’');
            
            return actions.map(action => `<div style="padding: 8px 0; border-bottom: 1px solid #c8e6c9;">â€¢ ${action}</div>`).join('');
        }

        function exportStrategicReview(currentData, historicalData) {
            const reviewData = {
                exportDate: new Date().toISOString(),
                period: `${currentYear}å¹´${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´`,
                currentData: currentData,
                analytics: calculateHalfyearMetrics(currentData),
                assessment: assessStrategicExecution(currentData),
                historicalData: historicalData
            };
            
            ExportUtils.exportToJSON(reviewData, `strategic_review_${currentYear}_H${currentHalf}.json`);
            MessageUtils.success('æˆ˜ç•¥å›é¡¾å·²å¯¼å‡º');
        }

        // å…¨é¢å›é¡¾åŠŸèƒ½
        function generateComprehensiveReview() {
            console.log('ğŸ”¥ å¼€å§‹ç”Ÿæˆå…¨é¢å›é¡¾...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('ğŸ“Š å…¨é¢å›é¡¾-åŠ è½½çš„æ•°æ®:', currentData);
                
                const reviewAnalysis = analyzeComprehensiveReview(currentData);
                console.log('ğŸ“Š å…¨é¢å›é¡¾åˆ†æç»“æœ:', reviewAnalysis);
                
                const reviewContent = generateComprehensiveReviewHTML(reviewAnalysis);
                console.log('ğŸ¨ ç”Ÿæˆçš„å…¨é¢å›é¡¾HTMLé•¿åº¦:', reviewContent.length);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('ğŸ“Š å…¨é¢å›é¡¾æŠ¥å‘Š', reviewContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºå…¨é¢å›é¡¾æ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰');
                    // åˆ›å»ºç®€å•çš„æç¤ºæ¡†ä½œä¸ºfallback
                    const fallbackModal = document.createElement('div');
                    fallbackModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.5); z-index: 9999; display: flex;
                        align-items: center; justify-content: center;
                    `;
                    fallbackModal.innerHTML = `
                        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 80vw; max-height: 80vh; overflow: auto;">
                            <button onclick="this.closest('div').parentNode.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
                            <div>${reviewContent}</div>
                        </div>
                    `;
                    document.body.appendChild(fallbackModal);
                }
            } catch (error) {
                console.error('âŒ å…¨é¢å›é¡¾ç”Ÿæˆå¤±è´¥:', error);
                console.error('âŒ é”™è¯¯å †æ ˆ:', error.stack);
                alert('å…¨é¢å›é¡¾å‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeComprehensiveReview(data) {
            console.log('ğŸ” å¼€å§‹åˆ†æå…¨é¢å›é¡¾...');
            
            // æ”¶é›†æ‰€æœ‰å†…å®¹
            const allContent = {
                vision: data.vision || '',
                strategic: data.strategicGoals || '',
                quarter1: data.quarter1Milestones || '',
                quarter2: data.quarter2Milestones || '',
                projects: data.projects || '',
                skills: data.skills || '',
                balance: data.balance || '',
                review: data.review || ''
            };

            // åˆ†æå„ä¸ªç»´åº¦
            const analysis = {
                overview: generateOverviewAnalysis(allContent),
                goalProgress: analyzeGoalProgress(allContent),
                projectStatus: analyzeProjectStatus(allContent),
                skillDevelopment: analyzeSkillDevelopment(allContent),
                balanceAssessment: analyzeBalanceAssessment(allContent),
                timeManagement: analyzeTimeManagement(allContent),
                achievements: extractAchievements(allContent),
                challenges: extractChallenges(allContent),
                recommendations: generateRecommendations(allContent)
            };

            // è®¡ç®—ç»¼åˆè¯„åˆ†
            const overallScore = calculateOverallScore(analysis);
            
            // ç”Ÿæˆæ€»ç»“
            const summary = generateReviewSummary(analysis, overallScore);

            return {
                analysis: analysis,
                overallScore: overallScore,
                summary: summary,
                timestamp: new Date().toISOString()
            };
        }

        function generateOverviewAnalysis(content) {
            const totalWords = Object.values(content).join(' ').split(/\s+/).filter(word => word.length > 0).length;
            const completionRate = calculateCompletionRate(content);
            const contentRichness = Math.min(totalWords / 800, 1) * 100; // 800è¯ä¸ºæ»¡åˆ†
            
            return {
                totalWords: totalWords,
                completionRate: completionRate,
                contentRichness: Math.round(contentRichness),
                planningDepth: assessPlanningDepth(content),
                executionQuality: assessExecutionQuality(content)
            };
        }

        function analyzeGoalProgress(content) {
            const strategicGoals = content.strategic || '';
            const q1Goals = content.quarter1 || '';
            const q2Goals = content.quarter2 || '';
            
            // åˆ†æç›®æ ‡å®Œæˆæƒ…å†µ
            const strategicProgress = calculateTextProgress(strategicGoals);
            const q1Progress = calculateTextProgress(q1Goals);
            const q2Progress = calculateTextProgress(q2Goals);
            
            // è¯†åˆ«å…³é”®ç›®æ ‡
            const keyGoals = extractKeyGoals(strategicGoals);
            
            return {
                strategic: {
                    progress: strategicProgress,
                    goals: keyGoals.slice(0, 3)
                },
                quarterly: {
                    q1Progress: q1Progress,
                    q2Progress: q2Progress,
                    trend: q2Progress >= q1Progress ? 'improving' : 'declining'
                },
                overallProgress: Math.round((strategicProgress + q1Progress + q2Progress) / 3)
            };
        }

        function analyzeProjectStatus(content) {
            const projects = content.projects || '';
            const projectLines = projects.split('\n').filter(line => line.trim());
            
            const projectAnalysis = projectLines.map(line => {
                const isCompleted = /\[x\]/i.test(line);
                const isInProgress = /\[-\]/.test(line) || (!isCompleted && /\[\s*\]/.test(line));
                const priority = getPriority(line);
                
                return {
                    content: line.replace(/^\[.\]\s*/, '').trim(),
                    status: isCompleted ? 'completed' : (isInProgress ? 'in-progress' : 'planned'),
                    priority: priority
                };
            });

            const completed = projectAnalysis.filter(p => p.status === 'completed').length;
            const inProgress = projectAnalysis.filter(p => p.status === 'in-progress').length;
            const total = projectAnalysis.length;

            return {
                total: total,
                completed: completed,
                inProgress: inProgress,
                planned: total - completed - inProgress,
                completionRate: total > 0 ? Math.round((completed / total) * 100) : 0,
                projects: projectAnalysis.slice(0, 5) // æ˜¾ç¤ºå‰5ä¸ªé¡¹ç›®
            };
        }

        function analyzeSkillDevelopment(content) {
            const skills = content.skills || '';
            const skillLines = skills.split('\n').filter(line => line.trim());
            
            const skillCategories = {
                technical: 0,
                management: 0,
                communication: 0,
                other: 0
            };

            const skillProgress = skillLines.map(line => {
                const isCompleted = /\[x\]/i.test(line);
                const category = categorizeSkill(line);
                skillCategories[category]++;
                
                return {
                    content: line.replace(/^\[.\]\s*/, '').trim(),
                    status: isCompleted ? 'mastered' : 'learning',
                    category: category
                };
            });

            const masteredCount = skillProgress.filter(s => s.status === 'mastered').length;
            const totalSkills = skillProgress.length;

            return {
                total: totalSkills,
                mastered: masteredCount,
                learning: totalSkills - masteredCount,
                masteryRate: totalSkills > 0 ? Math.round((masteredCount / totalSkills) * 100) : 0,
                categories: skillCategories,
                skills: skillProgress.slice(0, 6)
            };
        }

        function analyzeBalanceAssessment(content) {
            const balance = content.balance || '';
            const balanceScore = calculateBalanceScore(content);
            
            // åˆ†æå·¥ä½œç”Ÿæ´»å¹³è¡¡çš„å…³é”®è¯
            const workKeywords = ['å·¥ä½œ', 'é¡¹ç›®', 'ä»»åŠ¡', 'ä¼šè®®', 'åŠ ç­'];
            const lifeKeywords = ['å®¶åº­', 'ä¼‘æ¯', 'è¿åŠ¨', 'å¨±ä¹', 'æœ‹å‹', 'å¥åº·'];
            
            const workMentions = countKeywords(balance, workKeywords);
            const lifeMentions = countKeywords(balance, lifeKeywords);
            
            return {
                overallScore: balanceScore,
                workFocus: workMentions,
                lifeFocus: lifeMentions,
                balance: lifeMentions > 0 ? Math.round((lifeMentions / (workMentions + lifeMentions)) * 100) : 0,
                assessment: getBalanceAssessment(balanceScore)
            };
        }

        function analyzeTimeManagement(content) {
            const allText = Object.values(content).join(' ');
            
            // åˆ†ææ—¶é—´ç®¡ç†ç›¸å…³è¯æ±‡
            const timeKeywords = ['è®¡åˆ’', 'å®‰æ’', 'æ—¶é—´', 'æ—¥ç¨‹', 'ä¼˜å…ˆçº§', 'æ•ˆç‡'];
            const urgencyKeywords = ['ç´§æ€¥', 'é‡è¦', 'ä¼˜å…ˆ', 'å…³é”®', 'æ ¸å¿ƒ'];
            
            const timeScore = countKeywords(allText, timeKeywords);
            const urgencyScore = countKeywords(allText, urgencyKeywords);
            
            // åˆ†æå­£åº¦åˆ†å¸ƒ
            const q1Length = (content.quarter1 || '').length;
            const q2Length = (content.quarter2 || '').length;
            const timeDistribution = q1Length + q2Length > 0 ? 
                Math.round((q1Length / (q1Length + q2Length)) * 100) : 50;

            return {
                planningAwareness: Math.min(timeScore * 10, 100),
                priorityAwareness: Math.min(urgencyScore * 15, 100),
                timeDistribution: {
                    q1Percentage: timeDistribution,
                    q2Percentage: 100 - timeDistribution,
                    balance: Math.abs(50 - timeDistribution) <= 20 ? 'balanced' : 'unbalanced'
                }
            };
        }

        function extractAchievements(content) {
            const achievements = [];
            const achievementKeywords = ['å®Œæˆ', 'è¾¾æˆ', 'å®ç°', 'æˆåŠŸ', 'çªç ´', 'è·å¾—', 'æŒæ¡', 'å»ºç«‹'];
            
            Object.entries(content).forEach(([area, text]) => {
                if (!text) return;
                
                const sentences = text.split(/[ã€‚ï¼ï¼Ÿ.!?\n]/).filter(s => s.trim());
                sentences.forEach(sentence => {
                    const hasAchievement = achievementKeywords.some(keyword => 
                        sentence.toLowerCase().includes(keyword.toLowerCase())
                    );
                    
                    if (hasAchievement && sentence.length > 10 && sentence.length < 100) {
                        achievements.push({
                            area: getAreaDisplayName(area),
                            content: sentence.trim(),
                            impact: assessImpact(sentence)
                        });
                    }
                });
            });

            return achievements.sort((a, b) => b.impact - a.impact).slice(0, 6);
        }

        function extractChallenges(content) {
            const challenges = [];
            const challengeKeywords = ['å›°éš¾', 'æŒ‘æˆ˜', 'é—®é¢˜', 'éšœç¢', 'ä¸è¶³', 'éœ€è¦æ”¹è¿›', 'å¾…æå‡'];
            
            Object.entries(content).forEach(([area, text]) => {
                if (!text) return;
                
                const sentences = text.split(/[ã€‚ï¼ï¼Ÿ.!?\n]/).filter(s => s.trim());
                sentences.forEach(sentence => {
                    const hasChallenge = challengeKeywords.some(keyword => 
                        sentence.toLowerCase().includes(keyword.toLowerCase())
                    );
                    
                    if (hasChallenge && sentence.length > 10 && sentence.length < 100) {
                        challenges.push({
                            area: getAreaDisplayName(area),
                            content: sentence.trim(),
                            severity: assessSeverity(sentence)
                        });
                    }
                });
            });

            return challenges.sort((a, b) => b.severity - a.severity).slice(0, 5);
        }

        function generateRecommendations(content) {
            const recommendations = [];
            const overview = generateOverviewAnalysis(content);
            const goalProgress = analyzeGoalProgress(content);
            const projectStatus = analyzeProjectStatus(content);
            
            // åŸºäºå®Œæˆç‡çš„å»ºè®®
            if (overview.completionRate < 50) {
                recommendations.push({
                    category: 'execution',
                    priority: 'high',
                    title: 'æå‡æ‰§è¡Œæ•ˆç‡',
                    suggestion: 'å½“å‰å®Œæˆç‡åä½ï¼Œå»ºè®®é‡æ–°è¯„ä¼°ç›®æ ‡å¯è¡Œæ€§ï¼Œé‡‡ç”¨SMARTåŸåˆ™é‡æ–°åˆ¶å®šè®¡åˆ’'
                });
            } else if (overview.completionRate > 80) {
                recommendations.push({
                    category: 'growth',
                    priority: 'medium',
                    title: 'æŒ‘æˆ˜æ›´é«˜ç›®æ ‡',
                    suggestion: 'æ‰§è¡Œæ•ˆæœä¼˜ç§€ï¼Œå¯ä»¥è€ƒè™‘è®¾å®šæ›´å…·æŒ‘æˆ˜æ€§çš„ç›®æ ‡'
                });
            }

            // åŸºäºé¡¹ç›®çŠ¶æ€çš„å»ºè®®
            if (projectStatus.inProgress > projectStatus.completed) {
                recommendations.push({
                    category: 'focus',
                    priority: 'high',
                    title: 'èšç„¦æ ¸å¿ƒé¡¹ç›®',
                    suggestion: 'è¿›è¡Œä¸­çš„é¡¹ç›®è¾ƒå¤šï¼Œå»ºè®®èšç„¦æœ€é‡è¦çš„2-3ä¸ªé¡¹ç›®ï¼Œé¿å…ç²¾åŠ›åˆ†æ•£'
                });
            }

            // åŸºäºå†…å®¹ä¸°å¯Œåº¦çš„å»ºè®®
            if (overview.contentRichness < 60) {
                recommendations.push({
                    category: 'planning',
                    priority: 'medium',
                    title: 'æ·±åŒ–è§„åˆ’å†…å®¹',
                    suggestion: 'è®¡åˆ’å†…å®¹ç›¸å¯¹ç®€å•ï¼Œå»ºè®®å¢åŠ å…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤å’ŒæˆåŠŸæ ‡å‡†'
                });
            }

            return recommendations.slice(0, 4);
        }

        function calculateOverallScore(analysis) {
            const weights = {
                completion: 0.3,
                planning: 0.2,
                execution: 0.2,
                balance: 0.15,
                growth: 0.15
            };

            const scores = {
                completion: analysis.overview.completionRate,
                planning: analysis.overview.contentRichness,
                execution: analysis.projectStatus.completionRate,
                balance: analysis.balanceAssessment.overallScore,
                growth: analysis.skillDevelopment.masteryRate
            };

            let totalScore = 0;
            Object.entries(weights).forEach(([key, weight]) => {
                totalScore += (scores[key] || 0) * weight;
            });

            return Math.round(totalScore);
        }

        function generateReviewSummary(analysis, overallScore) {
            let level, description, highlights;
            
            if (overallScore >= 80) {
                level = 'excellent';
                description = 'è¡¨ç°ä¼˜ç§€ï¼Œå„æ–¹é¢å‘å±•å‡è¡¡';
                highlights = ['æ‰§è¡ŒåŠ›å¼º', 'è§„åˆ’å®Œæ•´', 'æŒç»­æˆé•¿'];
            } else if (overallScore >= 60) {
                level = 'good';
                description = 'æ•´ä½“è¡¨ç°è‰¯å¥½ï¼Œæœ‰æå‡ç©ºé—´';
                highlights = ['åŸºç¡€æ‰å®', 'æ–¹å‘æ˜ç¡®', 'ç¨³æ­¥æ¨è¿›'];
            } else {
                level = 'developing';
                description = 'ä»åœ¨å‘å±•ä¸­ï¼Œéœ€è¦é‡ç‚¹æ”¹è¿›';
                highlights = ['æœ‰å¾…æå‡', 'éœ€è¦èšç„¦', 'åŠ å¼ºæ‰§è¡Œ'];
            }

            return {
                overallScore: overallScore,
                level: level,
                description: description,
                highlights: highlights,
                keyMetrics: {
                    completion: analysis.overview.completionRate,
                    projects: analysis.projectStatus.completionRate,
                    skills: analysis.skillDevelopment.masteryRate,
                    balance: analysis.balanceAssessment.overallScore
                }
            };
        }

        // è¾…åŠ©å‡½æ•°
        function calculateCompletionRate(content) {
            let totalTasks = 0;
            let completedTasks = 0;

            Object.values(content).forEach(text => {
                if (!text) return;
                const tasks = (text.match(/\[.\]/g) || []).length;
                const completed = (text.match(/\[x\]/gi) || []).length;
                totalTasks += tasks;
                completedTasks += completed;
            });

            return totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        }

        function calculateTextProgress(text) {
            if (!text) return 0;
            const tasks = (text.match(/\[.\]/g) || []).length;
            const completed = (text.match(/\[x\]/gi) || []).length;
            return tasks > 0 ? Math.round((completed / tasks) * 100) : 0;
        }

        function assessPlanningDepth(content) {
            const totalSentences = Object.values(content).join(' ').split(/[ã€‚ï¼ï¼Ÿ.!?]/).filter(s => s.trim().length > 5).length;
            return Math.min(Math.round(totalSentences / 20 * 100), 100);
        }

        function assessExecutionQuality(content) {
            const allText = Object.values(content).join(' ');
            const executionKeywords = ['å®Œæˆ', 'å®ç°', 'è¾¾æˆ', 'æ‰§è¡Œ', 'æ¨è¿›'];
            const executionScore = countKeywords(allText, executionKeywords);
            return Math.min(executionScore * 15, 100);
        }

        function extractKeyGoals(strategicText) {
            if (!strategicText) return [];
            return strategicText.split('\n')
                .filter(line => line.trim() && !line.startsWith('#'))
                .slice(0, 5)
                .map(line => line.replace(/^\[.\]\s*/, '').trim());
        }

        function getPriority(text) {
            if (/é‡è¦|å…³é”®|æ ¸å¿ƒ|ä¼˜å…ˆ/i.test(text)) return 'high';
            if (/æ¬¡è¦|è¾…åŠ©|æ”¯æŒ/i.test(text)) return 'low';
            return 'medium';
        }

        function categorizeSkill(skillText) {
            const technical = /æŠ€æœ¯|ç¼–ç¨‹|å¼€å‘|ç³»ç»Ÿ|å·¥å…·|è½¯ä»¶/i;
            const management = /ç®¡ç†|é¢†å¯¼|å›¢é˜Ÿ|åè°ƒ|è§„åˆ’/i;
            const communication = /æ²Ÿé€š|è¡¨è¾¾|æ¼”è®²|å†™ä½œ|äº¤æµ/i;
            
            if (technical.test(skillText)) return 'technical';
            if (management.test(skillText)) return 'management';
            if (communication.test(skillText)) return 'communication';
            return 'other';
        }

        function countKeywords(text, keywords) {
            return keywords.reduce((count, keyword) => {
                return count + (text.toLowerCase().split(keyword.toLowerCase()).length - 1);
            }, 0);
        }

        function getBalanceAssessment(score) {
            if (score >= 80) return 'excellent';
            if (score >= 60) return 'good';
            if (score >= 40) return 'fair';
            return 'needs_improvement';
        }

        function getAreaDisplayName(area) {
            const names = {
                vision: 'æ„¿æ™¯è§„åˆ’',
                strategic: 'æˆ˜ç•¥ç›®æ ‡',
                quarter1: 'Q1é‡Œç¨‹ç¢‘',
                quarter2: 'Q2é‡Œç¨‹ç¢‘',
                projects: 'é‡ç‚¹é¡¹ç›®',
                skills: 'æŠ€èƒ½å‘å±•',
                balance: 'å·¥ä½œç”Ÿæ´»å¹³è¡¡',
                review: 'å›é¡¾æ€»ç»“'
            };
            return names[area] || area;
        }

        function assessImpact(sentence) {
            const highImpactKeywords = ['é‡å¤§', 'å…³é”®', 'æ ¸å¿ƒ', 'çªç ´', 'æˆåŠŸ'];
            const mediumImpactKeywords = ['å®Œæˆ', 'è¾¾æˆ', 'å®ç°', 'æå‡'];
            
            if (highImpactKeywords.some(keyword => sentence.includes(keyword))) return 5;
            if (mediumImpactKeywords.some(keyword => sentence.includes(keyword))) return 3;
            return 1;
        }

        function assessSeverity(sentence) {
            const highSeverityKeywords = ['ä¸¥é‡', 'é‡å¤§', 'å…³é”®', 'ç´§æ€¥'];
            const mediumSeverityKeywords = ['é—®é¢˜', 'å›°éš¾', 'æŒ‘æˆ˜', 'ä¸è¶³'];
            
            if (highSeverityKeywords.some(keyword => sentence.includes(keyword))) return 5;
            if (mediumSeverityKeywords.some(keyword => sentence.includes(keyword))) return 3;
            return 1;
        }

        function generateComprehensiveReviewHTML(reviewAnalysis) {
            console.log('ğŸ¨ å¼€å§‹ç”Ÿæˆå…¨é¢å›é¡¾HTML...');
            
            if (!reviewAnalysis || !reviewAnalysis.summary) {
                return `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 3em; margin-bottom: 16px;">ğŸ“Š</div>
                        <div style="font-size: 1.2em; margin-bottom: 8px;">æš‚æ— å›é¡¾æ•°æ®</div>
                        <div style="font-size: 0.9em;">è¯·å…ˆå¡«å†™åŠå¹´è®¡åˆ’çš„å„ä¸ªéƒ¨åˆ†ï¼Œç„¶åå†ç”Ÿæˆå…¨é¢å›é¡¾</div>
                    </div>
                `;
            }

            const { analysis, summary, overallScore } = reviewAnalysis;

            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6;">
                    <!-- å…¨é¢å›é¡¾æ¦‚è§ˆ -->
                    <div style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; text-align: center;">
                        <div style="font-size: 2.5em; margin-bottom: 12px;">ğŸ“Š</div>
                        <h2 style="margin: 0 0 16px 0; font-size: 1.8em;">åŠå¹´å…¨é¢å›é¡¾æŠ¥å‘Š</h2>
                        <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 16px; margin-bottom: 16px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.8em; font-weight: bold;">${overallScore}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ç»¼åˆè¯„åˆ†</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.5em; font-weight: bold;">${summary.keyMetrics.completion}%</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">å®Œæˆç‡</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.5em; font-weight: bold;">${analysis.achievements.length}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">é‡è¦æˆå°±</div>
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 4px;">æ•´ä½“è¯„ä¼°</div>
                            <div style="font-size: 0.9em; margin-bottom: 8px;">${summary.description}</div>
                            <div style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
                                ${summary.highlights.map(highlight => `
                                    <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 0.8em;">
                                        ${highlight}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- æ ¸å¿ƒæŒ‡æ ‡ä»ªè¡¨ç›˜ -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ“ˆ</span>
                            </div>
                            <h3 style="margin: 0; color: #1e40af; font-size: 1.3em;">æ ¸å¿ƒæŒ‡æ ‡ä»ªè¡¨ç›˜</h3>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div style="background: #f0f9ff; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #0ea5e9; margin-bottom: 4px;">${summary.keyMetrics.completion}%</div>
                                <div style="font-size: 0.9em; color: #0369a1; margin-bottom: 8px;">ä»»åŠ¡å®Œæˆç‡</div>
                                <div style="background: #e0f2fe; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: #0ea5e9; height: 100%; width: ${summary.keyMetrics.completion}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                            <div style="background: #f0fdf4; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #22c55e; margin-bottom: 4px;">${summary.keyMetrics.projects}%</div>
                                <div style="font-size: 0.9em; color: #15803d; margin-bottom: 8px;">é¡¹ç›®å®Œæˆç‡</div>
                                <div style="background: #dcfce7; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: #22c55e; height: 100%; width: ${summary.keyMetrics.projects}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                            <div style="background: #fef3c7; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #f59e0b; margin-bottom: 4px;">${summary.keyMetrics.skills}%</div>
                                <div style="font-size: 0.9em; color: #d97706; margin-bottom: 8px;">æŠ€èƒ½æŒæ¡ç‡</div>
                                <div style="background: #fef3c7; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: #f59e0b; height: 100%; width: ${summary.keyMetrics.skills}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                            <div style="background: #fdf2f8; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 2em; font-weight: bold; color: #ec4899; margin-bottom: 4px;">${summary.keyMetrics.balance}%</div>
                                <div style="font-size: 0.9em; color: #be185d; margin-bottom: 8px;">å·¥ä½œç”Ÿæ´»å¹³è¡¡</div>
                                <div style="background: #fce7f3; height: 6px; border-radius: 3px; overflow: hidden;">
                                    <div style="background: #ec4899; height: 100%; width: ${summary.keyMetrics.balance}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç›®æ ‡è¿›å±•åˆ†æ -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ¯</span>
                            </div>
                            <h3 style="margin: 0; color: #059669; font-size: 1.3em;">ç›®æ ‡è¿›å±•åˆ†æ</h3>
                        </div>
                        <div style="display: grid; gap: 16px;">
                            <div style="background: #ecfdf5; border-radius: 8px; padding: 16px;">
                                <div style="font-weight: bold; color: #065f46; margin-bottom: 8px;">æˆ˜ç•¥ç›®æ ‡è¿›å±•: ${analysis.goalProgress.strategic.progress}%</div>
                                <div style="background: #d1fae5; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 12px;">
                                    <div style="background: #10b981; height: 100%; width: ${analysis.goalProgress.strategic.progress}%; transition: width 0.3s ease;"></div>
                                </div>
                                ${analysis.goalProgress.strategic.goals.length > 0 ? `
                                    <div style="font-size: 0.9em; color: #374151;">
                                        <div style="font-weight: 500; margin-bottom: 6px;">å…³é”®ç›®æ ‡:</div>
                                        ${analysis.goalProgress.strategic.goals.map(goal => `
                                            <div style="background: white; padding: 8px 12px; border-radius: 6px; margin-bottom: 4px; border-left: 3px solid #10b981;">
                                                ${goal}
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div style="background: #f0f9ff; border-radius: 8px; padding: 16px;">
                                    <div style="font-weight: bold; color: #0c4a6e; margin-bottom: 8px;">Q1è¿›å±•</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: #0284c7;">${analysis.goalProgress.quarterly.q1Progress}%</div>
                                </div>
                                <div style="background: ${analysis.goalProgress.quarterly.trend === 'improving' ? '#f0fdf4' : '#fef2f2'}; border-radius: 8px; padding: 16px;">
                                    <div style="font-weight: bold; color: ${analysis.goalProgress.quarterly.trend === 'improving' ? '#14532d' : '#991b1b'}; margin-bottom: 8px;">Q2è¿›å±•</div>
                                    <div style="font-size: 1.5em; font-weight: bold; color: ${analysis.goalProgress.quarterly.trend === 'improving' ? '#16a34a' : '#dc2626'};">
                                        ${analysis.goalProgress.quarterly.q2Progress}%
                                        <span style="font-size: 0.6em; margin-left: 8px;">
                                            ${analysis.goalProgress.quarterly.trend === 'improving' ? 'ğŸ“ˆ' : 'ğŸ“‰'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é¡¹ç›®çŠ¶æ€æ¦‚è§ˆ -->
                    ${analysis.projectStatus.total > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ“‹</span>
                            </div>
                            <h3 style="margin: 0; color: #7c3aed; font-size: 1.3em;">é¡¹ç›®çŠ¶æ€æ¦‚è§ˆ</h3>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 16px;">
                            <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #16a34a;">${analysis.projectStatus.completed}</div>
                                <div style="font-size: 0.8em; color: #15803d;">å·²å®Œæˆ</div>
                            </div>
                            <div style="background: #fff7ed; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #ea580c;">${analysis.projectStatus.inProgress}</div>
                                <div style="font-size: 0.8em; color: #c2410c;">è¿›è¡Œä¸­</div>
                            </div>
                            <div style="background: #f8fafc; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #64748b;">${analysis.projectStatus.planned}</div>
                                <div style="font-size: 0.8em; color: #475569;">è®¡åˆ’ä¸­</div>
                            </div>
                            <div style="background: #ede9fe; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #8b5cf6;">${analysis.projectStatus.total}</div>
                                <div style="font-size: 0.8em; color: #7c3aed;">æ€»é¡¹ç›®</div>
                            </div>
                        </div>
                        ${analysis.projectStatus.projects.length > 0 ? `
                            <div style="background: #fafafa; border-radius: 8px; padding: 12px;">
                                <div style="font-weight: 500; margin-bottom: 8px; color: #374151;">ä¸»è¦é¡¹ç›®:</div>
                                <div style="display: grid; gap: 6px;">
                                    ${analysis.projectStatus.projects.map(project => `
                                        <div style="background: white; padding: 8px 12px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between;">
                                            <span style="font-size: 0.9em;">${project.content}</span>
                                            <div style="display: flex; align-items: center; gap: 6px;">
                                                <span style="background: ${project.status === 'completed' ? '#dcfce7' : project.status === 'in-progress' ? '#fed7aa' : '#f1f5f9'}; color: ${project.status === 'completed' ? '#166534' : project.status === 'in-progress' ? '#c2410c' : '#475569'}; padding: 2px 6px; border-radius: 10px; font-size: 0.7em;">
                                                    ${project.status === 'completed' ? 'âœ“ å®Œæˆ' : project.status === 'in-progress' ? 'â³ è¿›è¡Œä¸­' : 'ğŸ“‹ è®¡åˆ’'}
                                                </span>
                                                <span style="background: ${project.priority === 'high' ? '#fecaca' : project.priority === 'low' ? '#e5e7eb' : '#fef3c7'}; color: ${project.priority === 'high' ? '#991b1b' : project.priority === 'low' ? '#374151' : '#92400e'}; padding: 2px 6px; border-radius: 10px; font-size: 0.7em;">
                                                    ${project.priority === 'high' ? 'ğŸ”´' : project.priority === 'low' ? 'ğŸŸ¢' : 'ğŸŸ¡'}
                                                </span>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    ` : ''}

                    <!-- æŠ€èƒ½å‘å±•è¯„ä¼° -->
                    ${analysis.skillDevelopment.total > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #f59e0b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ“</span>
                            </div>
                            <h3 style="margin: 0; color: #d97706; font-size: 1.3em;">æŠ€èƒ½å‘å±•è¯„ä¼°</h3>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 16px;">
                            <div style="background: #fef3c7; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #d97706;">${analysis.skillDevelopment.mastered}</div>
                                <div style="font-size: 0.8em; color: #92400e;">å·²æŒæ¡</div>
                            </div>
                            <div style="background: #fef2f2; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #dc2626;">${analysis.skillDevelopment.learning}</div>
                                <div style="font-size: 0.8em; color: #991b1b;">å­¦ä¹ ä¸­</div>
                            </div>
                            <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #16a34a;">${analysis.skillDevelopment.masteryRate}%</div>
                                <div style="font-size: 0.8em; color: #15803d;">æŒæ¡ç‡</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin-bottom: 12px;">
                            <div style="background: #e0f2fe; padding: 8px; border-radius: 6px; text-align: center;">
                                <div style="font-weight: bold; color: #0277bd;">æŠ€æœ¯: ${analysis.skillDevelopment.categories.technical}</div>
                            </div>
                            <div style="background: #f3e8ff; padding: 8px; border-radius: 6px; text-align: center;">
                                <div style="font-weight: bold; color: #7c3aed;">ç®¡ç†: ${analysis.skillDevelopment.categories.management}</div>
                            </div>
                            <div style="background: #ecfdf5; padding: 8px; border-radius: 6px; text-align: center;">
                                <div style="font-weight: bold; color: #059669;">æ²Ÿé€š: ${analysis.skillDevelopment.categories.communication}</div>
                            </div>
                            <div style="background: #f1f5f9; padding: 8px; border-radius: 6px; text-align: center;">
                                <div style="font-weight: bold; color: #64748b;">å…¶ä»–: ${analysis.skillDevelopment.categories.other}</div>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- é‡è¦æˆå°± -->
                    ${analysis.achievements.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #059669; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ†</span>
                            </div>
                            <h3 style="margin: 0; color: #047857; font-size: 1.3em;">é‡è¦æˆå°± (${analysis.achievements.length}é¡¹)</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${analysis.achievements.map((achievement, index) => `
                                <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 12px 16px; border-radius: 6px; position: relative;">
                                    <div style="position: absolute; top: 8px; right: 12px; background: #10b981; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8em; font-weight: bold;">
                                        ${index + 1}
                                    </div>
                                    <div style="font-weight: 500; color: #065f46; margin-bottom: 4px; padding-right: 32px;">${achievement.area}</div>
                                    <div style="color: #374151; font-size: 0.95em; padding-right: 32px;">${achievement.content}</div>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: #059669;">
                                        å½±å“ç¨‹åº¦: ${'â­'.repeat(Math.min(achievement.impact, 5))}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æŒ‘æˆ˜ä¸é—®é¢˜ -->
                    ${analysis.challenges.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">âš ï¸</span>
                            </div>
                            <h3 style="margin: 0; color: #b91c1c; font-size: 1.3em;">æŒ‘æˆ˜ä¸é—®é¢˜ (${analysis.challenges.length}é¡¹)</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${analysis.challenges.map(challenge => `
                                <div style="background: #fef2f2; border-left: 4px solid #f87171; padding: 12px 16px; border-radius: 6px;">
                                    <div style="font-weight: 500; color: #b91c1c; margin-bottom: 4px;">${challenge.area}</div>
                                    <div style="color: #374151; font-size: 0.95em;">${challenge.content}</div>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: #dc2626;">
                                        ä¸¥é‡ç¨‹åº¦: ${'ğŸ”´'.repeat(Math.min(challenge.severity, 5))}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æ”¹è¿›å»ºè®® -->
                    ${analysis.recommendations.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #2563eb; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ’¡</span>
                            </div>
                            <h3 style="margin: 0; color: #1d4ed8; font-size: 1.3em;">æ”¹è¿›å»ºè®®</h3>
                        </div>
                        <div style="display: grid; gap: 16px;">
                            ${analysis.recommendations.map(rec => `
                                <div style="background: #eff6ff; border-radius: 8px; padding: 16px; border-left: 4px solid ${rec.priority === 'high' ? '#dc2626' : rec.priority === 'medium' ? '#f59e0b' : '#10b981'};">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <span style="background: ${rec.priority === 'high' ? '#fecaca' : rec.priority === 'medium' ? '#fef3c7' : '#dcfce7'}; color: ${rec.priority === 'high' ? '#991b1b' : rec.priority === 'medium' ? '#92400e' : '#166534'}; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 8px;">
                                            ${rec.priority === 'high' ? 'ğŸ”´ é«˜ä¼˜å…ˆçº§' : rec.priority === 'medium' ? 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§' : 'ğŸŸ¢ ä½ä¼˜å…ˆçº§'}
                                        </span>
                                        <div style="font-weight: bold; color: #1e40af;">${rec.title}</div>
                                    </div>
                                    <div style="color: #374151; font-size: 0.95em;">${rec.suggestion}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æ—¶é—´ç®¡ç†åˆ†æ -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #7c3aed; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">â°</span>
                            </div>
                            <h3 style="margin: 0; color: #6d28d9; font-size: 1.3em;">æ—¶é—´ç®¡ç†åˆ†æ</h3>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div style="background: #f3e8ff; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #7c3aed; margin-bottom: 4px;">${analysis.timeManagement.planningAwareness}%</div>
                                <div style="font-size: 0.9em; color: #6d28d9;">è§„åˆ’æ„è¯†</div>
                            </div>
                            <div style="background: #ecfdf5; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 1.8em; font-weight: bold; color: #10b981; margin-bottom: 4px;">${analysis.timeManagement.priorityAwareness}%</div>
                                <div style="font-size: 0.9em; color: #059669;">ä¼˜å…ˆçº§æ„è¯†</div>
                            </div>
                            <div style="background: ${analysis.timeManagement.timeDistribution.balance === 'balanced' ? '#f0fdf4' : '#fef2f2'}; border-radius: 8px; padding: 16px; text-align: center;">
                                <div style="font-size: 1.2em; font-weight: bold; color: ${analysis.timeManagement.timeDistribution.balance === 'balanced' ? '#16a34a' : '#dc2626'}; margin-bottom: 4px;">
                                    ${analysis.timeManagement.timeDistribution.balance === 'balanced' ? 'âš–ï¸ å¹³è¡¡' : 'âš ï¸ å¤±è¡¡'}
                                </div>
                                <div style="font-size: 0.9em; color: ${analysis.timeManagement.timeDistribution.balance === 'balanced' ? '#15803d' : '#991b1b'};">æ—¶é—´åˆ†é…</div>
                                <div style="font-size: 0.8em; margin-top: 4px; color: #6b7280;">
                                    Q1: ${analysis.timeManagement.timeDistribution.q1Percentage}% | Q2: ${analysis.timeManagement.timeDistribution.q2Percentage}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸‹é˜¶æ®µå±•æœ› -->
                    <div style="background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); color: white; border-radius: 12px; padding: 20px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 12px;">ğŸš€</div>
                        <h3 style="margin: 0 0 16px 0; font-size: 1.3em;">ä¸‹é˜¶æ®µå±•æœ›</h3>
                        <div style="display: grid; gap: 12px; text-align: left;">
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ¯ èšç„¦é‡ç‚¹</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">åŸºäºå½“å‰åˆ†æç»“æœï¼Œä¸“æ³¨äºé«˜ä¼˜å…ˆçº§çš„æ”¹è¿›é¢†åŸŸ</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ“ˆ æŒç»­ä¼˜åŒ–</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ä¿æŒæˆåŠŸåšæ³•ï¼Œæ”¹è¿›è–„å¼±ç¯èŠ‚ï¼Œå»ºç«‹æŒç»­æ”¹è¿›æœºåˆ¶</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ”„ å®šæœŸå›é¡¾</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">å»ºç«‹å®šæœŸå›é¡¾æœºåˆ¶ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥å’Œç›®æ ‡</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç»éªŒæ€»ç»“åŠŸèƒ½
        function generateLessonsLearned() {
            console.log('ğŸ”¥ å¼€å§‹ç”Ÿæˆç»éªŒæ€»ç»“...');
            try {
                const halfyearKey = `${currentYear}-H${currentHalf}`;
                const currentData = StorageUtils.loadPlan('halfyear', halfyearKey) || {};
                console.log('ğŸ’¡ ç»éªŒæ€»ç»“-åŠ è½½çš„æ•°æ®:', currentData);
                
                const lessonsAnalysis = analyzeLessonsLearned(currentData);
                console.log('ğŸ’¡ ç»éªŒåˆ†æç»“æœ:', lessonsAnalysis);
                
                const lessonsContent = generateLessonsLearnedHTML(lessonsAnalysis);
                console.log('ğŸ¨ ç”Ÿæˆçš„ç»éªŒæ€»ç»“HTMLé•¿åº¦:', lessonsContent.length);
                
                if (typeof ModalUtils !== 'undefined' && ModalUtils.show) {
                    ModalUtils.show('ğŸ’¡ ç»éªŒæ€»ç»“æŠ¥å‘Š', lessonsContent, 'large');
                    console.log('âœ… æˆåŠŸæ˜¾ç¤ºç»éªŒæ€»ç»“æ¨¡æ€æ¡†');
                } else {
                    console.error('âŒ ModalUtilsæœªå®šä¹‰');
                    // åˆ›å»ºç®€å•çš„æç¤ºæ¡†ä½œä¸ºfallback
                    const fallbackModal = document.createElement('div');
                    fallbackModal.style.cssText = `
                        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                        background: rgba(0,0,0,0.5); z-index: 9999; display: flex;
                        align-items: center; justify-content: center;
                    `;
                    fallbackModal.innerHTML = `
                        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 80vw; max-height: 80vh; overflow: auto;">
                            <button onclick="this.closest('div').parentNode.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">Ã—</button>
                            <div>${lessonsContent}</div>
                        </div>
                    `;
                    document.body.appendChild(fallbackModal);
                }
            } catch (error) {
                console.error('âŒ ç»éªŒæ€»ç»“ç”Ÿæˆå¤±è´¥:', error);
                console.error('âŒ é”™è¯¯å †æ ˆ:', error.stack);
                alert('ç»éªŒæ€»ç»“å‡ºç°é”™è¯¯: ' + error.message);
            }
        }

        function analyzeLessonsLearned(data) {
            console.log('ğŸ” å¼€å§‹åˆ†æç»éªŒæ•™è®­...');
            
            // æ”¶é›†æ‰€æœ‰å†…å®¹
            const allContent = {
                strategic: data.strategicGoals || '',
                quarter1: data.quarter1Milestones || '',
                quarter2: data.quarter2Milestones || '',
                projects: data.projects || '',
                skills: data.skills || '',
                balance: data.balance || '',
                review: data.review || ''
            };

            // åˆ†æå„ä¸ªç»´åº¦çš„ç»éªŒ
            const experienceAnalysis = {
                successes: extractSuccessExperiences(allContent),
                challenges: extractChallengeExperiences(allContent),
                insights: extractKeyInsights(allContent),
                patterns: identifyPatterns(allContent),
                improvements: suggestImprovements(allContent)
            };

            // ç”Ÿæˆæ ¸å¿ƒæ•™è®­
            const coreGLessons = generateCoreLessons(experienceAnalysis);
            
            // æå–å¯è¡ŒåŠ¨çš„å»ºè®®
            const actionableAdvice = generateActionableAdvice(experienceAnalysis);
            
            // åˆ†ææˆé•¿è½¨è¿¹
            const growthTrajectory = analyzeGrowthTrajectory(allContent);

            return {
                experience: experienceAnalysis,
                coreGLessons: coreGLessons,
                actionableAdvice: actionableAdvice,
                growthTrajectory: growthTrajectory,
                summary: generateLessonsSummary(experienceAnalysis, coreGLessons)
            };
        }

        function extractSuccessExperiences(content) {
            const successIndicators = [
                'å®Œæˆ', 'æˆåŠŸ', 'è¾¾æˆ', 'å®ç°', 'çªç ´', 'ä¼˜ç§€', 'è‰¯å¥½', 'æå‡', 'æ”¹å–„', 'å¢é•¿',
                'è·å¾—', 'æŒæ¡', 'å­¦ä¼š', 'å»ºç«‹', 'åˆ›å»º', 'è§£å†³', 'å…‹æœ', 'è¶…è¶Š', '[x]', '[X]'
            ];

            const successes = [];
            
            Object.entries(content).forEach(([area, text]) => {
                if (!text) return;
                
                const lines = text.split('\n').filter(line => line.trim());
                lines.forEach(line => {
                    const hasSuccess = successIndicators.some(indicator => 
                        line.toLowerCase().includes(indicator.toLowerCase())
                    );
                    
                    if (hasSuccess) {
                        successes.push({
                            area: getAreaName(area),
                            content: line.replace(/^\[.\]\s*/, '').trim(),
                            type: 'success',
                            keywords: successIndicators.filter(indicator => 
                                line.toLowerCase().includes(indicator.toLowerCase())
                            )
                        });
                    }
                });
            });

            return successes.slice(0, 8); // æœ€å¤š8ä¸ªæˆåŠŸç»éªŒ
        }

        function extractChallengeExperiences(content) {
            const challengeIndicators = [
                'å›°éš¾', 'æŒ‘æˆ˜', 'é—®é¢˜', 'éšœç¢', 'å»¶è¿Ÿ', 'æ¨è¿Ÿ', 'å¤±è´¥', 'é”™è¯¯', 'ä¸è¶³', 'ç¼ºä¹',
                'éœ€è¦æ”¹è¿›', 'å¾…æå‡', 'æœªå®Œæˆ', 'æœªè¾¾åˆ°', 'ä¸å¤Ÿ', 'æœ‰é™', 'ç“¶é¢ˆ', 'é˜»ç¢'
            ];

            const challenges = [];
            
            Object.entries(content).forEach(([area, text]) => {
                if (!text) return;
                
                const lines = text.split('\n').filter(line => line.trim());
                lines.forEach(line => {
                    const hasChallenge = challengeIndicators.some(indicator => 
                        line.toLowerCase().includes(indicator.toLowerCase())
                    );
                    
                    if (hasChallenge) {
                        challenges.push({
                            area: getAreaName(area),
                            content: line.replace(/^\[.\]\s*/, '').trim(),
                            type: 'challenge',
                            keywords: challengeIndicators.filter(indicator => 
                                line.toLowerCase().includes(indicator.toLowerCase())
                            )
                        });
                    }
                });
            });

            return challenges.slice(0, 6); // æœ€å¤š6ä¸ªæŒ‘æˆ˜ç»éªŒ
        }

        function extractKeyInsights(content) {
            const insights = [];
            
            // ä»å›é¡¾å†…å®¹ä¸­æå–æ´å¯Ÿ
            const reviewContent = content.review || '';
            if (reviewContent) {
                const sentences = reviewContent.split(/[ã€‚ï¼ï¼Ÿ.!?]/).filter(s => s.trim());
                sentences.forEach(sentence => {
                    if (sentence.length > 10 && sentence.length < 100) {
                        const insightScore = calculateInsightScore(sentence);
                        if (insightScore > 3) {
                            insights.push({
                                content: sentence.trim(),
                                score: insightScore,
                                source: 'å›é¡¾æ€»ç»“'
                            });
                        }
                    }
                });
            }

            // ä»å…¶ä»–å†…å®¹æ¨å¯¼æ´å¯Ÿ
            const derivedInsights = deriveInsightsFromContent(content);
            insights.push(...derivedInsights);

            return insights.sort((a, b) => b.score - a.score).slice(0, 5);
        }

        function calculateInsightScore(sentence) {
            const insightKeywords = [
                'å­¦åˆ°', 'æ„è¯†åˆ°', 'å‘ç°', 'ç†è§£', 'è®¤è¯†åˆ°', 'ä½“ä¼šåˆ°', 'æ„Ÿæ‚Ÿ', 'å¯å‘',
                'å…³é”®', 'é‡è¦', 'æ ¸å¿ƒ', 'æœ¬è´¨', 'æ ¹æœ¬', 'æ·±åˆ»', 'ç»éªŒ', 'æ•™è®­'
            ];

            let score = 0;
            insightKeywords.forEach(keyword => {
                if (sentence.includes(keyword)) score += 1;
            });

            // é•¿åº¦é€‚ä¸­çš„å¥å­æ›´å¯èƒ½æ˜¯æœ‰ä»·å€¼çš„æ´å¯Ÿ
            if (sentence.length >= 20 && sentence.length <= 80) score += 1;
            
            return score;
        }

        function deriveInsightsFromContent(content) {
            const insights = [];
            
            // åŸºäºå®Œæˆç‡æ¨å¯¼æ´å¯Ÿ
            const completionRate = calculateOverallCompletionRate(content);
            if (completionRate > 80) {
                insights.push({
                    content: 'æ‰§è¡ŒåŠ›å¼ºæ˜¯æˆåŠŸçš„å…³é”®å› ç´ ï¼Œè‰¯å¥½çš„è®¡åˆ’æ‰§è¡Œèƒ½åŠ›ä¸ºç›®æ ‡è¾¾æˆæä¾›äº†ä¿éšœ',
                    score: 4,
                    source: 'æ‰§è¡Œåˆ†æ'
                });
            } else if (completionRate < 40) {
                insights.push({
                    content: 'è®¡åˆ’ä¸æ‰§è¡Œä¹‹é—´å­˜åœ¨å·®è·ï¼Œéœ€è¦æå‡ç›®æ ‡åˆ†è§£å’Œæ—¶é—´ç®¡ç†èƒ½åŠ›',
                    score: 4,
                    source: 'æ‰§è¡Œåˆ†æ'
                });
            }

            // åŸºäºå¹³è¡¡åº¦æ¨å¯¼æ´å¯Ÿ
            const balanceScore = calculateBalanceScore(content);
            if (balanceScore < 50) {
                insights.push({
                    content: 'å·¥ä½œç”Ÿæ´»å¹³è¡¡éœ€è¦æ›´å¤šå…³æ³¨ï¼Œå…¨é¢å‘å±•æ¯”å•ä¸€çªç ´æ›´æœ‰åˆ©äºé•¿æœŸæˆåŠŸ',
                    score: 3,
                    source: 'å¹³è¡¡åˆ†æ'
                });
            }

            return insights;
        }

        function identifyPatterns(content) {
            const patterns = [];
            
            // åˆ†ææ—¶é—´æ¨¡å¼
            const timePatterns = analyzeTimePatterns(content);
            patterns.push(...timePatterns);
            
            // åˆ†æä¸»é¢˜æ¨¡å¼
            const themePatterns = analyzeThemePatterns(content);
            patterns.push(...themePatterns);
            
            // åˆ†æè¡Œä¸ºæ¨¡å¼
            const behaviorPatterns = analyzeBehaviorPatterns(content);
            patterns.push(...behaviorPatterns);

            return patterns.slice(0, 4);
        }

        function analyzeTimePatterns(content) {
            const patterns = [];
            
            // æ£€æŸ¥Q1 vs Q2çš„å·®å¼‚
            const q1Content = content.quarter1 || '';
            const q2Content = content.quarter2 || '';
            
            if (q1Content.length > q2Content.length * 1.5) {
                patterns.push({
                    type: 'time',
                    pattern: 'å‰æœŸè§„åˆ’è¯¦ç»†ï¼ŒåæœŸè§„åˆ’ç›¸å¯¹ç®€å•',
                    insight: 'å¯èƒ½å­˜åœ¨å‰æ¾åç´§çš„æ—¶é—´ç®¡ç†æ¨¡å¼',
                    suggestion: 'å»ºè®®å¹³è¡¡å„é˜¶æ®µçš„è§„åˆ’æ·±åº¦'
                });
            } else if (q2Content.length > q1Content.length * 1.5) {
                patterns.push({
                    type: 'time',
                    pattern: 'åæœŸè§„åˆ’æ›´åŠ è¯¦ç»†',
                    insight: 'æ˜¾ç¤ºå‡ºé€æ­¥æ·±å…¥çš„è§„åˆ’ä¹ æƒ¯',
                    suggestion: 'ä¿æŒè¿™ç§æ¸è¿›å¼çš„è§„åˆ’æ–¹å¼'
                });
            }

            return patterns;
        }

        function analyzeThemePatterns(content) {
            const patterns = [];
            const allText = Object.values(content).join(' ').toLowerCase();
            
            // åˆ†æä¸»é¢˜é¢‘æ¬¡
            const themes = {
                'æŠ€æœ¯': ['æŠ€æœ¯', 'æŠ€èƒ½', 'å­¦ä¹ ', 'åŸ¹è®­', 'æŒæ¡'],
                'ç®¡ç†': ['ç®¡ç†', 'é¢†å¯¼', 'å›¢é˜Ÿ', 'åè°ƒ', 'ç»„ç»‡'],
                'åˆ›æ–°': ['åˆ›æ–°', 'åˆ›æ„', 'æ”¹è¿›', 'ä¼˜åŒ–', 'çªç ´'],
                'æ•ˆç‡': ['æ•ˆç‡', 'ä¼˜åŒ–', 'æ”¹å–„', 'æå‡', 'åŠ é€Ÿ']
            };

            Object.entries(themes).forEach(([theme, keywords]) => {
                const frequency = keywords.filter(keyword => allText.includes(keyword)).length;
                if (frequency >= 3) {
                    patterns.push({
                        type: 'theme',
                        pattern: `${theme}ä¸»é¢˜å‡ºç°é¢‘ç¹`,
                        insight: `${theme}æ˜¯å½“å‰é˜¶æ®µçš„é‡ç‚¹å…³æ³¨é¢†åŸŸ`,
                        suggestion: `ç»§ç»­æ·±åŒ–${theme}æ–¹é¢çš„å‘å±•`
                    });
                }
            });

            return patterns;
        }

        function analyzeBehaviorPatterns(content) {
            const patterns = [];
            const allText = Object.values(content).join(' ').toLowerCase();
            
            // åˆ†æè¡Œä¸ºå€¾å‘
            if (allText.includes('è®¡åˆ’') && allText.includes('æ‰§è¡Œ')) {
                patterns.push({
                    type: 'behavior',
                    pattern: 'æ³¨é‡è®¡åˆ’åˆ¶å®šå’Œæ‰§è¡Œè·Ÿè¿›',
                    insight: 'å…·å¤‡ç³»ç»Ÿæ€§æ€ç»´å’Œæ‰§è¡Œæ„è¯†',
                    suggestion: 'å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–è®¡åˆ’çš„çµæ´»æ€§'
                });
            }

            if (allText.includes('å­¦ä¹ ') && allText.includes('å®è·µ')) {
                patterns.push({
                    type: 'behavior',
                    pattern: 'å­¦ä»¥è‡´ç”¨çš„è¡Œä¸ºæ¨¡å¼',
                    insight: 'ç†è®ºä¸å®è·µç»“åˆçš„å­¦ä¹ æ–¹å¼',
                    suggestion: 'ç»§ç»­ä¿æŒå¹¶æ‰©å¤§åº”ç”¨èŒƒå›´'
                });
            }

            return patterns;
        }

        function suggestImprovements(content) {
            const improvements = [];
            
            // åŸºäºå®Œæˆç‡å»ºè®®æ”¹è¿›
            const completionRate = calculateOverallCompletionRate(content);
            if (completionRate < 60) {
                improvements.push({
                    area: 'æ‰§è¡Œæ•ˆç‡',
                    current: 'ç›®æ ‡å®Œæˆç‡åä½',
                    suggestion: 'å»ºè®®é‡‡ç”¨SMARTç›®æ ‡è®¾å®šæ³•ï¼Œå°†å¤§ç›®æ ‡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„å°ä»»åŠ¡',
                    priority: 'high'
                });
            }

            // åŸºäºå†…å®¹ä¸°å¯Œåº¦å»ºè®®æ”¹è¿›
            const contentRichness = calculateContentRichness(content);
            if (contentRichness < 0.5) {
                improvements.push({
                    area: 'è§„åˆ’æ·±åº¦',
                    current: 'è®¡åˆ’å†…å®¹ç›¸å¯¹ç®€å•',
                    suggestion: 'å¢åŠ å…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤ã€æ—¶é—´èŠ‚ç‚¹å’ŒæˆåŠŸæ ‡å‡†',
                    priority: 'medium'
                });
            }

            // åŸºäºå¹³è¡¡åº¦å»ºè®®æ”¹è¿›
            const balanceScore = calculateBalanceScore(content);
            if (balanceScore < 60) {
                improvements.push({
                    area: 'å‘å±•å¹³è¡¡',
                    current: 'æŸäº›ç»´åº¦å…³æ³¨ä¸è¶³',
                    suggestion: 'å»ºè®®åˆ¶å®šæ›´å…¨é¢çš„å‘å±•è®¡åˆ’ï¼Œå…³æ³¨å·¥ä½œç”Ÿæ´»å¹³è¡¡',
                    priority: 'medium'
                });
            }

            return improvements.slice(0, 3);
        }

        function generateCoreLessons(experienceAnalysis) {
            const lessons = [];
            
            // ä»æˆåŠŸç»éªŒä¸­æå–æ•™è®­
            if (experienceAnalysis.successes.length > 0) {
                lessons.push({
                    category: 'success',
                    title: 'æˆåŠŸè¦ç´ è¯†åˆ«',
                    lesson: 'æˆåŠŸçš„å…³é”®åœ¨äºæ˜ç¡®ç›®æ ‡ã€åˆ¶å®šè®¡åˆ’å¹¶åšæŒæ‰§è¡Œ',
                    evidence: experienceAnalysis.successes.slice(0, 2),
                    applicability: 'å¯åº”ç”¨äºæœªæ¥çš„ç›®æ ‡è®¾å®šå’Œé¡¹ç›®ç®¡ç†'
                });
            }

            // ä»æŒ‘æˆ˜ä¸­æå–æ•™è®­
            if (experienceAnalysis.challenges.length > 0) {
                lessons.push({
                    category: 'challenge',
                    title: 'æŒ‘æˆ˜åº”å¯¹ç­–ç•¥',
                    lesson: 'é¢å¯¹æŒ‘æˆ˜æ—¶ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥æ¯”å›ºå®ˆåŸè®¡åˆ’æ›´é‡è¦',
                    evidence: experienceAnalysis.challenges.slice(0, 2),
                    applicability: 'å¸®åŠ©æå‡é—®é¢˜è§£å†³èƒ½åŠ›å’Œé€‚åº”æ€§'
                });
            }

            // ä»æ¨¡å¼ä¸­æå–æ•™è®­
            if (experienceAnalysis.patterns.length > 0) {
                const pattern = experienceAnalysis.patterns[0];
                lessons.push({
                    category: 'pattern',
                    title: 'è¡Œä¸ºæ¨¡å¼æ´å¯Ÿ',
                    lesson: pattern.insight,
                    evidence: [{ content: pattern.pattern }],
                    applicability: pattern.suggestion
                });
            }

            return lessons;
        }

        function generateActionableAdvice(experienceAnalysis) {
            const advice = [];
            
            // åŸºäºæˆåŠŸç»éªŒçš„å»ºè®®
            advice.push({
                category: 'ç»§ç»­ä¿æŒ',
                icon: 'âœ…',
                color: '#4caf50',
                items: [
                    'ä¿æŒå·²éªŒè¯æœ‰æ•ˆçš„å·¥ä½œæ–¹æ³•å’Œä¹ æƒ¯',
                    'ç»§ç»­å‘æŒ¥åœ¨ä¼˜åŠ¿é¢†åŸŸçš„ä¸“é•¿',
                    'ç»´æŒè‰¯å¥½çš„æ‰§è¡ŒèŠ‚å¥å’Œè´¨é‡æ ‡å‡†'
                ]
            });

            // åŸºäºæŒ‘æˆ˜çš„æ”¹è¿›å»ºè®®
            if (experienceAnalysis.challenges.length > 0) {
                advice.push({
                    category: 'é‡ç‚¹æ”¹è¿›',
                    icon: 'ğŸ¯',
                    color: '#ff9800',
                    items: experienceAnalysis.improvements.map(imp => imp.suggestion)
                });
            }

            // åŸºäºæ´å¯Ÿçš„å‘å±•å»ºè®®
            advice.push({
                category: 'æœªæ¥å‘å±•',
                icon: 'ğŸš€',
                color: '#2196f3',
                items: [
                    'åŸºäºç»éªŒå»ºç«‹ä¸ªäººæœ€ä½³å®è·µåº“',
                    'å®šæœŸå›é¡¾å’Œæ›´æ–°å·¥ä½œæ–¹æ³•',
                    'å°†æˆåŠŸç»éªŒåˆ†äº«ç»™å›¢é˜Ÿæˆ–åŒè¡Œ'
                ]
            });

            return advice;
        }

        function analyzeGrowthTrajectory(content) {
            const trajectory = {
                startPoint: 'åŠå¹´è®¡åˆ’å¼€å§‹é˜¶æ®µ',
                currentPoint: 'å½“å‰é˜¶æ®µ',
                growthAreas: [],
                nextSteps: []
            };

            // è¯†åˆ«æˆé•¿é¢†åŸŸ
            const skillsContent = content.skills || '';
            if (skillsContent) {
                const skillLines = skillsContent.split('\n').filter(line => line.trim());
                trajectory.growthAreas = skillLines.slice(0, 3).map(line => 
                    line.replace(/^\[.\]\s*/, '').trim()
                );
            }

            // å»ºè®®ä¸‹ä¸€æ­¥
            trajectory.nextSteps = [
                'åŸºäºå½“å‰ç»éªŒï¼Œåˆ¶å®šä¸‹ä¸€é˜¶æ®µçš„å‘å±•é‡ç‚¹',
                'å»ºç«‹ä¸ªäººçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œç§¯ç´¯ç»éªŒèµ„äº§',
                'å¯»æ‰¾æ–°çš„æŒ‘æˆ˜æœºä¼šï¼Œæ‰©å±•èƒ½åŠ›è¾¹ç•Œ'
            ];

            return trajectory;
        }

        function generateLessonsSummary(experienceAnalysis, coreGLessons) {
            const totalExperiences = experienceAnalysis.successes.length + experienceAnalysis.challenges.length;
            const successRate = totalExperiences > 0 ? 
                Math.round((experienceAnalysis.successes.length / totalExperiences) * 100) : 0;

            return {
                totalExperiences: totalExperiences,
                successCount: experienceAnalysis.successes.length,
                challengeCount: experienceAnalysis.challenges.length,
                successRate: successRate,
                keyInsights: experienceAnalysis.insights.length,
                coreGLessonsCount: coreGLessons.length,
                overallAssessment: getOverallAssessment(successRate, experienceAnalysis.insights.length)
            };
        }

        function getOverallAssessment(successRate, insightCount) {
            if (successRate >= 70 && insightCount >= 3) {
                return { level: 'excellent', description: 'ç»éªŒç§¯ç´¯ä¸°å¯Œï¼Œåæ€æ·±å…¥' };
            } else if (successRate >= 50 && insightCount >= 2) {
                return { level: 'good', description: 'æœ‰ä¸€å®šç»éªŒç§¯ç´¯ï¼ŒæŒç»­æ”¹è¿›ä¸­' };
            } else {
                return { level: 'developing', description: 'æ­£åœ¨ç§¯ç´¯ç»éªŒï¼Œéœ€è¦åŠ å¼ºåæ€' };
            }
        }

        function calculateOverallCompletionRate(content) {
            let totalTasks = 0;
            let completedTasks = 0;

            Object.values(content).forEach(text => {
                if (!text) return;
                const tasks = (text.match(/\[.\]/g) || []).length;
                const completed = (text.match(/\[x\]/gi) || []).length;
                totalTasks += tasks;
                completedTasks += completed;
            });

            return totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        }

        function calculateContentRichness(content) {
            const totalWords = Object.values(content).join(' ').split(/\s+/).length;
            return Math.min(totalWords / 500, 1); // 500è¯ä¸ºæ»¡åˆ†
        }

        function calculateBalanceScore(content) {
            const areas = ['strategic', 'projects', 'skills', 'balance'];
            const scores = areas.map(area => {
                const text = content[area] || '';
                return Math.min(text.length / 100, 1); // 100å­—ç¬¦ä¸ºæ»¡åˆ†
            });
            return Math.round(scores.reduce((sum, score) => sum + score, 0) / areas.length * 100);
        }

        function getAreaName(area) {
            const names = {
                strategic: 'æˆ˜ç•¥ç›®æ ‡',
                quarter1: 'Q1é‡Œç¨‹ç¢‘',
                quarter2: 'Q2é‡Œç¨‹ç¢‘',
                projects: 'é‡ç‚¹é¡¹ç›®',
                skills: 'æŠ€èƒ½å‘å±•',
                balance: 'å·¥ä½œç”Ÿæ´»å¹³è¡¡',
                review: 'å›é¡¾æ€»ç»“'
            };
            return names[area] || area;
        }

        function generateLessonsLearnedHTML(lessonsAnalysis) {
            console.log('ğŸ¨ å¼€å§‹ç”Ÿæˆç»éªŒæ€»ç»“HTML...');
            
            if (!lessonsAnalysis || !lessonsAnalysis.summary) {
                return `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <div style="font-size: 3em; margin-bottom: 16px;">ğŸ’¡</div>
                        <div style="font-size: 1.2em; margin-bottom: 8px;">æš‚æ— ç»éªŒæ•°æ®</div>
                        <div style="font-size: 0.9em;">è¯·å…ˆå¡«å†™åŠå¹´è®¡åˆ’çš„å„ä¸ªéƒ¨åˆ†ï¼Œç„¶åå†ç”Ÿæˆç»éªŒæ€»ç»“</div>
                    </div>
                `;
            }

            const { summary, experience, coreGLessons, actionableAdvice, growthTrajectory } = lessonsAnalysis;

            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6;">
                    <!-- ç»éªŒæ€»ç»“æ¦‚è§ˆ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px; text-align: center;">
                        <div style="font-size: 2.5em; margin-bottom: 12px;">ğŸ’¡</div>
                        <h2 style="margin: 0 0 16px 0; font-size: 1.8em;">ç»éªŒæ€»ç»“æŠ¥å‘Š</h2>
                        <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 16px;">
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.5em; font-weight: bold;">${summary.totalExperiences}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">æ€»ç»éªŒæ•°</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.5em; font-weight: bold;">${summary.successRate}%</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">æˆåŠŸç‡</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 12px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-size: 1.5em; font-weight: bold;">${summary.keyInsights}</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">å…³é”®æ´å¯Ÿ</div>
                            </div>
                        </div>
                        <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.15); border-radius: 8px; backdrop-filter: blur(10px);">
                            <div style="font-weight: bold; margin-bottom: 4px;">æ•´ä½“è¯„ä¼°</div>
                            <div style="font-size: 0.9em;">${summary.overallAssessment.description}</div>
                        </div>
                    </div>

                    <!-- æˆåŠŸç»éªŒåˆ†æ -->
                    ${experience.successes.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #4caf50; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">âœ“</span>
                            </div>
                            <h3 style="margin: 0; color: #2e7d32; font-size: 1.3em;">æˆåŠŸç»éªŒ (${experience.successes.length}é¡¹)</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${experience.successes.map(success => `
                                <div style="background: #f1f8e9; border-left: 4px solid #4caf50; padding: 12px 16px; border-radius: 6px;">
                                    <div style="font-weight: 500; color: #2e7d32; margin-bottom: 4px;">${success.area}</div>
                                    <div style="color: #424242; font-size: 0.95em;">${success.content}</div>
                                    ${success.keywords.length > 0 ? `
                                        <div style="margin-top: 8px;">
                                            ${success.keywords.map(keyword => `
                                                <span style="background: #c8e6c9; color: #1b5e20; padding: 2px 6px; border-radius: 12px; font-size: 0.8em; margin-right: 6px;">${keyword}</span>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æŒ‘æˆ˜ä¸æ•™è®­ -->
                    ${experience.challenges.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #ff9800; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">!</span>
                            </div>
                            <h3 style="margin: 0; color: #ef6c00; font-size: 1.3em;">æŒ‘æˆ˜ä¸æ•™è®­ (${experience.challenges.length}é¡¹)</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${experience.challenges.map(challenge => `
                                <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 12px 16px; border-radius: 6px;">
                                    <div style="font-weight: 500; color: #ef6c00; margin-bottom: 4px;">${challenge.area}</div>
                                    <div style="color: #424242; font-size: 0.95em;">${challenge.content}</div>
                                    ${challenge.keywords.length > 0 ? `
                                        <div style="margin-top: 8px;">
                                            ${challenge.keywords.map(keyword => `
                                                <span style="background: #ffe0b2; color: #bf360c; padding: 2px 6px; border-radius: 12px; font-size: 0.8em; margin-right: 6px;">${keyword}</span>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- å…³é”®æ´å¯Ÿ -->
                    ${experience.insights.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #9c27b0; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ’¡</span>
                            </div>
                            <h3 style="margin: 0; color: #7b1fa2; font-size: 1.3em;">å…³é”®æ´å¯Ÿ</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${experience.insights.map((insight, index) => `
                                <div style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 12px 16px; border-radius: 6px; position: relative;">
                                    <div style="position: absolute; top: 8px; right: 12px; background: #9c27b0; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7em; font-weight: bold;">
                                        ${index + 1}
                                    </div>
                                    <div style="color: #424242; font-size: 0.95em; padding-right: 32px;">${insight.content}</div>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: #7b1fa2; opacity: 0.8;">
                                        æ¥æºï¼š${insight.source} | é‡è¦æ€§ï¼š${'â˜…'.repeat(Math.min(insight.score, 5))}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æ ¸å¿ƒæ•™è®­ -->
                    ${coreGLessons.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #e91e63; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ¯</span>
                            </div>
                            <h3 style="margin: 0; color: #c2185b; font-size: 1.3em;">æ ¸å¿ƒæ•™è®­</h3>
                        </div>
                        <div style="display: grid; gap: 16px;">
                            ${coreGLessons.map(lesson => `
                                <div style="background: #fce4ec; border-radius: 8px; padding: 16px;">
                                    <div style="font-weight: bold; color: #c2185b; margin-bottom: 8px; font-size: 1.1em;">
                                        ${lesson.title}
                                    </div>
                                    <div style="color: #424242; margin-bottom: 12px; font-style: italic;">
                                        "${lesson.lesson}"
                                    </div>
                                    ${lesson.evidence.length > 0 ? `
                                        <div style="margin-bottom: 12px;">
                                            <div style="font-size: 0.85em; color: #666; margin-bottom: 6px;">æ”¯æ’‘è¯æ®ï¼š</div>
                                            ${lesson.evidence.map(evidence => `
                                                <div style="background: white; padding: 8px 12px; border-radius: 6px; margin-bottom: 4px; border-left: 3px solid #e91e63;">
                                                    <div style="font-size: 0.9em; color: #424242;">${evidence.content}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                    <div style="background: rgba(233, 30, 99, 0.1); padding: 8px 12px; border-radius: 6px; border-left: 3px solid #e91e63;">
                                        <div style="font-size: 0.85em; color: #666; margin-bottom: 2px;">åº”ç”¨ä»·å€¼ï¼š</div>
                                        <div style="font-size: 0.9em; color: #424242;">${lesson.applicability}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- è¡Œä¸ºæ¨¡å¼åˆ†æ -->
                    ${experience.patterns.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #607d8b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ“Š</span>
                            </div>
                            <h3 style="margin: 0; color: #455a64; font-size: 1.3em;">è¡Œä¸ºæ¨¡å¼åˆ†æ</h3>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            ${experience.patterns.map(pattern => `
                                <div style="background: #eceff1; border-radius: 8px; padding: 16px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                        <span style="background: #607d8b; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 8px;">
                                            ${pattern.type === 'time' ? 'â° æ—¶é—´' : pattern.type === 'theme' ? 'ğŸ¯ ä¸»é¢˜' : 'ğŸ”„ è¡Œä¸º'}
                                        </span>
                                        <div style="font-weight: 500; color: #455a64;">${pattern.pattern}</div>
                                    </div>
                                    <div style="color: #424242; margin-bottom: 8px; font-size: 0.95em;">
                                        ğŸ’¡ æ´å¯Ÿï¼š${pattern.insight}
                                    </div>
                                    <div style="background: white; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #607d8b;">
                                        <div style="font-size: 0.9em; color: #424242;">
                                            ğŸ¯ å»ºè®®ï¼š${pattern.suggestion}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- å¯è¡ŒåŠ¨å»ºè®® -->
                    ${actionableAdvice.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #3f51b5; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸš€</span>
                            </div>
                            <h3 style="margin: 0; color: #303f9f; font-size: 1.3em;">è¡ŒåŠ¨å»ºè®®</h3>
                        </div>
                        <div style="display: grid; gap: 16px;">
                            ${actionableAdvice.map(advice => `
                                <div style="background: #e8eaf6; border-radius: 8px; padding: 16px;">
                                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                                        <span style="font-size: 1.5em; margin-right: 8px;">${advice.icon}</span>
                                        <div style="font-weight: bold; color: ${advice.color}; font-size: 1.1em;">
                                            ${advice.category}
                                        </div>
                                    </div>
                                    <div style="display: grid; gap: 8px;">
                                        ${advice.items.map(item => `
                                            <div style="background: white; padding: 12px; border-radius: 6px; border-left: 4px solid ${advice.color};">
                                                <div style="color: #424242; font-size: 0.95em;">${item}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- æˆé•¿è½¨è¿¹ -->
                    ${growthTrajectory && growthTrajectory.growthAreas.length > 0 ? `
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 16px;">
                            <div style="width: 32px; height: 32px; background: #00bcd4; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                <span style="color: white; font-weight: bold;">ğŸ“ˆ</span>
                            </div>
                            <h3 style="margin: 0; color: #00acc1; font-size: 1.3em;">æˆé•¿è½¨è¿¹</h3>
                        </div>
                        <div style="display: grid; gap: 16px;">
                            <div style="background: #e0f2f1; border-radius: 8px; padding: 16px;">
                                <div style="font-weight: bold; color: #00695c; margin-bottom: 8px;">ä¸»è¦æˆé•¿é¢†åŸŸ</div>
                                <div style="display: grid; gap: 6px;">
                                    ${growthTrajectory.growthAreas.map((area, index) => `
                                        <div style="background: white; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #00bcd4;">
                                            <span style="background: #00bcd4; color: white; width: 20px; height: 20px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 0.8em; margin-right: 8px;">
                                                ${index + 1}
                                            </span>
                                            ${area}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div style="background: #e1f5fe; border-radius: 8px; padding: 16px;">
                                <div style="font-weight: bold; color: #0277bd; margin-bottom: 8px;">ä¸‹ä¸€æ­¥å‘å±•å»ºè®®</div>
                                <div style="display: grid; gap: 6px;">
                                    ${growthTrajectory.nextSteps.map((step, index) => `
                                        <div style="background: white; padding: 8px 12px; border-radius: 6px; border-left: 3px solid #03a9f4;">
                                            <span style="background: #03a9f4; color: white; width: 20px; height: 20px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 0.8em; margin-right: 8px;">
                                                ${index + 1}
                                            </span>
                                            ${step}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- ç»éªŒåº”ç”¨æŒ‡å— -->
                    <div style="background: linear-gradient(135deg, #ff7043 0%, #d84315 100%); color: white; border-radius: 12px; padding: 20px; text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 12px;">ğŸ¯</div>
                        <h3 style="margin: 0 0 16px 0; font-size: 1.3em;">ç»éªŒåº”ç”¨æŒ‡å—</h3>
                        <div style="display: grid; gap: 12px; text-align: left;">
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ“š å»ºç«‹ç»éªŒåº“</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">å°†è¿™äº›ç»éªŒæ•´ç†æˆä¸ªäººçŸ¥è¯†åº“ï¼Œå®šæœŸå›é¡¾å’Œæ›´æ–°</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ”„ æŒç»­æ”¹è¿›</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">åŸºäºæ•™è®­è°ƒæ•´å·¥ä½œæ–¹æ³•ï¼Œå°†æˆåŠŸç»éªŒåˆ¶åº¦åŒ–</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; backdrop-filter: blur(10px);">
                                <div style="font-weight: bold; margin-bottom: 6px;">ğŸ¤ åˆ†äº«ä¼ æ’­</div>
                                <div style="font-size: 0.9em; opacity: 0.9;">ä¸å›¢é˜Ÿåˆ†äº«æœ‰ä»·å€¼çš„ç»éªŒï¼Œå½¢æˆç»„ç»‡å­¦ä¹ </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // === æˆ˜ç•¥è§„åˆ’åŠŸèƒ½ ===
        function generateStrategicPlanningGuide() {
            const currentData = getCurrentPlanData();
            const planningGuide = generatePlanningGuidanceContent(currentData);
            
            ModalUtils.show('ğŸ§  æˆ˜ç•¥è§„åˆ’åŠ©æ‰‹', planningGuide, {
                size: 'large',
                buttons: [
                    {
                        text: 'åº”ç”¨å»ºè®®',
                        class: 'btn-main',
                        handler: () => applyStrategicSuggestions(currentData),
                        close: false
                    },
                    {
                        text: 'ä¿å­˜æ¨¡æ¿',
                        class: 'btn-secondary',
                        handler: () => saveStrategicTemplate(),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function getCurrentPlanData() {
            const halfyearKey = `${currentYear}-H${currentHalf}`;
            let currentData = StorageUtils.loadPlan('halfyear', halfyearKey);
            
            if (!currentData) {
                currentData = {
                    vision: '',
                    strategicGoals: '',
                    quarter1Milestones: '',
                    quarter2Milestones: '',
                    projects: '',
                    skills: '',
                    balance: '',
                    review: ''
                };
            }
            
            return currentData;
        }

        function generatePlanningGuidanceContent(currentData) {
            const hasVision = currentData.vision && currentData.vision.trim();
            const hasStrategicGoals = currentData.strategicGoals && currentData.strategicGoals.trim();
            const planningStatus = assessPlanningCompleteness(currentData);
            
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <!-- æˆ˜ç•¥è§„åˆ’æ¦‚è§ˆ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                        <h3 style="margin: 0 0 12px 0;">ğŸ§  æˆ˜ç•¥è§„åˆ’åŠ©æ‰‹</h3>
                        <p style="margin: 0; opacity: 0.9;">è®©æˆ‘ä»¬ä¸€èµ·åˆ¶å®šä¸€ä¸ªæ¸…æ™°ã€å¯æ‰§è¡Œçš„åŠå¹´æˆ˜ç•¥è®¡åˆ’</p>
                        <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                            <div style="font-size: 0.9em;">è§„åˆ’å®Œæ•´åº¦: <strong>${planningStatus.completeness}%</strong> | å½“å‰é˜¶æ®µ: <strong>${planningStatus.stage}</strong></div>
                        </div>
                    </div>

                    <!-- æˆ˜ç•¥è§„åˆ’æ­¥éª¤ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ“‹ æˆ˜ç•¥è§„åˆ’äº”æ­¥æ³•</h4>
                        ${generatePlanningSteps(currentData, planningStatus)}
                    </div>

                    <!-- å½“å‰çŠ¶æ€åˆ†æ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ” å½“å‰è§„åˆ’çŠ¶æ€åˆ†æ</h4>
                        ${generateCurrentStatusAnalysis(currentData)}
                    </div>

                    <!-- ä¸ªæ€§åŒ–å»ºè®® -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h4>
                        ${generatePersonalizedSuggestions(currentData, planningStatus)}
                    </div>

                    <!-- æˆ˜ç•¥æ¨¡æ¿ -->
                    <div style="background: #e8f5e9; border-radius: 12px; padding: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #2e7d32;">ğŸ“ æ¨èçš„æˆ˜ç•¥æ¡†æ¶</h4>
                        ${generateStrategicFrameworks()}
                    </div>
                </div>
            `;
        }

        function assessPlanningCompleteness(data) {
            let score = 0;
            let stage = 'å‡†å¤‡é˜¶æ®µ';
            
            // æ„¿æ™¯ (20åˆ†)
            if (data.vision && data.vision.trim()) score += 20;
            
            // æˆ˜ç•¥ç›®æ ‡ (30åˆ†)
            if (data.strategicGoals && data.strategicGoals.trim()) score += 30;
            
            // å­£åº¦é‡Œç¨‹ç¢‘ (20åˆ†)
            if ((data.quarter1Milestones && data.quarter1Milestones.trim()) || 
                (data.quarter2Milestones && data.quarter2Milestones.trim())) score += 20;
            
            // é¡¹ç›®è§„åˆ’ (20åˆ†)
            if (data.projects && data.projects.trim()) score += 20;
            
            // èƒ½åŠ›å‘å±• (10åˆ†)
            if (data.skills && data.skills.trim()) score += 10;
            
            // ç¡®å®šé˜¶æ®µ
            if (score >= 80) stage = 'æ‰§è¡Œé˜¶æ®µ';
            else if (score >= 60) stage = 'å®Œå–„é˜¶æ®µ';
            else if (score >= 30) stage = 'è§„åˆ’é˜¶æ®µ';
            else stage = 'å‡†å¤‡é˜¶æ®µ';
            
            return { completeness: score, stage };
        }

        function generatePlanningSteps(data, status) {
            const steps = [
                {
                    title: '1. æ˜ç¡®æ„¿æ™¯',
                    description: 'è®¾å®šåŠå¹´çš„æ•´ä½“æ„¿æ™¯å’Œä¸»é¢˜',
                    completed: !!(data.vision && data.vision.trim()),
                    action: 'åœ¨æ„¿æ™¯éƒ¨åˆ†æè¿°ä½ å¸Œæœ›åœ¨è¿™åŠå¹´è¾¾åˆ°çš„ç†æƒ³çŠ¶æ€'
                },
                {
                    title: '2. è®¾å®šæˆ˜ç•¥ç›®æ ‡',
                    description: 'åˆ¶å®š2-5ä¸ªæ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡',
                    completed: !!(data.strategicGoals && data.strategicGoals.trim()),
                    action: 'ä½¿ç”¨SMARTåŸåˆ™è®¾å®šå…·ä½“ã€å¯è¡¡é‡çš„ç›®æ ‡'
                },
                {
                    title: '3. å­£åº¦åˆ†è§£',
                    description: 'å°†ç›®æ ‡åˆ†è§£ä¸ºå­£åº¦é‡Œç¨‹ç¢‘',
                    completed: !!(data.quarter1Milestones && data.quarter1Milestones.trim()) || 
                              !!(data.quarter2Milestones && data.quarter2Milestones.trim()),
                    action: 'ä¸ºæ¯ä¸ªå­£åº¦è®¾å®šå…³é”®æˆæœå’Œé‡Œç¨‹ç¢‘'
                },
                {
                    title: '4. é¡¹ç›®è§„åˆ’',
                    description: 'ç¡®å®šæ”¯æ’‘ç›®æ ‡çš„é‡ç‚¹é¡¹ç›®',
                    completed: !!(data.projects && data.projects.trim()),
                    action: 'åˆ—å‡ºå®ç°ç›®æ ‡æ‰€éœ€çš„å…·ä½“é¡¹ç›®å’Œè¡ŒåŠ¨'
                },
                {
                    title: '5. èƒ½åŠ›å»ºè®¾',
                    description: 'è§„åˆ’å¿…è¦çš„èƒ½åŠ›å‘å±•',
                    completed: !!(data.skills && data.skills.trim()),
                    action: 'è¯†åˆ«å¹¶è§„åˆ’å®Œæˆç›®æ ‡æ‰€éœ€çš„æŠ€èƒ½æå‡'
                }
            ];
            
            return steps.map(step => `
                <div style="display: flex; align-items: flex-start; padding: 12px; margin: 8px 0; background: ${step.completed ? '#e8f5e9' : '#fff3e0'}; border-radius: 8px; border-left: 4px solid ${step.completed ? '#4caf50' : '#ff9800'};">
                    <div style="font-size: 1.5em; margin-right: 12px;">${step.completed ? 'âœ…' : 'â³'}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #333; margin-bottom: 4px;">${step.title}</div>
                        <div style="color: #666; font-size: 0.9em; margin-bottom: 8px;">${step.description}</div>
                        ${!step.completed ? `<div style="color: #ff9800; font-size: 0.85em; font-style: italic;">ğŸ’¡ ${step.action}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function generateCurrentStatusAnalysis(data) {
            const analysis = [];
            
            // æ„¿æ™¯åˆ†æ
            if (data.vision && data.vision.trim()) {
                const visionLength = data.vision.trim().length;
                if (visionLength < 50) {
                    analysis.push('ğŸŒŸ æ„¿æ™¯è¿‡äºç®€çŸ­ï¼Œå»ºè®®æ‰©å±•ä¸ºæ›´å…·ä½“å’Œé¼“èˆäººå¿ƒçš„æè¿°');
                } else if (visionLength > 500) {
                    analysis.push('ğŸŒŸ æ„¿æ™¯è¿‡äºè¯¦ç»†ï¼Œå»ºè®®ç²¾ç‚¼ä¸ºæ ¸å¿ƒè¦ç‚¹');
                } else {
                    analysis.push('ğŸŒŸ æ„¿æ™¯é•¿åº¦é€‚ä¸­ï¼Œå†…å®¹ä¸°å¯Œåº¦è‰¯å¥½');
                }
            } else {
                analysis.push('âš ï¸ ç¼ºå°‘æ„¿æ™¯è®¾å®šï¼Œè¿™æ˜¯æˆ˜ç•¥è§„åˆ’çš„é‡è¦èµ·ç‚¹');
            }
            
            // ç›®æ ‡åˆ†æ
            if (data.strategicGoals && data.strategicGoals.trim()) {
                const goals = data.strategicGoals.split('\n').filter(line => line.trim() && line.includes('['));
                const goalCount = goals.length;
                
                if (goalCount === 0) {
                    analysis.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡åŒºåŸŸæœ‰å†…å®¹ä½†ç¼ºå°‘å…·ä½“çš„ç›®æ ‡æ¡ç›®');
                } else if (goalCount <= 2) {
                    analysis.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡è¾ƒå°‘ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šç»´åº¦çš„ç›®æ ‡');
                } else if (goalCount > 6) {
                    analysis.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡è¾ƒå¤šï¼Œå»ºè®®èšç„¦æœ€é‡è¦çš„3-5ä¸ªæ ¸å¿ƒç›®æ ‡');
                } else {
                    analysis.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡æ•°é‡åˆç†ï¼Œè¦†ç›–é¢é€‚ä¸­');
                }
            } else {
                analysis.push('âš ï¸ ç¼ºå°‘æˆ˜ç•¥ç›®æ ‡ï¼Œè¿™æ˜¯æ‰§è¡Œçš„æ ¸å¿ƒæŒ‡å¯¼');
            }
            
            // å¹³è¡¡æ€§åˆ†æ
            const hasProjects = !!(data.projects && data.projects.trim());
            const hasSkills = !!(data.skills && data.skills.trim());
            const hasBalance = !!(data.balance && data.balance.trim());
            
            const balanceScore = [hasProjects, hasSkills, hasBalance].filter(Boolean).length;
            
            if (balanceScore === 3) {
                analysis.push('âš–ï¸ è§„åˆ’ç»´åº¦å®Œæ•´ï¼Œæ¶µç›–äº†é¡¹ç›®ã€èƒ½åŠ›å’Œç”Ÿæ´»å¹³è¡¡');
            } else if (balanceScore >= 2) {
                analysis.push('âš–ï¸ è§„åˆ’ç»´åº¦è¾ƒä¸ºå®Œæ•´ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥å®Œå–„');
            } else {
                analysis.push('âš ï¸ è§„åˆ’ç»´åº¦å•ä¸€ï¼Œå»ºè®®å¢åŠ æ›´å¤šç»´åº¦çš„è€ƒè™‘');
            }
            
            return analysis.map(item => `
                <div style="padding: 8px 12px; margin: 4px 0; background: white; border-radius: 6px; border-left: 3px solid #2196f3;">
                    ${item}
                </div>
            `).join('');
        }

        function generatePersonalizedSuggestions(data, status) {
            const suggestions = [];
            
            // åŸºäºå®Œæ•´åº¦çš„å»ºè®®
            if (status.completeness < 30) {
                suggestions.push('ğŸš€ å»ºè®®ä»æ„¿æ™¯å¼€å§‹ï¼šèŠ±15-30åˆ†é’Ÿæ€è€ƒè¿™åŠå¹´æœ€æƒ³è¾¾æˆçš„ç†æƒ³çŠ¶æ€');
                suggestions.push('ğŸ¯ è®¾å®šä¼˜å…ˆçº§ï¼šé€‰æ‹©æœ€é‡è¦çš„2-3ä¸ªç›®æ ‡å¼€å§‹è§„åˆ’');
                suggestions.push('ğŸ“… åˆ¶å®šæ—¶é—´è¡¨ï¼šä¸ºè‡ªå·±è®¾å®šä¸€ä¸ªå®Œæˆè§„åˆ’çš„æˆªæ­¢æ—¥æœŸ');
            } else if (status.completeness < 60) {
                suggestions.push('ğŸ“‹ æ·±åŒ–ç›®æ ‡ï¼šå°†ç°æœ‰ç›®æ ‡åˆ†è§£ä¸ºæ›´å…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤');
                suggestions.push('â° æ—¶é—´åˆ†é…ï¼šä¸ºæ¯ä¸ªç›®æ ‡åˆ†é…åˆç†çš„æ—¶é—´å’Œèµ„æº');
                suggestions.push('ğŸ”— å»ºç«‹è”ç³»ï¼šç¡®ä¿å„ä¸ªç›®æ ‡ä¹‹é—´çš„åè°ƒæ€§');
            } else if (status.completeness < 80) {
                suggestions.push('ğŸ¨ ä¼˜åŒ–è¡¨è¾¾ï¼šè®©ç›®æ ‡æè¿°æ›´åŠ æ¸…æ™°å’Œå¯è¡¡é‡');
                suggestions.push('ğŸ” æŸ¥æ¼è¡¥ç¼ºï¼šæ£€æŸ¥æ˜¯å¦é—æ¼äº†é‡è¦çš„å‘å±•é¢†åŸŸ');
                suggestions.push('ğŸ“Š è®¾å®šæŒ‡æ ‡ï¼šä¸ºå…³é”®ç›®æ ‡å»ºç«‹é‡åŒ–çš„æˆåŠŸæ ‡å‡†');
            } else {
                suggestions.push('ğŸ‰ è§„åˆ’å¾ˆå®Œæ•´ï¼å»ºè®®å®šæœŸå›é¡¾å’Œè°ƒæ•´');
                suggestions.push('ğŸ“ˆ æŒç»­ä¼˜åŒ–ï¼šåŸºäºæ‰§è¡Œæƒ…å†µä¸æ–­å®Œå–„è®¡åˆ’');
                suggestions.push('ğŸ¤ åˆ†äº«ç»éªŒï¼šè€ƒè™‘ä¸ä»–äººåˆ†äº«ä½ çš„è§„åˆ’æ–¹æ³•');
            }
            
            // åŸºäºå†…å®¹çš„ä¸ªæ€§åŒ–å»ºè®®
            if (!(data.vision && data.vision.trim())) {
                suggestions.push('ğŸ’¡ æ„¿æ™¯æŠ€å·§ï¼šå°è¯•æƒ³è±¡åŠå¹´åçš„æˆåŠŸç”»é¢ï¼Œç”¨ç¬¬ä¸€äººç§°æè¿°');
            }
            
            if (!(data.balance && data.balance.trim())) {
                suggestions.push('âš–ï¸ å¹³è¡¡æé†’ï¼šä¸è¦å¿˜è®°å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œè¿™æ˜¯å¯æŒç»­å‘å±•çš„å…³é”®');
            }
            
            return suggestions.map(suggestion => `
                <div style="padding: 8px 12px; margin: 4px 0; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">
                    ${suggestion}
                </div>
            `).join('');
        }

        function generateStrategicFrameworks() {
            return `
                <div style="display: grid; gap: 16px;">
                    <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e0e0e0;">
                        <h5 style="margin: 0 0 8px 0; color: #2e7d32;">ğŸ¯ OKRæ¡†æ¶</h5>
                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">ç›®æ ‡ä¸å…³é”®ç»“æœæ³•</div>
                        <div style="font-size: 0.85em; color: #999;">
                            â€¢ Objective: å®šæ€§çš„ç›®æ ‡æè¿°<br>
                            â€¢ Key Results: 3-5ä¸ªé‡åŒ–çš„å…³é”®ç»“æœ<br>
                            â€¢ é€‚åˆï¼šæ³¨é‡ç»“æœå’Œå½±å“åŠ›çš„ç›®æ ‡
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e0e0e0;">
                        <h5 style="margin: 0 0 8px 0; color: #2e7d32;">ğŸ—ï¸ SMARTåŸåˆ™</h5>
                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">å…·ä½“ã€å¯è¡¡é‡ã€å¯è¾¾æˆã€ç›¸å…³ã€æœ‰æ—¶é™</div>
                        <div style="font-size: 0.85em; color: #999;">
                            â€¢ Specific: ç›®æ ‡å…·ä½“æ˜ç¡®<br>
                            â€¢ Measurable: å¯é‡åŒ–è¡¡é‡<br>
                            â€¢ Achievable: ç°å®å¯è¾¾æˆ<br>
                            â€¢ Relevant: ä¸æ„¿æ™¯ç›¸å…³<br>
                            â€¢ Time-bound: æœ‰æ˜ç¡®æ—¶é™
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e0e0e0;">
                        <h5 style="margin: 0 0 8px 0; color: #2e7d32;">ğŸ”„ å¹³è¡¡è®¡åˆ†å¡</h5>
                        <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">å››ä¸ªç»´åº¦çš„å¹³è¡¡å‘å±•</div>
                        <div style="font-size: 0.85em; color: #999;">
                            â€¢ è´¢åŠ¡ç»´åº¦: æ”¶å…¥ã€æˆæœ¬ã€æŠ•èµ„<br>
                            â€¢ å®¢æˆ·ç»´åº¦: æ»¡æ„åº¦ã€å¸‚åœºä»½é¢<br>
                            â€¢ å†…éƒ¨æµç¨‹: æ•ˆç‡ã€è´¨é‡æå‡<br>
                            â€¢ å­¦ä¹ æˆé•¿: æŠ€èƒ½ã€åˆ›æ–°èƒ½åŠ›
                        </div>
                    </div>
                </div>
            `;
        }

        function applyStrategicSuggestions(currentData) {
            // ç”Ÿæˆå»ºè®®çš„å†…å®¹å¡«å……
            const suggestions = generateContentSuggestions(currentData);
            
            const applyHtml = `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <div style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 8px 0;">ğŸš€ åº”ç”¨æˆ˜ç•¥å»ºè®®</h3>
                        <p style="margin: 0; opacity: 0.9;">ä»¥ä¸‹æ˜¯åŸºäºæ‚¨å½“å‰æƒ…å†µç”Ÿæˆçš„å…·ä½“å»ºè®®å†…å®¹</p>
                    </div>
                    
                    ${suggestions.map(suggestion => `
                        <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h4 style="margin: 0; color: #333;">${suggestion.title}</h4>
                                <button onclick="applySuggestionContent('${suggestion.field}', \`${suggestion.content.replace(/`/g, '\\`')}\`)" 
                                        style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                    åº”ç”¨åˆ°è®¡åˆ’
                                </button>
                            </div>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; font-size: 0.9em; color: #666;">
                                ${suggestion.content.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            ModalUtils.show('ğŸš€ åº”ç”¨å»ºè®®', applyHtml, 'large');
        }

        function generateContentSuggestions(currentData) {
            const suggestions = [];
            
            // æ„¿æ™¯å»ºè®®
            if (!(currentData.vision && currentData.vision.trim())) {
                suggestions.push({
                    field: 'halfyear_vision',
                    title: 'ğŸŒŸ åŠå¹´æ„¿æ™¯å»ºè®®',
                    content: `åœ¨è¿™åŠå¹´ä¸­ï¼Œæˆ‘å°†ä¸“æ³¨äºä¸ªäººå’ŒèŒä¸šçš„å…¨é¢å‘å±•ã€‚æˆ‘å¸Œæœ›åœ¨ä¸“ä¸šæŠ€èƒ½ä¸Šå–å¾—æ˜¾è‘—çªç ´ï¼Œå»ºç«‹æ›´é«˜æ•ˆçš„å·¥ä½œæ–¹å¼ï¼ŒåŒæ—¶ä¿æŒå¥åº·çš„ç”Ÿæ´»èŠ‚å¥ã€‚é€šè¿‡æ˜ç¡®çš„ç›®æ ‡è®¾å®šå’ŒæŒç»­çš„è¡ŒåŠ¨ï¼Œæˆ‘å°†ä¸ºè‡ªå·±åˆ›é€ æ›´å¤šçš„å¯èƒ½æ€§å’Œæœºä¼šã€‚

å…³é”®ä¸»é¢˜ï¼š
â€¢ ä¸“ä¸šæŠ€èƒ½çš„æ·±åº¦å‘å±•
â€¢ å·¥ä½œæ•ˆç‡çš„ç³»ç»Ÿæ€§æå‡
â€¢ å¥åº·ç”Ÿæ´»ä¹ æƒ¯çš„å»ºç«‹
â€¢ äººé™…å…³ç³»çš„æ·±åŒ–å’Œæ‹“å±•`
                });
            }
            
            // æˆ˜ç•¥ç›®æ ‡å»ºè®®
            if (!(currentData.strategicGoals && currentData.strategicGoals.trim())) {
                suggestions.push({
                    field: 'halfyear_strategic_goals',
                    title: 'ğŸ¯ æˆ˜ç•¥ç›®æ ‡å»ºè®®',
                    content: `[ ] åœ¨æ ¸å¿ƒæŠ€èƒ½é¢†åŸŸè¾¾åˆ°ä¸“å®¶æ°´å¹³ï¼Œå®Œæˆ3ä¸ªé‡è¦é¡¹ç›®
[ ] å»ºç«‹ä¸ªäººå“ç‰Œï¼Œåœ¨è¡Œä¸šå†…è·å¾—è®¤å¯å’Œå½±å“åŠ›
[ ] æ”¹å–„å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œæ¯å‘¨è¿åŠ¨3æ¬¡ï¼Œæœˆè¯»2æœ¬ä¹¦
[ ] æ‰©å±•èŒä¸šç½‘ç»œï¼Œç»“è¯†10ä½è¡Œä¸šä¸“å®¶å¹¶å»ºç«‹æ·±åº¦è”ç³»
[ ] åˆ¶å®šå¹¶æ‰§è¡Œè´¢åŠ¡è§„åˆ’ï¼Œå®ç°æ”¶å…¥å¢é•¿æˆ–ç†è´¢ç›®æ ‡`
                });
            }
            
            // é¡¹ç›®è§„åˆ’å»ºè®®
            if (!(currentData.projects && currentData.projects.trim())) {
                suggestions.push({
                    field: 'halfyear_projects',
                    title: 'ğŸ—ï¸ é‡ç‚¹é¡¹ç›®å»ºè®®',
                    content: `[ ] æ ¸å¿ƒæŠ€èƒ½æå‡é¡¹ç›®ï¼šé€‰æ‹©1-2ä¸ªå…³é”®æŠ€èƒ½è¿›è¡Œæ·±åº¦å­¦ä¹ 
[ ] ä¸ªäººå“ç‰Œå»ºè®¾é¡¹ç›®ï¼šå¼€å§‹å†™ä½œã€æ¼”è®²æˆ–å†…å®¹åˆ›ä½œ
[ ] å¥åº·ç®¡ç†é¡¹ç›®ï¼šåˆ¶å®šè¿åŠ¨è®¡åˆ’å¹¶å»ºç«‹å¥åº·é¥®é£Ÿä¹ æƒ¯
[ ] å…³ç³»å»ºè®¾é¡¹ç›®ï¼šä¸»åŠ¨ç»´æŠ¤é‡è¦äººé™…å…³ç³»ï¼Œå‚åŠ è¡Œä¸šæ´»åŠ¨
[ ] åˆ›æ–°æ¢ç´¢é¡¹ç›®ï¼šå°è¯•æ–°çš„å·¥ä½œæ–¹æ³•æˆ–ä¸šä½™å…´è¶£`
                });
            }
            
            return suggestions;
        }

        function saveStrategicTemplate() {
            const template = {
                name: 'åŠå¹´æˆ˜ç•¥è§„åˆ’æ¨¡æ¿',
                timestamp: new Date().toISOString(),
                vision: 'åœ¨è¿™åŠå¹´ä¸­ï¼Œæˆ‘å°†ä¸“æ³¨äº...',
                strategicGoals: '[ ] ç›®æ ‡1ï¼šå…·ä½“ã€å¯è¡¡é‡çš„ç›®æ ‡\n[ ] ç›®æ ‡2ï¼šä¸æ„¿æ™¯å¯¹é½çš„ç›®æ ‡\n[ ] ç›®æ ‡3ï¼šæŒ‘æˆ˜ä½†å¯è¾¾æˆçš„ç›®æ ‡',
                projects: '[ ] é¡¹ç›®1ï¼šæ”¯æ’‘ç›®æ ‡çš„å…·ä½“é¡¹ç›®\n[ ] é¡¹ç›®2ï¼šèƒ½åŠ›å»ºè®¾ç›¸å…³é¡¹ç›®\n[ ] é¡¹ç›®3ï¼šåˆ›æ–°æ¢ç´¢é¡¹ç›®',
                skills: 'ä¸“ä¸šæŠ€èƒ½æå‡è®¡åˆ’ï¼š\nâ€¢ æ ¸å¿ƒæŠ€èƒ½æ·±åŒ–\nâ€¢ æ–°æŠ€èƒ½æ¢ç´¢\nâ€¢ è½¯æŠ€èƒ½å‘å±•',
                balance: '[ ] æ¯å‘¨è¿åŠ¨3æ¬¡\n[ ] æ¯æœˆè¯»ä¹¦2æœ¬\n[ ] å®šæœŸç¤¾äº¤æ´»åŠ¨\n[ ] ä¿è¯å……è¶³ç¡çœ '
            };
            
            StorageUtils.setItem('strategic_planning_template', template);
            MessageUtils.success('æˆ˜ç•¥è§„åˆ’æ¨¡æ¿å·²ä¿å­˜');
        }

        // === ç›®æ ‡å¯¹é½åŠŸèƒ½ ===
        function generateGoalAlignmentAnalysis() {
            const currentData = getCurrentPlanData();
            const alignmentAnalysis = analyzeGoalAlignment(currentData);
            
            ModalUtils.show('ğŸ¯ ç›®æ ‡å¯¹é½åˆ†æ', generateAlignmentContent(alignmentAnalysis), {
                size: 'large',
                buttons: [
                    {
                        text: 'ä¼˜åŒ–å¯¹é½',
                        class: 'btn-main',
                        handler: () => showAlignmentOptimization(alignmentAnalysis),
                        close: false
                    },
                    {
                        text: 'ç”Ÿæˆå¯¹é½å›¾',
                        class: 'btn-secondary',
                        handler: () => generateAlignmentChart(alignmentAnalysis),
                        close: false
                    },
                    {
                        text: 'å…³é—­',
                        class: 'btn-secondary'
                    }
                ]
            });
        }

        function analyzeGoalAlignment(data) {
            // æå–å„å±‚çº§ç›®æ ‡
            const vision = data.vision || '';
            const strategicGoals = extractGoals(data.strategicGoals || '');
            const projects = extractGoals(data.projects || '');
            const q1Milestones = extractGoals(data.quarter1Milestones || '');
            const q2Milestones = extractGoals(data.quarter2Milestones || '');
            const balanceGoals = extractGoals(data.balance || '');
            
            // åˆ†æå¯¹é½åº¦
            const alignmentScore = calculateAlignmentScore(vision, strategicGoals, projects, q1Milestones, q2Milestones);
            const consistencyCheck = checkGoalConsistency(strategicGoals, projects, q1Milestones, q2Milestones);
            const coverageAnalysis = analyzeCoverage(strategicGoals, projects, q1Milestones, q2Milestones);
            
            return {
                vision,
                strategicGoals,
                projects,
                q1Milestones,
                q2Milestones,
                balanceGoals,
                alignmentScore,
                consistencyCheck,
                coverageAnalysis,
                recommendations: generateAlignmentRecommendations(alignmentScore, consistencyCheck, coverageAnalysis)
            };
        }

        function extractGoals(content) {
            if (!content) return [];
            return content.split('\n')
                .filter(line => line.trim() && line.includes('['))
                .map(line => {
                    const match = line.match(/\[(.)\]\s*(.*)/);
                    return match ? {
                        completed: match[1].toLowerCase() === 'x',
                        text: match[2].trim(),
                        fullText: line.trim()
                    } : null;
                })
                .filter(goal => goal !== null);
        }

        function calculateAlignmentScore(vision, strategic, projects, q1, q2) {
            let score = 0;
            let maxScore = 0;
            
            // æ„¿æ™¯å­˜åœ¨æ€§ (20åˆ†)
            maxScore += 20;
            if (vision && vision.trim()) score += 20;
            
            // æˆ˜ç•¥ç›®æ ‡å®Œæ•´æ€§ (30åˆ†)
            maxScore += 30;
            if (strategic.length > 0) {
                score += Math.min(30, strategic.length * 10);
            }
            
            // é¡¹ç›®ä¸æˆ˜ç•¥çš„å¯¹é½ (25åˆ†)
            maxScore += 25;
            if (projects.length > 0 && strategic.length > 0) {
                score += 25;
            } else if (projects.length > 0 || strategic.length > 0) {
                score += 10;
            }
            
            // å­£åº¦é‡Œç¨‹ç¢‘çš„å¯¹é½ (25åˆ†)
            maxScore += 25;
            const totalMilestones = q1.length + q2.length;
            if (totalMilestones > 0 && strategic.length > 0) {
                score += 25;
            } else if (totalMilestones > 0 || strategic.length > 0) {
                score += 10;
            }
            
            return Math.round((score / maxScore) * 100);
        }

        function checkGoalConsistency(strategic, projects, q1, q2) {
            const issues = [];
            const strengths = [];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å­¤ç«‹çš„é¡¹ç›®
            if (projects.length > 0 && strategic.length === 0) {
                issues.push('å­˜åœ¨é¡¹ç›®ä½†ç¼ºå°‘å¯¹åº”çš„æˆ˜ç•¥ç›®æ ‡');
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å­¤ç«‹çš„é‡Œç¨‹ç¢‘
            const totalMilestones = q1.length + q2.length;
            if (totalMilestones > 0 && strategic.length === 0) {
                issues.push('å­˜åœ¨å­£åº¦é‡Œç¨‹ç¢‘ä½†ç¼ºå°‘å¯¹åº”çš„æˆ˜ç•¥ç›®æ ‡');
            }
            
            // æ£€æŸ¥æ•°é‡å¹³è¡¡
            if (strategic.length > 0) {
                const avgProjectsPerGoal = projects.length / strategic.length;
                const avgMilestonesPerGoal = totalMilestones / strategic.length;
                
                if (avgProjectsPerGoal < 1) {
                    issues.push('æˆ˜ç•¥ç›®æ ‡ç¼ºå°‘è¶³å¤Ÿçš„æ”¯æ’‘é¡¹ç›®');
                } else if (avgProjectsPerGoal > 3) {
                    issues.push('å•ä¸ªæˆ˜ç•¥ç›®æ ‡çš„é¡¹ç›®è¿‡å¤šï¼Œå¯èƒ½åˆ†æ•£æ³¨æ„åŠ›');
                } else {
                    strengths.push('é¡¹ç›®ä¸æˆ˜ç•¥ç›®æ ‡çš„æ•°é‡æ¯”ä¾‹åˆç†');
                }
                
                if (avgMilestonesPerGoal < 2) {
                    issues.push('æˆ˜ç•¥ç›®æ ‡ç¼ºå°‘è¶³å¤Ÿçš„å­£åº¦é‡Œç¨‹ç¢‘');
                } else {
                    strengths.push('å­£åº¦é‡Œç¨‹ç¢‘è¦†ç›–åº¦è‰¯å¥½');
                }
            }
            
            // æ£€æŸ¥å­£åº¦å¹³è¡¡
            if (q1.length > 0 || q2.length > 0) {
                const q1Ratio = q1.length / (q1.length + q2.length);
                if (q1Ratio < 0.3 || q1Ratio > 0.7) {
                    issues.push('å­£åº¦é—´çš„é‡Œç¨‹ç¢‘åˆ†å¸ƒä¸å‡è¡¡');
                } else {
                    strengths.push('å­£åº¦é—´çš„é‡Œç¨‹ç¢‘åˆ†å¸ƒå‡è¡¡');
                }
            }
            
            return { issues, strengths };
        }

        function analyzeCoverage(strategic, projects, q1, q2) {
            const coverage = {
                strategicCovered: 0,
                projectsLinked: 0,
                milestonesLinked: 0,
                gaps: []
            };
            
            if (strategic.length > 0) {
                // ç®€åŒ–çš„è¦†ç›–åˆ†æï¼ˆå®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„æ–‡æœ¬åŒ¹é…ç®—æ³•ï¼‰
                coverage.strategicCovered = strategic.length;
                
                if (projects.length === 0) {
                    coverage.gaps.push('æˆ˜ç•¥ç›®æ ‡ç¼ºå°‘å…·ä½“çš„æ‰§è¡Œé¡¹ç›®');
                }
                
                if (q1.length === 0 && q2.length === 0) {
                    coverage.gaps.push('æˆ˜ç•¥ç›®æ ‡ç¼ºå°‘å­£åº¦é‡Œç¨‹ç¢‘åˆ†è§£');
                }
                
                coverage.projectsLinked = Math.min(projects.length, strategic.length);
                coverage.milestonesLinked = Math.min(q1.length + q2.length, strategic.length * 2);
            }
            
            return coverage;
        }

        function generateAlignmentRecommendations(score, consistency, coverage) {
            const recommendations = [];
            
            // åŸºäºå¯¹é½åˆ†æ•°çš„å»ºè®®
            if (score < 40) {
                recommendations.push('ğŸš¨ ç›®æ ‡å¯¹é½åº¦è¾ƒä½ï¼Œå»ºè®®é‡æ–°å®¡è§†å„å±‚çº§ç›®æ ‡çš„å…³è”æ€§');
                recommendations.push('ğŸ“‹ ä¼˜å…ˆå®Œå–„æˆ˜ç•¥ç›®æ ‡ï¼Œç¡®ä¿æœ‰æ˜ç¡®çš„æ–¹å‘æŒ‡å¼•');
                recommendations.push('ğŸ”— ä¸ºæ¯ä¸ªæˆ˜ç•¥ç›®æ ‡è‡³å°‘è®¾è®¡1-2ä¸ªæ”¯æ’‘é¡¹ç›®');
            } else if (score < 70) {
                recommendations.push('âš¡ ç›®æ ‡å¯¹é½åº¦ä¸­ç­‰ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–å„å±‚çº§çš„è¿æ¥');
                recommendations.push('ğŸ“Š æ£€æŸ¥é¡¹ç›®å’Œé‡Œç¨‹ç¢‘æ˜¯å¦å……åˆ†æ”¯æ’‘æˆ˜ç•¥ç›®æ ‡');
                recommendations.push('ğŸ¯ è€ƒè™‘è°ƒæ•´æˆ–é‡æ–°è¡¨è¿°ç›®æ ‡ä»¥æé«˜ä¸€è‡´æ€§');
            } else {
                recommendations.push('âœ… ç›®æ ‡å¯¹é½åº¦è‰¯å¥½ï¼Œä¿æŒå½“å‰çš„è§„åˆ’ç»“æ„');
                recommendations.push('ğŸ” å®šæœŸæ£€æŸ¥æ‰§è¡Œè¿›åº¦ï¼Œç¡®ä¿å®é™…è¡ŒåŠ¨ä¸è§„åˆ’ä¸€è‡´');
                recommendations.push('ğŸ“ˆ å¯ä»¥è€ƒè™‘è®¾å®šæ›´å…·æŒ‘æˆ˜æ€§çš„ç›®æ ‡');
            }
            
            // åŸºäºä¸€è‡´æ€§æ£€æŸ¥çš„å»ºè®®
            consistency.issues.forEach(issue => {
                recommendations.push(`âš ï¸ ${issue}`);
            });
            
            // åŸºäºè¦†ç›–åº¦çš„å»ºè®®
            coverage.gaps.forEach(gap => {
                recommendations.push(`ğŸ”§ ${gap}`);
            });
            
            return recommendations;
        }

        function generateAlignmentContent(analysis) {
            const { alignmentScore, consistencyCheck, coverageAnalysis, recommendations } = analysis;
            
            return `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <!-- å¯¹é½åˆ†ææ¦‚è§ˆ -->
                    <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                        <h3 style="margin: 0 0 16px 0;">ğŸ¯ ç›®æ ‡å¯¹é½åˆ†ææŠ¥å‘Š</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${alignmentScore}%</div>
                                <div style="opacity: 0.9;">å¯¹é½åº¦å¾—åˆ†</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${analysis.strategicGoals.length}</div>
                                <div style="opacity: 0.9;">æˆ˜ç•¥ç›®æ ‡</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${analysis.projects.length}</div>
                                <div style="opacity: 0.9;">æ”¯æ’‘é¡¹ç›®</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2em; font-weight: bold;">${analysis.q1Milestones.length + analysis.q2Milestones.length}</div>
                                <div style="opacity: 0.9;">å­£åº¦é‡Œç¨‹ç¢‘</div>
                            </div>
                        </div>
                    </div>

                    <!-- å±‚çº§ç»“æ„åˆ†æ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ—ï¸ ç›®æ ‡å±‚çº§ç»“æ„</h4>
                        ${generateHierarchyVisualization(analysis)}
                    </div>

                    <!-- ä¸€è‡´æ€§æ£€æŸ¥ -->
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ” ä¸€è‡´æ€§æ£€æŸ¥</h4>
                        
                        ${consistencyCheck.strengths.length > 0 ? `
                        <div style="margin-bottom: 16px;">
                            <h5 style="color: #4caf50; margin: 0 0 8px 0;">âœ… ä¼˜åŠ¿</h5>
                            ${consistencyCheck.strengths.map(strength => `
                                <div style="padding: 6px 12px; background: #e8f5e9; border-radius: 4px; margin: 4px 0; color: #2e7d32;">
                                    ${strength}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                        
                        ${consistencyCheck.issues.length > 0 ? `
                        <div>
                            <h5 style="color: #f44336; margin: 0 0 8px 0;">âš ï¸ éœ€è¦å…³æ³¨</h5>
                            ${consistencyCheck.issues.map(issue => `
                                <div style="padding: 6px 12px; background: #ffebee; border-radius: 4px; margin: 4px 0; color: #c62828;">
                                    ${issue}
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>

                    <!-- å¯¹é½å»ºè®® -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px;">
                        <h4 style="margin: 0 0 16px 0; color: #333;">ğŸ’¡ å¯¹é½ä¼˜åŒ–å»ºè®®</h4>
                        ${recommendations.map(rec => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; margin: 4px 0; border-left: 3px solid #ff6b6b;">
                                ${rec}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateHierarchyVisualization(analysis) {
            const { vision, strategicGoals, projects, q1Milestones, q2Milestones } = analysis;
            
            return `
                <div style="display: grid; gap: 16px;">
                    <!-- æ„¿æ™¯å±‚ -->
                    <div style="text-align: center; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">ğŸŒŸ åŠå¹´æ„¿æ™¯</div>
                        <div style="font-size: 0.9em; opacity: 0.9;">
                            ${vision && vision.trim() ? 
                                (vision.length > 100 ? vision.substring(0, 100) + '...' : vision) : 
                                'æœªè®¾å®šæ„¿æ™¯'}
                        </div>
                    </div>
                    
                    <!-- æˆ˜ç•¥ç›®æ ‡å±‚ -->
                    <div style="background: rgba(33,150,243,0.1); padding: 16px; border-radius: 8px;">
                        <div style="font-weight: 600; color: #1976d2; margin-bottom: 12px;">ğŸ¯ æˆ˜ç•¥ç›®æ ‡ (${strategicGoals.length}é¡¹)</div>
                        <div style="display: grid; gap: 8px;">
                            ${strategicGoals.length > 0 ? 
                                strategicGoals.slice(0, 3).map(goal => `
                                    <div style="background: white; padding: 8px 12px; border-radius: 4px; font-size: 0.9em;">
                                        ${goal.completed ? 'âœ…' : 'â³'} ${goal.text}
                                    </div>
                                `).join('') +
                                (strategicGoals.length > 3 ? `<div style="color: #666; font-size: 0.8em; text-align: center;">...è¿˜æœ‰${strategicGoals.length - 3}é¡¹</div>` : '')
                                : '<div style="color: #999; font-style: italic; text-align: center;">æš‚æ— æˆ˜ç•¥ç›®æ ‡</div>'
                            }
                        </div>
                    </div>
                    
                    <!-- é¡¹ç›®å’Œé‡Œç¨‹ç¢‘å±‚ -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <!-- é‡ç‚¹é¡¹ç›® -->
                        <div style="background: rgba(156,39,176,0.1); padding: 12px; border-radius: 6px;">
                            <div style="font-weight: 600; color: #7b1fa2; margin-bottom: 8px; font-size: 0.9em;">ğŸ—ï¸ é‡ç‚¹é¡¹ç›®</div>
                            <div style="color: #333; font-size: 0.8em;">${projects.length}é¡¹</div>
                        </div>
                        
                        <!-- Q1é‡Œç¨‹ç¢‘ -->
                        <div style="background: rgba(255,152,0,0.1); padding: 12px; border-radius: 6px;">
                            <div style="font-weight: 600; color: #f57c00; margin-bottom: 8px; font-size: 0.9em;">ğŸ“… Q1é‡Œç¨‹ç¢‘</div>
                            <div style="color: #333; font-size: 0.8em;">${q1Milestones.length}é¡¹</div>
                        </div>
                        
                        <!-- Q2é‡Œç¨‹ç¢‘ -->
                        <div style="background: rgba(76,175,80,0.1); padding: 12px; border-radius: 6px;">
                            <div style="font-weight: 600; color: #388e3c; margin-bottom: 8px; font-size: 0.9em;">ğŸ“… Q2é‡Œç¨‹ç¢‘</div>
                            <div style="color: #333; font-size: 0.8em;">${q2Milestones.length}é¡¹</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showAlignmentOptimization(analysis) {
            const optimizationHtml = `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <div style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 8px 0;">ğŸ”§ ç›®æ ‡å¯¹é½ä¼˜åŒ–æ–¹æ¡ˆ</h3>
                        <p style="margin: 0; opacity: 0.9;">åŸºäºåˆ†æç»“æœæä¾›çš„å…·ä½“ä¼˜åŒ–å»ºè®®</p>
                    </div>
                    
                    ${generateOptimizationSteps(analysis)}
                </div>
            `;
            
            ModalUtils.show('ğŸ”§ å¯¹é½ä¼˜åŒ–', optimizationHtml, 'large');
        }

        function generateOptimizationSteps(analysis) {
            const steps = [];
            
            // åŸºäºåˆ†æç»“æœç”Ÿæˆä¼˜åŒ–æ­¥éª¤
            if (analysis.strategicGoals.length === 0) {
                steps.push({
                    priority: 'high',
                    title: 'ç¬¬ä¸€æ­¥ï¼šè®¾å®šæˆ˜ç•¥ç›®æ ‡',
                    description: 'å»ºç«‹2-5ä¸ªæ ¸å¿ƒæˆ˜ç•¥ç›®æ ‡ä½œä¸ºåŠå¹´è§„åˆ’çš„åŸºç¡€',
                    action: 'åœ¨æˆ˜ç•¥ç›®æ ‡åŒºåŸŸæ·»åŠ å…·ä½“ã€å¯è¡¡é‡çš„ç›®æ ‡'
                });
            }
            
            if (analysis.projects.length === 0 && analysis.strategicGoals.length > 0) {
                steps.push({
                    priority: 'high',
                    title: 'ç¬¬äºŒæ­¥ï¼šè®¾è®¡æ”¯æ’‘é¡¹ç›®',
                    description: 'ä¸ºæ¯ä¸ªæˆ˜ç•¥ç›®æ ‡è®¾è®¡1-2ä¸ªå…·ä½“çš„æ‰§è¡Œé¡¹ç›®',
                    action: 'åœ¨é‡ç‚¹é¡¹ç›®åŒºåŸŸæ·»åŠ æ”¯æ’‘æˆ˜ç•¥ç›®æ ‡çš„å…·ä½“é¡¹ç›®'
                });
            }
            
            if ((analysis.q1Milestones.length + analysis.q2Milestones.length) === 0) {
                steps.push({
                    priority: 'medium',
                    title: 'ç¬¬ä¸‰æ­¥ï¼šåˆ†è§£å­£åº¦é‡Œç¨‹ç¢‘',
                    description: 'å°†ç›®æ ‡åˆ†è§£ä¸ºå­£åº¦å¯è¾¾æˆçš„å…·ä½“é‡Œç¨‹ç¢‘',
                    action: 'åœ¨å­£åº¦é‡Œç¨‹ç¢‘åŒºåŸŸè®¾å®šé˜¶æ®µæ€§æˆæœ'
                });
            }
            
            if (analysis.alignmentScore < 70) {
                steps.push({
                    priority: 'medium',
                    title: 'ç¬¬å››æ­¥ï¼šæ£€æŸ¥ç›®æ ‡ä¸€è‡´æ€§',
                    description: 'ç¡®ä¿å„å±‚çº§ç›®æ ‡ä¹‹é—´çš„é€»è¾‘å…³è”å’Œæ”¯æ’‘å…³ç³»',
                    action: 'å®¡æŸ¥å¹¶è°ƒæ•´ç›®æ ‡è¡¨è¿°ï¼Œæé«˜å…³è”åº¦'
                });
            }
            
            if (steps.length === 0) {
                steps.push({
                    priority: 'low',
                    title: 'æŒç»­ä¼˜åŒ–',
                    description: 'å®šæœŸå›é¡¾å’Œè°ƒæ•´ç›®æ ‡å¯¹é½æƒ…å†µ',
                    action: 'å»ºç«‹å®šæœŸå›é¡¾æœºåˆ¶ï¼Œä¿æŒç›®æ ‡çš„åŠ¨æ€å¯¹é½'
                });
            }
            
            return steps.map(step => `
                <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid ${step.priority === 'high' ? '#f44336' : step.priority === 'medium' ? '#ff9800' : '#4caf50'};">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="background: ${step.priority === 'high' ? '#f44336' : step.priority === 'medium' ? '#ff9800' : '#4caf50'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 12px;">
                            ${step.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : step.priority === 'medium' ? 'ä¸­ä¼˜å…ˆçº§' : 'ä½ä¼˜å…ˆçº§'}
                        </span>
                        <h4 style="margin: 0; color: #333;">${step.title}</h4>
                    </div>
                    <div style="color: #666; margin-bottom: 8px;">${step.description}</div>
                    <div style="background: #f8f9fa; padding: 8px; border-radius: 4px; font-size: 0.9em; color: #333;">
                        ğŸ’¡ <strong>å…·ä½“è¡ŒåŠ¨ï¼š</strong>${step.action}
                    </div>
                </div>
            `).join('');
        }

        function generateAlignmentChart(analysis) {
            // è¿™é‡Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªç®€å•çš„æ–‡æœ¬å›¾è¡¨
            const chartHtml = `
                <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 8px 0;">ğŸ“Š ç›®æ ‡å¯¹é½å…³ç³»å›¾</h3>
                        <p style="margin: 0; opacity: 0.9;">å¯è§†åŒ–å±•ç¤ºå„å±‚çº§ç›®æ ‡ä¹‹é—´çš„å…³ç³»</p>
                    </div>
                    
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px;">
                        <div style="text-align: center; font-family: monospace; line-height: 1.8; color: #333;">
                            <div style="color: #667eea; font-weight: bold;">ğŸŒŸ åŠå¹´æ„¿æ™¯</div>
                            <div>|</div>
                            <div style="color: #2196f3; font-weight: bold;">ğŸ¯ æˆ˜ç•¥ç›®æ ‡ (${analysis.strategicGoals.length}é¡¹)</div>
                            <div>â”œâ”€â”€ ğŸ“‹ é‡ç‚¹é¡¹ç›® (${analysis.projects.length}é¡¹)</div>
                            <div>â”œâ”€â”€ ğŸ“… Q1é‡Œç¨‹ç¢‘ (${analysis.q1Milestones.length}é¡¹)</div>
                            <div>â””â”€â”€ ğŸ“… Q2é‡Œç¨‹ç¢‘ (${analysis.q2Milestones.length}é¡¹)</div>
                            <div style="margin-top: 20px; padding: 12px; background: #f8f9fa; border-radius: 6px;">
                                <strong>å¯¹é½åº¦è¯„åˆ†ï¼š${analysis.alignmentScore}/100</strong><br>
                                <div style="background: #e0e0e0; height: 8px; border-radius: 4px; margin-top: 8px; overflow: hidden;">
                                    <div style="background: ${analysis.alignmentScore >= 70 ? '#4caf50' : analysis.alignmentScore >= 40 ? '#ff9800' : '#f44336'}; height: 100%; width: ${analysis.alignmentScore}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ“Š å¯¹é½å…³ç³»å›¾', chartHtml, 'large');
        }

        // === AIåŠ©æ‰‹åŠŸèƒ½ ===
        function showHalfyearAIAssistant() {
            const aiContent = `
                <div style="text-align: center; margin-bottom: 24px;">
                    <h3 style="color: #667eea; margin-bottom: 16px;">ğŸ¤– åŠå¹´è§„åˆ’AIåŠ©æ‰‹</h3>
                    <p style="color: #666; font-size: 0.95em;">è®©AIå¸®åŠ©æ‚¨åˆ¶å®šå’Œä¼˜åŒ–åŠå¹´è®¡åˆ’</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <button class="ai-feature-btn" onclick="generateVisionSuggestions()">
                        <div class="feature-icon">ğŸŒŸ</div>
                        <div class="feature-title">æ„¿æ™¯è§„åˆ’åŠ©æ‰‹</div>
                        <div class="feature-desc">AIååŠ©åˆ¶å®šåŠå¹´æ„¿æ™¯</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateStrategicGoals()">
                        <div class="feature-icon">ğŸ¯</div>
                        <div class="feature-title">æˆ˜ç•¥ç›®æ ‡ç”Ÿæˆ</div>
                        <div class="feature-desc">æ™ºèƒ½ç”ŸæˆSMARTç›®æ ‡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="analyzeHalfyearBalance()">
                        <div class="feature-icon">âš–ï¸</div>
                        <div class="feature-title">å¹³è¡¡åº¦åˆ†æ</div>
                        <div class="feature-desc">åˆ†æå·¥ä½œç”Ÿæ´»å¹³è¡¡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateMilestoneBreakdown()">
                        <div class="feature-icon">ğŸ“…</div>
                        <div class="feature-title">é‡Œç¨‹ç¢‘åˆ†è§£</div>
                        <div class="feature-desc">æ™ºèƒ½åˆ†è§£å­£åº¦ç›®æ ‡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="suggestSkillDevelopment()">
                        <div class="feature-icon">ğŸ“ˆ</div>
                        <div class="feature-title">èƒ½åŠ›å‘å±•å»ºè®®</div>
                        <div class="feature-desc">ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateRiskAssessment()">
                        <div class="feature-icon">ğŸ›¡ï¸</div>
                        <div class="feature-title">é£é™©è¯„ä¼°</div>
                        <div class="feature-desc">è¯†åˆ«æ½œåœ¨æŒ‘æˆ˜</div>
                    </button>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="color: #667eea; font-weight: 600; margin-bottom: 8px;">ğŸš€ ä¸€é”®ä¼˜åŒ–</div>
                    <button class="btn-main" onclick="comprehensiveHalfyearOptimization()" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white;">
                        å…¨é¢ä¼˜åŒ–åŠå¹´è®¡åˆ’
                    </button>
                </div>
                
                <style>
                    .ai-feature-btn {
                        background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
                        border: 2px solid #e0e7ff;
                        border-radius: 12px;
                        padding: 20px 16px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
                    }
                    .ai-feature-btn:hover {
                        border-color: #667eea;
                        transform: translateY(-3px);
                        box-shadow: 0 8px 24px rgba(102,126,234,0.15);
                        background: linear-gradient(135deg, rgba(255,255,255,1), rgba(248,250,252,1));
                    }
                    .feature-icon { 
                        font-size: 2.2em; 
                        margin-bottom: 12px; 
                        display: block;
                    }
                    .feature-title { 
                        font-weight: 600; 
                        color: #374151; 
                        margin-bottom: 6px; 
                        font-size: 1.05em;
                    }
                    .feature-desc { 
                        font-size: 0.9em; 
                        color: #6b7280; 
                        line-height: 1.4;
                    }
                </style>
            `;
            
            ModalUtils.show('ğŸ¤– åŠå¹´è§„åˆ’AIåŠ©æ‰‹', aiContent, 'large');
        }

        // AIåŠŸèƒ½å®ç°
        function generateVisionSuggestions() {
            const currentVision = document.getElementById('halfyear_vision').value;
            const currentGoals = getTodoContent('halfyear_strategic_goals');
            
            const suggestions = [
                {
                    title: 'ğŸŒŸ èŒä¸šå‘å±•ä¸»å¯¼å‹æ„¿æ™¯',
                    content: `åœ¨è¿™${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´ï¼Œæˆ‘å°†ä¸“æ³¨äºèŒä¸šæŠ€èƒ½çš„æ·±åº¦å‘å±•å’Œä¸“ä¸šå½±å“åŠ›çš„å»ºç«‹ã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„å­¦ä¹ å’Œå®è·µï¼Œæˆ‘è¦åœ¨æ ¸å¿ƒä¸“ä¸šé¢†åŸŸè¾¾åˆ°æ–°çš„é«˜åº¦ï¼ŒåŒæ—¶å»ºç«‹ä¸ªäººå“ç‰Œå’Œè¡Œä¸šè®¤çŸ¥åº¦ã€‚

â€¢ æˆä¸ºæ‰€åœ¨é¢†åŸŸçš„ä¸“å®¶çº§äººæ‰
â€¢ å»ºç«‹æœ‰å½±å“åŠ›çš„ä¸ªäººå“ç‰Œ
â€¢ æ‰©å±•é«˜è´¨é‡çš„èŒä¸šç½‘ç»œ
â€¢ è·å¾—é‡è¦çš„é¡¹ç›®æˆæœå’Œè®¤å¯`
                },
                {
                    title: 'âš–ï¸ å¹³è¡¡å‘å±•å‹æ„¿æ™¯',
                    content: `è¿™${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´ï¼Œæˆ‘å°†è¿½æ±‚å·¥ä½œä¸ç”Ÿæ´»çš„å’Œè°å¹³è¡¡ï¼Œåœ¨èŒä¸šå‘å±•çš„åŒæ—¶ï¼Œä¸å¿˜ä¸ªäººæˆé•¿å’Œç”Ÿæ´»å“è´¨çš„æå‡ã€‚æˆ‘è¦å»ºç«‹å¯æŒç»­çš„ç”Ÿæ´»æ–¹å¼ï¼Œè®©æ¯ä¸ªç»´åº¦éƒ½å¾—åˆ°å……å®çš„å‘å±•ã€‚

â€¢ èŒä¸šæŠ€èƒ½ç¨³æ­¥æå‡ï¼Œå·¥ä½œæ•ˆç‡ä¼˜åŒ–
â€¢ èº«ä½“å¥åº·å’Œç²¾ç¥çŠ¶æ€æŒç»­æ”¹å–„
â€¢ äººé™…å…³ç³»æ›´åŠ æ·±å…¥å’Œæœ‰æ„ä¹‰
â€¢ åŸ¹å…»æ–°çš„å…´è¶£çˆ±å¥½å’Œç”Ÿæ´»æŠ€èƒ½`
                },
                {
                    title: 'ğŸš€ çªç ´åˆ›æ–°å‹æ„¿æ™¯',
                    content: `åœ¨è¿™${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´ï¼Œæˆ‘å°†å‹‡äºçªç ´èˆ’é€‚åœˆï¼Œæ¢ç´¢æ–°çš„å¯èƒ½æ€§å’Œæœºä¼šã€‚é€šè¿‡åˆ›æ–°æ€ç»´å’Œå¤§èƒ†å°è¯•ï¼Œæˆ‘è¦ä¸ºè‡ªå·±å¼€æ‹“å…¨æ–°çš„å‘å±•è·¯å¾„å’Œæˆé•¿ç©ºé—´ã€‚

â€¢ å°è¯•æ–°çš„é¢†åŸŸå’ŒæŒ‘æˆ˜æ€§é¡¹ç›®
â€¢ åŸ¹å…»åˆ›æ–°æ€ç»´å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›
â€¢ å»ºç«‹å¤šå…ƒåŒ–çš„æŠ€èƒ½ç»„åˆ
â€¢ åˆ›é€ ç‹¬ç‰¹çš„ä»·å€¼å’Œå½±å“åŠ›`
                }
            ];
            
            let content = `
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸŒŸ AIæ„¿æ™¯å»ºè®®</h4>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">
                        åŸºäºåŠå¹´è§„åˆ’çš„ç‰¹ç‚¹ï¼Œä¸ºæ‚¨æ¨èä»¥ä¸‹æ„¿æ™¯æ–¹å‘ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä¸€ä¸ªä½œä¸ºåŸºç¡€ï¼Œç„¶åæ ¹æ®ä¸ªäººæƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚
                    </p>
                </div>
            `;
            
            suggestions.forEach((suggestion, index) => {
                content += `
                    <div style="border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 16px; background: linear-gradient(135deg, rgba(102,126,234,0.02), rgba(255,255,255,0.5));">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                            <h5 style="margin: 0; color: #374151; font-size: 1.1em;">${suggestion.title}</h5>
                            <button onclick="applyVisionSuggestion(\`${suggestion.content.replace(/`/g, '\\`').replace(/\n/g, '\\n')}\`)" 
                                    style="background: #667eea; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                åº”ç”¨æ­¤æ„¿æ™¯
                            </button>
                        </div>
                        <div style="color: #6b7280; line-height: 1.6; font-size: 0.95em; white-space: pre-line;">
                            ${suggestion.content}
                        </div>
                    </div>
                `;
            });
            
            content += `
                <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-top: 20px;">
                    <h5 style="color: #374151; margin: 0 0 8px 0;">ğŸ’¡ ä¸ªæ€§åŒ–å®šåˆ¶</h5>
                    <p style="color: #6b7280; font-size: 0.9em; margin: 0;">
                        æ‚¨ä¹Ÿå¯ä»¥å°†ä»¥ä¸Šå»ºè®®ä½œä¸ºçµæ„Ÿï¼Œç»“åˆè‡ªå·±çš„å…·ä½“æƒ…å†µï¼Œåˆ¶å®šç‹¬ç‰¹çš„ä¸ªäººæ„¿æ™¯ã€‚
                        è®°ä½ï¼Œå¥½çš„æ„¿æ™¯åº”è¯¥æ—¢æœ‰æŒ‘æˆ˜æ€§åˆå…·å¤‡å¯å®ç°æ€§ã€‚
                    </p>
                </div>
            `;
            
            ModalUtils.show('ğŸŒŸ AIæ„¿æ™¯å»ºè®®', content, 'large');
        }

        function generateStrategicGoals() {
            const currentVision = document.getElementById('halfyear_vision').value;
            const currentGoals = getTodoContent('halfyear_strategic_goals');
            
            const goalCategories = [
                {
                    category: 'èŒä¸šå‘å±•',
                    icon: 'ğŸ’¼',
                    goals: [
                        'å®Œæˆ3ä¸ªé‡è¦é¡¹ç›®ï¼Œæå‡ä¸“ä¸šæŠ€èƒ½å’Œå½±å“åŠ›',
                        'è·å¾—æ–°çš„èŒä¸šè®¤è¯æˆ–æŠ€èƒ½èµ„è´¨',
                        'å»ºç«‹ä¸ªäººå“ç‰Œï¼Œåœ¨è¡Œä¸šå†…è·å¾—è®¤å¯',
                        'æ‰©å±•èŒä¸šç½‘ç»œï¼Œç»“è¯†10ä½è¡Œä¸šä¸“å®¶'
                    ]
                },
                {
                    category: 'æŠ€èƒ½æå‡',
                    icon: 'ğŸ“š',
                    goals: [
                        'æŒæ¡2é¡¹æ–°çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œè¾¾åˆ°ä¸­çº§æ°´å¹³',
                        'å®Œæˆç³»ç»Ÿæ€§å­¦ä¹ è®¡åˆ’ï¼Œé˜…è¯»12æœ¬ä¸“ä¸šä¹¦ç±',
                        'å‚åŠ é‡è¦çš„åŸ¹è®­æˆ–ä¼šè®®ï¼Œè·å¾—æ–°çŸ¥è¯†',
                        'å»ºç«‹çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œæå‡å­¦ä¹ æ•ˆç‡'
                    ]
                },
                {
                    category: 'å¥åº·ç”Ÿæ´»',
                    icon: 'ğŸƒ',
                    goals: [
                        'å»ºç«‹è§„å¾‹è¿åŠ¨ä¹ æƒ¯ï¼Œæ¯å‘¨è¿åŠ¨4æ¬¡ä»¥ä¸Š',
                        'æ”¹å–„é¥®é£Ÿç»“æ„ï¼Œä¿æŒå¥åº·çš„ç”Ÿæ´»èŠ‚å¥',
                        'ä¿è¯å……è¶³ç¡çœ ï¼Œæå‡èº«ä½“å’Œç²¾ç¥çŠ¶æ€',
                        'å­¦ä¼šå‹åŠ›ç®¡ç†ï¼Œä¿æŒå¿ƒç†å¥åº·'
                    ]
                },
                {
                    category: 'äººé™…å…³ç³»',
                    icon: 'ğŸ¤',
                    goals: [
                        'æ·±åŒ–é‡è¦å…³ç³»ï¼Œä¸å®¶äººæœ‹å‹ä¿æŒå¯†åˆ‡è”ç³»',
                        'ä¸»åŠ¨å‚ä¸ç¤¾äº¤æ´»åŠ¨ï¼Œæ‰©å±•ç¤¾äº¤åœˆ',
                        'æå‡æ²Ÿé€šæŠ€å·§ï¼Œå»ºç«‹æ›´å¥½çš„äººé™…å…³ç³»',
                        'å‚ä¸å¿—æ„¿æ´»åŠ¨æˆ–ç¤¾åŒºæœåŠ¡ï¼Œå›é¦ˆç¤¾ä¼š'
                    ]
                }
            ];
            
            let content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ¯ AIæˆ˜ç•¥ç›®æ ‡ç”Ÿæˆ</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        ä»¥ä¸‹æ˜¯æ ¹æ®SMARTåŸåˆ™ç”Ÿæˆçš„æˆ˜ç•¥ç›®æ ‡å»ºè®®ã€‚å»ºè®®é€‰æ‹©2-5ä¸ªç›®æ ‡ï¼Œç¡®ä¿ç›®æ ‡é—´çš„å¹³è¡¡å’Œåè°ƒã€‚
                    </p>
                </div>
            `;
            
            goalCategories.forEach(category => {
                content += `
                    <div style="border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px; background: rgba(102,126,234,0.02);">
                        <h5 style="color: #374151; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            ${category.icon} ${category.category}
                        </h5>
                        <div style="display: grid; gap: 10px;">
                            ${category.goals.map(goal => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: white; border-radius: 8px; border: 1px solid #f0f0f0;">
                                    <span style="color: #374151; font-size: 0.95em;">[ ] ${goal}</span>
                                    <button onclick="addStrategicGoal('[ ] ${goal}')" 
                                            style="background: #667eea; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">
                                        æ·»åŠ 
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            content += `
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); padding: 20px; border-radius: 12px; text-align: center;">
                    <h5 style="color: #667eea; margin: 0 0 12px 0;">ğŸš€ ä¸€é”®ç”Ÿæˆå®Œæ•´ç›®æ ‡é›†</h5>
                    <button onclick="generateBalancedGoalSet()" 
                            style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ç”Ÿæˆå¹³è¡¡çš„ç›®æ ‡ç»„åˆ
                    </button>
                </div>
            `;
            
            ModalUtils.show('ğŸ¯ AIæˆ˜ç•¥ç›®æ ‡ç”Ÿæˆ', content, 'large');
        }

        function analyzeHalfyearBalance() {
            const currentData = getCurrentPlanData();
            const balanceAnalysis = performBalanceAnalysis(currentData);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">âš–ï¸ åŠå¹´å¹³è¡¡åº¦åˆ†æ</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        AIåˆ†ææ‚¨çš„åŠå¹´è®¡åˆ’åœ¨å„ä¸ªç»´åº¦çš„å¹³è¡¡æƒ…å†µï¼Œå¹¶æä¾›ä¼˜åŒ–å»ºè®®ã€‚
                    </p>
                </div>
                
                <!-- å¹³è¡¡åº¦é›·è¾¾å›¾ -->
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(255,255,255,0.8)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #374151; margin: 0 0 16px 0;">ğŸ“Š å„ç»´åº¦å¹³è¡¡è¯„åˆ†</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        ${balanceAnalysis.dimensions.map(dim => `
                            <div style="text-align: center; padding: 16px; background: white; border-radius: 8px; border: 1px solid #e0e7ff;">
                                <div style="font-size: 1.8em; margin-bottom: 8px;">${dim.icon}</div>
                                <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">${dim.name}</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: ${dim.score >= 80 ? '#10b981' : dim.score >= 60 ? '#f59e0b' : '#ef4444'};">
                                    ${dim.score}%
                                </div>
                                <div style="background: #f3f4f6; height: 6px; border-radius: 3px; margin-top: 8px; overflow: hidden;">
                                    <div style="background: ${dim.score >= 80 ? '#10b981' : dim.score >= 60 ? '#f59e0b' : '#ef4444'}; height: 100%; width: ${dim.score}%; transition: width 0.3s ease;"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- åˆ†ææ´å¯Ÿ -->
                <div style="background: white; border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #374151; margin: 0 0 16px 0;">ğŸ” AIæ´å¯Ÿåˆ†æ</h5>
                    <div style="display: grid; gap: 12px;">
                        ${balanceAnalysis.insights.map(insight => `
                            <div style="padding: 12px; background: rgba(102,126,234,0.05); border-radius: 8px; border-left: 4px solid #667eea;">
                                ${insight}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- ä¼˜åŒ–å»ºè®® -->
                <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #92400e; margin: 0 0 16px 0;">ğŸ’¡ å¹³è¡¡ä¼˜åŒ–å»ºè®®</h5>
                    <div style="display: grid; gap: 8px;">
                        ${balanceAnalysis.recommendations.map(rec => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                                ${rec}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            ModalUtils.show('âš–ï¸ åŠå¹´å¹³è¡¡åº¦åˆ†æ', content, 'large');
        }

        function generateMilestoneBreakdown() {
            const strategicGoals = getTodoContent('halfyear_strategic_goals');
            const currentQ1 = getTodoContent('quarter1_milestones');
            const currentQ2 = getTodoContent('quarter2_milestones');
            
            if (!strategicGoals.trim()) {
                MessageUtils.info('è¯·å…ˆè®¾å®šæˆ˜ç•¥ç›®æ ‡ï¼Œç„¶åå†ç”Ÿæˆé‡Œç¨‹ç¢‘åˆ†è§£');
                return;
            }
            
            const goals = strategicGoals.split('\n').filter(line => line.trim() && line.includes('['));
            const milestoneBreakdown = generateMilestones(goals);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ“… AIé‡Œç¨‹ç¢‘åˆ†è§£</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºæ‚¨çš„æˆ˜ç•¥ç›®æ ‡ï¼ŒAIä¸ºæ‚¨ç”Ÿæˆäº†å­£åº¦é‡Œç¨‹ç¢‘åˆ†è§£å»ºè®®ã€‚
                    </p>
                </div>
                
                ${milestoneBreakdown.map((breakdown, index) => `
                    <div style="border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px; background: rgba(102,126,234,0.02);">
                        <h5 style="color: #374151; margin: 0 0 16px 0;">
                            ğŸ¯ ç›®æ ‡ ${index + 1}: ${breakdown.goal.replace(/^\[.\]\s*/, '')}
                        </h5>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <!-- Q1é‡Œç¨‹ç¢‘ -->
                            <div style="background: rgba(33,150,243,0.1); padding: 16px; border-radius: 8px;">
                                <h6 style="color: #1976d2; margin: 0 0 12px 0;">
                                    ğŸŒ± ${currentHalf === 1 ? 'Q1' : 'Q3'} é‡Œç¨‹ç¢‘
                                </h6>
                                <div style="display: grid; gap: 8px;">
                                    ${breakdown.q1.map(milestone => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; border-radius: 4px; font-size: 0.9em;">
                                            <span>[ ] ${milestone}</span>
                                            <button onclick="addMilestone('quarter1_milestones', '[ ] ${milestone}')" 
                                                    style="background: #1976d2; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 0.8em;">
                                                æ·»åŠ 
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Q2é‡Œç¨‹ç¢‘ -->
                            <div style="background: rgba(255,152,0,0.1); padding: 16px; border-radius: 8px;">
                                <h6 style="color: #f57c00; margin: 0 0 12px 0;">
                                    ğŸš€ ${currentHalf === 1 ? 'Q2' : 'Q4'} é‡Œç¨‹ç¢‘
                                </h6>
                                <div style="display: grid; gap: 8px;">
                                    ${breakdown.q2.map(milestone => `
                                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; border-radius: 4px; font-size: 0.9em;">
                                            <span>[ ] ${milestone}</span>
                                            <button onclick="addMilestone('quarter2_milestones', '[ ] ${milestone}')" 
                                                    style="background: #f57c00; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer; font-size: 0.8em;">
                                                æ·»åŠ 
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
                
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); padding: 20px; border-radius: 12px; text-align: center;">
                    <button onclick="applyAllMilestones()" 
                            style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 12px;">
                        åº”ç”¨æ‰€æœ‰é‡Œç¨‹ç¢‘
                    </button>
                    <button onclick="regenerateMilestones()" 
                            style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        é‡æ–°ç”Ÿæˆ
                    </button>
                </div>
            `;
            
            ModalUtils.show('ğŸ“… AIé‡Œç¨‹ç¢‘åˆ†è§£', content, 'large');
        }

        function suggestSkillDevelopment() {
            const currentSkills = document.getElementById('halfyear_skills').value;
            const strategicGoals = getTodoContent('halfyear_strategic_goals');
            
            const skillSuggestions = generateSkillSuggestions(currentSkills, strategicGoals);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ“ˆ AIèƒ½åŠ›å‘å±•å»ºè®®</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºæ‚¨çš„æˆ˜ç•¥ç›®æ ‡å’Œå½“å‰æŠ€èƒ½çŠ¶å†µï¼ŒAIä¸ºæ‚¨æ¨èä¸ªæ€§åŒ–çš„èƒ½åŠ›å‘å±•è·¯å¾„ã€‚
                    </p>
                </div>
                
                ${skillSuggestions.categories.map(category => `
                    <div style="border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px; background: rgba(102,126,234,0.02);">
                        <h5 style="color: #374151; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            ${category.icon} ${category.name}
                        </h5>
                        <div style="display: grid; gap: 12px;">
                            ${category.skills.map(skill => `
                                <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #f0f0f0;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <h6 style="margin: 0; color: #374151; font-size: 1em;">${skill.name}</h6>
                                        <span style="background: ${skill.priority === 'high' ? '#ef4444' : skill.priority === 'medium' ? '#f59e0b' : '#10b981'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                            ${skill.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : skill.priority === 'medium' ? 'ä¸­ä¼˜å…ˆçº§' : 'ä½ä¼˜å…ˆçº§'}
                                        </span>
                                    </div>
                                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">${skill.description}</div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div style="color: #374151; font-size: 0.85em;">
                                            ğŸ“š ${skill.resources.join(' â€¢ ')}
                                        </div>
                                        <button onclick="addSkillToPlan('${skill.name}', '${skill.description}')" 
                                                style="background: #667eea; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                            æ·»åŠ åˆ°è®¡åˆ’
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
                
                <div style="background: #e0f2fe; border: 1px solid #0288d1; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #01579b; margin: 0 0 12px 0;">ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®</h5>
                    <div style="color: #01579b; font-size: 0.95em; line-height: 1.6;">
                        ${skillSuggestions.learningPath}
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ“ˆ AIèƒ½åŠ›å‘å±•å»ºè®®', content, 'large');
        }

        function generateRiskAssessment() {
            const currentData = getCurrentPlanData();
            const riskAssessment = analyzeRisks(currentData);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ›¡ï¸ AIé£é™©è¯„ä¼°</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        AIè¯†åˆ«æ‚¨åŠå¹´è®¡åˆ’ä¸­çš„æ½œåœ¨é£é™©å’ŒæŒ‘æˆ˜ï¼Œå¹¶æä¾›åº”å¯¹ç­–ç•¥ã€‚
                    </p>
                </div>
                
                <!-- é£é™©ç­‰çº§æ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(248,113,113,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #dc2626; margin: 0 0 16px 0;">âš ï¸ é£é™©ç­‰çº§åˆ†å¸ƒ</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;">
                        <div style="text-align: center; padding: 12px; background: rgba(239,68,68,0.1); border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #dc2626;">${riskAssessment.highRisks.length}</div>
                            <div style="font-size: 0.9em; color: #7f1d1d;">é«˜é£é™©</div>
                        </div>
                        <div style="text-align: center; padding: 12px; background: rgba(245,158,11,0.1); border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #d97706;">${riskAssessment.mediumRisks.length}</div>
                            <div style="font-size: 0.9em; color: #92400e;">ä¸­é£é™©</div>
                        </div>
                        <div style="text-align: center; padding: 12px; background: rgba(34,197,94,0.1); border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #16a34a;">${riskAssessment.lowRisks.length}</div>
                            <div style="font-size: 0.9em; color: #15803d;">ä½é£é™©</div>
                        </div>
                    </div>
                </div>
                
                <!-- è¯¦ç»†é£é™©åˆ†æ -->
                ${['high', 'medium', 'low'].map(level => {
                    const risks = riskAssessment[level + 'Risks'];
                    const colors = {
                        high: { bg: '#fef2f2', border: '#dc2626', text: '#991b1b' },
                        medium: { bg: '#fffbeb', border: '#d97706', text: '#92400e' },
                        low: { bg: '#f0fdf4', border: '#16a34a', text: '#15803d' }
                    };
                    
                    if (risks.length === 0) return '';
                    
                    return `
                        <div style="background: ${colors[level].bg}; border: 1px solid ${colors[level].border}; border-radius: 12px; padding: 20px; margin-bottom: 16px;">
                            <h5 style="color: ${colors[level].text}; margin: 0 0 16px 0;">
                                ${level === 'high' ? 'ğŸš¨ é«˜é£é™©é¡¹' : level === 'medium' ? 'âš ï¸ ä¸­é£é™©é¡¹' : 'ğŸ’¡ ä½é£é™©é¡¹'}
                            </h5>
                            <div style="display: grid; gap: 12px;">
                                ${risks.map(risk => `
                                    <div style="background: white; padding: 16px; border-radius: 8px;">
                                        <div style="font-weight: 600; color: #374151; margin-bottom: 8px;">${risk.title}</div>
                                        <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">${risk.description}</div>
                                        <div style="background: #f9fafb; padding: 12px; border-radius: 6px;">
                                            <div style="font-weight: 600; color: #374151; margin-bottom: 4px;">åº”å¯¹ç­–ç•¥:</div>
                                            <div style="color: #6b7280; font-size: 0.9em;">${risk.mitigation}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}
                
                <!-- é£é™©ç®¡ç†å»ºè®® -->
                <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #0c4a6e; margin: 0 0 16px 0;">ğŸ“‹ é£é™©ç®¡ç†å»ºè®®</h5>
                    <div style="display: grid; gap: 8px;">
                        ${riskAssessment.managementTips.map(tip => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #0ea5e9;">
                                ${tip}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ›¡ï¸ AIé£é™©è¯„ä¼°', content, 'large');
        }

        function comprehensiveHalfyearOptimization() {
            const currentData = getCurrentPlanData();
            const optimization = performComprehensiveOptimization(currentData);
            
            const content = `
                <div style="margin-bottom: 24px; text-align: center;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸš€ å…¨é¢ä¼˜åŒ–æŠ¥å‘Š</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        AIå¯¹æ‚¨çš„åŠå¹´è®¡åˆ’è¿›è¡Œå…¨é¢åˆ†æå’Œä¼˜åŒ–ï¼Œç”Ÿæˆä¸ªæ€§åŒ–æ”¹è¿›æ–¹æ¡ˆ
                    </p>
                </div>
                
                <!-- ä¼˜åŒ–æ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; margin-bottom: 24px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; text-align: center;">
                        <div>
                            <div style="font-size: 1.8em; font-weight: bold;">${optimization.currentScore}</div>
                            <div style="opacity: 0.9; font-size: 0.9em;">å½“å‰å¾—åˆ†</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8em; font-weight: bold;">${optimization.optimizedScore}</div>
                            <div style="opacity: 0.9; font-size: 0.9em;">ä¼˜åŒ–åå¾—åˆ†</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8em; font-weight: bold;">+${optimization.improvement}</div>
                            <div style="opacity: 0.9; font-size: 0.9em;">æå‡å¹…åº¦</div>
                        </div>
                    </div>
                </div>
                
                <!-- ä¼˜åŒ–å»ºè®® -->
                ${optimization.categories.map(category => `
                    <div style="background: white; border: 1px solid #e0e7ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h5 style="color: #374151; margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px;">
                            ${category.icon} ${category.name}
                        </h5>
                        <div style="display: grid; gap: 12px;">
                            ${category.optimizations.map(opt => `
                                <div style="background: rgba(102,126,234,0.05); padding: 16px; border-radius: 8px; border-left: 4px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                                        <div style="font-weight: 600; color: #374151;">${opt.title}</div>
                                        <span style="background: ${opt.impact === 'high' ? '#10b981' : opt.impact === 'medium' ? '#f59e0b' : '#6b7280'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                            ${opt.impact === 'high' ? 'é«˜å½±å“' : opt.impact === 'medium' ? 'ä¸­å½±å“' : 'ä½å½±å“'}
                                        </span>
                                    </div>
                                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">${opt.description}</div>
                                    <button onclick="applyOptimization('${category.field}', \`${opt.content.replace(/`/g, '\\`')}\`)" 
                                            style="background: #667eea; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                        åº”ç”¨ä¼˜åŒ–
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
                
                <!-- ä¸€é”®åº”ç”¨ -->
                <div style="background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.05)); padding: 20px; border-radius: 12px; text-align: center;">
                    <h5 style="color: #059669; margin: 0 0 12px 0;">âš¡ å¿«é€Ÿä¼˜åŒ–</h5>
                    <button onclick="applyAllOptimizations()" 
                            style="background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 12px;">
                        åº”ç”¨æ‰€æœ‰ä¼˜åŒ–å»ºè®®
                    </button>
                    <button onclick="exportOptimizationReport()" 
                            style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        å¯¼å‡ºä¼˜åŒ–æŠ¥å‘Š
                    </button>
                </div>
            `;
            
            ModalUtils.show('ğŸš€ å…¨é¢ä¼˜åŒ–æ–¹æ¡ˆ', content, 'large');
        }

        // è¾…åŠ©å‡½æ•°
        function applyVisionSuggestion(content) {
            document.getElementById('halfyear_vision').value = content;
            MessageUtils.success('æ„¿æ™¯å»ºè®®å·²åº”ç”¨');
            ModalUtils.hide();
        }

        function addStrategicGoal(goal) {
            const container = document.getElementById('halfyear_strategic_goals');
            const currentContent = container.textContent || '';
            const newContent = currentContent ? currentContent + '\n' + goal : goal;
            container.textContent = newContent;
            TodoUtils.renderTodos(container);
            MessageUtils.success('ç›®æ ‡å·²æ·»åŠ ');
        }

        function generateBalancedGoalSet() {
            const balancedGoals = [
                '[ ] åœ¨æ ¸å¿ƒä¸“ä¸šé¢†åŸŸå®Œæˆ2ä¸ªé‡è¦é¡¹ç›®ï¼Œæå‡ä¸“ä¸šå½±å“åŠ›',
                '[ ] æŒæ¡1é¡¹æ–°æŠ€èƒ½ï¼Œè·å¾—ç›¸å…³è®¤è¯æˆ–èµ„è´¨',
                '[ ] å»ºç«‹è§„å¾‹è¿åŠ¨ä¹ æƒ¯ï¼Œæ¯å‘¨è¿åŠ¨3æ¬¡ä»¥ä¸Š',
                '[ ] æ·±åŒ–é‡è¦äººé™…å…³ç³»ï¼Œæ‰©å±•é«˜è´¨é‡ç¤¾äº¤ç½‘ç»œ'
            ];
            
            const container = document.getElementById('halfyear_strategic_goals');
            container.textContent = balancedGoals.join('\n');
            TodoUtils.renderTodos(container);
            MessageUtils.success('å¹³è¡¡ç›®æ ‡é›†å·²ç”Ÿæˆ');
            ModalUtils.hide();
        }

        function addMilestone(containerId, milestone) {
            const container = document.getElementById(containerId);
            const currentContent = container.textContent || '';
            const newContent = currentContent ? currentContent + '\n' + milestone : milestone;
            container.textContent = newContent;
            TodoUtils.renderTodos(container);
            MessageUtils.success('é‡Œç¨‹ç¢‘å·²æ·»åŠ ');
        }

        function addSkillToPlan(skillName, description) {
            const skillsField = document.getElementById('halfyear_skills');
            const currentContent = skillsField.value;
            const newSkill = `${skillName}ï¼š${description}`;
            const newContent = currentContent ? currentContent + '\nâ€¢ ' + newSkill : 'â€¢ ' + newSkill;
            skillsField.value = newContent;
            MessageUtils.success('æŠ€èƒ½å·²æ·»åŠ åˆ°å‘å±•è®¡åˆ’');
        }

        // æ•°æ®åˆ†æå‡½æ•°
        function performBalanceAnalysis(data) {
            const dimensions = [
                {
                    name: 'èŒä¸šå‘å±•',
                    icon: 'ğŸ’¼',
                    score: calculateDimensionScore(data.strategicGoals, ['èŒä¸š', 'å·¥ä½œ', 'é¡¹ç›®', 'æŠ€èƒ½'])
                },
                {
                    name: 'å¥åº·ç”Ÿæ´»',
                    icon: 'ğŸƒ',
                    score: calculateDimensionScore(data.balance, ['å¥åº·', 'è¿åŠ¨', 'ç¡çœ ', 'é¥®é£Ÿ'])
                },
                {
                    name: 'å­¦ä¹ æˆé•¿',
                    icon: 'ğŸ“š',
                    score: calculateDimensionScore(data.skills, ['å­¦ä¹ ', 'åŸ¹è®­', 'é˜…è¯»', 'è¯¾ç¨‹'])
                },
                {
                    name: 'äººé™…å…³ç³»',
                    icon: 'ğŸ¤',
                    score: calculateDimensionScore(data.balance, ['å…³ç³»', 'ç¤¾äº¤', 'æœ‹å‹', 'å®¶åº­'])
                }
            ];
            
            const insights = generateOldBalanceInsights(dimensions);
            const recommendations = generateOldBalanceRecommendations(dimensions);
            
            return { dimensions, insights, recommendations };
        }

        function calculateDimensionScore(content, keywords) {
            if (!content) return 20;
            
            const lowerContent = content.toLowerCase();
            const hasKeywords = keywords.some(keyword => lowerContent.includes(keyword));
            const wordCount = content.split(/\s+/).length;
            
            let score = 40; // åŸºç¡€åˆ†
            if (hasKeywords) score += 30; // å…³é”®è¯åŒ¹é…
            if (wordCount > 50) score += 20; // å†…å®¹ä¸°å¯Œåº¦
            if (content.includes('[x]') || content.includes('[X]')) score += 10; // æœ‰å®Œæˆé¡¹
            
            return Math.min(score, 100);
        }

        function generateOldBalanceInsights(dimensions) {
            const insights = [];
            const avgScore = dimensions.reduce((sum, dim) => sum + dim.score, 0) / dimensions.length;
            
            if (avgScore >= 80) {
                insights.push('ğŸ‰ æ•´ä½“å¹³è¡¡åº¦ä¼˜ç§€ï¼Œå„ç»´åº¦å‘å±•å‡è¡¡');
            } else if (avgScore >= 60) {
                insights.push('ğŸ“Š æ•´ä½“å¹³è¡¡åº¦è‰¯å¥½ï¼Œéƒ¨åˆ†ç»´åº¦æœ‰æå‡ç©ºé—´');
            } else {
                insights.push('âš ï¸ æ•´ä½“å¹³è¡¡åº¦åä½ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨è–„å¼±ç»´åº¦');
            }
            
            const minDim = dimensions.reduce((min, dim) => dim.score < min.score ? dim : min);
            const maxDim = dimensions.reduce((max, dim) => dim.score > max.score ? dim : max);
            
            if (maxDim.score - minDim.score > 30) {
                insights.push(`ğŸ“ˆ ${maxDim.name}å‘å±•è¾ƒå¥½ï¼Œå»ºè®®åŠ å¼º${minDim.name}çš„è§„åˆ’`);
            }
            
            dimensions.forEach(dim => {
                if (dim.score < 50) {
                    insights.push(`ğŸ¯ ${dim.name}ç»´åº¦éœ€è¦é‡ç‚¹å…³æ³¨å’Œæ”¹å–„`);
                }
            });
            
            return insights;
        }

        function generateOldBalanceRecommendations(dimensions) {
            const recommendations = [];
            
            dimensions.forEach(dim => {
                if (dim.score < 60) {
                    switch (dim.name) {
                        case 'èŒä¸šå‘å±•':
                            recommendations.push('ğŸ’¼ å»ºè®®å¢åŠ å…·ä½“çš„èŒä¸šå‘å±•ç›®æ ‡å’Œé¡¹ç›®è§„åˆ’');
                            break;
                        case 'å¥åº·ç”Ÿæ´»':
                            recommendations.push('ğŸƒ å»ºè®®åˆ¶å®šè¿åŠ¨è®¡åˆ’å’Œå¥åº·ç”Ÿæ´»ä¹ æƒ¯');
                            break;
                        case 'å­¦ä¹ æˆé•¿':
                            recommendations.push('ğŸ“š å»ºè®®å®Œå–„å­¦ä¹ è®¡åˆ’å’ŒæŠ€èƒ½å‘å±•è·¯å¾„');
                            break;
                        case 'äººé™…å…³ç³»':
                            recommendations.push('ğŸ¤ å»ºè®®å¢åŠ ç¤¾äº¤æ´»åŠ¨å’Œå…³ç³»ç»´æŠ¤è®¡åˆ’');
                            break;
                    }
                }
            });
            
            if (recommendations.length === 0) {
                recommendations.push('âœ… å½“å‰å¹³è¡¡åº¦è‰¯å¥½ï¼Œç»§ç»­ä¿æŒ');
                recommendations.push('ğŸ“ˆ å¯ä»¥è€ƒè™‘è®¾å®šæ›´å…·æŒ‘æˆ˜æ€§çš„ç›®æ ‡');
            }
            
            return recommendations;
        }

        function generateMilestones(goals) {
            return goals.map(goal => {
                const goalText = goal.replace(/^\[.\]\s*/, '');
                
                // ç®€åŒ–çš„é‡Œç¨‹ç¢‘ç”Ÿæˆé€»è¾‘
                const q1Milestones = [
                    `åˆ¶å®š${goalText}çš„è¯¦ç»†æ‰§è¡Œè®¡åˆ’`,
                    `å¯åŠ¨ç›¸å…³é¡¹ç›®å’Œå‡†å¤‡å·¥ä½œ`,
                    `å®ŒæˆåˆæœŸå…³é”®ä»»åŠ¡`
                ];
                
                const q2Milestones = [
                    `æ¨è¿›${goalText}çš„æ ¸å¿ƒå·¥ä½œ`,
                    `è¯„ä¼°è¿›å±•å¹¶è°ƒæ•´ç­–ç•¥`,
                    `å®Œæˆ${goalText}å¹¶æ€»ç»“ç»éªŒ`
                ];
                
                return {
                    goal: goal,
                    q1: q1Milestones,
                    q2: q2Milestones
                };
            });
        }

        function generateSkillSuggestions(currentSkills, strategicGoals) {
            const categories = [
                {
                    name: 'ä¸“ä¸šæŠ€èƒ½',
                    icon: 'ğŸ”§',
                    skills: [
                        {
                            name: 'é¡¹ç›®ç®¡ç†',
                            description: 'æŒæ¡é¡¹ç›®ç®¡ç†æ–¹æ³•è®ºï¼Œæå‡é¡¹ç›®æ‰§è¡Œæ•ˆç‡',
                            priority: 'high',
                            resources: ['PMPè®¤è¯', 'æ•æ·æ–¹æ³•', 'é¡¹ç›®å·¥å…·']
                        },
                        {
                            name: 'æ•°æ®åˆ†æ',
                            description: 'æå‡æ•°æ®å¤„ç†å’Œåˆ†æèƒ½åŠ›ï¼Œæ”¯æŒå†³ç­–åˆ¶å®š',
                            priority: 'medium',
                            resources: ['Excelé«˜çº§', 'Python', 'Tableau']
                        }
                    ]
                },
                {
                    name: 'è½¯æŠ€èƒ½',
                    icon: 'ğŸ§ ',
                    skills: [
                        {
                            name: 'æ²Ÿé€šè¡¨è¾¾',
                            description: 'æå‡å£å¤´å’Œä¹¦é¢æ²Ÿé€šèƒ½åŠ›ï¼Œå¢å¼ºå½±å“åŠ›',
                            priority: 'high',
                            resources: ['æ¼”è®²è®­ç»ƒ', 'å†™ä½œç»ƒä¹ ', 'åé¦ˆæ”¶é›†']
                        },
                        {
                            name: 'æ—¶é—´ç®¡ç†',
                            description: 'ä¼˜åŒ–æ—¶é—´åˆ†é…ï¼Œæé«˜å·¥ä½œæ•ˆç‡',
                            priority: 'medium',
                            resources: ['GTDæ–¹æ³•', 'ç•ªèŒ„å·¥ä½œæ³•', 'ä¼˜å…ˆçº§çŸ©é˜µ']
                        }
                    ]
                }
            ];
            
            const learningPath = `
                1. è¯„ä¼°å½“å‰æŠ€èƒ½æ°´å¹³ï¼Œè¯†åˆ«å…³é”®å·®è·
                2. åˆ¶å®šåˆ†é˜¶æ®µçš„å­¦ä¹ è®¡åˆ’ï¼Œè®¾å®šå…·ä½“ç›®æ ‡
                3. é€‰æ‹©åˆé€‚çš„å­¦ä¹ èµ„æºå’Œæ–¹æ³•
                4. é€šè¿‡å®é™…é¡¹ç›®åº”ç”¨æ–°æŠ€èƒ½
                5. å®šæœŸå›é¡¾å’Œè°ƒæ•´å­¦ä¹ ç­–ç•¥
            `;
            
            return { categories, learningPath };
        }

        function analyzeRisks(data) {
            const highRisks = [
                {
                    title: 'ç›®æ ‡è¿‡äºå®å¤§',
                    description: 'è®¾å®šçš„ç›®æ ‡å¯èƒ½è¶…å‡ºå®é™…èƒ½åŠ›èŒƒå›´ï¼Œå¯¼è‡´æ‰§è¡Œå›°éš¾',
                    mitigation: 'å°†å¤§ç›®æ ‡åˆ†è§£ä¸ºæ›´å°çš„å¯æ‰§è¡Œæ­¥éª¤ï¼Œè®¾å®šç°å®çš„é‡Œç¨‹ç¢‘'
                }
            ];
            
            const mediumRisks = [
                {
                    title: 'æ—¶é—´å®‰æ’ç´§å¼ ',
                    description: 'åŠå¹´æ—¶é—´å†…è¦å®Œæˆçš„ä»»åŠ¡è¾ƒå¤šï¼Œå¯èƒ½å­˜åœ¨æ—¶é—´å†²çª',
                    mitigation: 'ä¼˜åŒ–ä¼˜å…ˆçº§æ’åºï¼Œä¸ºé‡è¦ä»»åŠ¡é¢„ç•™å……è¶³æ—¶é—´ç¼“å†²'
                }
            ];
            
            const lowRisks = [
                {
                    title: 'åŠ¨æœºç»´æŒæŒ‘æˆ˜',
                    description: 'é•¿æœŸç›®æ ‡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°åŠ¨æœºä¸‹é™',
                    mitigation: 'è®¾ç«‹é˜¶æ®µæ€§å¥–åŠ±æœºåˆ¶ï¼Œå®šæœŸå›é¡¾æˆæœå¢å¼ºæˆå°±æ„Ÿ'
                }
            ];
            
            const managementTips = [
                'ğŸ“… å»ºç«‹å®šæœŸå›é¡¾æœºåˆ¶ï¼ŒåŠæ—¶å‘ç°å’Œåº”å¯¹é£é™©',
                'ğŸ”„ ä¿æŒè®¡åˆ’çš„çµæ´»æ€§ï¼Œæ ¹æ®æƒ…å†µè°ƒæ•´ç›®æ ‡',
                'ğŸ’ª å»ºç«‹æ”¯æŒç½‘ç»œï¼Œå¯»æ±‚ä»–äººçš„å¸®åŠ©å’Œç›‘ç£',
                'ğŸ“Š è·Ÿè¸ªå…³é”®æŒ‡æ ‡ï¼Œé‡åŒ–é£é™©ç®¡ç†æ•ˆæœ'
            ];
            
            return { highRisks, mediumRisks, lowRisks, managementTips };
        }

        function performComprehensiveOptimization(data) {
            const currentScore = 72; // ç®€åŒ–çš„å½“å‰å¾—åˆ†
            const optimizedScore = 88; // ä¼˜åŒ–åå¾—åˆ†
            const improvement = optimizedScore - currentScore;
            
            const categories = [
                {
                    name: 'æ„¿æ™¯è§„åˆ’',
                    icon: 'ğŸŒŸ',
                    field: 'halfyear_vision',
                    optimizations: [
                        {
                            title: 'å¢å¼ºæ„¿æ™¯çš„å…·ä½“æ€§',
                            description: 'å½“å‰æ„¿æ™¯è¾ƒä¸ºæŠ½è±¡ï¼Œå»ºè®®å¢åŠ æ›´å…·ä½“çš„æˆæœæè¿°',
                            impact: 'high',
                            content: 'åœ¨è¿™åŠå¹´ä¸­ï¼Œæˆ‘å°†é€šè¿‡ç³»ç»Ÿæ€§çš„åŠªåŠ›ï¼Œåœ¨èŒä¸šå‘å±•ä¸Šå®ç°çªç ´æ€§è¿›å±•...'
                        }
                    ]
                },
                {
                    name: 'ç›®æ ‡è®¾å®š',
                    icon: 'ğŸ¯',
                    field: 'halfyear_strategic_goals',
                    optimizations: [
                        {
                            title: 'ä¼˜åŒ–ç›®æ ‡çš„å¯è¡¡é‡æ€§',
                            description: 'éƒ¨åˆ†ç›®æ ‡ç¼ºå°‘é‡åŒ–æŒ‡æ ‡ï¼Œå»ºè®®å¢åŠ å…·ä½“çš„æˆåŠŸæ ‡å‡†',
                            impact: 'high',
                            content: '[ ] å®Œæˆ3ä¸ªé‡è¦é¡¹ç›®ï¼Œè·å¾—å®¢æˆ·æ»¡æ„åº¦95%ä»¥ä¸Šçš„è¯„ä»·'
                        }
                    ]
                }
            ];
            
            return { currentScore, optimizedScore, improvement, categories };
        }

        function applyOptimization(field, content) {
            const element = document.getElementById(field);
            if (element) {
                if (element.tagName === 'TEXTAREA') {
                    element.value = content;
                } else if (element.classList && element.classList.contains('todo-list-container')) {
                    element.textContent = content;
                    TodoUtils.renderTodos(element);
                }
                MessageUtils.success('ä¼˜åŒ–å»ºè®®å·²åº”ç”¨');
            }
        }

        // æ·»åŠ ç¼ºå¤±çš„è¾…åŠ©å‡½æ•°
        function applyAllMilestones() {
            const strategicGoals = getTodoContent('halfyear_strategic_goals');
            if (!strategicGoals.trim()) {
                MessageUtils.info('è¯·å…ˆè®¾å®šæˆ˜ç•¥ç›®æ ‡');
                return;
            }
            
            const goals = strategicGoals.split('\n').filter(line => line.trim() && line.includes('['));
            const milestoneBreakdown = generateMilestones(goals);
            
            let q1Content = '';
            let q2Content = '';
            
            milestoneBreakdown.forEach(breakdown => {
                breakdown.q1.forEach(milestone => {
                    q1Content += (q1Content ? '\n' : '') + '[ ] ' + milestone;
                });
                breakdown.q2.forEach(milestone => {
                    q2Content += (q2Content ? '\n' : '') + '[ ] ' + milestone;
                });
            });
            
            const q1Container = document.getElementById('quarter1_milestones');
            const q2Container = document.getElementById('quarter2_milestones');
            
            q1Container.textContent = q1Content;
            q2Container.textContent = q2Content;
            
            TodoUtils.renderTodos(q1Container);
            TodoUtils.renderTodos(q2Container);
            
            MessageUtils.success('æ‰€æœ‰é‡Œç¨‹ç¢‘å·²åº”ç”¨');
            ModalUtils.hide();
        }

        function regenerateMilestones() {
            MessageUtils.info('æ­£åœ¨é‡æ–°ç”Ÿæˆé‡Œç¨‹ç¢‘...');
            setTimeout(() => {
                generateMilestoneBreakdown();
            }, 500);
        }

        function applyAllOptimizations() {
            const currentData = getCurrentPlanData();
            const optimization = performComprehensiveOptimization(currentData);
            
            // åº”ç”¨æ„¿æ™¯ä¼˜åŒ–
            if (optimization.categories[0] && optimization.categories[0].optimizations[0]) {
                const visionOpt = optimization.categories[0].optimizations[0];
                document.getElementById('halfyear_vision').value = visionOpt.content;
            }
            
            // åº”ç”¨ç›®æ ‡ä¼˜åŒ–
            if (optimization.categories[1] && optimization.categories[1].optimizations[0]) {
                const goalOpt = optimization.categories[1].optimizations[0];
                const container = document.getElementById('halfyear_strategic_goals');
                container.textContent = goalOpt.content;
                TodoUtils.renderTodos(container);
            }
            
            MessageUtils.success('æ‰€æœ‰ä¼˜åŒ–å»ºè®®å·²åº”ç”¨');
            ModalUtils.hide();
        }

        function exportOptimizationReport() {
            const currentData = getCurrentPlanData();
            const optimization = performComprehensiveOptimization(currentData);
            
            const reportData = {
                exportDate: new Date().toISOString(),
                period: `${currentYear}å¹´${currentHalf === 1 ? 'ä¸Š' : 'ä¸‹'}åŠå¹´`,
                optimization: optimization,
                currentData: currentData
            };
            
            ExportUtils.exportToJSON(reportData, `halfyear_optimization_${currentYear}_H${currentHalf}.json`);
            MessageUtils.success('ä¼˜åŒ–æŠ¥å‘Šå·²å¯¼å‡º');
        }

        // å¢å¼ºæ™ºèƒ½åˆ†æåŠŸèƒ½
        function generateSmartInsights() {
            const currentData = getCurrentPlanData();
            const insights = performDeepAnalysis(currentData);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ§  AIæ·±åº¦æ´å¯Ÿ</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºæ‚¨çš„åŠå¹´è®¡åˆ’å†…å®¹ï¼ŒAIæä¾›æ·±åº¦åˆ†æå’Œä¸ªæ€§åŒ–æ´å¯Ÿ
                    </p>
                </div>
                
                <!-- æ•´ä½“è¯„ä¼° -->
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin: 0 0 16px 0;">ğŸ“Š æ•´ä½“è¯„ä¼°</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #667eea;">${insights.overallScore}/100</div>
                            <div style="font-size: 0.9em; color: #666;">ç»¼åˆå¾—åˆ†</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #10b981;">${insights.strengths.length}</div>
                            <div style="font-size: 0.9em; color: #666;">ä¼˜åŠ¿é¡¹</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #f59e0b;">${insights.improvements.length}</div>
                            <div style="font-size: 0.9em; color: #666;">æ”¹è¿›é¡¹</div>
                        </div>
                    </div>
                </div>
                
                <!-- ä¼˜åŠ¿åˆ†æ -->
                ${insights.strengths.length > 0 ? `
                <div style="background: #f0fdf4; border: 1px solid #10b981; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #059669; margin: 0 0 16px 0;">âœ… å‘ç°çš„ä¼˜åŠ¿</h5>
                    <div style="display: grid; gap: 8px;">
                        ${insights.strengths.map(strength => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #10b981;">
                                ${strength}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- æ”¹è¿›å»ºè®® -->
                ${insights.improvements.length > 0 ? `
                <div style="background: #fffbeb; border: 1px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #d97706; margin: 0 0 16px 0;">ğŸ”§ æ”¹è¿›æœºä¼š</h5>
                    <div style="display: grid; gap: 8px;">
                        ${insights.improvements.map(improvement => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #f59e0b;">
                                ${improvement}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- ä¸ªæ€§åŒ–å»ºè®® -->
                <div style="background: #e0f2fe; border: 1px solid #0288d1; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #01579b; margin: 0 0 16px 0;">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h5>
                    <div style="display: grid; gap: 8px;">
                        ${insights.personalizedTips.map(tip => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #0288d1;">
                                ${tip}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ§  AIæ·±åº¦æ´å¯Ÿ', content, 'large');
        }

        function performDeepAnalysis(data) {
            const analysis = {
                overallScore: 75,
                strengths: [],
                improvements: [],
                personalizedTips: []
            };
            
            // åˆ†ææ„¿æ™¯
            if (data.vision && data.vision.length > 100) {
                analysis.strengths.push('âœ¨ æ„¿æ™¯æè¿°è¯¦ç»†ï¼Œå…·æœ‰å¾ˆå¥½çš„æŒ‡å¯¼æ€§');
                analysis.overallScore += 5;
            } else if (data.vision && data.vision.length > 50) {
                analysis.improvements.push('ğŸŒŸ æ„¿æ™¯å¯ä»¥æ›´åŠ å…·ä½“å’Œé¼“èˆäººå¿ƒ');
            } else {
                analysis.improvements.push('ğŸŒŸ å»ºè®®è®¾å®šæ¸…æ™°çš„åŠå¹´æ„¿æ™¯ä½œä¸ºè¡ŒåŠ¨æŒ‡å—');
            }
            
            // åˆ†ææˆ˜ç•¥ç›®æ ‡
            const strategicGoals = data.strategicGoals ? data.strategicGoals.split('\n').filter(line => line.includes('[')).length : 0;
            if (strategicGoals >= 3 && strategicGoals <= 5) {
                analysis.strengths.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡æ•°é‡åˆç†ï¼Œä¾¿äºèšç„¦æ‰§è¡Œ');
                analysis.overallScore += 5;
            } else if (strategicGoals > 5) {
                analysis.improvements.push('ğŸ¯ æˆ˜ç•¥ç›®æ ‡è¾ƒå¤šï¼Œå»ºè®®èšç„¦æœ€é‡è¦çš„3-5ä¸ª');
            } else if (strategicGoals > 0) {
                analysis.improvements.push('ğŸ¯ å¯ä»¥å¢åŠ æ›´å¤šç»´åº¦çš„æˆ˜ç•¥ç›®æ ‡');
            }
            
            // åˆ†æé¡¹ç›®è§„åˆ’
            const projects = data.projects ? data.projects.split('\n').filter(line => line.includes('[')).length : 0;
            if (projects > 0) {
                analysis.strengths.push('ğŸ—ï¸ æœ‰å…·ä½“çš„é¡¹ç›®è§„åˆ’æ”¯æ’‘ç›®æ ‡å®ç°');
                analysis.overallScore += 5;
            } else {
                analysis.improvements.push('ğŸ—ï¸ å»ºè®®ä¸ºæˆ˜ç•¥ç›®æ ‡è®¾è®¡å…·ä½“çš„æ‰§è¡Œé¡¹ç›®');
            }
            
            // åˆ†ææŠ€èƒ½å‘å±•
            if (data.skills && data.skills.length > 100) {
                analysis.strengths.push('ğŸ“ˆ æŠ€èƒ½å‘å±•è§„åˆ’è¯¦ç»†ï¼Œæœ‰åˆ©äºèƒ½åŠ›æå‡');
                analysis.overallScore += 5;
            } else {
                analysis.improvements.push('ğŸ“ˆ å»ºè®®å®Œå–„æŠ€èƒ½å‘å±•å’Œå­¦ä¹ è®¡åˆ’');
            }
            
            // åˆ†æå·¥ä½œç”Ÿæ´»å¹³è¡¡
            const balanceItems = data.balance ? data.balance.split('\n').filter(line => line.includes('[')).length : 0;
            if (balanceItems > 0) {
                analysis.strengths.push('âš–ï¸ å…³æ³¨å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œæœ‰åˆ©äºå¯æŒç»­å‘å±•');
                analysis.overallScore += 5;
            } else {
                analysis.improvements.push('âš–ï¸ å»ºè®®å¢åŠ å·¥ä½œç”Ÿæ´»å¹³è¡¡çš„å…·ä½“æªæ–½');
            }
            
            // ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
            analysis.personalizedTips = [
                'ğŸ“… å»ºè®®æ¯æœˆè¿›è¡Œä¸€æ¬¡è®¡åˆ’å›é¡¾å’Œè°ƒæ•´',
                'ğŸ¯ ä¸ºæ¯ä¸ªç›®æ ‡è®¾å®šå…·ä½“çš„æˆåŠŸæŒ‡æ ‡',
                'ğŸ“Š å»ºç«‹è¿›åº¦è·Ÿè¸ªæœºåˆ¶ï¼Œä¿æŒæ‰§è¡ŒåŠ¨åŠ›',
                'ğŸ¤ å¯»æ‰¾å¿—åŒé“åˆçš„ä¼™ä¼´ï¼Œäº’ç›¸ç›‘ç£æ”¯æŒ',
                'ğŸ‰ è®¾ç«‹é‡Œç¨‹ç¢‘åº†ç¥æœºåˆ¶ï¼Œå¢å¼ºæˆå°±æ„Ÿ'
            ];
            
            return analysis;
        }

        // AIå­¦ä¹ å’Œé€‚åº”åŠŸèƒ½
        function adaptivePlanning() {
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ¤– è‡ªé€‚åº”è§„åˆ’</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        AIæ ¹æ®æ‚¨çš„ä½¿ç”¨ä¹ æƒ¯å’Œåé¦ˆï¼ŒæŒç»­ä¼˜åŒ–è§„åˆ’å»ºè®®
                    </p>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #667eea; margin: 0 0 16px 0;">ğŸ“Š ä½¿ç”¨æ¨¡å¼åˆ†æ</h5>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: white; border-radius: 8px;">
                            <strong>åå¥½çš„ç›®æ ‡ç±»å‹ï¼š</strong> èŒä¸šå‘å±•å¯¼å‘
                        </div>
                        <div style="padding: 12px; background: white; border-radius: 8px;">
                            <strong>è§„åˆ’é£æ ¼ï¼š</strong> è¯¦ç»†å‹è§„åˆ’è€…
                        </div>
                        <div style="padding: 12px; background: white; border-radius: 8px;">
                            <strong>æ‰§è¡Œç‰¹ç‚¹ï¼š</strong> é‡è§†é‡Œç¨‹ç¢‘åˆ†è§£
                        </div>
                    </div>
                </div>
                
                <div style="background: #f0fdf4; border: 1px solid #10b981; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #059669; margin: 0 0 16px 0;">ğŸ¯ ä¸ªæ€§åŒ–ä¼˜åŒ–å»ºè®®</h5>
                    <div style="display: grid; gap: 8px;">
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            åŸºäºæ‚¨çš„åå¥½ï¼Œå»ºè®®å¢åŠ æ›´å¤šèŒä¸šå‘å±•ç›¸å…³çš„ç›®æ ‡
                        </div>
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            æ‚¨å€¾å‘äºè¯¦ç»†è§„åˆ’ï¼Œå»ºè®®ä¸ºæ¯ä¸ªç›®æ ‡åˆ¶å®šå…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤
                        </div>
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            å»ºè®®è®¾ç½®æ›´å¤šçš„ä¸­æœŸæ£€æŸ¥ç‚¹ï¼Œç¬¦åˆæ‚¨çš„æ‰§è¡Œé£æ ¼
                        </div>
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ¤– è‡ªé€‚åº”è§„åˆ’', content, 'large');
        }

        // æ·»åŠ æ›´å¤šAIåŠŸèƒ½åˆ°ä¸»ç•Œé¢
        function addAIFeaturesToInterface() {
            // åœ¨AIåŠ©æ‰‹ä¸»ç•Œé¢æ·»åŠ æ›´å¤šåŠŸèƒ½æŒ‰é’®
            const additionalFeatures = `
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e7ff;">
                    <h5 style="color: #667eea; margin: 0 0 16px 0; text-align: center;">ğŸ”¬ é«˜çº§AIåŠŸèƒ½</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="ai-feature-btn" onclick="generateSmartInsights()" style="padding: 16px;">
                            <div class="feature-icon">ğŸ§ </div>
                            <div class="feature-title">æ·±åº¦æ´å¯Ÿ</div>
                            <div class="feature-desc">AIæ·±åº¦åˆ†æè®¡åˆ’</div>
                        </button>
                        
                        <button class="ai-feature-btn" onclick="adaptivePlanning()" style="padding: 16px;">
                            <div class="feature-icon">ğŸ¤–</div>
                            <div class="feature-title">è‡ªé€‚åº”è§„åˆ’</div>
                            <div class="feature-desc">ä¸ªæ€§åŒ–ä¼˜åŒ–å»ºè®®</div>
                        </button>
                        
                        <button class="ai-feature-btn" onclick="generateExecutionPlan()" style="padding: 16px;">
                            <div class="feature-icon">ğŸ“‹</div>
                            <div class="feature-title">æ‰§è¡Œè®¡åˆ’</div>
                            <div class="feature-desc">ç”Ÿæˆè¯¦ç»†æ‰§è¡Œæ­¥éª¤</div>
                        </button>
                    </div>
                </div>
            `;
            return additionalFeatures;
        }

        // ç”Ÿæˆè¯¦ç»†æ‰§è¡Œè®¡åˆ’
        function generateExecutionPlan() {
            const currentData = getCurrentPlanData();
            const executionPlan = createDetailedExecutionPlan(currentData);
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #667eea; margin-bottom: 16px;">ğŸ“‹ AIæ‰§è¡Œè®¡åˆ’ç”Ÿæˆ</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºæ‚¨çš„åŠå¹´è®¡åˆ’ï¼ŒAIä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„æ‰§è¡Œè·¯å¾„å’Œæ—¶é—´å®‰æ’
                    </p>
                </div>
                
                <!-- æ‰§è¡Œæ—¶é—´è½´ -->
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.05), rgba(255,255,255,0.8)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #374151; margin: 0 0 16px 0;">ğŸ“… æ‰§è¡Œæ—¶é—´è½´</h5>
                    <div style="position: relative;">
                        ${executionPlan.timeline.map((phase, index) => `
                            <div style="display: flex; align-items: flex-start; margin-bottom: 20px; position: relative;">
                                <div style="flex-shrink: 0; width: 40px; height: 40px; background: ${phase.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 16px; z-index: 2;">
                                    ${index + 1}
                                </div>
                                ${index < executionPlan.timeline.length - 1 ? `
                                    <div style="position: absolute; left: 19px; top: 40px; width: 2px; height: 40px; background: #e0e7ff; z-index: 1;"></div>
                                ` : ''}
                                <div style="flex: 1; background: white; padding: 16px; border-radius: 8px; border: 1px solid #e0e7ff;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                        <h6 style="margin: 0; color: #374151;">${phase.title}</h6>
                                        <span style="background: ${phase.color}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                            ${phase.duration}
                                        </span>
                                    </div>
                                    <div style="color: #6b7280; font-size: 0.9em; margin-bottom: 12px;">${phase.description}</div>
                                    <div style="display: grid; gap: 4px;">
                                        ${phase.tasks.map(task => `
                                            <div style="padding: 4px 8px; background: rgba(102,126,234,0.05); border-radius: 4px; font-size: 0.85em;">
                                                â€¢ ${task}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- å…³é”®æˆåŠŸå› ç´  -->
                <div style="background: #f0fdf4; border: 1px solid #10b981; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #059669; margin: 0 0 16px 0;">ğŸ”‘ å…³é”®æˆåŠŸå› ç´ </h5>
                    <div style="display: grid; gap: 8px;">
                        ${executionPlan.successFactors.map(factor => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #10b981;">
                                ${factor}
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- é£é™©é¢„è­¦ -->
                <div style="background: #fffbeb; border: 1px solid #f59e0b; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #d97706; margin: 0 0 16px 0;">âš ï¸ é£é™©é¢„è­¦ä¸åº”å¯¹</h5>
                    <div style="display: grid; gap: 8px;">
                        ${executionPlan.riskMitigation.map(risk => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #f59e0b;">
                                ${risk}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ“‹ AIæ‰§è¡Œè®¡åˆ’', content, 'large');
        }

        function createDetailedExecutionPlan(data) {
            const timeline = [
                {
                    title: 'è§„åˆ’ç¡®è®¤é˜¶æ®µ',
                    duration: 'ç¬¬1å‘¨',
                    color: '#667eea',
                    description: 'å®Œå–„å’Œç¡®è®¤åŠå¹´è®¡åˆ’çš„å„é¡¹ç»†èŠ‚',
                    tasks: [
                        'å®¡æŸ¥å’Œä¼˜åŒ–æ„¿æ™¯è¡¨è¿°',
                        'ç¡®è®¤æˆ˜ç•¥ç›®æ ‡çš„ä¼˜å…ˆçº§',
                        'åˆ¶å®šè¯¦ç»†çš„é‡Œç¨‹ç¢‘æ—¶é—´è¡¨',
                        'å‡†å¤‡å¿…è¦çš„èµ„æºå’Œå·¥å…·'
                    ]
                },
                {
                    title: 'å¯åŠ¨å®æ–½é˜¶æ®µ',
                    duration: 'ç¬¬2-4å‘¨',
                    color: '#10b981',
                    description: 'å¼€å§‹æ‰§è¡Œè®¡åˆ’å¹¶å»ºç«‹å·¥ä½œèŠ‚å¥',
                    tasks: [
                        'å¯åŠ¨ç¬¬ä¸€ä¸ªé‡ç‚¹é¡¹ç›®',
                        'å»ºç«‹æ—¥å¸¸å’Œå‘¨åº¦å›é¡¾æœºåˆ¶',
                        'å¼€å§‹æŠ€èƒ½å­¦ä¹ è®¡åˆ’',
                        'è®¾ç«‹è¿›åº¦è·Ÿè¸ªç³»ç»Ÿ'
                    ]
                },
                {
                    title: 'æ·±åŒ–æ¨è¿›é˜¶æ®µ',
                    duration: 'ç¬¬2-4ä¸ªæœˆ',
                    color: '#f59e0b',
                    description: 'å…¨é¢æ¨è¿›å„é¡¹ç›®æ ‡çš„å®æ–½',
                    tasks: [
                        'åŠ é€Ÿé¡¹ç›®æ‰§è¡Œè¿›åº¦',
                        'æ·±åŒ–æŠ€èƒ½å­¦ä¹ å’Œå®è·µ',
                        'æ‰©å±•èŒä¸šç½‘ç»œå»ºè®¾',
                        'ä¼˜åŒ–å·¥ä½œç”Ÿæ´»å¹³è¡¡æªæ–½'
                    ]
                },
                {
                    title: 'å†²åˆºæ”¶å®˜é˜¶æ®µ',
                    duration: 'ç¬¬5-6ä¸ªæœˆ',
                    color: '#ef4444',
                    description: 'å†²åˆºå®Œæˆç›®æ ‡å¹¶æ€»ç»“ç»éªŒ',
                    tasks: [
                        'å®Œæˆå…³é”®é¡¹ç›®äº¤ä»˜',
                        'è¾¾æˆè®¾å®šçš„æŠ€èƒ½ç›®æ ‡',
                        'è¿›è¡Œå…¨é¢çš„æˆæœè¯„ä¼°',
                        'æ€»ç»“ç»éªŒå’Œæœ€ä½³å®è·µ'
                    ]
                }
            ];
            
            const successFactors = [
                'ğŸ¯ ä¿æŒå¯¹æ ¸å¿ƒç›®æ ‡çš„ä¸“æ³¨ï¼Œé¿å…åˆ†æ•£æ³¨æ„åŠ›',
                'ğŸ“… ä¸¥æ ¼æ‰§è¡Œæ—¶é—´ç®¡ç†ï¼Œåˆç†åˆ†é…ç²¾åŠ›',
                'ğŸ”„ å»ºç«‹å®šæœŸå›é¡¾æœºåˆ¶ï¼ŒåŠæ—¶è°ƒæ•´ç­–ç•¥',
                'ğŸ’ª åŸ¹å…»æŒç»­å­¦ä¹ çš„ä¹ æƒ¯ï¼Œä¸æ–­æå‡èƒ½åŠ›',
                'ğŸ¤ ç§¯æå¯»æ±‚æ”¯æŒå’Œåé¦ˆï¼Œå»ºç«‹é—®è´£æœºåˆ¶'
            ];
            
            const riskMitigation = [
                'â° æ—¶é—´ä¸è¶³é£é™©ï¼šé¢„ç•™20%çš„æ—¶é—´ç¼“å†²ï¼Œä¼˜å…ˆå®Œæˆæ ¸å¿ƒç›®æ ‡',
                'ğŸ”¥ åŠ¨æœºä¸‹é™é£é™©ï¼šè®¾ç«‹é˜¶æ®µæ€§å¥–åŠ±ï¼Œå®šæœŸå›é¡¾æˆæœå¢å¼ºä¿¡å¿ƒ',
                'ğŸ“Š ç›®æ ‡åç¦»é£é™©ï¼šå»ºç«‹æœˆåº¦æ£€æŸ¥æœºåˆ¶ï¼ŒåŠæ—¶çº å',
                'ğŸš§ å¤–éƒ¨å¹²æ‰°é£é™©ï¼šåˆ¶å®šåº”æ€¥é¢„æ¡ˆï¼Œä¿æŠ¤æ ¸å¿ƒå·¥ä½œæ—¶é—´',
                'ğŸ’¡ èƒ½åŠ›ä¸è¶³é£é™©ï¼šæå‰è¯†åˆ«æŠ€èƒ½ç¼ºå£ï¼Œå¯»æ±‚å­¦ä¹ å’Œå¸®åŠ©'
            ];
            
            return { timeline, successFactors, riskMitigation };
        }

        // æ›´æ–°AIåŠ©æ‰‹ä¸»ç•Œé¢ï¼ŒåŒ…å«æ–°åŠŸèƒ½
        function showHalfyearAIAssistantEnhanced() {
            const aiContent = `
                <div style="text-align: center; margin-bottom: 24px;">
                    <h3 style="color: #667eea; margin-bottom: 16px;">ğŸ¤– åŠå¹´è§„åˆ’AIåŠ©æ‰‹</h3>
                    <p style="color: #666; font-size: 0.95em;">è®©AIå¸®åŠ©æ‚¨åˆ¶å®šå’Œä¼˜åŒ–åŠå¹´è®¡åˆ’</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <button class="ai-feature-btn" onclick="generateVisionSuggestions()">
                        <div class="feature-icon">ğŸŒŸ</div>
                        <div class="feature-title">æ„¿æ™¯è§„åˆ’åŠ©æ‰‹</div>
                        <div class="feature-desc">AIååŠ©åˆ¶å®šåŠå¹´æ„¿æ™¯</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateStrategicGoals()">
                        <div class="feature-icon">ğŸ¯</div>
                        <div class="feature-title">æˆ˜ç•¥ç›®æ ‡ç”Ÿæˆ</div>
                        <div class="feature-desc">æ™ºèƒ½ç”ŸæˆSMARTç›®æ ‡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="analyzeHalfyearBalance()">
                        <div class="feature-icon">âš–ï¸</div>
                        <div class="feature-title">å¹³è¡¡åº¦åˆ†æ</div>
                        <div class="feature-desc">åˆ†æå·¥ä½œç”Ÿæ´»å¹³è¡¡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateMilestoneBreakdown()">
                        <div class="feature-icon">ğŸ“…</div>
                        <div class="feature-title">é‡Œç¨‹ç¢‘åˆ†è§£</div>
                        <div class="feature-desc">æ™ºèƒ½åˆ†è§£å­£åº¦ç›®æ ‡</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="suggestSkillDevelopment()">
                        <div class="feature-icon">ğŸ“ˆ</div>
                        <div class="feature-title">èƒ½åŠ›å‘å±•å»ºè®®</div>
                        <div class="feature-desc">ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„</div>
                    </button>
                    
                    <button class="ai-feature-btn" onclick="generateRiskAssessment()">
                        <div class="feature-icon">ğŸ›¡ï¸</div>
                        <div class="feature-title">é£é™©è¯„ä¼°</div>
                        <div class="feature-desc">è¯†åˆ«æ½œåœ¨æŒ‘æˆ˜</div>
                    </button>
                </div>
                
                ${addAIFeaturesToInterface()}
                
                <div style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1)); padding: 16px; border-radius: 12px; text-align: center;">
                    <div style="color: #667eea; font-weight: 600; margin-bottom: 8px;">ğŸš€ ä¸€é”®ä¼˜åŒ–</div>
                    <button class="btn-main" onclick="comprehensiveHalfyearOptimization()" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white;">
                        å…¨é¢ä¼˜åŒ–åŠå¹´è®¡åˆ’
                    </button>
                </div>
                
                <style>
                    .ai-feature-btn {
                        background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
                        border: 2px solid #e0e7ff;
                        border-radius: 12px;
                        padding: 20px 16px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
                    }
                    .ai-feature-btn:hover {
                        border-color: #667eea;
                        transform: translateY(-3px);
                        box-shadow: 0 8px 24px rgba(102,126,234,0.15);
                        background: linear-gradient(135deg, rgba(255,255,255,1), rgba(248,250,252,1));
                    }
                    .feature-icon { 
                        font-size: 2.2em; 
                        margin-bottom: 12px; 
                        display: block;
                    }
                    .feature-title { 
                        font-weight: 600; 
                        color: #374151; 
                        margin-bottom: 6px; 
                        font-size: 1.05em;
                    }
                    .feature-desc { 
                        font-size: 0.9em; 
                        color: #6b7280; 
                        line-height: 1.4;
                    }
                </style>
            `;
            
            ModalUtils.show('ğŸ¤– åŠå¹´è§„åˆ’AIåŠ©æ‰‹', aiContent, 'large');
        }

        // === é¡¹ç›®è§„åˆ’åŠŸèƒ½å®ç° ===
        function generateProjectPlanningGuide(currentData) {
            const strategicGoals = currentData.strategicGoals || '';
            const currentProjects = currentData.projects || '';
            const projectAnalysis = analyzeCurrentProjects(strategicGoals, currentProjects);
            
            return `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #9c27b0; margin-bottom: 16px;">ğŸ“‹ AIé¡¹ç›®è§„åˆ’åŠ©æ‰‹</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºæ‚¨çš„æˆ˜ç•¥ç›®æ ‡ï¼ŒAIä¸ºæ‚¨è®¾è®¡ç§‘å­¦çš„é¡¹ç›®è§„åˆ’æ–¹æ¡ˆ
                    </p>
                </div>
                
                <!-- é¡¹ç›®è§„åˆ’æ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, rgba(156,39,176,0.1), rgba(142,36,170,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin: 0 0 16px 0;">ğŸ“Š é¡¹ç›®è§„åˆ’çŠ¶æ€</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #9c27b0;">${projectAnalysis.currentProjectCount}</div>
                            <div style="font-size: 0.9em; color: #666;">å½“å‰é¡¹ç›®</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4caf50;">${projectAnalysis.recommendedCount}</div>
                            <div style="font-size: 0.9em; color: #666;">å»ºè®®é¡¹ç›®æ•°</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: ${projectAnalysis.balanceScore >= 80 ? '#4caf50' : projectAnalysis.balanceScore >= 60 ? '#ff9800' : '#f44336'};">${projectAnalysis.balanceScore}%</div>
                            <div style="font-size: 0.9em; color: #666;">å¹³è¡¡åº¦è¯„åˆ†</div>
                        </div>
                    </div>
                </div>
                
                <!-- é¡¹ç›®åˆ†ç±»å»ºè®® -->
                <div style="background: white; border: 1px solid #e1bee7; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin: 0 0 16px 0;">ğŸ—ï¸ é¡¹ç›®åˆ†ç±»è§„åˆ’</h5>
                    <div style="display: grid; gap: 16px;">
                        ${generateProjectCategories().map(category => `
                            <div style="border: 1px solid #f3e5f5; border-radius: 8px; padding: 16px; background: rgba(156,39,176,0.02);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h6 style="margin: 0; color: #7b1fa2; display: flex; align-items: center; gap: 8px;">
                                        ${category.icon} ${category.name}
                                    </h6>
                                    <span style="background: ${category.priority === 'high' ? '#f44336' : category.priority === 'medium' ? '#ff9800' : '#4caf50'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                        ${category.priority === 'high' ? 'é«˜ä¼˜å…ˆçº§' : category.priority === 'medium' ? 'ä¸­ä¼˜å…ˆçº§' : 'ä½ä¼˜å…ˆçº§'}
                                    </span>
                                </div>
                                <div style="color: #666; font-size: 0.9em; margin-bottom: 12px;">${category.description}</div>
                                <div style="display: grid; gap: 8px;">
                                    ${category.examples.map(example => `
                                        <div style="padding: 8px 12px; background: white; border-radius: 6px; border: 1px solid #f0f0f0; font-size: 0.9em;">
                                            ğŸ“Œ ${example}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- é¡¹ç›®ç®¡ç†æ–¹æ³•è®º -->
                <div style="background: #f3e5f5; border: 1px solid #9c27b0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin: 0 0 16px 0;">ğŸ“š æ¨èé¡¹ç›®ç®¡ç†æ–¹æ³•</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
                        ${generateProjectMethodologies().map(method => `
                            <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e1bee7;">
                                <h6 style="margin: 0 0 8px 0; color: #7b1fa2;">${method.name}</h6>
                                <div style="color: #666; font-size: 0.9em; margin-bottom: 12px;">${method.description}</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="background: rgba(156,39,176,0.1); color: #7b1fa2; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                        ${method.suitableFor}
                                    </span>
                                    <button onclick="learnMoreAbout('${method.id}')" style="background: #9c27b0; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8em;">
                                        äº†è§£æ›´å¤š
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- é¡¹ç›®æ—¶é—´å®‰æ’ -->
                <div style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #f57c00; margin: 0 0 16px 0;">â° é¡¹ç›®æ—¶é—´å®‰æ’å»ºè®®</h5>
                    <div style="display: grid; gap: 12px;">
                        ${generateTimeAllocationSuggestions().map(suggestion => `
                            <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid #ff9800;">
                                <div style="font-weight: 600; color: #f57c00; margin-bottom: 4px;">${suggestion.phase}</div>
                                <div style="color: #666; font-size: 0.9em;">${suggestion.advice}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function analyzeCurrentProjects(strategicGoals, currentProjects) {
            const goalCount = strategicGoals ? strategicGoals.split('\n').filter(line => line.includes('[')).length : 0;
            const projectCount = currentProjects ? currentProjects.split('\n').filter(line => line.includes('[')).length : 0;
            
            const recommendedCount = Math.max(3, Math.min(goalCount * 1.5, 8));
            const balanceScore = goalCount > 0 ? Math.min(100, (projectCount / goalCount) * 60 + 40) : 20;
            
            return {
                currentProjectCount: projectCount,
                recommendedCount: Math.round(recommendedCount),
                balanceScore: Math.round(balanceScore)
            };
        }

        function generateProjectCategories() {
            return [
                {
                    name: 'æ ¸å¿ƒä¸šåŠ¡é¡¹ç›®',
                    icon: 'ğŸ¯',
                    priority: 'high',
                    description: 'ç›´æ¥æ”¯æ’‘æˆ˜ç•¥ç›®æ ‡å®ç°çš„å…³é”®é¡¹ç›®',
                    examples: [
                        'æå‡æ ¸å¿ƒæŠ€èƒ½çš„ä¸“ä¸šé¡¹ç›®',
                        'å»ºç«‹ä¸ªäººå“ç‰Œçš„å†…å®¹åˆ›ä½œé¡¹ç›®',
                        'æ‰©å±•èŒä¸šç½‘ç»œçš„è¡Œä¸šå‚ä¸é¡¹ç›®'
                    ]
                },
                {
                    name: 'èƒ½åŠ›å»ºè®¾é¡¹ç›®',
                    icon: 'ğŸ“ˆ',
                    priority: 'high',
                    description: 'æå‡ä¸ªäººèƒ½åŠ›å’Œç«äº‰åŠ›çš„å‘å±•æ€§é¡¹ç›®',
                    examples: [
                        'ç³»ç»Ÿå­¦ä¹ æ–°æŠ€èƒ½çš„åŸ¹è®­é¡¹ç›®',
                        'è·å¾—ä¸“ä¸šè®¤è¯çš„è€ƒè¯é¡¹ç›®',
                        'å»ºç«‹çŸ¥è¯†ä½“ç³»çš„ç ”ç©¶é¡¹ç›®'
                    ]
                },
                {
                    name: 'åˆ›æ–°æ¢ç´¢é¡¹ç›®',
                    icon: 'ğŸ’¡',
                    priority: 'medium',
                    description: 'æ¢ç´¢æ–°æœºä¼šå’Œå¯èƒ½æ€§çš„å®éªŒæ€§é¡¹ç›®',
                    examples: [
                        'å°è¯•æ–°é¢†åŸŸçš„è¯•ç‚¹é¡¹ç›®',
                        'å¼€å‘å‰¯ä¸šçš„å­µåŒ–é¡¹ç›®',
                        'åˆ›æ–°æ–¹æ³•çš„å®éªŒé¡¹ç›®'
                    ]
                },
                {
                    name: 'ç”Ÿæ´»ä¼˜åŒ–é¡¹ç›®',
                    icon: 'âš–ï¸',
                    priority: 'medium',
                    description: 'æ”¹å–„ç”Ÿæ´»è´¨é‡å’Œå·¥ä½œæ•ˆç‡çš„æ”¯æŒæ€§é¡¹ç›®',
                    examples: [
                        'å»ºç«‹å¥åº·ä¹ æƒ¯çš„ç”Ÿæ´»é¡¹ç›®',
                        'ä¼˜åŒ–å·¥ä½œæµç¨‹çš„æ•ˆç‡é¡¹ç›®',
                        'æ”¹å–„äººé™…å…³ç³»çš„ç¤¾äº¤é¡¹ç›®'
                    ]
                }
            ];
        }

        function generateProjectMethodologies() {
            return [
                {
                    id: 'agile',
                    name: 'ğŸ”„ æ•æ·æ–¹æ³•',
                    description: 'é€‚åˆéœ€æ±‚å˜åŒ–é¢‘ç¹ã€éœ€è¦å¿«é€Ÿè¿­ä»£çš„é¡¹ç›®',
                    suitableFor: 'æŠ€èƒ½å­¦ä¹ é¡¹ç›®'
                },
                {
                    id: 'waterfall',
                    name: 'ğŸ“Š ç€‘å¸ƒæ¨¡å‹',
                    description: 'é€‚åˆéœ€æ±‚æ˜ç¡®ã€æ­¥éª¤æ¸…æ™°çš„ä¼ ç»Ÿé¡¹ç›®',
                    suitableFor: 'è®¤è¯è€ƒè¯•é¡¹ç›®'
                },
                {
                    id: 'kanban',
                    name: 'ğŸ“‹ çœ‹æ¿æ–¹æ³•',
                    description: 'é€‚åˆæŒç»­æ€§å·¥ä½œã€éœ€è¦å¯è§†åŒ–ç®¡ç†çš„é¡¹ç›®',
                    suitableFor: 'ä¹ æƒ¯å…»æˆé¡¹ç›®'
                },
                {
                    id: 'design_thinking',
                    name: 'ğŸ’¡ è®¾è®¡æ€ç»´',
                    description: 'é€‚åˆåˆ›æ–°æ€§ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„é¡¹ç›®',
                    suitableFor: 'åˆ›æ–°æ¢ç´¢é¡¹ç›®'
                }
            ];
        }

        function generateTimeAllocationSuggestions() {
            return [
                {
                    phase: 'é¡¹ç›®å¯åŠ¨æœŸ (ç¬¬1-2å‘¨)',
                    advice: 'é‡ç‚¹è¿›è¡Œé¡¹ç›®è§„åˆ’ã€èµ„æºå‡†å¤‡å’Œå›¢é˜Ÿç»„å»ºï¼Œå ç”¨æ€»æ—¶é—´çš„15-20%'
                },
                {
                    phase: 'é¡¹ç›®æ‰§è¡ŒæœŸ (ç¬¬3-20å‘¨)',
                    advice: 'æ ¸å¿ƒæ‰§è¡Œé˜¶æ®µï¼ŒæŒ‰é‡Œç¨‹ç¢‘æ¨è¿›ï¼Œå ç”¨æ€»æ—¶é—´çš„60-70%'
                },
                {
                    phase: 'é¡¹ç›®æ”¶å°¾æœŸ (ç¬¬21-24å‘¨)',
                    advice: 'æˆæœäº¤ä»˜ã€ç»éªŒæ€»ç»“å’ŒçŸ¥è¯†æ²‰æ·€ï¼Œå ç”¨æ€»æ—¶é—´çš„10-15%'
                },
                {
                    phase: 'ç¼“å†²æ—¶é—´ (è´¯ç©¿å…¨ç¨‹)',
                    advice: 'é¢„ç•™10-15%çš„æ—¶é—´ä½œä¸ºç¼“å†²ï¼Œåº”å¯¹çªå‘æƒ…å†µå’Œé£é™©'
                }
            ];
        }

        function generateProjectTemplates() {
            const templates = generateProjectTemplateContent();
            
            const content = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #9c27b0; margin-bottom: 16px;">ğŸ“‹ é¡¹ç›®æ¨¡æ¿ç”Ÿæˆå™¨</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        é€‰æ‹©é€‚åˆçš„é¡¹ç›®æ¨¡æ¿ï¼Œå¿«é€Ÿå¯åŠ¨æ‚¨çš„åŠå¹´é¡¹ç›®è§„åˆ’
                    </p>
                </div>
                
                <div style="display: grid; gap: 20px;">
                    ${templates.map(template => `
                        <div style="border: 1px solid #e1bee7; border-radius: 12px; padding: 20px; background: rgba(156,39,176,0.02);">
                            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 16px;">
                                <h5 style="margin: 0; color: #7b1fa2; display: flex; align-items: center; gap: 8px;">
                                    ${template.icon} ${template.name}
                                </h5>
                                <button onclick="applyProjectTemplate('${template.id}')" 
                                        style="background: #9c27b0; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em;">
                                    ä½¿ç”¨æ¨¡æ¿
                                </button>
                            </div>
                            <div style="color: #666; font-size: 0.9em; margin-bottom: 16px;">${template.description}</div>
                            <div style="background: white; padding: 12px; border-radius: 6px; border: 1px solid #f0f0f0;">
                                <div style="font-weight: 600; color: #7b1fa2; margin-bottom: 8px;">é¡¹ç›®å†…å®¹é¢„è§ˆ:</div>
                                <div style="font-family: monospace; font-size: 0.85em; color: #333; white-space: pre-line;">${template.preview}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            ModalUtils.show('ğŸ“‹ é¡¹ç›®æ¨¡æ¿', content, 'large');
        }

        function generateProjectTemplateContent() {
            return [
                {
                    id: 'skill_development',
                    name: 'æŠ€èƒ½æå‡é¡¹ç›®',
                    icon: 'ğŸ“ˆ',
                    description: 'ç³»ç»Ÿæ€§æå‡ä¸“ä¸šæŠ€èƒ½æˆ–å­¦ä¹ æ–°æŠ€èƒ½çš„é¡¹ç›®æ¨¡æ¿',
                    preview: `[ ] æŠ€èƒ½è¯„ä¼°å’Œå­¦ä¹ ç›®æ ‡è®¾å®š
[ ] åˆ¶å®šè¯¦ç»†çš„å­¦ä¹ è®¡åˆ’å’Œæ—¶é—´è¡¨
[ ] é€‰æ‹©å­¦ä¹ èµ„æºï¼ˆè¯¾ç¨‹ã€ä¹¦ç±ã€å®è·µæœºä¼šï¼‰
[ ] å¼€å§‹ç³»ç»Ÿæ€§å­¦ä¹ å’Œç»ƒä¹ 
[ ] è¿›è¡Œé˜¶æ®µæ€§æµ‹è¯•å’Œè¯„ä¼°
[ ] å®ŒæˆæŠ€èƒ½è®¤è¯æˆ–é¡¹ç›®å®æˆ˜
[ ] æ€»ç»“å­¦ä¹ æˆæœå’Œç»éªŒæ•™è®­`
                },
                {
                    id: 'personal_branding',
                    name: 'ä¸ªäººå“ç‰Œå»ºè®¾',
                    icon: 'ğŸŒŸ',
                    description: 'å»ºç«‹å’Œæå‡ä¸ªäººå“ç‰Œå½±å“åŠ›çš„ç»¼åˆæ€§é¡¹ç›®',
                    preview: `[ ] ä¸ªäººå“ç‰Œå®šä½å’Œä»·å€¼ä¸»å¼ ç¡®å®š
[ ] å»ºç«‹ä¸“ä¸šçš„åœ¨çº¿å½¢è±¡å’Œæ¡£æ¡ˆ
[ ] å¼€å§‹å®šæœŸåˆ›ä½œå’Œåˆ†äº«æœ‰ä»·å€¼çš„å†…å®¹
[ ] å‚ä¸è¡Œä¸šæ´»åŠ¨å’Œç¤¾åŒºè®¨è®º
[ ] å»ºç«‹ä¸“ä¸šç½‘ç»œå’Œåˆä½œå…³ç³»
[ ] æ”¶é›†åé¦ˆå¹¶ä¼˜åŒ–å“ç‰Œç­–ç•¥
[ ] è¯„ä¼°å“ç‰Œå½±å“åŠ›å’Œè®¤çŸ¥åº¦`
                },
                {
                    id: 'health_lifestyle',
                    name: 'å¥åº·ç”Ÿæ´»æ–¹å¼',
                    icon: 'ğŸƒ',
                    description: 'å»ºç«‹å¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯å’Œå·¥ä½œç”Ÿæ´»å¹³è¡¡çš„é¡¹ç›®',
                    preview: `[ ] åˆ¶å®šè¿åŠ¨è®¡åˆ’å¹¶å¼€å§‹æ‰§è¡Œ
[ ] ä¼˜åŒ–é¥®é£Ÿç»“æ„å’Œä½œæ¯æ—¶é—´
[ ] å»ºç«‹å‹åŠ›ç®¡ç†å’Œæ”¾æ¾æœºåˆ¶
[ ] å®šæœŸä½“æ£€å’Œå¥åº·ç›‘æµ‹
[ ] åŸ¹å…»æœ‰ç›Šçš„ä¸šä½™çˆ±å¥½
[ ] æ”¹å–„å·¥ä½œç¯å¢ƒå’Œæ•ˆç‡
[ ] å»ºç«‹å¯æŒç»­çš„ç”Ÿæ´»èŠ‚å¥`
                },
                {
                    id: 'career_advancement',
                    name: 'èŒä¸šå‘å±•æ¨è¿›',
                    icon: 'ğŸ’¼',
                    description: 'åŠ é€ŸèŒä¸šå‘å±•å’Œæ™‹å‡æœºä¼šçš„æˆ˜ç•¥æ€§é¡¹ç›®',
                    preview: `[ ] èŒä¸šå‘å±•ç›®æ ‡å’Œè·¯å¾„è§„åˆ’
[ ] æå‡å…³é”®èŒä¸šæŠ€èƒ½å’Œèƒ½åŠ›
[ ] æ‰©å±•è¡Œä¸šç½‘ç»œå’Œå¯¼å¸ˆå…³ç³»
[ ] äº‰å–é‡è¦é¡¹ç›®å’Œå±•ç¤ºæœºä¼š
[ ] å»ºç«‹ä¸“ä¸šå£°èª‰å’Œå½±å“åŠ›
[ ] å‡†å¤‡æ™‹å‡æˆ–è½¬å²—æœºä¼š
[ ] åˆ¶å®šèŒä¸šå‘å±•å¤‡é€‰æ–¹æ¡ˆ`
                }
            ];
        }

        function applyProjectTemplate(templateId) {
            const templates = generateProjectTemplateContent();
            const template = templates.find(t => t.id === templateId);
            
            if (template) {
                const container = document.getElementById('halfyear_projects');
                const currentContent = container.textContent || '';
                const newContent = currentContent ? currentContent + '\n\n' + template.preview : template.preview;
                
                container.textContent = newContent;
                TodoUtils.renderTodos(container);
                
                MessageUtils.success(`${template.name}æ¨¡æ¿å·²åº”ç”¨åˆ°é¡¹ç›®è§„åˆ’ä¸­`);
                ModalUtils.hide();
            }
        }

        function applyProjectSuggestions() {
            const suggestedProjects = [
                '[ ] ä¸“ä¸šæŠ€èƒ½æ·±åŒ–é¡¹ç›®ï¼šé€‰æ‹©1-2ä¸ªæ ¸å¿ƒæŠ€èƒ½è¿›è¡Œç³»ç»Ÿæå‡',
                '[ ] ä¸ªäººå“ç‰Œå»ºè®¾é¡¹ç›®ï¼šå»ºç«‹ä¸“ä¸šçš„åœ¨çº¿å½¢è±¡å’Œå†…å®¹åˆ›ä½œ',
                '[ ] ç½‘ç»œæ‰©å±•é¡¹ç›®ï¼šä¸»åŠ¨å‚ä¸è¡Œä¸šæ´»åŠ¨ï¼Œå»ºç«‹é«˜è´¨é‡èŒä¸šå…³ç³»',
                '[ ] å¥åº·ç®¡ç†é¡¹ç›®ï¼šå»ºç«‹è§„å¾‹è¿åŠ¨å’Œå¥åº·ç”Ÿæ´»ä¹ æƒ¯',
                '[ ] åˆ›æ–°æ¢ç´¢é¡¹ç›®ï¼šå°è¯•æ–°çš„æ–¹æ³•ã€å·¥å…·æˆ–é¢†åŸŸ'
            ];
            
            const container = document.getElementById('halfyear_projects');
            container.textContent = suggestedProjects.join('\n');
            TodoUtils.renderTodos(container);
            
            MessageUtils.success('é¡¹ç›®å»ºè®®å·²åº”ç”¨åˆ°è§„åˆ’ä¸­');
            ModalUtils.hide();
        }

        function learnMoreAbout(methodId) {
            const methodDetails = {
                agile: {
                    title: 'ğŸ”„ æ•æ·é¡¹ç›®ç®¡ç†',
                    content: `
                        <h5>æ ¸å¿ƒåŸåˆ™ï¼š</h5>
                        <ul>
                            <li>ä¸ªä½“å’Œäº’åŠ¨èƒœè¿‡æµç¨‹å’Œå·¥å…·</li>
                            <li>å¯å·¥ä½œçš„è½¯ä»¶èƒœè¿‡è¯¦å°½çš„æ–‡æ¡£</li>
                            <li>å®¢æˆ·åˆä½œèƒœè¿‡åˆåŒè°ˆåˆ¤</li>
                            <li>å“åº”å˜åŒ–èƒœè¿‡éµå¾ªè®¡åˆ’</li>
                        </ul>
                        
                        <h5>é€‚ç”¨åœºæ™¯ï¼š</h5>
                        <p>æŠ€èƒ½å­¦ä¹ ã€åˆ›æ–°é¡¹ç›®ã€éœ€æ±‚é¢‘ç¹å˜åŒ–çš„é¡¹ç›®</p>
                        
                        <h5>å®æ–½æ­¥éª¤ï¼š</h5>
                        <ol>
                            <li>è®¾å®šçŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨å†²åˆºï¼‰</li>
                            <li>æ¯æ—¥æ£€æŸ¥è¿›åº¦å’Œè°ƒæ•´è®¡åˆ’</li>
                            <li>å®šæœŸå›é¡¾å’Œæ”¹è¿›å·¥ä½œæ–¹å¼</li>
                            <li>å¿«é€Ÿå“åº”å˜åŒ–å’Œåé¦ˆ</li>
                        </ol>
                    `
                },
                waterfall: {
                    title: 'ğŸ“Š ç€‘å¸ƒé¡¹ç›®ç®¡ç†',
                    content: `
                        <h5>æ ¸å¿ƒç‰¹ç‚¹ï¼š</h5>
                        <ul>
                            <li>çº¿æ€§ã€é¡ºåºçš„é¡¹ç›®æ‰§è¡Œæ–¹å¼</li>
                            <li>æ¯ä¸ªé˜¶æ®µå®Œæˆåæ‰è¿›å…¥ä¸‹ä¸€é˜¶æ®µ</li>
                            <li>è¯¦ç»†çš„å‰æœŸè§„åˆ’å’Œæ–‡æ¡£</li>
                            <li>æ˜ç¡®çš„é‡Œç¨‹ç¢‘å’Œäº¤ä»˜ç‰©</li>
                        </ul>
                        
                        <h5>é€‚ç”¨åœºæ™¯ï¼š</h5>
                        <p>è®¤è¯è€ƒè¯•ã€æŠ€èƒ½åŸ¹è®­ã€éœ€æ±‚æ˜ç¡®çš„é¡¹ç›®</p>
                        
                        <h5>å®æ–½æ­¥éª¤ï¼š</h5>
                        <ol>
                            <li>éœ€æ±‚åˆ†æå’Œç›®æ ‡è®¾å®š</li>
                            <li>è¯¦ç»†è®¾è®¡å’Œè®¡åˆ’åˆ¶å®š</li>
                            <li>æŒ‰è®¡åˆ’æ‰§è¡Œå„ä¸ªé˜¶æ®µ</li>
                            <li>æµ‹è¯•éªŒè¯å’Œæˆæœäº¤ä»˜</li>
                        </ol>
                    `
                },
                kanban: {
                    title: 'ğŸ“‹ çœ‹æ¿é¡¹ç›®ç®¡ç†',
                    content: `
                        <h5>æ ¸å¿ƒåŸåˆ™ï¼š</h5>
                        <ul>
                            <li>å¯è§†åŒ–å·¥ä½œæµç¨‹</li>
                            <li>é™åˆ¶åœ¨åˆ¶å“æ•°é‡</li>
                            <li>ç®¡ç†æµåŠ¨ï¼Œè€Œéç®¡ç†äººå‘˜</li>
                            <li>æŒç»­æ”¹è¿›</li>
                        </ul>
                        
                        <h5>é€‚ç”¨åœºæ™¯ï¼š</h5>
                        <p>ä¹ æƒ¯å…»æˆã€æŒç»­æ”¹è¿›ã€æ—¥å¸¸å·¥ä½œç®¡ç†</p>
                        
                        <h5>å®æ–½æ­¥éª¤ï¼š</h5>
                        <ol>
                            <li>åˆ›å»ºçœ‹æ¿ï¼ˆå¾…åŠã€è¿›è¡Œä¸­ã€å·²å®Œæˆï¼‰</li>
                            <li>æ·»åŠ ä»»åŠ¡å¡ç‰‡åˆ°çœ‹æ¿</li>
                            <li>è®¾ç½®åœ¨åˆ¶å“é™åˆ¶</li>
                            <li>å®šæœŸå›é¡¾å’Œä¼˜åŒ–æµç¨‹</li>
                        </ol>
                    `
                },
                design_thinking: {
                    title: 'ğŸ’¡ è®¾è®¡æ€ç»´é¡¹ç›®ç®¡ç†',
                    content: `
                        <h5>æ ¸å¿ƒé˜¶æ®µï¼š</h5>
                        <ul>
                            <li>å…±æƒ…ï¼ˆEmpathizeï¼‰ï¼šç†è§£ç”¨æˆ·éœ€æ±‚</li>
                            <li>å®šä¹‰ï¼ˆDefineï¼‰ï¼šæ˜ç¡®é—®é¢˜å®šä¹‰</li>
                            <li>æ„æ€ï¼ˆIdeateï¼‰ï¼šäº§ç”Ÿåˆ›æ„è§£å†³æ–¹æ¡ˆ</li>
                            <li>åŸå‹ï¼ˆPrototypeï¼‰ï¼šåˆ¶ä½œåŸå‹æµ‹è¯•</li>
                            <li>æµ‹è¯•ï¼ˆTestï¼‰ï¼šéªŒè¯å’Œæ”¹è¿›æ–¹æ¡ˆ</li>
                        </ul>
                        
                        <h5>é€‚ç”¨åœºæ™¯ï¼š</h5>
                        <p>åˆ›æ–°é¡¹ç›®ã€äº§å“å¼€å‘ã€ç”¨æˆ·ä½“éªŒæ”¹è¿›</p>
                        
                        <h5>å®æ–½æ­¥éª¤ï¼š</h5>
                        <ol>
                            <li>æ·±å…¥äº†è§£ç›®æ ‡ç”¨æˆ·å’Œéœ€æ±‚</li>
                            <li>é‡æ–°å®šä¹‰é—®é¢˜å’ŒæŒ‘æˆ˜</li>
                            <li>å¤´è„‘é£æš´äº§ç”Ÿå¤šä¸ªè§£å†³æ–¹æ¡ˆ</li>
                            <li>å¿«é€Ÿåˆ¶ä½œåŸå‹è¿›è¡Œæµ‹è¯•</li>
                            <li>æ ¹æ®åé¦ˆè¿­ä»£æ”¹è¿›</li>
                        </ol>
                    `
                }
            };
            
            const detail = methodDetails[methodId];
            if (detail) {
                ModalUtils.show(detail.title, detail.content, 'medium');
            }
        }

        // === èµ„æºåˆ†é…åŠŸèƒ½å®ç° ===
        function generateResourceAllocationGuide(currentData) {
            const resourceAnalysis = analyzeResourceRequirements(currentData);
            
            return `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #ef6c00; margin-bottom: 16px;">ğŸ¯ æ™ºèƒ½èµ„æºåˆ†é…åŠ©æ‰‹</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        AIåˆ†ææ‚¨çš„ç›®æ ‡å’Œé¡¹ç›®ï¼Œæä¾›æœ€ä¼˜çš„èµ„æºåˆ†é…æ–¹æ¡ˆ
                    </p>
                </div>
                
                <!-- èµ„æºæ¦‚è§ˆ -->
                <div style="background: linear-gradient(135deg, rgba(239,108,0,0.1), rgba(255,152,0,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #ef6c00; margin: 0 0 16px 0;">ğŸ“Š èµ„æºåˆ†é…æ¦‚è§ˆ</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #ef6c00;">${resourceAnalysis.timeAllocation}%</div>
                            <div style="font-size: 0.9em; color: #666;">æ—¶é—´åˆ©ç”¨ç‡</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: #4caf50;">${resourceAnalysis.balanceScore}</div>
                            <div style="font-size: 0.9em; color: #666;">å¹³è¡¡æŒ‡æ•°</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 1.5em; font-weight: bold; color: ${resourceAnalysis.efficiency >= 80 ? '#4caf50' : resourceAnalysis.efficiency >= 60 ? '#ff9800' : '#f44336'};">${resourceAnalysis.efficiency}%</div>
                            <div style="font-size: 0.9em; color: #666;">æ•ˆç‡è¯„ä¼°</div>
                        </div>
                    </div>
                </div>
                
                <!-- èµ„æºç±»å‹åˆ†æ -->
                <div style="background: white; border: 1px solid #ffcc02; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #ef6c00; margin: 0 0 16px 0;">ğŸ—ï¸ èµ„æºç±»å‹åˆ†æ</h5>
                    <div style="display: grid; gap: 16px;">
                        ${generateResourceTypes().map(resourceType => `
                            <div style="border: 1px solid #fff3e0; border-radius: 8px; padding: 16px; background: rgba(239,108,0,0.02);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h6 style="margin: 0; color: #ef6c00; display: flex; align-items: center; gap: 8px;">
                                        ${resourceType.icon} ${resourceType.name}
                                    </h6>
                                    <div style="background: ${resourceType.status === 'optimal' ? '#4caf50' : resourceType.status === 'needs_attention' ? '#ff9800' : '#f44336'}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                        ${resourceType.status === 'optimal' ? 'è‰¯å¥½' : resourceType.status === 'needs_attention' ? 'éœ€å…³æ³¨' : 'ä¸è¶³'}
                                    </div>
                                </div>
                                <div style="color: #666; font-size: 0.9em; margin-bottom: 12px;">${resourceType.description}</div>
                                <div style="display: grid; gap: 8px;">
                                    ${resourceType.recommendations.map(rec => `
                                        <div style="padding: 8px 12px; background: white; border-radius: 6px; border: 1px solid #f0f0f0; font-size: 0.9em;">
                                            ğŸ’¡ ${rec}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- æ—¶é—´åˆ†é…å»ºè®® -->
                <div style="background: #f3e5f5; border: 1px solid #9c27b0; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #7b1fa2; margin: 0 0 16px 0;">â° æ—¶é—´èµ„æºåˆ†é…</h5>
                    <div style="display: grid; gap: 12px;">
                        ${generateTimeAllocation().map(allocation => `
                            <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e1bee7;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <h6 style="margin: 0; color: #7b1fa2;">${allocation.category}</h6>
                                    <span style="background: rgba(156,39,176,0.1); color: #7b1fa2; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">
                                        ${allocation.percentage}%
                                    </span>
                                </div>
                                <div style="background: #f0f0f0; height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 8px;">
                                    <div style="background: #9c27b0; height: 100%; width: ${allocation.percentage}%; transition: width 0.3s ease;"></div>
                                </div>
                                <div style="color: #666; font-size: 0.9em;">${allocation.description}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- èµ„æºä¼˜åŒ–å»ºè®® -->
                <div style="background: #e0f2fe; border: 1px solid #0288d1; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #01579b; margin: 0 0 16px 0;">ğŸ”§ èµ„æºä¼˜åŒ–å»ºè®®</h5>
                    <div style="display: grid; gap: 8px;">
                        ${resourceAnalysis.optimizationTips.map(tip => `
                            <div style="padding: 8px 12px; background: white; border-radius: 6px; border-left: 3px solid #0288d1;">
                                ${tip}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function analyzeResourceRequirements(data) {
            const goalCount = data.strategicGoals ? data.strategicGoals.split('\n').filter(line => line.includes('[')).length : 0;
            const projectCount = data.projects ? data.projects.split('\n').filter(line => line.includes('[')).length : 0;
            
            const timeAllocation = Math.min(100, (goalCount + projectCount) * 12);
            const balanceScore = calculateResourceBalance(data);
            const efficiency = calculateResourceEfficiency(goalCount, projectCount);
            
            const optimizationTips = generateOptimizationTips(timeAllocation, balanceScore, efficiency);
            
            return {
                timeAllocation,
                balanceScore,
                efficiency,
                optimizationTips
            };
        }

        function calculateResourceBalance(data) {
            let score = 50; // åŸºç¡€åˆ†
            
            // æ£€æŸ¥å„ç»´åº¦æ˜¯å¦éƒ½æœ‰å†…å®¹
            if (data.strategicGoals && data.strategicGoals.trim()) score += 15;
            if (data.projects && data.projects.trim()) score += 15;
            if (data.skills && data.skills.trim()) score += 10;
            if (data.balance && data.balance.trim()) score += 10;
            
            return Math.min(100, score);
        }

        function calculateResourceEfficiency(goalCount, projectCount) {
            if (goalCount === 0) return 20;
            
            const ratio = projectCount / goalCount;
            if (ratio >= 1 && ratio <= 2) return 90; // ç†æƒ³æ¯”ä¾‹
            if (ratio >= 0.5 && ratio <= 2.5) return 75; // è‰¯å¥½æ¯”ä¾‹
            if (ratio >= 0.3 && ratio <= 3) return 60; // å¯æ¥å—æ¯”ä¾‹
            return 40; // éœ€è¦è°ƒæ•´
        }

        function generateOptimizationTips(timeAllocation, balanceScore, efficiency) {
            const tips = [];
            
            if (timeAllocation < 60) {
                tips.push('â° è€ƒè™‘å¢åŠ æ›´å¤šå…·ä½“ç›®æ ‡å’Œé¡¹ç›®ï¼Œå……åˆ†åˆ©ç”¨åŠå¹´æ—¶é—´');
            } else if (timeAllocation > 90) {
                tips.push('âš–ï¸ ç›®æ ‡è¾ƒå¤šï¼Œå»ºè®®ä¼˜å…ˆæ’åºï¼Œèšç„¦æœ€é‡è¦çš„é¡¹ç›®');
            }
            
            if (balanceScore < 70) {
                tips.push('ğŸ“Š å»ºè®®å®Œå–„å„ä¸ªç»´åº¦çš„è§„åˆ’ï¼Œä¿æŒå‘å±•çš„å¹³è¡¡æ€§');
            }
            
            if (efficiency < 60) {
                tips.push('ğŸ¯ é¡¹ç›®ä¸ç›®æ ‡çš„åŒ¹é…åº¦éœ€è¦ä¼˜åŒ–ï¼Œç¡®ä¿æ¯ä¸ªé¡¹ç›®éƒ½æ”¯æ’‘ç›®æ ‡å®ç°');
            }
            
            tips.push('ğŸ“… å»ºè®®æ¯æœˆå›é¡¾èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶è°ƒæ•´åˆ†é…ç­–ç•¥');
            tips.push('ğŸ’ª é¢„ç•™20%çš„æ—¶é—´ä½œä¸ºç¼“å†²ï¼Œåº”å¯¹çªå‘æƒ…å†µ');
            
            return tips;
        }

        function generateResourceTypes() {
            return [
                {
                    name: 'æ—¶é—´èµ„æº',
                    icon: 'â°',
                    status: 'needs_attention',
                    description: 'åŠå¹´çº¦180å¤©ï¼Œéœ€è¦åˆç†åˆ†é…å·¥ä½œå’Œå­¦ä¹ æ—¶é—´',
                    recommendations: [
                        'å»ºè®®å°†60%æ—¶é—´æŠ•å…¥æ ¸å¿ƒç›®æ ‡',
                        'é¢„ç•™20%æ—¶é—´ç”¨äºæŠ€èƒ½æå‡',
                        'ä¿ç•™20%ç¼“å†²æ—¶é—´åº”å¯¹å˜åŒ–'
                    ]
                },
                {
                    name: 'ç²¾åŠ›èµ„æº',
                    icon: 'ğŸ’ª',
                    status: 'optimal',
                    description: 'ä¸ªäººç²¾åŠ›å’Œæ³¨æ„åŠ›çš„åˆç†åˆ†é…',
                    recommendations: [
                        'åœ¨ç²¾åŠ›æœ€å……æ²›æ—¶å¤„ç†é‡è¦ä»»åŠ¡',
                        'é¿å…åŒæ—¶æ¨è¿›è¿‡å¤šé¡¹ç›®',
                        'å®šæœŸä¼‘æ¯å’Œæ¢å¤ç²¾åŠ›'
                    ]
                },
                {
                    name: 'å­¦ä¹ èµ„æº',
                    icon: 'ğŸ“š',
                    status: 'needs_attention',
                    description: 'çŸ¥è¯†è·å–å’ŒæŠ€èƒ½æå‡æ‰€éœ€çš„èµ„æº',
                    recommendations: [
                        'é€‰æ‹©é«˜è´¨é‡çš„å­¦ä¹ ææ–™å’Œè¯¾ç¨‹',
                        'å¯»æ‰¾å®è·µæœºä¼šå·©å›ºå­¦ä¹ æˆæœ',
                        'å»ºç«‹çŸ¥è¯†åˆ†äº«å’Œäº¤æµç½‘ç»œ'
                    ]
                },
                {
                    name: 'äººé™…èµ„æº',
                    icon: 'ğŸ¤',
                    status: 'needs_attention',
                    description: 'äººé™…å…³ç³»å’Œç¤¾äº¤ç½‘ç»œçš„å»ºè®¾ç»´æŠ¤',
                    recommendations: [
                        'ä¸»åŠ¨ç»´æŠ¤é‡è¦çš„èŒä¸šå…³ç³»',
                        'å‚ä¸è¡Œä¸šæ´»åŠ¨æ‰©å±•ç½‘ç»œ',
                        'å¯»æ‰¾å¯¼å¸ˆå’Œåˆä½œä¼™ä¼´'
                    ]
                }
            ];
        }

        function generateTimeAllocation() {
            return [
                {
                    category: 'æ ¸å¿ƒç›®æ ‡æ¨è¿›',
                    percentage: 40,
                    description: 'ä¸“æ³¨äºæœ€é‡è¦çš„æˆ˜ç•¥ç›®æ ‡å®ç°'
                },
                {
                    category: 'æŠ€èƒ½èƒ½åŠ›æå‡',
                    percentage: 25,
                    description: 'æŠ•èµ„äºé•¿æœŸèƒ½åŠ›å»ºè®¾å’Œå­¦ä¹ '
                },
                {
                    category: 'é¡¹ç›®æ‰§è¡Œ',
                    percentage: 20,
                    description: 'å…·ä½“é¡¹ç›®çš„å®æ–½å’Œæ¨è¿›'
                },
                {
                    category: 'ç”Ÿæ´»å¹³è¡¡',
                    percentage: 15,
                    description: 'ç»´æŠ¤å¥åº·å’Œå·¥ä½œç”Ÿæ´»å¹³è¡¡'
                }
            ];
        }

        function optimizeResourceAllocation() {
            const optimizedAllocation = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #ef6c00; margin-bottom: 16px;">ğŸ”§ èµ„æºé…ç½®ä¼˜åŒ–æ–¹æ¡ˆ</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        åŸºäºAIåˆ†æï¼Œä¸ºæ‚¨æä¾›ä¸ªæ€§åŒ–çš„èµ„æºä¼˜åŒ–å»ºè®®
                    </p>
                </div>
                
                <!-- ä¼˜åŒ–å»ºè®® -->
                <div style="background: linear-gradient(135deg, rgba(76,175,80,0.1), rgba(69,160,73,0.05)); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <h5 style="color: #4caf50; margin: 0 0 16px 0;">âœ… ä¼˜åŒ–é‡ç‚¹</h5>
                    <div style="display: grid; gap: 12px;">
                        <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">
                            <strong>æ—¶é—´ç®¡ç†ï¼š</strong> ä½¿ç”¨ç•ªèŒ„å·¥ä½œæ³•ï¼Œæé«˜ä¸“æ³¨åº¦å’Œæ•ˆç‡
                        </div>
                        <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">
                            <strong>ç›®æ ‡èšç„¦ï¼š</strong> åŒæ—¶æ¨è¿›çš„é¡¹ç›®ä¸è¶…è¿‡3ä¸ªï¼Œé¿å…åˆ†æ•£æ³¨æ„åŠ›
                        </div>
                        <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">
                            <strong>å­¦ä¹ æ•ˆç‡ï¼š</strong> é‡‡ç”¨å®è·µå¯¼å‘çš„å­¦ä¹ æ–¹å¼ï¼Œè¾¹å­¦è¾¹ç”¨
                        </div>
                        <div style="padding: 12px; background: white; border-radius: 6px; border-left: 3px solid #4caf50;">
                            <strong>ç½‘ç»œå»ºè®¾ï¼š</strong> æ¯æœˆå‚åŠ 1-2æ¬¡è¡Œä¸šæ´»åŠ¨ï¼Œæ‰©å±•äººè„‰
                        </div>
                    </div>
                </div>
                
                <!-- å…·ä½“è¡ŒåŠ¨è®¡åˆ’ -->
                <div style="background: #fff3e0; border: 1px solid #ff9800; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #f57c00; margin: 0 0 16px 0;">ğŸ“‹ å…·ä½“è¡ŒåŠ¨è®¡åˆ’</h5>
                    <div style="display: grid; gap: 8px;">
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            <strong>ç¬¬1ä¸ªæœˆï¼š</strong> å»ºç«‹èµ„æºç®¡ç†ä½“ç³»ï¼Œæ˜ç¡®ä¼˜å…ˆçº§
                        </div>
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            <strong>ç¬¬2-4ä¸ªæœˆï¼š</strong> æŒ‰ä¼˜åŒ–æ–¹æ¡ˆæ‰§è¡Œï¼Œå®šæœŸç›‘æ§å’Œè°ƒæ•´
                        </div>
                        <div style="padding: 8px 12px; background: white; border-radius: 6px;">
                            <strong>ç¬¬5-6ä¸ªæœˆï¼š</strong> è¯„ä¼°æ•ˆæœï¼Œæ€»ç»“æœ€ä½³å®è·µ
                        </div>
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ”§ èµ„æºä¼˜åŒ–æ–¹æ¡ˆ', optimizedAllocation, 'large');
        }

        function generateResourcePlan() {
            const resourcePlan = `
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #ef6c00; margin-bottom: 16px;">ğŸ“Š èµ„æºé…ç½®è®¡åˆ’</h4>
                    <p style="color: #666; font-size: 0.9em;">
                        è¯¦ç»†çš„èµ„æºåˆ†é…å’Œä½¿ç”¨è®¡åˆ’
                    </p>
                </div>
                
                <!-- å‘¨åº¦èµ„æºåˆ†é… -->
                <div style="background: white; border: 1px solid #ffcc02; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h5 style="color: #ef6c00; margin: 0 0 16px 0;">ğŸ“… å‘¨åº¦èµ„æºåˆ†é…æ¨¡æ¿</h5>
                    <div style="font-family: monospace; background: #f9f9f9; padding: 16px; border-radius: 6px; font-size: 0.9em; line-height: 1.6;">
                        <strong>å‘¨ä¸€ï¼š</strong> æ ¸å¿ƒç›®æ ‡æ¨è¿› (4å°æ—¶) + å­¦ä¹ æ—¶é—´ (2å°æ—¶)<br>
                        <strong>å‘¨äºŒï¼š</strong> é¡¹ç›®æ‰§è¡Œ (4å°æ—¶) + ç½‘ç»œå»ºè®¾ (2å°æ—¶)<br>
                        <strong>å‘¨ä¸‰ï¼š</strong> æ ¸å¿ƒç›®æ ‡æ¨è¿› (4å°æ—¶) + æŠ€èƒ½ç»ƒä¹  (2å°æ—¶)<br>
                        <strong>å‘¨å››ï¼š</strong> é¡¹ç›®æ‰§è¡Œ (4å°æ—¶) + æ€»ç»“å›é¡¾ (2å°æ—¶)<br>
                        <strong>å‘¨äº”ï¼š</strong> æ ¸å¿ƒç›®æ ‡æ¨è¿› (3å°æ—¶) + è§„åˆ’è°ƒæ•´ (2å°æ—¶)<br>
                        <strong>å‘¨æœ«ï¼š</strong> ç”Ÿæ´»å¹³è¡¡ + å…´è¶£å‘å±• + ä¼‘æ¯æ¢å¤
                    </div>
                </div>
                
                <!-- æœˆåº¦æ£€æŸ¥æ¸…å• -->
                <div style="background: #e8f5e9; border: 1px solid #4caf50; border-radius: 12px; padding: 20px;">
                    <h5 style="color: #2e7d32; margin: 0 0 16px 0;">âœ… æœˆåº¦èµ„æºæ£€æŸ¥æ¸…å•</h5>
                    <div style="display: grid; gap: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 4px;">
                            <input type="checkbox"> æ—¶é—´åˆ†é…æ˜¯å¦åˆç†ï¼Ÿ
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 4px;">
                            <input type="checkbox"> ç²¾åŠ›ä½¿ç”¨æ˜¯å¦é«˜æ•ˆï¼Ÿ
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 4px;">
                            <input type="checkbox"> å­¦ä¹ èµ„æºæ˜¯å¦å……åˆ†åˆ©ç”¨ï¼Ÿ
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 4px;">
                            <input type="checkbox"> äººé™…ç½‘ç»œæ˜¯å¦åœ¨æ‰©å±•ï¼Ÿ
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; padding: 8px; background: white; border-radius: 4px;">
                            <input type="checkbox"> æ˜¯å¦éœ€è¦è°ƒæ•´èµ„æºåˆ†é…ï¼Ÿ
                        </label>
                    </div>
                </div>
            `;
            
            ModalUtils.show('ğŸ“Š èµ„æºé…ç½®è®¡åˆ’', resourcePlan, 'large');
        }

        // å…¨å±€å‡½æ•°ï¼Œç”¨äºåº”ç”¨å»ºè®®å†…å®¹
        window.applySuggestionContent = function(fieldId, content) {
            const field = document.getElementById(fieldId);
            if (field) {
                if (field.tagName === 'TEXTAREA') {
                    field.value = content;
                } else if (field.classList && field.classList.contains('todo-list-container')) {
                    field.textContent = content;
                    TodoUtils.renderTodos(field);
                }
                MessageUtils.success('å»ºè®®å†…å®¹å·²åº”ç”¨åˆ°è®¡åˆ’ä¸­');
                
                // è§¦å‘ä¿å­˜
                setTimeout(() => {
                    if (typeof window.saveDraft === 'function') {
                        window.saveDraft();
                    }
                }, 100);
            }
        };
    </script>
    
    <!-- åŒæ­¥æœåŠ¡ -->
    <script src="sync-service.js"></script>
    <script src="sync-providers.js"></script>
    <!-- é€šç”¨è‡ªåŠ¨åŒæ­¥åŠŸèƒ½ -->
    <script src="universal-auto-sync.js"></script>
    <script src="add-ai-to-all-pages.js"></script>
    <script src="ai-fix-universal.js"></script>  <!-- AIåˆ†æåŠŸèƒ½ä¿®å¤ -->
    <script src="universal-button-fix.js"></script>  <!-- é€šç”¨æŒ‰é’®ä¿®å¤ -->
</body>

</html>

