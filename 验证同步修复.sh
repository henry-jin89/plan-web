#!/bin/bash

# éªŒè¯åŒæ­¥ä¿®å¤è„šæœ¬
# å¿«é€Ÿæ£€æŸ¥åŒæ­¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

echo "========================================="
echo "   ğŸ” éªŒè¯è·¨è®¾å¤‡åŒæ­¥ä¿®å¤"
echo "========================================="
echo ""

# æ£€æŸ¥å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
echo "ğŸ“ æ£€æŸ¥æ–‡ä»¶..."
files=("leancloud-sync.js" "leancloud-config.js" "sync-test.html" "åŒæ­¥ä¼˜åŒ–è¯´æ˜.md")
missing_files=0

for file in "${files[@]}"; do
    if [ -f "$file" ]; then
        echo "  âœ… $file"
    else
        echo "  âŒ $file (ç¼ºå¤±)"
        missing_files=$((missing_files + 1))
    fi
done

echo ""

if [ $missing_files -gt 0 ]; then
    echo "âš ï¸  å‘ç° $missing_files ä¸ªæ–‡ä»¶ç¼ºå¤±"
    echo "è¯·ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½å­˜åœ¨"
    exit 1
fi

echo "âœ… æ‰€æœ‰æ–‡ä»¶æ£€æŸ¥é€šè¿‡"
echo ""

# æ£€æŸ¥å…³é”®ä»£ç æ˜¯å¦å·²ä¿®æ”¹
echo "ğŸ”§ æ£€æŸ¥ä»£ç ä¿®æ”¹..."

# æ£€æŸ¥åŒæ­¥é—´éš”æ˜¯å¦æ”¹ä¸º15ç§’
if grep -q "15 \* 1000" leancloud-sync.js; then
    echo "  âœ… åŒæ­¥é—´éš”å·²ä¿®æ”¹ä¸º 15 ç§’"
else
    echo "  âŒ åŒæ­¥é—´éš”æœªä¿®æ”¹"
    echo "     é¢„æœŸ: 15 * 1000"
    echo "     è¯·æ£€æŸ¥ leancloud-sync.js"
fi

# æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†é¡µé¢å¯è§æ€§æ£€æµ‹
if grep -q "visibilitychange" leancloud-sync.js; then
    echo "  âœ… é¡µé¢å¯è§æ€§æ£€æµ‹å·²æ·»åŠ "
else
    echo "  âŒ é¡µé¢å¯è§æ€§æ£€æµ‹æœªæ·»åŠ "
fi

# æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†çª—å£ç„¦ç‚¹æ£€æµ‹
if grep -q "window.addEventListener('focus'" leancloud-sync.js; then
    echo "  âœ… çª—å£ç„¦ç‚¹æ£€æµ‹å·²æ·»åŠ "
else
    echo "  âŒ çª—å£ç„¦ç‚¹æ£€æµ‹æœªæ·»åŠ "
fi

# æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†é˜²æŠ–æœºåˆ¶
if grep -q "_syncDebounceTimer" leancloud-sync.js; then
    echo "  âœ… åŒæ­¥é˜²æŠ–æœºåˆ¶å·²æ·»åŠ "
else
    echo "  âŒ åŒæ­¥é˜²æŠ–æœºåˆ¶æœªæ·»åŠ "
fi

# æ£€æŸ¥æ˜¯å¦æ·»åŠ äº†çŠ¶æ€æŒ‡ç¤ºå™¨æ›´æ–°
if grep -q "updateSyncStatusIndicator" leancloud-sync.js; then
    echo "  âœ… åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨å·²æ·»åŠ "
else
    echo "  âŒ åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨æœªæ·»åŠ "
fi

echo ""
echo "========================================="
echo "   ğŸ“Š ä¿®æ”¹æ€»ç»“"
echo "========================================="
echo ""

# ç»Ÿè®¡è¡Œæ•°å˜åŒ–
if command -v wc &> /dev/null; then
    lines=$(wc -l < leancloud-sync.js)
    echo "ğŸ“ leancloud-sync.js: $lines è¡Œä»£ç "
fi

echo ""
echo "ğŸ¯ ä¸»è¦æ”¹è¿›:"
echo "  â€¢ åŒæ­¥é—´éš”: 2åˆ†é’Ÿ â†’ 15ç§’ (å¿«8å€)"
echo "  â€¢ æ·»åŠ é¡µé¢å¯è§æ€§æ£€æµ‹ (åˆ‡æ¢æ—¶ç«‹å³åŒæ­¥)"
echo "  â€¢ æ·»åŠ çª—å£ç„¦ç‚¹æ£€æµ‹ (åˆ‡æ¢æ—¶ç«‹å³åŒæ­¥)"
echo "  â€¢ æ·»åŠ åŒæ­¥é˜²æŠ– (500ms)"
echo "  â€¢ æ·»åŠ å®æ—¶çŠ¶æ€åé¦ˆ"
echo "  â€¢ ä¼˜åŒ–æ›´æ–°é€šçŸ¥æ ·å¼"
echo ""

echo "========================================="
echo "   ğŸ§ª æµ‹è¯•å»ºè®®"
echo "========================================="
echo ""
echo "æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•é¡µé¢"
echo "  1. åœ¨æµè§ˆå™¨æ‰“å¼€ sync-test.html"
echo "  2. è¾“å…¥æµ‹è¯•æ•°æ®å¹¶ä¿å­˜"
echo "  3. åœ¨å¦ä¸€è®¾å¤‡æ‰“å¼€åŒä¸€é¡µé¢"
echo "  4. è§‚å¯Ÿæ˜¯å¦åœ¨ 15 ç§’å†…çœ‹åˆ°æ•°æ®"
echo ""
echo "æ–¹æ³• 2: ä½¿ç”¨å®é™…é¡µé¢"
echo "  1. åœ¨æ‰‹æœºä¸Šæ‰“å¼€æ—¥è®¡åˆ’é¡µé¢"
echo "  2. ä¿®æ”¹è®¡åˆ’å†…å®¹å¹¶ä¿å­˜"
echo "  3. åœ¨ç”µè„‘ä¸Šæ‰“å¼€æ—¥è®¡åˆ’é¡µé¢"
echo "  4. åˆ‡æ¢åˆ°è¯¥çª—å£(è§¦å‘ç„¦ç‚¹æ£€æµ‹)"
echo "  5. åº”è¯¥ç«‹å³æˆ–åœ¨15ç§’å†…çœ‹åˆ°æ›´æ–°"
echo ""
echo "æ–¹æ³• 3: æœ¬åœ°æµ‹è¯•æœåŠ¡å™¨"
echo "  è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨:"
echo "  $ python3 -m http.server 8000"
echo "  ç„¶ååœ¨æµè§ˆå™¨æ‰“å¼€: http://localhost:8000"
echo ""

echo "========================================="
echo "   ğŸ“š ç›¸å…³æ–‡æ¡£"
echo "========================================="
echo ""
echo "  ğŸ“„ åŒæ­¥ä¼˜åŒ–è¯´æ˜.md - è¯¦ç»†çš„æŠ€æœ¯è¯´æ˜"
echo "  ğŸ“„ åŒæ­¥åŠŸèƒ½æ›´æ–°æ—¥å¿—.txt - æ›´æ–°è®°å½•"
echo "  ğŸŒ sync-test.html - åŒæ­¥æµ‹è¯•é¡µé¢"
echo ""

echo "========================================="
echo "   âœ… éªŒè¯å®Œæˆï¼"
echo "========================================="
echo ""
echo "ğŸ’¡ æç¤º:"
echo "  â€¢ å¦‚éœ€å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨æµ‹è¯•ï¼Œè¯·è¿è¡Œ:"
echo "    python3 -m http.server 8000"
echo ""
echo "  â€¢ å¦‚éœ€åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæµ‹è¯•ï¼Œè¯·ç¡®ä¿:"
echo "    1. æ‰‹æœºå’Œç”µè„‘åœ¨åŒä¸€ç½‘ç»œ"
echo "    2. ä½¿ç”¨ç”µè„‘çš„å±€åŸŸç½‘ IP è®¿é—®"
echo "    3. ä¾‹å¦‚: http://192.168.1.100:8000"
echo ""
echo "ğŸ‰ ç¥æµ‹è¯•é¡ºåˆ©ï¼"
echo ""

