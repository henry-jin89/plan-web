# 📋 测试指南：数据恢复和同步功能

## ⏰ 部署等待时间

修改已推送到 GitHub，请等待 **5-10 分钟**让 GitHub Pages 重新部署。

**查看部署状态**：https://github.com/henry-jin89/plan-web/actions

---

## 🌐 测试网址

**网站地址**：https://henry-jin89.github.io/plan-web/

---

## ✅ 测试一：验证 Firebase 连接成功（消除错误）

### 步骤：

1. **打开网站**：https://henry-jin89.github.io/plan-web/

2. **查看顶部状态指示器**：
   - ⏳ 初始状态：🟡 黄色 "Firebase 初始化中..."
   - ✅ 成功状态：🟢 绿色 "Firebase 已连接"
   - ❌ 失败状态：🔴 红色 "仅本地存储"

3. **打开浏览器控制台**（按 F12 或 右键→检查→Console）

4. **检查日志**：

   **✅ 应该看到**（成功）：
   ```
   🚀 初始化Firebase数据库同步...
   📦 尝试从 Google官方CDN 加载 SDK...
   ✅ Firebase应用初始化成功
   ✅ Firestore数据库连接成功
   ✅ Firebase数据库同步初始化完成
   ```

   **❌ 不应该看到**（已修复）：
   ```
   ❌ WebSocket connection failed  （这个错误已消除）
   ❌ LeanCloud 404 错误           （已禁用 LeanCloud）
   ```

5. **点击顶部的状态指示器**，查看详细信息

---

## 🧪 测试二：电脑端删除数据后自动恢复

### 前置准备：先保存数据到云端

1. **进入日计划页面**：
   - 点击 "📅 今日计划"
   - 网址：https://henry-jin89.github.io/plan-web/day_plan.html

2. **添加测试数据**：
   ```
   任务 1：完成重要项目里程碑
   任务 2：处理紧急客户需求
   任务 3：准备明天的重要会议
   ```

3. **等待自动同步**：
   - 保存后等待 **10 秒**
   - 控制台应显示：`✅ 数据已同步到Firebase云端`
   - 或者查看状态指示器确认已连接

4. **确认数据已上传**：
   - 点击顶部 🟢 状态指示器
   - 查看 "本地数据: X 条记录"

### 开始测试恢复功能

5. **清除浏览器所有数据**：

   **方法 1 - Chrome/Edge**：
   ```
   1. 按 Cmd+Shift+Delete (Mac) 或 Ctrl+Shift+Delete (Windows)
   2. 勾选：
      ✅ Cookie 和其他网站数据
      ✅ 缓存的图片和文件
      ✅ 托管应用数据
   3. 时间范围：全部时间
   4. 点击"清除数据"
   ```

   **方法 2 - Safari**：
   ```
   1. Safari → 偏好设置 → 隐私
   2. 管理网站数据
   3. 搜索并删除 henry-jin89.github.io
   ```

6. **关闭浏览器标签页**

7. **重新打开网站**：
   - https://henry-jin89.github.io/plan-web/

8. **观察自动恢复**：

   **打开控制台（F12）查看**：
   ```
   ✅ 应该看到：
   🔍 从Firebase数据库恢复数据...
   📊 本地数据状态: 0 条记录         ← 本地为空
   🆕 检测到本地数据为空，将尝试从云端恢复
   ☁️ 发现云端数据: 2 条记录         ← 云端有数据
   📥 开始恢复数据...
   ✅ 已从云端恢复 2 条数据
   ```

9. **确认提示框**：
   - 应该弹出：**"数据已从云端恢复，是否刷新页面查看？"**
   - 点击 "确定"

10. **验证数据**：
    - 进入 "📅 今日计划"
    - 检查三个测试任务是否都恢复了 ✅

---

## 📱 测试三：电脑和手机数据同步

### 💻 步骤 1：在电脑上创建数据

1. **打开网站**：https://henry-jin89.github.io/plan-web/

2. **确认连接状态**：🟢 Firebase 已连接

3. **进入日计划**，添加带时间戳的任务：
   ```
   🕐 电脑端测试 - 15:30
   ```

4. **等待同步**：
   - 等待 10 秒
   - 控制台显示：`✅ 数据已同步到Firebase云端`

### 📱 步骤 2：在手机上查看

5. **手机浏览器打开**：
   - Safari (iPhone) 或 Chrome (Android)
   - 输入：https://henry-jin89.github.io/plan-web/

6. **等待初始化**：
   - 查看顶部状态指示器
   - 等待变为 🟢 绿色（可能需要 30 秒）

7. **进入日计划**：
   - 应该能看到刚才在电脑上添加的：
   ```
   🕐 电脑端测试 - 15:30 ✅
   ```

### 🔄 步骤 3：双向同步测试

8. **在手机上添加**：
   ```
   📱 手机端测试 - 15:35
   ```

9. **回到电脑**：
   - 刷新页面（F5）
   - 应该能看到手机添加的任务 ✅

---

## 🎯 测试四：手动恢复按钮

1. **打开首页**：https://henry-jin89.github.io/plan-web/

2. **点击按钮**：找到 "☁️ 从云端恢复" 按钮

3. **确认操作**：
   - 弹出确认框
   - 点击 "确定"

4. **观察过程**：
   - 显示加载动画
   - 控制台显示恢复日志

5. **验证结果**：
   - 应该显示恢复成功的提示
   - 数据已更新

---

## 🔧 故障排查

### 问题 1：状态一直是 🟡 黄色超过 30 秒

**可能原因**：
- 网络问题
- CDN 被阻止

**解决方法**：
```javascript
// 在控制台运行，查看详细错误：
window.firebaseSync.getStatus()
```

### 问题 2：状态变成 🔴 红色

**可能原因**：
- Firebase SDK 加载失败
- 所有 CDN 都被阻止

**解决方法**：
1. 刷新页面重试
2. 换个网络（如手机热点）
3. 在控制台查看错误详情

### 问题 3：数据没有自动恢复

**手动触发恢复**：
```javascript
// 在控制台运行：
window.firebaseSync.restoreFromDatabase(true)
```

### 问题 4：看到 LeanCloud 错误

**检查版本**：
- 确保使用的是最新部署的版本
- 清除浏览器缓存后重试
- 查看 GitHub Actions 确认部署完成

---

## 📊 成功标准

所有以下项都应该通过 ✅：

- [x] 顶部状态指示器显示 🟢 绿色
- [x] 控制台无 WebSocket 错误
- [x] 控制台无 LeanCloud 错误
- [x] 能看到 Firebase 初始化成功日志
- [x] 清除数据后能自动恢复
- [x] 手机能看到电脑添加的数据
- [x] 电脑能看到手机添加的数据
- [x] 手动恢复按钮正常工作

---

## 💡 提示

1. **首次加载可能较慢**（30秒内）
   - Firebase SDK 需要下载
   - 多个 CDN 可能会依次尝试

2. **同步不是即时的**
   - 保存后等待 5-10 秒
   - 刷新页面查看最新数据

3. **所有设备共享数据**
   - 使用固定的共享 ID：`shared-plan-web-user`
   - 不需要登录或注册

4. **数据安全**
   - 数据存储在 Google Firebase
   - 加密传输（HTTPS）
   - 本地+云端双重备份

---

## 🆘 需要帮助？

如果测试遇到问题，请提供：

1. **浏览器控制台完整日志**（截图或复制）
2. **顶部状态指示器的颜色**
3. **详细的操作步骤**
4. **网络环境**（家庭/公司/移动网络）

---

**祝测试顺利！** 🎉

预计测试时间：15-20 分钟

