# 📋 LeanCloud 数据恢复和跨设备同步测试指南

## 🎯 测试目标
验证以下功能：
1. ✅ **数据恢复**：删除浏览器数据后，重新打开网页能从 LeanCloud 恢复数据
2. ✅ **跨设备同步**：电脑保存数据后，手机打开网页能同步显示

---

## 📱 测试步骤

### 测试一：数据恢复功能（电脑端）

#### 准备阶段
1. **打开网页**
   ```
   https://你的用户名.github.io/plan-web-main/
   ```

2. **创建一些测试数据**
   - 在"今日Top 3"添加：`[ ] 测试任务1`
   - 在"日常习惯清单"添加：`[ ] 早起跑步`
   - 在"智能任务管理"添加：`[ ] 完成报告`

3. **等待同步完成**
   - 查看页面顶部状态指示器
   - 应该显示：**🟢 LeanCloud 已连接**
   - 控制台应该显示类似：`✅ 同步成功 (50ms)` 的消息

4. **验证数据已上传**
   - 打开浏览器控制台（F12）
   - 查找类似这样的日志：
     ```
     ✅ 同步成功 (50ms) - 键: day_top3
     ✅ 同步成功 (50ms) - 键: day_must_dos
     ✅ 同步成功 (50ms) - 键: day_todos
     ```

#### 删除浏览器数据
5. **清除浏览器数据**
   - **Chrome/Edge**：
     - 按 `Ctrl + Shift + Delete`（Windows）或 `Cmd + Shift + Delete`（Mac）
     - 选择"Cookie和其他网站数据"和"缓存的图片和文件"
     - 时间范围选择"全部时间"
     - 点击"清除数据"
   
   - **Safari**（Mac）：
     - 菜单栏 → Safari → 清除历史记录
     - 或者：设置 → 隐私 → 管理网站数据 → 移除全部

6. **关闭浏览器**
   - 完全退出浏览器（不只是关闭标签页）

#### 验证数据恢复
7. **重新打开浏览器**
   - 打开一个新的浏览器窗口
   - 访问网页：`https://你的用户名.github.io/plan-web-main/`

8. **打开控制台观察**
   - 按 `F12` 打开开发者工具
   - 切换到"Console"标签
   - 查看 LeanCloud 初始化日志

9. **等待自动恢复**
   - LeanCloud 会自动检测本地数据为空
   - 应该显示弹窗：**✅ 已从 LeanCloud 恢复 X 条数据！是否刷新页面查看？**
   - 点击"确定"刷新页面

10. **验证数据**
    - 检查之前创建的测试数据是否都回来了
    - "测试任务1"、"早起跑步"、"完成报告"应该都在

#### 手动恢复（备选方案）
如果自动恢复没有触发：
11. **点击"从云端恢复"按钮**
    - 在主页顶部找到"☁️ 从云端恢复"按钮
    - 点击它
    - 等待恢复完成
    - 刷新页面

---

### 测试二：跨设备同步功能（电脑 → 手机）

#### 在电脑端创建数据
1. **电脑打开网页**
   ```
   https://你的用户名.github.io/plan-web-main/
   ```

2. **创建新的测试数据**（使用独特的标识便于识别）
   - 在"今日Top 3"添加：`[ ] 📱 跨设备测试任务 - {当前时间}`
   - 例如：`[ ] 📱 跨设备测试任务 - 15:30`

3. **确认已同步**
   - 查看控制台日志
   - 应该看到：`✅ 同步成功 (50ms) - 键: day_top3`

#### 在手机端验证
4. **手机打开浏览器**
   - 使用 Safari（iOS）或 Chrome（Android）
   - 访问同一个网址：`https://你的用户名.github.io/plan-web-main/`

5. **等待 LeanCloud 初始化**
   - 手机页面顶部应该显示：**🟢 LeanCloud 已连接**
   - 如果显示"初始化中..."，等待几秒钟

6. **检查数据是否同步**
   - 滚动到"今日Top 3"区域
   - 应该能看到刚才在电脑上创建的任务：`📱 跨设备测试任务 - 15:30`

7. **在手机上修改数据**
   - 勾选刚才的任务（变成 `[x]`）
   - 或者添加新任务：`[ ] 🖥️ 手机端添加的任务`

8. **回到电脑端验证**
   - 刷新电脑上的网页
   - 应该能看到手机端的修改

---

### 测试三：实时同步延迟测试

1. **同时打开两个浏览器标签页**
   - 标签页A：`https://你的用户名.github.io/plan-web-main/`
   - 标签页B：同样的网址

2. **在标签页A创建任务**
   - 添加：`[ ] 实时同步测试`
   - 打开控制台，记录同步时间

3. **切换到标签页B**
   - 刷新页面
   - 检查新任务是否出现

4. **测量同步延迟**
   - 正常情况下，LeanCloud 同步延迟应该在 50-200ms 之间
   - 控制台会显示：`✅ 同步成功 (XXms)`

---

## ✅ 预期结果

### 成功标准
- ✅ 删除浏览器数据后，能自动/手动恢复所有数据
- ✅ 电脑端和手机端数据能双向同步
- ✅ 同步延迟在 200ms 以内（国内网络）
- ✅ 页面顶部显示"🟢 LeanCloud 已连接"
- ✅ 控制台无错误日志（404 错误是首次使用时正常的）

### 控制台日志示例
```javascript
// 成功的日志应该类似这样：
🚀 LeanCloud 初始化开始
🔧 应用ID: abc123...
🔧 应用Key: xyz789...
✅ LeanCloud 已初始化
ℹ️ 云端暂无数据（首次使用），这是正常的  // 首次使用
💡 开始创建计划后，数据会自动同步到云端

// 或者（有数据时）：
✅ 从云端恢复成功: day_top3
✅ 从云端恢复成功: day_must_dos
✅ 恢复了 10 条数据

// 同步时：
⬆️ 正在同步到 LeanCloud: day_top3
✅ 同步成功 (52ms) - 键: day_top3
```

---

## 🐛 常见问题排查

### 问题1：页面显示"🔴 仅本地存储"
**原因**：LeanCloud 未成功连接

**解决方案**：
1. 检查 `leancloud-config.js` 配置是否正确
2. 检查控制台是否有错误信息
3. 确认网络连接正常
4. 刷新页面重试

### 问题2：数据恢复弹窗没有出现
**原因**：可能已有本地数据或同步尚未完成

**解决方案**：
1. 使用"☁️ 从云端恢复"按钮手动恢复
2. 打开控制台检查是否有错误
3. 确认之前的数据已成功上传到云端

### 问题3：手机端看不到电脑端的数据
**原因**：可能需要手动刷新

**解决方案**：
1. 手机端下拉刷新页面
2. 检查手机端控制台日志（需使用浏览器的远程调试）
3. 确认电脑端数据已成功同步（查看控制台）

### 问题4：首次使用出现 404 错误
**状态**：这是正常的！

**说明**：
```
ℹ️ 云端暂无数据（首次使用），这是正常的
💡 开始创建计划后，数据会自动同步到云端
```
- 首次使用时，LeanCloud 数据表还不存在
- 创建第一个计划后，系统会自动创建数据表
- 之后就能正常同步和恢复了

---

## 📊 性能基准

| 指标 | 预期值 | 说明 |
|------|--------|------|
| 同步延迟 | 50-200ms | 国内服务器，速度快 |
| 初始化时间 | 1-3秒 | LeanCloud SDK 加载和连接 |
| 数据恢复时间 | 200-500ms | 取决于数据量 |
| 连接成功率 | >99% | LeanCloud 国内服务器稳定 |

---

## 🎉 测试完成

如果以上所有测试都通过，说明：
- ✅ LeanCloud 云同步正常工作
- ✅ 数据恢复功能完善
- ✅ 跨设备同步稳定可靠
- ✅ 完全移除 Firebase 没有影响系统功能

---

## 📝 测试记录

**测试日期**：_____________

**测试结果**：
- [ ] 测试一：数据恢复功能 - ✅ 通过 / ❌ 未通过
- [ ] 测试二：跨设备同步功能 - ✅ 通过 / ❌ 未通过  
- [ ] 测试三：实时同步延迟测试 - ✅ 通过 / ❌ 未通过

**备注**：

