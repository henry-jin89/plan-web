<!-- åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨ç»„ä»¶ - å¯åœ¨ä»»ä½•é¡µé¢å¼•å…¥ -->
<div id="sync-status-indicator" style="background: rgba(76, 175, 80, 0.95); color: white; padding: 8px 16px; border-radius: 8px; margin-bottom: 16px; font-size: 0.9em; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <span id="sync-status-icon">ğŸŸ¢</span>
    <span id="sync-status-text">LeanCloud å·²è¿æ¥</span>
    <button onclick="testSync()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; cursor: pointer; margin-left: auto;">æµ‹è¯•åŒæ­¥</button>
</div>

<script>
// æµ‹è¯•åŒæ­¥åŠŸèƒ½
async function testSync() {
    const indicator = document.getElementById('sync-status-indicator');
    const icon = document.getElementById('sync-status-icon');
    const text = document.getElementById('sync-status-text');
    
    try {
        // æ˜¾ç¤ºæµ‹è¯•ä¸­çŠ¶æ€
        icon.textContent = 'ğŸ”„';
        text.textContent = 'æ­£åœ¨æµ‹è¯•åŒæ­¥...';
        indicator.style.background = 'rgba(33, 150, 243, 0.95)';
        
        if (window.leanCloudSync && window.leanCloudSync.isEnabled) {
            // å…ˆä¸Šä¼ æœ¬åœ°æ•°æ®
            await window.leanCloudSync.syncToCloud();
            
            // å†æ£€æŸ¥äº‘ç«¯æ›´æ–°
            await window.leanCloudSync.checkAndPullUpdates();
            
            // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
            icon.textContent = 'âœ…';
            text.textContent = 'åŒæ­¥æµ‹è¯•æˆåŠŸï¼';
            indicator.style.background = 'rgba(76, 175, 80, 0.95)';
            
            // 3ç§’åæ¢å¤æ­£å¸¸çŠ¶æ€
            setTimeout(() => {
                icon.textContent = 'ğŸŸ¢';
                text.textContent = 'LeanCloud å·²è¿æ¥';
            }, 3000);
            
        } else {
            throw new Error('åŒæ­¥æœåŠ¡æœªå¯ç”¨');
        }
        
    } catch (error) {
        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        icon.textContent = 'âŒ';
        text.textContent = 'åŒæ­¥æµ‹è¯•å¤±è´¥: ' + error.message;
        indicator.style.background = 'rgba(244, 67, 54, 0.95)';
        
        // 5ç§’åæ¢å¤æ­£å¸¸çŠ¶æ€
        setTimeout(() => {
            icon.textContent = 'ğŸŸ¢';
            text.textContent = 'LeanCloud å·²è¿æ¥';
            indicator.style.background = 'rgba(76, 175, 80, 0.95)';
        }, 5000);
    }
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥åŒæ­¥çŠ¶æ€
if (!window.syncStatusInitialized) {
    window.syncStatusInitialized = true;
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            const indicator = document.getElementById('sync-status-indicator');
            const icon = document.getElementById('sync-status-icon');
            const text = document.getElementById('sync-status-text');
            
            if (!indicator || !icon || !text) return;
            
            if (window.leanCloudSync) {
                if (window.leanCloudSync.isEnabled) {
                    icon.textContent = 'ğŸŸ¢';
                    text.textContent = 'LeanCloud å·²è¿æ¥';
                    indicator.style.background = 'rgba(76, 175, 80, 0.95)';
                } else {
                    icon.textContent = 'âš ï¸';
                    text.textContent = 'LeanCloud æœªå¯ç”¨';
                    indicator.style.background = 'rgba(255, 152, 0, 0.95)';
                }
            } else {
                icon.textContent = 'âŒ';
                text.textContent = 'LeanCloud æœªåŠ è½½';
                indicator.style.background = 'rgba(244, 67, 54, 0.95)';
            }
        }, 2000);
    });
}
</script>

<style>
/* ç¡®ä¿åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨å§‹ç»ˆå¯è§ */
#sync-status-indicator {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
}
</style>
