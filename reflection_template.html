<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <script src="config.js"></script>
    
    <!-- Firebaseé…ç½® -->
    <script src="firebase-config.js"></script>
    
    <!-- åŒæ­¥ä¿®å¤å·¥å…· -->
    <script src="sync-fix.js"></script>
    
    <!-- Firebaseæ•°æ®åº“åŒæ­¥ -->
    <script src="firebase-database-sync.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºèƒ½åæ€æ¨¡æ¿ - ä¸ªäººæˆé•¿ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .reflection-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .reflection-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--theme-color);
            transition: all 0.3s ease;
        }

        .reflection-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .reflection-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .reflection-icon {
            font-size: 2em;
            background: linear-gradient(135deg, var(--theme-color), #42a5f5);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .reflection-title {
            font-size: 1.4em;
            font-weight: 600;
            color: var(--theme-color);
            margin: 0;
        }

        .reflection-subtitle {
            font-size: 0.9em;
            color: #666;
            margin: 4px 0 0 0;
        }

        .reflection-textarea {
            width: 100%;
            min-height: 120px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .reflection-textarea:focus {
            outline: none;
            border-color: var(--theme-color);
            box-shadow: 0 0 0 3px rgba(25,118,210,0.1);
        }

        .reflection-textarea::placeholder {
            color: #999;
            line-height: 1.6;
        }

        .template-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .template-btn {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.85em;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .template-btn:hover {
            background: linear-gradient(135deg, var(--theme-color-light), #bbdefb);
            color: var(--theme-color);
            transform: translateY(-1px);
        }

        .template-btn.active {
            background: linear-gradient(135deg, var(--theme-color), #1565c0);
            color: white;
            border-color: var(--theme-color);
        }

        .smart-suggestions {
            background: linear-gradient(135deg, #f3e5f5, #e8eaf6);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            border: 1px solid #e1bee7;
        }

        .suggestion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            color: #5e35b1;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-item:hover {
            background: rgba(255,255,255,0.5);
            border-radius: 4px;
            padding-left: 4px;
        }

        .progress-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .progress-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .progress-number {
            font-size: 2em;
            font-weight: 700;
            color: var(--theme-color);
            margin-bottom: 4px;
        }

        .progress-label {
            font-size: 0.85em;
            color: #666;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e0e0e0;
        }

        .action-btn {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: var(--theme-color);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, var(--theme-color), #1565c0);
            color: white;
            transform: translateY(-1px);
        }

        .mood-tracker {
            display: flex;
            justify-content: space-between;
            margin: 16px 0;
        }

        .mood-item {
            text-align: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
            margin: 0 2px;
        }

        .mood-item:hover {
            background: rgba(25,118,210,0.1);
        }

        .mood-item.selected {
            background: linear-gradient(135deg, var(--theme-color), #1565c0);
            color: white;
        }

        .mood-emoji {
            font-size: 2em;
            display: block;
            margin-bottom: 4px;
        }

        .mood-label {
            font-size: 0.8em;
        }

        .insights-panel {
            background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            border-left: 4px solid #4caf50;
        }

        .insights-title {
            color: #2e7d32;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-item {
            background: rgba(255,255,255,0.7);
            border-radius: 6px;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: #2e7d32;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <a href="day_plan.html" class="back-to-home">â† è¿”å›æ—¥è®¡åˆ’</a>
            <h1 class="page-title">ğŸ§  æ™ºèƒ½åæ€æ¨¡æ¿</h1>
            <div style="display: flex; gap: 8px;">
                <button type="button" id="save-reflection-btn" class="btn-main">ğŸ’¾ ä¿å­˜åæ€</button>
                <button type="button" id="export-reflection-btn" class="btn-main">ğŸ“¤ å¯¼å‡º</button>
            </div>
        </div>

        <div class="reflection-container">
            <!-- æ—¥æœŸå’Œå¿ƒæƒ…è®°å½• -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">ğŸ“…</span>
                    <div>
                        <h3 class="reflection-title">ä»Šæ—¥æ¦‚è§ˆ</h3>
                        <p class="reflection-subtitle">è®°å½•æ—¥æœŸå’Œæ•´ä½“å¿ƒæƒ…çŠ¶æ€</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 16px; align-items: center; margin-bottom: 16px;">
                    <label style="font-weight: 500;">åæ€æ—¥æœŸï¼š</label>
                    <input type="date" id="reflection-date" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                    <label style="font-weight: 500;">æ˜ŸæœŸï¼š</label>
                    <span id="reflection-weekday" style="color: var(--theme-color); font-weight: 600;"></span>
                </div>

                <div style="margin-bottom: 12px;">
                    <label style="font-weight: 500; margin-bottom: 8px; display: block;">ä»Šæ—¥å¿ƒæƒ…ï¼š</label>
                    <div class="mood-tracker">
                        <div class="mood-item" data-mood="terrible">
                            <span class="mood-emoji">ğŸ˜¢</span>
                            <span class="mood-label">å¾ˆç³Ÿç³•</span>
                        </div>
                        <div class="mood-item" data-mood="bad">
                            <span class="mood-emoji">ğŸ˜•</span>
                            <span class="mood-label">ä¸å¤ªå¥½</span>
                        </div>
                        <div class="mood-item" data-mood="neutral">
                            <span class="mood-emoji">ğŸ˜</span>
                            <span class="mood-label">ä¸€èˆ¬</span>
                        </div>
                        <div class="mood-item" data-mood="good">
                            <span class="mood-emoji">ğŸ˜Š</span>
                            <span class="mood-label">ä¸é”™</span>
                        </div>
                        <div class="mood-item" data-mood="excellent">
                            <span class="mood-emoji">ğŸ˜„</span>
                            <span class="mood-label">éå¸¸æ£’</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä»Šæ—¥æˆå°± -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">ğŸ†</span>
                    <div>
                        <h3 class="reflection-title">ä»Šæ—¥æˆå°±</h3>
                        <p class="reflection-subtitle">è®°å½•å®Œæˆçš„ä»»åŠ¡å’Œå–å¾—çš„æˆæœ</p>
                    </div>
                </div>

                <div class="template-selector">
                    <button class="template-btn" onclick="addReflectionTemplate('achievements', 'âœ… å®Œæˆäº†é‡è¦çš„å·¥ä½œé¡¹ç›®')">å·¥ä½œæˆå°±</button>
                    <button class="template-btn" onclick="addReflectionTemplate('achievements', 'ğŸ“š å­¦ä¹ äº†æ–°çš„çŸ¥è¯†æŠ€èƒ½')">å­¦ä¹ æˆé•¿</button>
                    <button class="template-btn" onclick="addReflectionTemplate('achievements', 'ğŸ’ª åšæŒäº†å¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯')">å¥åº·ä¹ æƒ¯</button>
                    <button class="template-btn" onclick="addReflectionTemplate('achievements', 'ğŸ‘¥ æ”¹å–„äº†äººé™…å…³ç³»')">äººé™…äº¤å¾€</button>
                    <button class="template-btn" onclick="addReflectionTemplate('achievements', 'ğŸ¯ è¾¾æˆäº†è®¾å®šçš„ç›®æ ‡')">ç›®æ ‡è¾¾æˆ</button>
                </div>

                <textarea id="achievements-textarea" class="reflection-textarea" 
                    placeholder="ä»Šå¤©å®Œæˆäº†å“ªäº›é‡è¦çš„äº‹æƒ…ï¼Ÿå–å¾—äº†ä»€ä¹ˆæˆæœï¼Ÿ

ä¾‹å¦‚ï¼š
âœ… å®Œæˆäº†é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½å¼€å‘
âœ… å­¦ä¹ äº†æ–°çš„ç¼–ç¨‹æŠ€èƒ½
âœ… åšæŒè¿åŠ¨30åˆ†é’Ÿ
âœ… ä¸åŒäº‹å»ºç«‹äº†æ›´å¥½çš„åˆä½œå…³ç³»
âœ… è§£å†³äº†ä¸€ä¸ªå›°æ‰°å·²ä¹…çš„é—®é¢˜"></textarea>

                <div class="action-buttons">
                    <button class="action-btn" onclick="addReflectionTemplate('achievements', 'â€¢ ')">æ·»åŠ é¡¹ç›®</button>
                    <button class="action-btn" onclick="formatList('achievements-textarea')">æ ¼å¼åŒ–åˆ—è¡¨</button>
                    <button class="action-btn" onclick="countAchievements()">ç»Ÿè®¡æˆå°±</button>
                </div>
            </div>

            <!-- é‡åˆ°çš„æŒ‘æˆ˜ -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">âš¡</span>
                    <div>
                        <h3 class="reflection-title">æŒ‘æˆ˜ä¸å›°éš¾</h3>
                        <p class="reflection-subtitle">è®°å½•é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</p>
                    </div>
                </div>

                <div class="template-selector">
                    <button class="template-btn" onclick="addReflectionTemplate('challenges', 'âŒ é—®é¢˜ï¼š\nğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š\nğŸ“ æ”¶è·ï¼š')">é—®é¢˜è§£å†³</button>
                    <button class="template-btn" onclick="addReflectionTemplate('challenges', 'â° æ—¶é—´ç®¡ç†æŒ‘æˆ˜')">æ—¶é—´ç®¡ç†</button>
                    <button class="template-btn" onclick="addReflectionTemplate('challenges', 'ğŸ¤ æ²Ÿé€šåä½œå›°éš¾')">æ²Ÿé€šåä½œ</button>
                    <button class="template-btn" onclick="addReflectionTemplate('challenges', 'ğŸ§  æŠ€èƒ½å­¦ä¹ éšœç¢')">æŠ€èƒ½å­¦ä¹ </button>
                </div>

                <textarea id="challenges-textarea" class="reflection-textarea" 
                    placeholder="ä»Šå¤©é‡åˆ°äº†ä»€ä¹ˆæŒ‘æˆ˜ï¼Ÿæ˜¯å¦‚ä½•åº”å¯¹çš„ï¼Ÿ

ä¾‹å¦‚ï¼š
âŒ é—®é¢˜ï¼šé¡¹ç›®è¿›åº¦è½åäºé¢„æœŸ
ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šé‡æ–°è¯„ä¼°ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œå¯»æ±‚å›¢é˜Ÿæ”¯æŒ
ğŸ“ æ”¶è·ï¼šå­¦ä¼šäº†æ›´å¥½çš„é¡¹ç›®æ—¶é—´ä¼°ç®—

âŒ é—®é¢˜ï¼šæ–°æŠ€æœ¯å­¦ä¹ å›°éš¾
ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼šåˆ†è§£å­¦ä¹ ç›®æ ‡ï¼Œå¯»æ‰¾æ›´å¥½çš„æ•™ç¨‹
ğŸ“ æ”¶è·ï¼šæ‰¾åˆ°äº†é€‚åˆè‡ªå·±çš„å­¦ä¹ æ–¹æ³•"></textarea>

                <div class="action-buttons">
                    <button class="action-btn" onclick="addProblemTemplate()">æ·»åŠ é—®é¢˜æ¨¡æ¿</button>
                    <button class="action-btn" onclick="analyzeChallenges()">åˆ†ææ¨¡å¼</button>
                </div>
            </div>

            <!-- å­¦ä¹ ä¸æˆé•¿ -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">ğŸŒ±</span>
                    <div>
                        <h3 class="reflection-title">å­¦ä¹ ä¸æˆé•¿</h3>
                        <p class="reflection-subtitle">è®°å½•æ–°çš„çŸ¥è¯†ã€æŠ€èƒ½å’Œå¿ƒå¾—ä½“ä¼š</p>
                    </div>
                </div>

                <div class="template-selector">
                    <button class="template-btn" onclick="addReflectionTemplate('learning', 'ğŸ“– æ–°çŸ¥è¯†ï¼š')">æ–°çŸ¥è¯†</button>
                    <button class="template-btn" onclick="addReflectionTemplate('learning', 'ğŸ› ï¸ æ–°æŠ€èƒ½ï¼š')">æ–°æŠ€èƒ½</button>
                    <button class="template-btn" onclick="addReflectionTemplate('learning', 'ğŸ’­ æ–°æ€è€ƒï¼š')">æ–°æ€è€ƒ</button>
                    <button class="template-btn" onclick="addReflectionTemplate('learning', 'ğŸ” æ–°å‘ç°ï¼š')">æ–°å‘ç°</button>
                </div>

                <textarea id="learning-textarea" class="reflection-textarea" 
                    placeholder="ä»Šå¤©å­¦åˆ°äº†ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Ÿæœ‰ä»€ä¹ˆæ–°çš„ç†è§£å’Œæ„Ÿæ‚Ÿï¼Ÿ

ä¾‹å¦‚ï¼š
ğŸ“– æ–°çŸ¥è¯†ï¼šäº†è§£äº†React Hooksçš„å·¥ä½œåŸç†
ğŸ› ï¸ æ–°æŠ€èƒ½ï¼šæŒæ¡äº†CSS Gridå¸ƒå±€æŠ€å·§  
ğŸ’­ æ–°æ€è€ƒï¼šæ„è¯†åˆ°ä»£ç å¯è¯»æ€§æ¯”æ€§èƒ½ä¼˜åŒ–æ›´é‡è¦
ğŸ” æ–°å‘ç°ï¼šå‘ç°äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å¼€å‘å·¥å…·"></textarea>

                <div class="action-buttons">
                    <button class="action-btn" onclick="addLearningGoal()">è®¾ç½®å­¦ä¹ ç›®æ ‡</button>
                    <button class="action-btn" onclick="reviewLearningProgress()">å­¦ä¹ è¿›åº¦</button>
                </div>
            </div>

            <!-- æƒ…ç»ªä¸æ„Ÿå— -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">ğŸ’</span>
                    <div>
                        <h3 class="reflection-title">æƒ…ç»ªä¸æ„Ÿå—</h3>
                        <p class="reflection-subtitle">è®°å½•å†…å¿ƒçš„æ„Ÿå—å’Œæƒ…ç»ªå˜åŒ–</p>
                    </div>
                </div>

                <div class="template-selector">
                    <button class="template-btn" onclick="addReflectionTemplate('emotions', 'ğŸ˜Š å¼€å¿ƒçš„äº‹ï¼š')">å¼€å¿ƒ</button>
                    <button class="template-btn" onclick="addReflectionTemplate('emotions', 'ğŸ˜° ç„¦è™‘çš„äº‹ï¼š')">ç„¦è™‘</button>
                    <button class="template-btn" onclick="addReflectionTemplate('emotions', 'ğŸ˜¤ æ„¤æ€’çš„äº‹ï¼š')">æ„¤æ€’</button>
                    <button class="template-btn" onclick="addReflectionTemplate('emotions', 'ğŸ˜¢ éš¾è¿‡çš„äº‹ï¼š')">éš¾è¿‡</button>
                    <button class="template-btn" onclick="addReflectionTemplate('emotions', 'ğŸ™ æ„Ÿæ¿€çš„äº‹ï¼š')">æ„Ÿæ¿€</button>
                </div>

                <textarea id="emotions-textarea" class="reflection-textarea" 
                    placeholder="ä»Šå¤©çš„æƒ…ç»ªå¦‚ä½•ï¼Ÿä»€ä¹ˆäº‹æƒ…å½±å“äº†ä½ çš„å¿ƒæƒ…ï¼Ÿ

ä¾‹å¦‚ï¼š
ğŸ˜Š å¼€å¿ƒçš„äº‹ï¼šé¡¹ç›®è·å¾—äº†å®¢æˆ·çš„å¥½è¯„
ğŸ˜° ç„¦è™‘çš„äº‹ï¼šæ‹…å¿ƒæ˜å¤©çš„é‡è¦ä¼šè®®  
ğŸ™ æ„Ÿæ¿€çš„äº‹ï¼šåŒäº‹ä¸»åŠ¨å¸®åŠ©è§£å†³äº†æŠ€æœ¯é—®é¢˜
ğŸ’ª è‡ªè±ªçš„äº‹ï¼šåšæŒäº†ä¸€å‘¨çš„æ—©èµ·ä¹ æƒ¯"></textarea>

                <div class="action-buttons">
                    <button class="action-btn" onclick="emotionAnalysis()">æƒ…ç»ªåˆ†æ</button>
                    <button class="action-btn" onclick="addGratitudeItem()">æ·»åŠ æ„Ÿæ¿€</button>
                </div>
            </div>

            <!-- æ˜æ—¥è®¡åˆ’ -->
            <div class="reflection-card">
                <div class="reflection-header">
                    <span class="reflection-icon">ğŸ¯</span>
                    <div>
                        <h3 class="reflection-title">æ˜æ—¥è®¡åˆ’</h3>
                        <p class="reflection-subtitle">åŸºäºä»Šæ—¥åæ€åˆ¶å®šæ˜å¤©çš„è¡ŒåŠ¨è®¡åˆ’</p>
                    </div>
                </div>

                <div class="template-selector">
                    <button class="template-btn" onclick="addReflectionTemplate('tomorrow', 'ğŸ¯ æ ¸å¿ƒç›®æ ‡ï¼š')">æ ¸å¿ƒç›®æ ‡</button>
                    <button class="template-btn" onclick="addReflectionTemplate('tomorrow', 'ğŸ“ é‡è¦ä»»åŠ¡ï¼š')">é‡è¦ä»»åŠ¡</button>
                    <button class="template-btn" onclick="addReflectionTemplate('tomorrow', 'ğŸ”„ æ”¹è¿›è®¡åˆ’ï¼š')">æ”¹è¿›è®¡åˆ’</button>
                    <button class="template-btn" onclick="addReflectionTemplate('tomorrow', 'â° æ—¶é—´å®‰æ’ï¼š')">æ—¶é—´å®‰æ’</button>
                </div>

                <textarea id="tomorrow-textarea" class="reflection-textarea" 
                    placeholder="åŸºäºä»Šå¤©çš„ç»éªŒï¼Œæ˜å¤©è¦åšä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆéœ€è¦æ”¹è¿›çš„ï¼Ÿ

ä¾‹å¦‚ï¼š
ğŸ¯ æ ¸å¿ƒç›®æ ‡ï¼šå®Œæˆé¡¹ç›®ç¬¬äºŒé˜¶æ®µå¼€å‘
ğŸ“ é‡è¦ä»»åŠ¡ï¼š
  â€¢ å®Œæˆç”¨æˆ·ç•Œé¢è®¾è®¡
  â€¢ å®ç°æ•°æ®åº“é›†æˆ
  â€¢ è¿›è¡Œå•å…ƒæµ‹è¯•
ğŸ”„ æ”¹è¿›è®¡åˆ’ï¼š
  â€¢ æ›´å¥½åœ°ä¼°ç®—ä»»åŠ¡æ—¶é—´
  â€¢ æå‰å‡†å¤‡ä¼šè®®èµ„æ–™
â° æ—¶é—´å®‰æ’ï¼šä¸Šåˆä¸“æ³¨å¼€å‘ï¼Œä¸‹åˆå¤„ç†æ²Ÿé€š"></textarea>

                <div class="action-buttons">
                    <button class="action-btn" onclick="prioritizeTasks()">ä¼˜å…ˆçº§æ’åº</button>
                    <button class="action-btn" onclick="createTimeblocks()">åˆ›å»ºæ—¶é—´å—</button>
                    <button class="action-btn" onclick="syncToDayPlan()">åŒæ­¥åˆ°æ—¥è®¡åˆ’</button>
                </div>
            </div>

            <!-- æ™ºèƒ½æ´å¯Ÿé¢æ¿ -->
            <div class="insights-panel">
                <div class="insights-title">
                    ğŸ§  æ™ºèƒ½æ´å¯Ÿåˆ†æ
                </div>
                <div id="insights-content">
                    <div class="insight-item">ğŸ’¡ æ ¹æ®åæ€å†…å®¹ï¼Œå»ºè®®æ˜å¤©é‡ç‚¹å…³æ³¨æ—¶é—´ç®¡ç†</div>
                    <div class="insight-item">ğŸ“Š æœ¬å‘¨æƒ…ç»ªæ³¢åŠ¨è¾ƒå¤§ï¼Œå»ºè®®å¢åŠ æ”¾æ¾æ—¶é—´</div>
                    <div class="insight-item">ğŸ¯ å­¦ä¹ è¿›åº¦è‰¯å¥½ï¼Œå¯ä»¥å°è¯•æ›´æœ‰æŒ‘æˆ˜æ€§çš„ç›®æ ‡</div>
                </div>
            </div>

            <!-- è¿›åº¦ç»Ÿè®¡ -->
            <div class="progress-indicators">
                <div class="progress-card">
                    <div class="progress-number" id="reflection-words">0</div>
                    <div class="progress-label">åæ€å­—æ•°</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="achievements-count">0</div>
                    <div class="progress-label">ä»Šæ—¥æˆå°±</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="challenges-count">0</div>
                    <div class="progress-label">è§£å†³é—®é¢˜</div>
                </div>
                <div class="progress-card">
                    <div class="progress-number" id="reflection-score">0</div>
                    <div class="progress-label">åæ€è¯„åˆ†</div>
                </div>
            </div>
        </div>
    </div>

    <script src="common.js"></script>
    <script>
        // åˆå§‹åŒ–åæ€æ¨¡æ¿
        document.addEventListener('DOMContentLoaded', function() {
            initReflectionTemplate();
        });

        function initReflectionTemplate() {
            // è®¾ç½®å½“å‰æ—¥æœŸ
            const today = new Date();
            const dateInput = document.getElementById('reflection-date');
            dateInput.value = today.toISOString().split('T')[0];
            updateWeekday();

            // ç»‘å®šäº‹ä»¶
            dateInput.addEventListener('change', updateWeekday);
            
            // å¿ƒæƒ…é€‰æ‹©å™¨
            const moodItems = document.querySelectorAll('.mood-item');
            moodItems.forEach(item => {
                item.addEventListener('click', function() {
                    moodItems.forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                    updateInsights();
                });
            });

            // æ–‡æœ¬ç»Ÿè®¡
            const textareas = document.querySelectorAll('.reflection-textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', updateStatistics);
            });

            // åŠ è½½ä¿å­˜çš„åæ€
            loadSavedReflection();
            
            // è‡ªåŠ¨ä¿å­˜
            setInterval(autoSave, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜
        }

        function updateWeekday() {
            const dateInput = document.getElementById('reflection-date');
            const weekdaySpan = document.getElementById('reflection-weekday');
            const date = new Date(dateInput.value);
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            weekdaySpan.textContent = weekdays[date.getDay()];
        }

        function addReflectionTemplate(targetId, template) {
            const textarea = document.getElementById(targetId + '-textarea');
            if (!textarea) return;

            const currentValue = textarea.value;
            const newValue = currentValue ? currentValue + '\n\n' + template : template;
            textarea.value = newValue;
            textarea.focus();
            
            // ç§»åŠ¨å…‰æ ‡åˆ°æœ«å°¾
            textarea.setSelectionRange(textarea.value.length, textarea.value.length);
            
            updateStatistics();
            MessageUtils.success('æ¨¡æ¿å·²æ·»åŠ ');
        }

        function addProblemTemplate() {
            const template = `âŒ é—®é¢˜ï¼š
ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
ğŸ“ æ”¶è·ï¼š
â­ ä¸‹æ¬¡æ”¹è¿›ï¼š`;
            addReflectionTemplate('challenges', template);
        }

        function addLearningGoal() {
            const goal = prompt('è¯·è¾“å…¥æ˜å¤©çš„å­¦ä¹ ç›®æ ‡ï¼š');
            if (goal) {
                addReflectionTemplate('tomorrow', `ğŸ“š å­¦ä¹ ç›®æ ‡ï¼š${goal}`);
            }
        }

        function addGratitudeItem() {
            const gratitude = prompt('ä»Šå¤©æœ‰ä»€ä¹ˆå€¼å¾—æ„Ÿæ¿€çš„äº‹æƒ…ï¼Ÿ');
            if (gratitude) {
                addReflectionTemplate('emotions', `ğŸ™ æ„Ÿæ¿€ï¼š${gratitude}`);
            }
        }

        function formatList(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (!textarea) return;

            let content = textarea.value;
            // å°†æ¯è¡Œè½¬æ¢ä¸ºåˆ—è¡¨é¡¹
            const lines = content.split('\n').filter(line => line.trim());
            const formattedLines = lines.map(line => {
                line = line.trim();
                if (!line.startsWith('â€¢') && !line.startsWith('-') && !line.startsWith('âœ…')) {
                    return 'â€¢ ' + line;
                }
                return line;
            });
            
            textarea.value = formattedLines.join('\n');
            updateStatistics();
            MessageUtils.success('åˆ—è¡¨æ ¼å¼åŒ–å®Œæˆ');
        }

        function countAchievements() {
            const textarea = document.getElementById('achievements-textarea');
            const content = textarea.value;
            const lines = content.split('\n').filter(line => 
                line.trim() && (line.includes('âœ…') || line.includes('â€¢'))
            );
            MessageUtils.info(`ä»Šæ—¥å…±è®°å½• ${lines.length} é¡¹æˆå°±`);
        }

        function updateStatistics() {
            // è®¡ç®—æ€»å­—æ•°
            const textareas = document.querySelectorAll('.reflection-textarea');
            let totalWords = 0;
            textareas.forEach(textarea => {
                totalWords += textarea.value.length;
            });
            document.getElementById('reflection-words').textContent = totalWords;

            // è®¡ç®—æˆå°±æ•°é‡
            const achievementsContent = document.getElementById('achievements-textarea').value;
            const achievementsCount = (achievementsContent.match(/[âœ…â€¢-]/g) || []).length;
            document.getElementById('achievements-count').textContent = achievementsCount;

            // è®¡ç®—æŒ‘æˆ˜æ•°é‡
            const challengesContent = document.getElementById('challenges-textarea').value;
            const challengesCount = (challengesContent.match(/[âŒâš¡ğŸ’¡]/g) || []).length;
            document.getElementById('challenges-count').textContent = challengesCount;

            // è®¡ç®—åæ€è¯„åˆ†
            const score = Math.min(100, Math.floor((totalWords / 500) * 100));
            document.getElementById('reflection-score').textContent = score;
        }

        function updateInsights() {
            const selectedMood = document.querySelector('.mood-item.selected');
            const insights = document.getElementById('insights-content');
            
            if (!selectedMood) return;

            const mood = selectedMood.dataset.mood;
            let insightText = '';
            
            switch(mood) {
                case 'excellent':
                    insightText = 'ğŸŒŸ ä»Šå¤©çŠ¶æ€å¾ˆå¥½ï¼å»ºè®®å°†è¿™ç§ç§¯æçŠ¶æ€çš„ç§˜è¯€è®°å½•ä¸‹æ¥';
                    break;
                case 'good':
                    insightText = 'ğŸ˜Š ä¸é”™çš„ä¸€å¤©ï¼å¯ä»¥æ€è€ƒå¦‚ä½•è®©æ˜å¤©æ›´ä¸Šä¸€å±‚æ¥¼';
                    break;
                case 'neutral':
                    insightText = 'ğŸ’­ å¹³å¸¸çš„ä¸€å¤©ï¼Œè€ƒè™‘å¢åŠ ä¸€äº›è®©è‡ªå·±å…´å¥‹çš„æ´»åŠ¨';
                    break;
                case 'bad':
                    insightText = 'ğŸ’ª ä»Šå¤©æœ‰äº›æŒ‘æˆ˜ï¼Œé‡ç‚¹å…³æ³¨è§£å†³æ–¹æ¡ˆå’Œå­¦ä¹ æˆé•¿';
                    break;
                case 'terrible':
                    insightText = 'ğŸ¤— è‰°éš¾çš„ä¸€å¤©ï¼Œè®°å¾—å…³çˆ±è‡ªå·±ï¼Œæ˜å¤©ä¼šæ›´å¥½';
                    break;
            }
            
            insights.innerHTML = `<div class="insight-item">ğŸ’¡ ${insightText}</div>`;
        }

        function prioritizeTasks() {
            const tomorrow = document.getElementById('tomorrow-textarea');
            const content = tomorrow.value;
            
            if (!content.trim()) {
                MessageUtils.warning('è¯·å…ˆæ·»åŠ æ˜æ—¥è®¡åˆ’å†…å®¹');
                return;
            }
            
            const template = `
ğŸ”¥ æœ€é‡è¦ï¼ˆå¿…é¡»å®Œæˆï¼‰ï¼š

âš ï¸ é‡è¦ï¼ˆåº”è¯¥å®Œæˆï¼‰ï¼š

ğŸ’¡ ä¸€èˆ¬ï¼ˆæœ‰æ—¶é—´å†åšï¼‰ï¼š`;
            
            tomorrow.value = content + '\n\n=== ä¼˜å…ˆçº§æ’åº ===' + template;
            tomorrow.focus();
            MessageUtils.success('å·²æ·»åŠ ä¼˜å…ˆçº§æ¨¡æ¿');
        }

        function createTimeblocks() {
            const template = `
â° æ—¶é—´å—å®‰æ’ï¼š
09:00-10:30 ğŸ¯ [é«˜ä¼˜å…ˆçº§ä»»åŠ¡]
10:30-10:45 â˜• [ä¼‘æ¯]
10:45-12:00 ğŸ“ [ä¸­ä¼˜å…ˆçº§ä»»åŠ¡]
12:00-13:00 ğŸ½ï¸ [åˆé¤]
13:00-14:30 ğŸ’­ [ä½èƒ½é‡ä»»åŠ¡]
14:30-16:00 ğŸ”„ [å›é¡¾æ•´ç†]`;
            
            addReflectionTemplate('tomorrow', template);
        }

        function syncToDayPlan() {
            if (confirm('æ˜¯å¦å°†æ˜æ—¥è®¡åˆ’åŒæ­¥åˆ°æ—¥è®¡åˆ’ç³»ç»Ÿï¼Ÿ')) {
                const tomorrow = document.getElementById('tomorrow-textarea').value;
                localStorage.setItem('reflection_to_dayplan', tomorrow);
                MessageUtils.success('è®¡åˆ’å·²å‡†å¤‡åŒæ­¥ï¼Œè¯·å‰å¾€æ—¥è®¡åˆ’é¡µé¢æŸ¥çœ‹');
            }
        }

        function autoSave() {
            const reflectionData = gatherReflectionData();
            const date = document.getElementById('reflection-date').value;
            localStorage.setItem(`reflection_${date}`, JSON.stringify(reflectionData));
        }

        function loadSavedReflection() {
            const date = document.getElementById('reflection-date').value;
            const saved = localStorage.getItem(`reflection_${date}`);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    document.getElementById('achievements-textarea').value = data.achievements || '';
                    document.getElementById('challenges-textarea').value = data.challenges || '';
                    document.getElementById('learning-textarea').value = data.learning || '';
                    document.getElementById('emotions-textarea').value = data.emotions || '';
                    document.getElementById('tomorrow-textarea').value = data.tomorrow || '';
                    
                    if (data.mood) {
                        const moodItem = document.querySelector(`[data-mood="${data.mood}"]`);
                        if (moodItem) {
                            moodItem.click();
                        }
                    }
                    
                    updateStatistics();
                } catch (error) {
                    console.error('åŠ è½½åæ€æ•°æ®å¤±è´¥:', error);
                }
            }
        }

        function gatherReflectionData() {
            const selectedMood = document.querySelector('.mood-item.selected');
            
            return {
                date: document.getElementById('reflection-date').value,
                mood: selectedMood ? selectedMood.dataset.mood : null,
                achievements: document.getElementById('achievements-textarea').value,
                challenges: document.getElementById('challenges-textarea').value,
                learning: document.getElementById('learning-textarea').value,
                emotions: document.getElementById('emotions-textarea').value,
                tomorrow: document.getElementById('tomorrow-textarea').value,
                timestamp: new Date().toISOString()
            };
        }

        // ä¿å­˜æŒ‰é’®
        document.getElementById('save-reflection-btn')?.addEventListener('click', function() {
            const reflectionData = gatherReflectionData();
            const date = reflectionData.date;
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem(`reflection_${date}`, JSON.stringify(reflectionData));
            
            // åŒæ—¶ä¿å­˜åˆ°å†å²è®°å½•
            const history = JSON.parse(localStorage.getItem('reflection_history') || '[]');
            const existingIndex = history.findIndex(item => item.date === date);
            
            if (existingIndex >= 0) {
                history[existingIndex] = reflectionData;
            } else {
                history.unshift(reflectionData);
            }
            
            // åªä¿ç•™æœ€è¿‘30å¤©çš„è®°å½•
            history.splice(30);
            localStorage.setItem('reflection_history', JSON.stringify(history));
            
            MessageUtils.success('åæ€è®°å½•ä¿å­˜æˆåŠŸï¼');
        });

        // å¯¼å‡ºæŒ‰é’®
        document.getElementById('export-reflection-btn')?.addEventListener('click', function() {
            const reflectionData = gatherReflectionData();
            const content = `# ${reflectionData.date} åæ€è®°å½•

## ä»Šæ—¥æˆå°±
${reflectionData.achievements}

## æŒ‘æˆ˜ä¸å›°éš¾  
${reflectionData.challenges}

## å­¦ä¹ ä¸æˆé•¿
${reflectionData.learning}

## æƒ…ç»ªä¸æ„Ÿå—
${reflectionData.emotions}

## æ˜æ—¥è®¡åˆ’
${reflectionData.tomorrow}

---
è®°å½•æ—¶é—´ï¼š${new Date(reflectionData.timestamp).toLocaleString()}`;

            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `reflection_${reflectionData.date}.md`;
            a.click();
            URL.revokeObjectURL(url);
            
            MessageUtils.success('åæ€è®°å½•å·²å¯¼å‡ºï¼');
        });

        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        document.getElementById('save-reflection-btn').click();
                        break;
                    case 'e':
                        e.preventDefault();
                        document.getElementById('export-reflection-btn').click();
                        break;
                }
            }
        });
    </script>
    <!-- åŒæ­¥æœåŠ¡ -->
    <script src="sync-service.js"></script>
    <script src="sync-providers.js"></script>
    <!-- é€šç”¨è‡ªåŠ¨åŒæ­¥åŠŸèƒ½ -->
    <script src="universal-auto-sync.js"></script>
</body>

</html>

